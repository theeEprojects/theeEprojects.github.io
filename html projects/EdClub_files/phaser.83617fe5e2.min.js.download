/*! For license information please see phaser.83617fe5e2.min.js.LICENSE */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[5],{985:function(t,e,i){(function(e){t.exports=e["PIXI"]=i(986)}).call(this,i(14))},986:function(t,e,i){(function(){var i=this;var s=s||{};s.game=null;s.WEBGL_RENDERER=0;s.CANVAS_RENDERER=1;s.VERSION="v2.2.9";s._UID=0;if(typeof Float32Array!="undefined"){s.Float32Array=Float32Array;s.Uint16Array=Uint16Array;s.Uint32Array=Uint32Array;s.ArrayBuffer=ArrayBuffer}else{s.Float32Array=Array;s.Uint16Array=Array}s.PI_2=Math.PI*2;s.RAD_TO_DEG=180/Math.PI;s.DEG_TO_RAD=Math.PI/180;s.RETINA_PREFIX="@2x";s.DisplayObject=function(){this.position=new s.Point(0,0);this.scale=new s.Point(1,1);this.pivot=new s.Point(0,0);this.rotation=0;this.alpha=1;this.visible=true;this.hitArea=null;this.renderable=false;this.parent=null;this.worldAlpha=1;this.worldTransform=new s.Matrix;this.worldPosition=new s.Point(0,0);this.worldScale=new s.Point(1,1);this.worldRotation=0;this.filterArea=null;this._sr=0;this._cr=1;this._bounds=new s.Rectangle(0,0,0,0);this._currentBounds=null;this._mask=null;this._cacheAsBitmap=false;this._cacheIsDirty=false};s.DisplayObject.prototype.constructor=s.DisplayObject;s.DisplayObject.prototype={destroy:function(){if(this.children){var t=this.children.length;while(t--){this.children[t].destroy()}this.children=[]}this.hitArea=null;this.parent=null;this.worldTransform=null;this.filterArea=null;this.renderable=false;this._bounds=null;this._currentBounds=null;this._mask=null;this._destroyCachedSprite()},updateTransform:function(t){if(!t&&!this.parent&&!this.game){return this}var e=this.parent;if(t){e=t}else if(!this.parent){e=this.game.world}var i=e.worldTransform;var r=this.worldTransform;var n,a,o,h,l,u;if(this.rotation%s.PI_2){if(this.rotation!==this.rotationCache){this.rotationCache=this.rotation;this._sr=Math.sin(this.rotation);this._cr=Math.cos(this.rotation)}n=this._cr*this.scale.x;a=this._sr*this.scale.x;o=-this._sr*this.scale.y;h=this._cr*this.scale.y;l=this.position.x;u=this.position.y;if(this.pivot.x||this.pivot.y){l-=this.pivot.x*n+this.pivot.y*o;u-=this.pivot.x*a+this.pivot.y*h}r.a=n*i.a+a*i.c;r.b=n*i.b+a*i.d;r.c=o*i.a+h*i.c;r.d=o*i.b+h*i.d;r.tx=l*i.a+u*i.c+i.tx;r.ty=l*i.b+u*i.d+i.ty}else{n=this.scale.x;h=this.scale.y;l=this.position.x-this.pivot.x*n;u=this.position.y-this.pivot.y*h;r.a=n*i.a;r.b=n*i.b;r.c=h*i.c;r.d=h*i.d;r.tx=l*i.a+u*i.c+i.tx;r.ty=l*i.b+u*i.d+i.ty}this.worldAlpha=this.alpha*e.worldAlpha;this.worldPosition.set(r.tx,r.ty);this.worldScale.set(this.scale.x*Math.sqrt(r.a*r.a+r.c*r.c),this.scale.y*Math.sqrt(r.b*r.b+r.d*r.d));this.worldRotation=Math.atan2(-r.c,r.d);this._currentBounds=null;if(this.transformCallback){this.transformCallback.call(this.transformCallbackContext,r,i)}return this},preUpdate:function(){},generateTexture:function(t,e,i){var r=this.getLocalBounds();var n=new s.RenderTexture(r.width|0,r.height|0,i,e,t);s.DisplayObject._tempMatrix.tx=-r.x;s.DisplayObject._tempMatrix.ty=-r.y;n.render(this,s.DisplayObject._tempMatrix);return n},updateCache:function(){this._generateCachedSprite();return this},toGlobal:function(t){this.updateTransform();return this.worldTransform.apply(t)},toLocal:function(t,e){if(e){t=e.toGlobal(t)}this.updateTransform();return this.worldTransform.applyInverse(t)},_renderCachedSprite:function(t){this._cachedSprite.worldAlpha=this.worldAlpha;if(t.gl){s.Sprite.prototype._renderWebGL.call(this._cachedSprite,t)}else{s.Sprite.prototype._renderCanvas.call(this._cachedSprite,t)}},_generateCachedSprite:function(){this._cacheAsBitmap=false;var t=this.getLocalBounds();t.width=Math.max(1,Math.ceil(t.width));t.height=Math.max(1,Math.ceil(t.height));this.updateTransform();if(!this._cachedSprite){var e=new s.RenderTexture(t.width,t.height);this._cachedSprite=new s.Sprite(e);this._cachedSprite.worldTransform=this.worldTransform}else{this._cachedSprite.texture.resize(t.width,t.height)}var i=this._filters;this._filters=null;this._cachedSprite.filters=i;s.DisplayObject._tempMatrix.tx=-t.x;s.DisplayObject._tempMatrix.ty=-t.y;this._cachedSprite.texture.render(this,s.DisplayObject._tempMatrix,true);this._cachedSprite.anchor.x=-(t.x/t.width);this._cachedSprite.anchor.y=-(t.y/t.height);this._filters=i;this._cacheAsBitmap=true},_destroyCachedSprite:function(){if(!this._cachedSprite){return}this._cachedSprite.texture.destroy(true);this._cachedSprite=null}};s.DisplayObject.prototype.displayObjectUpdateTransform=s.DisplayObject.prototype.updateTransform;Object.defineProperties(s.DisplayObject.prototype,{x:{get:function(){return this.position.x},set:function(t){this.position.x=t}},y:{get:function(){return this.position.y},set:function(t){this.position.y=t}},worldVisible:{get:function(){if(!this.visible){return false}else{var t=this.parent;if(!t){return this.visible}else{do{if(!t.visible){return false}t=t.parent}while(t)}return true}}},mask:{get:function(){return this._mask},set:function(t){if(this._mask){this._mask.isMask=false}this._mask=t;if(t){this._mask.isMask=true}}},filters:{get:function(){return this._filters},set:function(t){if(Array.isArray(t)){var e=[];for(var i=0;i<t.length;i++){var r=t[i].passes;for(var n=0;n<r.length;n++){e.push(r[n])}}this._filterBlock={target:this,filterPasses:e}}this._filters=t;if(this.blendMode&&this.blendMode===s.blendModes.MULTIPLY){this.blendMode=s.blendModes.NORMAL}}},cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(t){if(this._cacheAsBitmap===t){return}if(t){this._generateCachedSprite()}else{this._destroyCachedSprite()}this._cacheAsBitmap=t}}});s.DisplayObjectContainer=function(){s.DisplayObject.call(this);this.children=[];this.ignoreChildInput=false};s.DisplayObjectContainer.prototype=Object.create(s.DisplayObject.prototype);s.DisplayObjectContainer.prototype.constructor=s.DisplayObjectContainer;s.DisplayObjectContainer.prototype.addChild=function(t){return this.addChildAt(t,this.children.length)};s.DisplayObjectContainer.prototype.addChildAt=function(t,e){if(e>=0&&e<=this.children.length){if(t.parent){t.parent.removeChild(t)}t.parent=this;this.children.splice(e,0,t);return t}else{throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length)}};s.DisplayObjectContainer.prototype.swapChildren=function(t,e){if(t===e){return}var i=this.getChildIndex(t);var s=this.getChildIndex(e);if(i<0||s<0){throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.")}this.children[i]=e;this.children[s]=t};s.DisplayObjectContainer.prototype.getChildIndex=function(t){var e=this.children.indexOf(t);if(e===-1){throw new Error("The supplied DisplayObject must be a child of the caller")}return e};s.DisplayObjectContainer.prototype.setChildIndex=function(t,e){if(e<0||e>=this.children.length){throw new Error("The supplied index is out of bounds")}var i=this.getChildIndex(t);this.children.splice(i,1);this.children.splice(e,0,t)};s.DisplayObjectContainer.prototype.getChildAt=function(t){if(t<0||t>=this.children.length){throw new Error("getChildAt: Supplied index "+t+" does not exist in the child list, or the supplied DisplayObject must be a child of the caller")}return this.children[t]};s.DisplayObjectContainer.prototype.removeChild=function(t){var e=this.children.indexOf(t);if(e===-1){return}return this.removeChildAt(e)};s.DisplayObjectContainer.prototype.removeChildAt=function(t){var e=this.getChildAt(t);if(e){e.parent=undefined;this.children.splice(t,1)}return e};s.DisplayObjectContainer.prototype.removeChildren=function(t,e){if(t===undefined){t=0}if(e===undefined){e=this.children.length}var i=e-t;if(i>0&&i<=e){var s=this.children.splice(begin,i);for(var r=0;r<s.length;r++){var n=s[r];n.parent=undefined}return s}else if(i===0&&this.children.length===0){return[]}else{throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range")}};s.DisplayObjectContainer.prototype.updateTransform=function(){if(!this.visible){return}this.displayObjectUpdateTransform();if(this._cacheAsBitmap){return}for(var t=0;t<this.children.length;t++){this.children[t].updateTransform()}};s.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform=s.DisplayObjectContainer.prototype.updateTransform;s.DisplayObjectContainer.prototype.getBounds=function(t){var e=t&&t instanceof s.DisplayObject;var i=true;if(!e){t=this}else if(t instanceof s.DisplayObjectContainer){i=t.contains(this)}else{i=false}var r;if(e){var n=t.worldTransform;t.worldTransform=s.identityMatrix;for(r=0;r<t.children.length;r++){t.children[r].updateTransform()}}var a=Infinity;var o=Infinity;var h=-Infinity;var l=-Infinity;var u;var c;var d;var f=false;for(r=0;r<this.children.length;r++){var p=this.children[r];if(!p.visible){continue}f=true;u=this.children[r].getBounds();a=a<u.x?a:u.x;o=o<u.y?o:u.y;c=u.width+u.x;d=u.height+u.y;h=h>c?h:c;l=l>d?l:d}var g=this._bounds;if(!f){g=new s.Rectangle;var m=g.x;var y=g.width+g.x;var v=g.y;var b=g.height+g.y;var x=this.worldTransform;var w=x.a;var _=x.b;var P=x.c;var T=x.d;var C=x.tx;var S=x.ty;var A=w*y+P*b+C;var E=T*b+_*y+S;var I=w*m+P*b+C;var M=T*b+_*m+S;var R=w*m+P*v+C;var L=T*v+_*m+S;var B=w*y+P*v+C;var O=T*v+_*y+S;h=A;l=E;a=A;o=E;a=I<a?I:a;a=R<a?R:a;a=B<a?B:a;o=M<o?M:o;o=L<o?L:o;o=O<o?O:o;h=I>h?I:h;h=R>h?R:h;h=B>h?B:h;l=M>l?M:l;l=L>l?L:l;l=O>l?O:l}g.x=a;g.y=o;g.width=h-a;g.height=l-o;if(e){t.worldTransform=n;for(r=0;r<t.children.length;r++){t.children[r].updateTransform()}}if(!i){var k=t.getBounds();g.x-=k.x;g.y-=k.y}return g};s.DisplayObjectContainer.prototype.getLocalBounds=function(){return this.getBounds(this)};s.DisplayObjectContainer.prototype.contains=function(t){if(!t){return false}else if(t===this){return true}else{return this.contains(t.parent)}};s.DisplayObjectContainer.prototype._renderWebGL=function(t){if(!this.visible||this.alpha<=0){return}if(this._cacheAsBitmap){this._renderCachedSprite(t);return}var e;if(this._mask||this._filters){if(this._filters){t.spriteBatch.flush();t.filterManager.pushFilter(this._filterBlock)}if(this._mask){t.spriteBatch.stop();t.maskManager.pushMask(this.mask,t);t.spriteBatch.start()}for(e=0;e<this.children.length;e++){this.children[e]._renderWebGL(t)}t.spriteBatch.stop();if(this._mask)t.maskManager.popMask(this._mask,t);if(this._filters)t.filterManager.popFilter();t.spriteBatch.start()}else{for(e=0;e<this.children.length;e++){this.children[e]._renderWebGL(t)}}};s.DisplayObjectContainer.prototype._renderCanvas=function(t){if(this.visible===false||this.alpha===0){return}if(this._cacheAsBitmap){this._renderCachedSprite(t);return}if(this._mask){t.maskManager.pushMask(this._mask,t)}for(var e=0;e<this.children.length;e++){this.children[e]._renderCanvas(t)}if(this._mask){t.maskManager.popMask(t)}};Object.defineProperty(s.DisplayObjectContainer.prototype,"width",{get:function(){return this.getLocalBounds().width*this.scale.x},set:function(t){var e=this.getLocalBounds().width;if(e!==0){this.scale.x=t/e}else{this.scale.x=1}this._width=t}});Object.defineProperty(s.DisplayObjectContainer.prototype,"height",{get:function(){return this.getLocalBounds().height*this.scale.y},set:function(t){var e=this.getLocalBounds().height;if(e!==0){this.scale.y=t/e}else{this.scale.y=1}this._height=t}});s.Sprite=function(t){s.DisplayObjectContainer.call(this);this.anchor=new s.Point;this.texture=t||s.Texture.emptyTexture;this._width=0;this._height=0;this.tint=16777215;this.cachedTint=-1;this.tintedTexture=null;this.blendMode=s.blendModes.NORMAL;this.shader=null;this.exists=true;if(this.texture.baseTexture.hasLoaded){this.onTextureUpdate()}this.renderable=true};s.Sprite.prototype=Object.create(s.DisplayObjectContainer.prototype);s.Sprite.prototype.constructor=s.Sprite;Object.defineProperty(s.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width;this._width=t}});Object.defineProperty(s.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height;this._height=t}});s.Sprite.prototype.setTexture=function(t,e){if(e!==undefined){this.texture.baseTexture.destroy()}this.texture.baseTexture.skipRender=false;this.texture=t;this.texture.valid=true;this.cachedTint=-1};s.Sprite.prototype.onTextureUpdate=function(){if(this._width)this.scale.x=this._width/this.texture.frame.width;if(this._height)this.scale.y=this._height/this.texture.frame.height};s.Sprite.prototype.getBounds=function(t){var e=this.texture.frame.width;var i=this.texture.frame.height;var s=e*(1-this.anchor.x);var r=e*-this.anchor.x;var n=i*(1-this.anchor.y);var a=i*-this.anchor.y;var o=t||this.worldTransform;var h=o.a;var l=o.b;var u=o.c;var c=o.d;var d=o.tx;var f=o.ty;var p=-Infinity;var g=-Infinity;var m=Infinity;var y=Infinity;if(l===0&&u===0){if(h<0){h*=-1;var v=s;s=-r;r=-v}if(c<0){c*=-1;var v=n;n=-a;a=-v}m=h*r+d;p=h*s+d;y=c*a+f;g=c*n+f}else{var b=h*r+u*a+d;var x=c*a+l*r+f;var w=h*s+u*a+d;var _=c*a+l*s+f;var P=h*s+u*n+d;var T=c*n+l*s+f;var C=h*r+u*n+d;var S=c*n+l*r+f;m=b<m?b:m;m=w<m?w:m;m=P<m?P:m;m=C<m?C:m;y=x<y?x:y;y=_<y?_:y;y=T<y?T:y;y=S<y?S:y;p=b>p?b:p;p=w>p?w:p;p=P>p?P:p;p=C>p?C:p;g=x>g?x:g;g=_>g?_:g;g=T>g?T:g;g=S>g?S:g}var A=this._bounds;A.x=m;A.width=p-m;A.y=y;A.height=g-y;this._currentBounds=A;return A};s.Sprite.prototype.getLocalBounds=function(){var t=this.worldTransform;this.worldTransform=s.identityMatrix;for(var e=0;e<this.children.length;e++){this.children[e].updateTransform()}var i=this.getBounds();this.worldTransform=t;for(e=0;e<this.children.length;e++){this.children[e].updateTransform()}return i};s.Sprite.prototype._renderWebGL=function(t,e){if(!this.visible||this.alpha<=0||!this.renderable)return;var i=this.worldTransform;if(e){i=e}if(this._mask||this._filters){var s=t.spriteBatch;if(this._filters){s.flush();t.filterManager.pushFilter(this._filterBlock)}if(this._mask){s.stop();t.maskManager.pushMask(this.mask,t);s.start()}s.render(this);for(var r=0;r<this.children.length;r++){this.children[r]._renderWebGL(t)}s.stop();if(this._mask)t.maskManager.popMask(this._mask,t);if(this._filters)t.filterManager.popFilter();s.start()}else{t.spriteBatch.render(this);for(var r=0;r<this.children.length;r++){this.children[r]._renderWebGL(t,i)}}};s.Sprite.prototype._renderCanvas=function(t,e){if(!this.visible||this.alpha===0||!this.renderable||this.texture.crop.width<=0||this.texture.crop.height<=0){return}var i=this.worldTransform;if(e){i=e}if(this.blendMode!==t.currentBlendMode){t.currentBlendMode=this.blendMode;t.context.globalCompositeOperation=s.blendModesCanvas[t.currentBlendMode]}if(this._mask){t.maskManager.pushMask(this._mask,t)}if(this.texture.valid){var r=this.texture.baseTexture.resolution/t.resolution;t.context.globalAlpha=this.worldAlpha;if(t.smoothProperty&&t.scaleMode!==this.texture.baseTexture.scaleMode){t.scaleMode=this.texture.baseTexture.scaleMode;t.context[t.smoothProperty]=t.scaleMode===s.scaleModes.LINEAR}var n=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width;var a=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;var o=i.tx*t.resolution+t.shakeX;var h=i.ty*t.resolution+t.shakeY;if(t.roundPixels){t.context.setTransform(i.a,i.b,i.c,i.d,o|0,h|0);n|=0;a|=0}else{t.context.setTransform(i.a,i.b,i.c,i.d,o,h)}var l=this.texture.crop.width;var u=this.texture.crop.height;n/=r;a/=r;if(this.tint!==16777215){if(this.texture.requiresReTint||this.cachedTint!==this.tint){this.tintedTexture=s.CanvasTinter.getTintedTexture(this,this.tint);this.cachedTint=this.tint;this.texture.requiresReTint=false}t.context.drawImage(this.tintedTexture,0,0,l,u,n,a,l/r,u/r)}else{var c=this.texture.crop.x;var d=this.texture.crop.y;t.context.drawImage(this.texture.baseTexture.source,c,d,l,u,n,a,l/r,u/r)}}for(var f=0;f<this.children.length;f++){this.children[f]._renderCanvas(t)}if(this._mask){t.maskManager.popMask(t)}};s.SpriteBatch=function(t){s.DisplayObjectContainer.call(this);this.textureThing=t;this.ready=false};s.SpriteBatch.prototype=Object.create(s.DisplayObjectContainer.prototype);s.SpriteBatch.prototype.constructor=s.SpriteBatch;s.SpriteBatch.prototype.initWebGL=function(t){this.fastSpriteBatch=new s.WebGLFastSpriteBatch(t);this.ready=true};s.SpriteBatch.prototype.updateTransform=function(){this.displayObjectUpdateTransform()};s.SpriteBatch.prototype._renderWebGL=function(t){if(!this.visible||this.alpha<=0||!this.children.length)return;if(!this.ready){this.initWebGL(t.gl)}if(this.fastSpriteBatch.gl!==t.gl){this.fastSpriteBatch.setContext(t.gl)}t.spriteBatch.stop();t.shaderManager.setShader(t.shaderManager.fastShader);this.fastSpriteBatch.begin(this,t);this.fastSpriteBatch.render(this);t.spriteBatch.start()};s.SpriteBatch.prototype._renderCanvas=function(t){if(!this.visible||this.alpha<=0||!this.children.length)return;var e=t.context;e.globalAlpha=this.worldAlpha;this.displayObjectUpdateTransform();var i=this.worldTransform;var s=true;for(var r=0;r<this.children.length;r++){var n=this.children[r];if(!n.visible)continue;var a=n.texture;var o=a.frame;e.globalAlpha=this.worldAlpha*n.alpha;if(n.rotation%(Math.PI*2)===0){if(s){e.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty);s=false}e.drawImage(a.baseTexture.source,o.x,o.y,o.width,o.height,n.anchor.x*(-o.width*n.scale.x)+n.position.x+.5+t.shakeX|0,n.anchor.y*(-o.height*n.scale.y)+n.position.y+.5+t.shakeY|0,o.width*n.scale.x,o.height*n.scale.y)}else{if(!s)s=true;n.displayObjectUpdateTransform();var h=n.worldTransform;var l=h.tx*t.resolution+t.shakeX;var u=h.ty*t.resolution+t.shakeY;if(t.roundPixels){e.setTransform(h.a,h.b,h.c,h.d,l|0,u|0)}else{e.setTransform(h.a,h.b,h.c,h.d,l,u)}e.drawImage(a.baseTexture.source,o.x,o.y,o.width,o.height,n.anchor.x*-o.width+.5|0,n.anchor.y*-o.height+.5|0,o.width,o.height)}}};s.hex2rgb=function(t){return[(t>>16&255)/255,(t>>8&255)/255,(t&255)/255]};s.rgb2hex=function(t){return(t[0]*255<<16)+(t[1]*255<<8)+t[2]*255};s.canUseNewCanvasBlendModes=function(){if(document===undefined)return false;var t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABAQMAAADD8p2OAAAAA1BMVEX/";var e="AAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==";var i=new Image;i.src=t+"AP804Oa6"+e;var r=new Image;r.src=t+"/wCKxvRF"+e;var n=s.CanvasPool.create(this,6,1);var a=n.getContext("2d");a.globalCompositeOperation="multiply";a.drawImage(i,0,0);a.drawImage(r,2,0);if(!a.getImageData(2,0,1,1)){return false}var o=a.getImageData(2,0,1,1).data;s.CanvasPool.remove(this);return o[0]===255&&o[1]===0&&o[2]===0};s.getNextPowerOfTwo=function(t){if(t>0&&(t&t-1)===0)return t;else{var e=1;while(e<t)e<<=1;return e}};s.isPowerOfTwo=function(t,e){return t>0&&(t&t-1)===0&&e>0&&(e&e-1)===0};s.CanvasPool={create:function(t,e,i){var r=s.CanvasPool.getFirst();var n;if(r===-1){var a={parent:t,canvas:document.createElement("canvas")};s.CanvasPool.pool.push(a);n=a.canvas}else{s.CanvasPool.pool[r].parent=t;n=s.CanvasPool.pool[r].canvas}if(e!==undefined){n.width=e;n.height=i}return n},getFirst:function(){var t=s.CanvasPool.pool;for(var e=0;e<t.length;e++){if(!t[e].parent){return e}}return-1},remove:function(t){var e=s.CanvasPool.pool;for(var i=0;i<e.length;i++){if(e[i].parent===t){e[i].parent=null;e[i].canvas.width=1;e[i].canvas.height=1}}},removeByCanvas:function(t){var e=s.CanvasPool.pool;for(var i=0;i<e.length;i++){if(e[i].canvas===t){e[i].parent=null;e[i].canvas.width=1;e[i].canvas.height=1}}},getTotal:function(){var t=s.CanvasPool.pool;var e=0;for(var i=0;i<t.length;i++){if(t[i].parent){e++}}return e},getFree:function(){var t=s.CanvasPool.pool;var e=0;for(var i=0;i<t.length;i++){if(!t[i].parent){e++}}return e}};s.CanvasPool.pool=[];s.initDefaultShaders=function(){};s.CompileVertexShader=function(t,e){return s._CompileShader(t,e,t.VERTEX_SHADER)};s.CompileFragmentShader=function(t,e){return s._CompileShader(t,e,t.FRAGMENT_SHADER)};s._CompileShader=function(t,e,i){var s=e;if(Array.isArray(e)){s=e.join("\n")}var r=t.createShader(i);t.shaderSource(r,s);t.compileShader(r);if(!t.getShaderParameter(r,t.COMPILE_STATUS)){window.console.log(t.getShaderInfoLog(r));return null}return r};s.compileProgram=function(t,e,i){var r=s.CompileFragmentShader(t,i);var n=s.CompileVertexShader(t,e);var a=t.createProgram();t.attachShader(a,n);t.attachShader(a,r);t.linkProgram(a);if(!t.getProgramParameter(a,t.LINK_STATUS)){window.console.log(t.getProgramInfoLog(a));window.console.log("Could not initialise shaders")}return a};s.PixiShader=function(t){this._UID=s._UID++;this.gl=t;this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"];this.textureCount=0;this.firstRun=true;this.dirty=true;this.attributes=[];this.init()};s.PixiShader.prototype.constructor=s.PixiShader;s.PixiShader.prototype.init=function(){var t=this.gl;var e=s.compileProgram(t,this.vertexSrc||s.PixiShader.defaultVertexSrc,this.fragmentSrc);t.useProgram(e);this.uSampler=t.getUniformLocation(e,"uSampler");this.projectionVector=t.getUniformLocation(e,"projectionVector");this.offsetVector=t.getUniformLocation(e,"offsetVector");this.dimensions=t.getUniformLocation(e,"dimensions");this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition");this.aTextureCoord=t.getAttribLocation(e,"aTextureCoord");this.colorAttribute=t.getAttribLocation(e,"aColor");if(this.colorAttribute===-1){this.colorAttribute=2}this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(var i in this.uniforms){this.uniforms[i].uniformLocation=t.getUniformLocation(e,i)}this.initUniforms();this.program=e};s.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var t=this.gl;var e;for(var i in this.uniforms){e=this.uniforms[i];var s=e.type;if(s==="sampler2D"){e._init=false;if(e.value!==null){this.initSampler2D(e)}}else if(s==="mat2"||s==="mat3"||s==="mat4"){e.glMatrix=true;e.glValueLength=1;if(s==="mat2"){e.glFunc=t.uniformMatrix2fv}else if(s==="mat3"){e.glFunc=t.uniformMatrix3fv}else if(s==="mat4"){e.glFunc=t.uniformMatrix4fv}}else{e.glFunc=t["uniform"+s];if(s==="2f"||s==="2i"){e.glValueLength=2}else if(s==="3f"||s==="3i"){e.glValueLength=3}else if(s==="4f"||s==="4i"){e.glValueLength=4}else{e.glValueLength=1}}}};s.PixiShader.prototype.initSampler2D=function(t){if(!t.value||!t.value.baseTexture||!t.value.baseTexture.hasLoaded){return}var e=this.gl;e.activeTexture(e["TEXTURE"+this.textureCount]);e.bindTexture(e.TEXTURE_2D,t.value.baseTexture._glTextures[e.id]);if(t.textureData){var i=t.textureData;var s=i.magFilter?i.magFilter:e.LINEAR;var r=i.minFilter?i.minFilter:e.LINEAR;var n=i.wrapS?i.wrapS:e.CLAMP_TO_EDGE;var a=i.wrapT?i.wrapT:e.CLAMP_TO_EDGE;var o=i.luminance?e.LUMINANCE:e.RGBA;if(i.repeat){n=e.REPEAT;a=e.REPEAT}e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!!i.flipY);if(i.width){var h=i.width?i.width:512;var l=i.height?i.height:2;var u=i.border?i.border:0;e.texImage2D(e.TEXTURE_2D,0,o,h,l,u,o,e.UNSIGNED_BYTE,null)}else{e.texImage2D(e.TEXTURE_2D,0,o,e.RGBA,e.UNSIGNED_BYTE,t.value.baseTexture.source)}e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,s);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,r);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,n);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,a)}e.uniform1i(t.uniformLocation,this.textureCount);t._init=true;this.textureCount++};s.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var t;var e=this.gl;for(var i in this.uniforms){t=this.uniforms[i];if(t.glValueLength===1){if(t.glMatrix===true){t.glFunc.call(e,t.uniformLocation,t.transpose,t.value)}else{t.glFunc.call(e,t.uniformLocation,t.value)}}else if(t.glValueLength===2){t.glFunc.call(e,t.uniformLocation,t.value.x,t.value.y)}else if(t.glValueLength===3){t.glFunc.call(e,t.uniformLocation,t.value.x,t.value.y,t.value.z)}else if(t.glValueLength===4){t.glFunc.call(e,t.uniformLocation,t.value.x,t.value.y,t.value.z,t.value.w)}else if(t.type==="sampler2D"){if(t._init){e.activeTexture(e["TEXTURE"+this.textureCount]);if(t.value.baseTexture._dirty[e.id]){s.instances[e.id].updateTexture(t.value.baseTexture)}else{e.bindTexture(e.TEXTURE_2D,t.value.baseTexture._glTextures[e.id])}e.uniform1i(t.uniformLocation,this.textureCount);this.textureCount++}else{this.initSampler2D(t)}}}};s.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};s.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"];s.PixiFastShader=function(t){this._UID=s._UID++;this.gl=t;this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"];this.textureCount=0;this.init()};s.PixiFastShader.prototype.constructor=s.PixiFastShader;s.PixiFastShader.prototype.init=function(){var t=this.gl;var e=s.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(e);this.uSampler=t.getUniformLocation(e,"uSampler");this.projectionVector=t.getUniformLocation(e,"projectionVector");this.offsetVector=t.getUniformLocation(e,"offsetVector");this.dimensions=t.getUniformLocation(e,"dimensions");this.uMatrix=t.getUniformLocation(e,"uMatrix");this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition");this.aPositionCoord=t.getAttribLocation(e,"aPositionCoord");this.aScale=t.getAttribLocation(e,"aScale");this.aRotation=t.getAttribLocation(e,"aRotation");this.aTextureCoord=t.getAttribLocation(e,"aTextureCoord");this.colorAttribute=t.getAttribLocation(e,"aColor");if(this.colorAttribute===-1){this.colorAttribute=2}this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute];this.program=e};s.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};s.StripShader=function(t){this._UID=s._UID++;this.gl=t;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * alpha;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"];this.init()};s.StripShader.prototype.constructor=s.StripShader;s.StripShader.prototype.init=function(){var t=this.gl;var e=s.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(e);this.uSampler=t.getUniformLocation(e,"uSampler");this.projectionVector=t.getUniformLocation(e,"projectionVector");this.offsetVector=t.getUniformLocation(e,"offsetVector");this.colorAttribute=t.getAttribLocation(e,"aColor");this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition");this.aTextureCoord=t.getAttribLocation(e,"aTextureCoord");this.attributes=[this.aVertexPosition,this.aTextureCoord];this.translationMatrix=t.getUniformLocation(e,"translationMatrix");this.alpha=t.getUniformLocation(e,"alpha");this.program=e};s.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attribute=null};s.PrimitiveShader=function(t){this._UID=s._UID++;this.gl=t;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"];this.init()};s.PrimitiveShader.prototype.constructor=s.PrimitiveShader;s.PrimitiveShader.prototype.init=function(){var t=this.gl;var e=s.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(e);this.projectionVector=t.getUniformLocation(e,"projectionVector");this.offsetVector=t.getUniformLocation(e,"offsetVector");this.tintColor=t.getUniformLocation(e,"tint");this.flipY=t.getUniformLocation(e,"flipY");this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition");this.colorAttribute=t.getAttribLocation(e,"aColor");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=t.getUniformLocation(e,"translationMatrix");this.alpha=t.getUniformLocation(e,"alpha");this.program=e};s.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};s.ComplexPrimitiveShader=function(t){this._UID=s._UID++;this.gl=t;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","uniform float flipY;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"];this.init()};s.ComplexPrimitiveShader.prototype.constructor=s.ComplexPrimitiveShader;s.ComplexPrimitiveShader.prototype.init=function(){var t=this.gl;var e=s.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(e);this.projectionVector=t.getUniformLocation(e,"projectionVector");this.offsetVector=t.getUniformLocation(e,"offsetVector");this.tintColor=t.getUniformLocation(e,"tint");this.color=t.getUniformLocation(e,"color");this.flipY=t.getUniformLocation(e,"flipY");this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=t.getUniformLocation(e,"translationMatrix");this.alpha=t.getUniformLocation(e,"alpha");this.program=e};s.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attribute=null};s.glContexts=[];s.instances=[];s.WebGLRenderer=function(t){this.game=t;if(!s.defaultRenderer){s.defaultRenderer=this}this.type=s.WEBGL_RENDERER;this.resolution=t.resolution;this.transparent=t.transparent;this.autoResize=false;this.preserveDrawingBuffer=t.preserveDrawingBuffer;this.clearBeforeRender=t.clearBeforeRender;this.width=t.width;this.height=t.height;this.view=t.canvas;this._contextOptions={alpha:this.transparent,antialias:t.antialias,premultipliedAlpha:this.transparent&&this.transparent!=="notMultiplied",stencil:true,preserveDrawingBuffer:this.preserveDrawingBuffer};this.projection=new s.Point;this.offset=new s.Point;this.shaderManager=new s.WebGLShaderManager;this.spriteBatch=new s.WebGLSpriteBatch;this.maskManager=new s.WebGLMaskManager;this.filterManager=new s.WebGLFilterManager;this.stencilManager=new s.WebGLStencilManager;this.blendModeManager=new s.WebGLBlendModeManager;this.renderSession={};this.renderSession.game=this.game;this.renderSession.gl=this.gl;this.renderSession.drawCount=0;this.renderSession.shaderManager=this.shaderManager;this.renderSession.maskManager=this.maskManager;this.renderSession.filterManager=this.filterManager;this.renderSession.blendModeManager=this.blendModeManager;this.renderSession.spriteBatch=this.spriteBatch;this.renderSession.stencilManager=this.stencilManager;this.renderSession.renderer=this;this.renderSession.resolution=this.resolution;this.initContext();this.mapBlendModes()};s.WebGLRenderer.prototype.constructor=s.WebGLRenderer;s.WebGLRenderer.prototype.initContext=function(){var t=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);this.gl=t;if(!t){throw new Error("This browser does not support webGL. Try using the canvas renderer")}this.glContextId=t.id=s.WebGLRenderer.glContextId++;s.glContexts[this.glContextId]=t;s.instances[this.glContextId]=this;t.disable(t.DEPTH_TEST);t.disable(t.CULL_FACE);t.enable(t.BLEND);this.shaderManager.setContext(t);this.spriteBatch.setContext(t);this.maskManager.setContext(t);this.filterManager.setContext(t);this.blendModeManager.setContext(t);this.stencilManager.setContext(t);this.renderSession.gl=this.gl;this.resize(this.width,this.height)};s.WebGLRenderer.prototype.render=function(t){if(this.contextLost){return}var e=this.gl;e.viewport(0,0,this.width,this.height);e.bindFramebuffer(e.FRAMEBUFFER,null);if(this.game.clearBeforeRender){e.clearColor(t._bgColor.r,t._bgColor.g,t._bgColor.b,t._bgColor.a);e.clear(e.COLOR_BUFFER_BIT)}this.offset.x=this.game.camera._shake.x;this.offset.y=this.game.camera._shake.y;this.renderDisplayObject(t,this.projection)};s.WebGLRenderer.prototype.renderDisplayObject=function(t,e,i,r){this.renderSession.blendModeManager.setBlendMode(s.blendModes.NORMAL);this.renderSession.drawCount=0;this.renderSession.flipY=i?-1:1;this.renderSession.projection=e;this.renderSession.offset=this.offset;this.spriteBatch.begin(this.renderSession);this.filterManager.begin(this.renderSession,i);t._renderWebGL(this.renderSession,r);this.spriteBatch.end()};s.WebGLRenderer.prototype.resize=function(t,e){this.width=t*this.resolution;this.height=e*this.resolution;this.view.width=this.width;this.view.height=this.height;if(this.autoResize){this.view.style.width=this.width/this.resolution+"px";this.view.style.height=this.height/this.resolution+"px"}this.gl.viewport(0,0,this.width,this.height);this.projection.x=this.width/2/this.resolution;this.projection.y=-this.height/2/this.resolution};s.WebGLRenderer.prototype.updateTexture=function(t){if(!t.hasLoaded){return false}var e=this.gl;if(!t._glTextures[e.id]){t._glTextures[e.id]=e.createTexture()}e.bindTexture(e.TEXTURE_2D,t._glTextures[e.id]);e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultipliedAlpha);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t.source);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t.scaleMode===s.scaleModes.LINEAR?e.LINEAR:e.NEAREST);if(t.mipmap&&s.isPowerOfTwo(t.width,t.height)){e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t.scaleMode===s.scaleModes.LINEAR?e.LINEAR_MIPMAP_LINEAR:e.NEAREST_MIPMAP_NEAREST);e.generateMipmap(e.TEXTURE_2D)}else{e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t.scaleMode===s.scaleModes.LINEAR?e.LINEAR:e.NEAREST)}if(!t._powerOf2){e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}else{e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)}t._dirty[e.id]=false;return true};s.WebGLRenderer.prototype.destroy=function(){s.glContexts[this.glContextId]=null;this.projection=null;this.offset=null;this.shaderManager.destroy();this.spriteBatch.destroy();this.maskManager.destroy();this.filterManager.destroy();this.shaderManager=null;this.spriteBatch=null;this.maskManager=null;this.filterManager=null;this.gl=null;this.renderSession=null;s.CanvasPool.remove(this);s.instances[this.glContextId]=null;s.WebGLRenderer.glContextId--};s.WebGLRenderer.prototype.mapBlendModes=function(){var t=this.gl;if(!s.blendModesWebGL){var e=[];var i=s.blendModes;e[i.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e[i.ADD]=[t.SRC_ALPHA,t.DST_ALPHA];e[i.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA];e[i.SCREEN]=[t.SRC_ALPHA,t.ONE];e[i.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e[i.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e[i.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e[i.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e[i.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e[i.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e[i.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e[i.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e[i.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e[i.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e[i.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e[i.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e[i.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];s.blendModesWebGL=e}};s.WebGLRenderer.glContextId=0;s.WebGLBlendModeManager=function(){this.currentBlendMode=99999};s.WebGLBlendModeManager.prototype.constructor=s.WebGLBlendModeManager;s.WebGLBlendModeManager.prototype.setContext=function(t){this.gl=t};s.WebGLBlendModeManager.prototype.setBlendMode=function(t){if(this.currentBlendMode===t)return false;this.currentBlendMode=t;var e=s.blendModesWebGL[this.currentBlendMode];if(e){this.gl.blendFunc(e[0],e[1])}return true};s.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null};s.WebGLMaskManager=function(){};s.WebGLMaskManager.prototype.constructor=s.WebGLMaskManager;s.WebGLMaskManager.prototype.setContext=function(t){this.gl=t};s.WebGLMaskManager.prototype.pushMask=function(t,e){var i=e.gl;if(t.dirty){s.WebGLGraphics.updateGraphics(t,i)}if(t._webGL[i.id]===undefined||t._webGL[i.id].data===undefined||t._webGL[i.id].data.length===0){return}e.stencilManager.pushStencil(t,t._webGL[i.id].data[0],e)};s.WebGLMaskManager.prototype.popMask=function(t,e){var i=this.gl;if(t._webGL[i.id]===undefined||t._webGL[i.id].data===undefined||t._webGL[i.id].data.length===0){return}e.stencilManager.popStencil(t,t._webGL[i.id].data[0],e)};s.WebGLMaskManager.prototype.destroy=function(){this.gl=null};s.WebGLStencilManager=function(){this.stencilStack=[];this.reverse=true;this.count=0};s.WebGLStencilManager.prototype.setContext=function(t){this.gl=t};s.WebGLStencilManager.prototype.pushStencil=function(t,e,i){var s=this.gl;this.bindGraphics(t,e,i);if(this.stencilStack.length===0){s.enable(s.STENCIL_TEST);s.clear(s.STENCIL_BUFFER_BIT);this.reverse=true;this.count=0}this.stencilStack.push(e);var r=this.count;s.colorMask(false,false,false,false);s.stencilFunc(s.ALWAYS,0,255);s.stencilOp(s.KEEP,s.KEEP,s.INVERT);if(e.mode===1){s.drawElements(s.TRIANGLE_FAN,e.indices.length-4,s.UNSIGNED_SHORT,0);if(this.reverse){s.stencilFunc(s.EQUAL,255-r,255);s.stencilOp(s.KEEP,s.KEEP,s.DECR)}else{s.stencilFunc(s.EQUAL,r,255);s.stencilOp(s.KEEP,s.KEEP,s.INCR)}s.drawElements(s.TRIANGLE_FAN,4,s.UNSIGNED_SHORT,(e.indices.length-4)*2);if(this.reverse){s.stencilFunc(s.EQUAL,255-(r+1),255)}else{s.stencilFunc(s.EQUAL,r+1,255)}this.reverse=!this.reverse}else{if(!this.reverse){s.stencilFunc(s.EQUAL,255-r,255);s.stencilOp(s.KEEP,s.KEEP,s.DECR)}else{s.stencilFunc(s.EQUAL,r,255);s.stencilOp(s.KEEP,s.KEEP,s.INCR)}s.drawElements(s.TRIANGLE_STRIP,e.indices.length,s.UNSIGNED_SHORT,0);if(!this.reverse){s.stencilFunc(s.EQUAL,255-(r+1),255)}else{s.stencilFunc(s.EQUAL,r+1,255)}}s.colorMask(true,true,true,true);s.stencilOp(s.KEEP,s.KEEP,s.KEEP);this.count++};s.WebGLStencilManager.prototype.bindGraphics=function(t,e,i){this._currentGraphics=t;var r=this.gl;var n=i.projection,a=i.offset,o;if(e.mode===1){o=i.shaderManager.complexPrimitiveShader;i.shaderManager.setShader(o);r.uniform1f(o.flipY,i.flipY);r.uniformMatrix3fv(o.translationMatrix,false,t.worldTransform.toArray(true));r.uniform2f(o.projectionVector,n.x,-n.y);r.uniform2f(o.offsetVector,-a.x,-a.y);r.uniform3fv(o.tintColor,s.hex2rgb(t.tint));r.uniform3fv(o.color,e.color);r.uniform1f(o.alpha,t.worldAlpha*e.alpha);r.bindBuffer(r.ARRAY_BUFFER,e.buffer);r.vertexAttribPointer(o.aVertexPosition,2,r.FLOAT,false,4*2,0);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e.indexBuffer)}else{o=i.shaderManager.primitiveShader;i.shaderManager.setShader(o);r.uniformMatrix3fv(o.translationMatrix,false,t.worldTransform.toArray(true));r.uniform1f(o.flipY,i.flipY);r.uniform2f(o.projectionVector,n.x,-n.y);r.uniform2f(o.offsetVector,-a.x,-a.y);r.uniform3fv(o.tintColor,s.hex2rgb(t.tint));r.uniform1f(o.alpha,t.worldAlpha);r.bindBuffer(r.ARRAY_BUFFER,e.buffer);r.vertexAttribPointer(o.aVertexPosition,2,r.FLOAT,false,4*6,0);r.vertexAttribPointer(o.colorAttribute,4,r.FLOAT,false,4*6,2*4);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e.indexBuffer)}};s.WebGLStencilManager.prototype.popStencil=function(t,e,i){var s=this.gl;this.stencilStack.pop();this.count--;if(this.stencilStack.length===0){s.disable(s.STENCIL_TEST)}else{var r=this.count;this.bindGraphics(t,e,i);s.colorMask(false,false,false,false);if(e.mode===1){this.reverse=!this.reverse;if(this.reverse){s.stencilFunc(s.EQUAL,255-(r+1),255);s.stencilOp(s.KEEP,s.KEEP,s.INCR)}else{s.stencilFunc(s.EQUAL,r+1,255);s.stencilOp(s.KEEP,s.KEEP,s.DECR)}s.drawElements(s.TRIANGLE_FAN,4,s.UNSIGNED_SHORT,(e.indices.length-4)*2);s.stencilFunc(s.ALWAYS,0,255);s.stencilOp(s.KEEP,s.KEEP,s.INVERT);s.drawElements(s.TRIANGLE_FAN,e.indices.length-4,s.UNSIGNED_SHORT,0);if(!this.reverse){s.stencilFunc(s.EQUAL,255-r,255)}else{s.stencilFunc(s.EQUAL,r,255)}}else{if(!this.reverse){s.stencilFunc(s.EQUAL,255-(r+1),255);s.stencilOp(s.KEEP,s.KEEP,s.INCR)}else{s.stencilFunc(s.EQUAL,r+1,255);s.stencilOp(s.KEEP,s.KEEP,s.DECR)}s.drawElements(s.TRIANGLE_STRIP,e.indices.length,s.UNSIGNED_SHORT,0);if(!this.reverse){s.stencilFunc(s.EQUAL,255-r,255)}else{s.stencilFunc(s.EQUAL,r,255)}}s.colorMask(true,true,true,true);s.stencilOp(s.KEEP,s.KEEP,s.KEEP)}};s.WebGLStencilManager.prototype.destroy=function(){this.stencilStack=null;this.gl=null};s.WebGLShaderManager=function(){this.maxAttibs=10;this.attribState=[];this.tempAttribState=[];for(var t=0;t<this.maxAttibs;t++){this.attribState[t]=false}this.stack=[]};s.WebGLShaderManager.prototype.constructor=s.WebGLShaderManager;s.WebGLShaderManager.prototype.setContext=function(t){this.gl=t;this.primitiveShader=new s.PrimitiveShader(t);this.complexPrimitiveShader=new s.ComplexPrimitiveShader(t);this.defaultShader=new s.PixiShader(t);this.fastShader=new s.PixiFastShader(t);this.stripShader=new s.StripShader(t);this.setShader(this.defaultShader)};s.WebGLShaderManager.prototype.setAttribs=function(t){var e;for(e=0;e<this.tempAttribState.length;e++){this.tempAttribState[e]=false}for(e=0;e<t.length;e++){var i=t[e];this.tempAttribState[i]=true}var s=this.gl;for(e=0;e<this.attribState.length;e++){if(this.attribState[e]!==this.tempAttribState[e]){this.attribState[e]=this.tempAttribState[e];if(this.tempAttribState[e]){s.enableVertexAttribArray(e)}else{s.disableVertexAttribArray(e)}}}};s.WebGLShaderManager.prototype.setShader=function(t){if(this._currentId===t._UID)return false;this._currentId=t._UID;this.currentShader=t;this.gl.useProgram(t.program);this.setAttribs(t.attributes);return true};s.WebGLShaderManager.prototype.destroy=function(){this.attribState=null;this.tempAttribState=null;this.primitiveShader.destroy();this.complexPrimitiveShader.destroy();this.defaultShader.destroy();this.fastShader.destroy();this.stripShader.destroy();this.gl=null};s.WebGLSpriteBatch=function(){this.vertSize=5;this.size=2e3;var t=this.size*4*4*this.vertSize;var e=this.size*6;this.vertices=new s.ArrayBuffer(t);this.positions=new s.Float32Array(this.vertices);this.colors=new s.Uint32Array(this.vertices);this.indices=new s.Uint16Array(e);this.lastIndexCount=0;for(var i=0,r=0;i<e;i+=6,r+=4){this.indices[i+0]=r+0;this.indices[i+1]=r+1;this.indices[i+2]=r+2;this.indices[i+3]=r+0;this.indices[i+4]=r+2;this.indices[i+5]=r+3}this.drawing=false;this.currentBatchSize=0;this.currentBaseTexture=null;this.dirty=true;this.textures=[];this.blendModes=[];this.shaders=[];this.sprites=[];this.defaultShader=new s.AbstractFilter(["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"])};s.WebGLSpriteBatch.prototype.setContext=function(t){this.gl=t;this.vertexBuffer=t.createBuffer();this.indexBuffer=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW);t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW);this.currentBlendMode=99999;var e=new s.PixiShader(t);e.fragmentSrc=this.defaultShader.fragmentSrc;e.uniforms={};e.init();this.defaultShader.shaders[t.id]=e};s.WebGLSpriteBatch.prototype.begin=function(t){this.renderSession=t;this.shader=this.renderSession.shaderManager.defaultShader;this.start()};s.WebGLSpriteBatch.prototype.end=function(){this.flush()};s.WebGLSpriteBatch.prototype.render=function(t,e){var i=t.texture;var s=t.worldTransform;if(e){s=e}if(this.currentBatchSize>=this.size){this.flush();this.currentBaseTexture=i.baseTexture}var r=i._uvs;if(!r){return}var n=t.anchor.x;var a=t.anchor.y;var o,h,l,u;if(i.trim){var c=i.trim;h=c.x-n*c.width;o=h+i.crop.width;u=c.y-a*c.height;l=u+i.crop.height}else{o=i.frame.width*(1-n);h=i.frame.width*-n;l=i.frame.height*(1-a);u=i.frame.height*-a}var d=this.currentBatchSize*4*this.vertSize;var f=i.baseTexture.resolution;var p=s.a/f;var g=s.b/f;var m=s.c/f;var y=s.d/f;var v=s.tx;var b=s.ty;var x=this.colors;var w=this.positions;if(this.renderSession.roundPixels){w[d]=p*h+m*u+v|0;w[d+1]=y*u+g*h+b|0;w[d+5]=p*o+m*u+v|0;w[d+6]=y*u+g*o+b|0;w[d+10]=p*o+m*l+v|0;w[d+11]=y*l+g*o+b|0;w[d+15]=p*h+m*l+v|0;w[d+16]=y*l+g*h+b|0}else{w[d]=p*h+m*u+v;w[d+1]=y*u+g*h+b;w[d+5]=p*o+m*u+v;w[d+6]=y*u+g*o+b;w[d+10]=p*o+m*l+v;w[d+11]=y*l+g*o+b;w[d+15]=p*h+m*l+v;w[d+16]=y*l+g*h+b}w[d+2]=r.x0;w[d+3]=r.y0;w[d+7]=r.x1;w[d+8]=r.y1;w[d+12]=r.x2;w[d+13]=r.y2;w[d+17]=r.x3;w[d+18]=r.y3;var _=t.tint;x[d+4]=x[d+9]=x[d+14]=x[d+19]=(_>>16)+(_&65280)+((_&255)<<16)+(t.worldAlpha*255<<24);this.sprites[this.currentBatchSize++]=t};s.WebGLSpriteBatch.prototype.renderTilingSprite=function(t){var e=t.tilingTexture;if(this.currentBatchSize>=this.size){this.flush();this.currentBaseTexture=e.baseTexture}if(!t._uvs){t._uvs=new s.TextureUvs}var i=t._uvs;var r=e.baseTexture.width;var n=e.baseTexture.height;t.tilePosition.x%=r*t.tileScaleOffset.x;t.tilePosition.y%=n*t.tileScaleOffset.y;var a=t.tilePosition.x/(r*t.tileScaleOffset.x);var o=t.tilePosition.y/(n*t.tileScaleOffset.y);var h=t.width/r/(t.tileScale.x*t.tileScaleOffset.x);var l=t.height/n/(t.tileScale.y*t.tileScaleOffset.y);i.x0=0-a;i.y0=0-o;i.x1=1*h-a;i.y1=0-o;i.x2=1*h-a;i.y2=1*l-o;i.x3=0-a;i.y3=1*l-o;var u=t.tint;var c=(u>>16)+(u&65280)+((u&255)<<16)+(t.worldAlpha*255<<24);var d=this.positions;var f=this.colors;var p=t.width;var g=t.height;var m=t.anchor.x;var y=t.anchor.y;var v=p*(1-m);var b=p*-m;var x=g*(1-y);var w=g*-y;var _=this.currentBatchSize*4*this.vertSize;var P=e.baseTexture.resolution;var T=t.worldTransform;var C=T.a/P;var S=T.b/P;var A=T.c/P;var E=T.d/P;var I=T.tx;var M=T.ty;d[_++]=C*b+A*w+I;d[_++]=E*w+S*b+M;d[_++]=i.x0;d[_++]=i.y0;f[_++]=c;d[_++]=C*v+A*w+I;d[_++]=E*w+S*v+M;d[_++]=i.x1;d[_++]=i.y1;f[_++]=c;d[_++]=C*v+A*x+I;d[_++]=E*x+S*v+M;d[_++]=i.x2;d[_++]=i.y2;f[_++]=c;d[_++]=C*b+A*x+I;d[_++]=E*x+S*b+M;d[_++]=i.x3;d[_++]=i.y3;f[_++]=c;this.sprites[this.currentBatchSize++]=t};s.WebGLSpriteBatch.prototype.flush=function(){if(this.currentBatchSize===0){return}var t=this.gl;var e;if(this.dirty){this.dirty=false;t.activeTexture(t.TEXTURE0);t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);e=this.defaultShader.shaders[t.id];var i=this.vertSize*4;t.vertexAttribPointer(e.aVertexPosition,2,t.FLOAT,false,i,0);t.vertexAttribPointer(e.aTextureCoord,2,t.FLOAT,false,i,2*4);t.vertexAttribPointer(e.colorAttribute,4,t.UNSIGNED_BYTE,true,i,4*4)}if(this.currentBatchSize>this.size*.5){t.bufferSubData(t.ARRAY_BUFFER,0,this.vertices)}else{var r=this.positions.subarray(0,this.currentBatchSize*4*this.vertSize);t.bufferSubData(t.ARRAY_BUFFER,0,r)}var n,a,o;var h=0;var l=0;var u=null;var c=this.renderSession.blendModeManager.currentBlendMode;var d=null;var f=false;var p=false;var g;for(var m=0,y=this.currentBatchSize;m<y;m++){g=this.sprites[m];if(g.tilingTexture){n=g.tilingTexture.baseTexture}else{n=g.texture.baseTexture}a=g.blendMode;o=g.shader||this.defaultShader;f=c!==a;p=d!==o;var v=n.skipRender;if(v&&g.children.length>0){v=false}if(u!==n&&!v||f||p){this.renderBatch(u,h,l);l=m;h=0;u=n;if(f){c=a;this.renderSession.blendModeManager.setBlendMode(c)}if(p){d=o;e=d.shaders[t.id];if(!e){e=new s.PixiShader(t);e.fragmentSrc=d.fragmentSrc;e.uniforms=d.uniforms;e.init();d.shaders[t.id]=e}this.renderSession.shaderManager.setShader(e);if(e.dirty){e.syncUniforms()}var b=this.renderSession.projection;t.uniform2f(e.projectionVector,b.x,b.y);var x=this.renderSession.offset;t.uniform2f(e.offsetVector,x.x,x.y)}}h++}this.renderBatch(u,h,l);this.currentBatchSize=0};s.WebGLSpriteBatch.prototype.renderBatch=function(t,e,i){if(e===0){return}var s=this.gl;if(t._dirty[s.id]){if(!this.renderSession.renderer.updateTexture(t)){return}}else{s.bindTexture(s.TEXTURE_2D,t._glTextures[s.id])}s.drawElements(s.TRIANGLES,e*6,s.UNSIGNED_SHORT,i*6*2);this.renderSession.drawCount++};s.WebGLSpriteBatch.prototype.stop=function(){this.flush();this.dirty=true};s.WebGLSpriteBatch.prototype.start=function(){this.dirty=true};s.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null;this.indices=null;this.gl.deleteBuffer(this.vertexBuffer);this.gl.deleteBuffer(this.indexBuffer);this.currentBaseTexture=null;this.gl=null};s.WebGLFastSpriteBatch=function(t){this.vertSize=10;this.maxSize=6e3;this.size=this.maxSize;var e=this.size*4*this.vertSize;var i=this.maxSize*6;this.vertices=new s.Float32Array(e);this.indices=new s.Uint16Array(i);this.vertexBuffer=null;this.indexBuffer=null;this.lastIndexCount=0;for(var r=0,n=0;r<i;r+=6,n+=4){this.indices[r+0]=n+0;this.indices[r+1]=n+1;this.indices[r+2]=n+2;this.indices[r+3]=n+0;this.indices[r+4]=n+2;this.indices[r+5]=n+3}this.drawing=false;this.currentBatchSize=0;this.currentBaseTexture=null;this.currentBlendMode=0;this.renderSession=null;this.shader=null;this.matrix=null;this.setContext(t)};s.WebGLFastSpriteBatch.prototype.constructor=s.WebGLFastSpriteBatch;s.WebGLFastSpriteBatch.prototype.setContext=function(t){this.gl=t;this.vertexBuffer=t.createBuffer();this.indexBuffer=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW);t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW)};s.WebGLFastSpriteBatch.prototype.begin=function(t,e){this.renderSession=e;this.shader=this.renderSession.shaderManager.fastShader;this.matrix=t.worldTransform.toArray(true);this.start()};s.WebGLFastSpriteBatch.prototype.end=function(){this.flush()};s.WebGLFastSpriteBatch.prototype.render=function(t){var e=t.children;var i=e[0];if(!i.texture._uvs)return;this.currentBaseTexture=i.texture.baseTexture;if(i.blendMode!==this.renderSession.blendModeManager.currentBlendMode){this.flush();this.renderSession.blendModeManager.setBlendMode(i.blendMode)}for(var s=0,r=e.length;s<r;s++){this.renderSprite(e[s])}this.flush()};s.WebGLFastSpriteBatch.prototype.renderSprite=function(t){if(!t.visible)return;if(t.texture.baseTexture!==this.currentBaseTexture&&!t.texture.baseTexture.skipRender){this.flush();this.currentBaseTexture=t.texture.baseTexture;if(!t.texture._uvs)return}var e,i=this.vertices,s,r,n,a,o,h,l;e=t.texture._uvs;s=t.texture.frame.width;r=t.texture.frame.height;if(t.texture.trim){var u=t.texture.trim;a=u.x-t.anchor.x*u.width;n=a+t.texture.crop.width;h=u.y-t.anchor.y*u.height;o=h+t.texture.crop.height}else{n=t.texture.frame.width*(1-t.anchor.x);a=t.texture.frame.width*-t.anchor.x;o=t.texture.frame.height*(1-t.anchor.y);h=t.texture.frame.height*-t.anchor.y}l=this.currentBatchSize*4*this.vertSize;i[l++]=a;i[l++]=h;i[l++]=t.position.x;i[l++]=t.position.y;i[l++]=t.scale.x;i[l++]=t.scale.y;i[l++]=t.rotation;i[l++]=e.x0;i[l++]=e.y1;i[l++]=t.alpha;i[l++]=n;i[l++]=h;i[l++]=t.position.x;i[l++]=t.position.y;i[l++]=t.scale.x;i[l++]=t.scale.y;i[l++]=t.rotation;i[l++]=e.x1;i[l++]=e.y1;i[l++]=t.alpha;i[l++]=n;i[l++]=o;i[l++]=t.position.x;i[l++]=t.position.y;i[l++]=t.scale.x;i[l++]=t.scale.y;i[l++]=t.rotation;i[l++]=e.x2;i[l++]=e.y2;i[l++]=t.alpha;i[l++]=a;i[l++]=o;i[l++]=t.position.x;i[l++]=t.position.y;i[l++]=t.scale.x;i[l++]=t.scale.y;i[l++]=t.rotation;i[l++]=e.x3;i[l++]=e.y3;i[l++]=t.alpha;this.currentBatchSize++;if(this.currentBatchSize>=this.size){this.flush()}};s.WebGLFastSpriteBatch.prototype.flush=function(){if(this.currentBatchSize===0)return;var t=this.gl;if(!this.currentBaseTexture._glTextures[t.id])this.renderSession.renderer.updateTexture(this.currentBaseTexture,t);t.bindTexture(t.TEXTURE_2D,this.currentBaseTexture._glTextures[t.id]);if(this.currentBatchSize>this.size*.5){t.bufferSubData(t.ARRAY_BUFFER,0,this.vertices)}else{var e=this.vertices.subarray(0,this.currentBatchSize*4*this.vertSize);t.bufferSubData(t.ARRAY_BUFFER,0,e)}t.drawElements(t.TRIANGLES,this.currentBatchSize*6,t.UNSIGNED_SHORT,0);this.currentBatchSize=0;this.renderSession.drawCount++};s.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()};s.WebGLFastSpriteBatch.prototype.start=function(){var t=this.gl;t.activeTexture(t.TEXTURE0);t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var e=this.renderSession.projection;t.uniform2f(this.shader.projectionVector,e.x,e.y);t.uniformMatrix3fv(this.shader.uMatrix,false,this.matrix);var i=this.vertSize*4;t.vertexAttribPointer(this.shader.aVertexPosition,2,t.FLOAT,false,i,0);t.vertexAttribPointer(this.shader.aPositionCoord,2,t.FLOAT,false,i,2*4);t.vertexAttribPointer(this.shader.aScale,2,t.FLOAT,false,i,4*4);t.vertexAttribPointer(this.shader.aRotation,1,t.FLOAT,false,i,6*4);t.vertexAttribPointer(this.shader.aTextureCoord,2,t.FLOAT,false,i,7*4);t.vertexAttribPointer(this.shader.colorAttribute,1,t.FLOAT,false,i,9*4)};s.WebGLFilterManager=function(){this.filterStack=[];this.offsetX=0;this.offsetY=0};s.WebGLFilterManager.prototype.constructor=s.WebGLFilterManager;s.WebGLFilterManager.prototype.setContext=function(t){this.gl=t;this.texturePool=[];this.initShaderBuffers()};s.WebGLFilterManager.prototype.begin=function(t,e){this.renderSession=t;this.defaultShader=t.shaderManager.defaultShader;var i=this.renderSession.projection;this.width=i.x*2;this.height=-i.y*2;this.buffer=e};s.WebGLFilterManager.prototype.pushFilter=function(t){var e=this.gl;var i=this.renderSession.projection;var r=this.renderSession.offset;t._filterArea=t.target.filterArea||t.target.getBounds();t._previous_stencil_mgr=this.renderSession.stencilManager;this.renderSession.stencilManager=new s.WebGLStencilManager;this.renderSession.stencilManager.setContext(e);e.disable(e.STENCIL_TEST);this.filterStack.push(t);var n=t.filterPasses[0];this.offsetX+=t._filterArea.x;this.offsetY+=t._filterArea.y;var a=this.texturePool.pop();if(!a){a=new s.FilterTexture(this.gl,this.width*this.renderSession.resolution,this.height*this.renderSession.resolution)}else{a.resize(this.width*this.renderSession.resolution,this.height*this.renderSession.resolution)}e.bindTexture(e.TEXTURE_2D,a.texture);var o=t._filterArea;var h=n.padding;o.x-=h;o.y-=h;o.width+=h*2;o.height+=h*2;if(o.x<0)o.x=0;if(o.width>this.width)o.width=this.width;if(o.y<0)o.y=0;if(o.height>this.height)o.height=this.height;e.bindFramebuffer(e.FRAMEBUFFER,a.frameBuffer);e.viewport(0,0,o.width*this.renderSession.resolution,o.height*this.renderSession.resolution);i.x=o.width/2;i.y=-o.height/2;r.x=-o.x;r.y=-o.y;e.colorMask(true,true,true,true);e.clearColor(0,0,0,0);e.clear(e.COLOR_BUFFER_BIT);t._glFilterTexture=a};s.WebGLFilterManager.prototype.popFilter=function(){var t=this.gl;var e=this.filterStack.pop();var i=e._filterArea;var r=e._glFilterTexture;var n=this.renderSession.projection;var a=this.renderSession.offset;if(e.filterPasses.length>1){t.viewport(0,0,i.width*this.renderSession.resolution,i.height*this.renderSession.resolution);t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=0;this.vertexArray[1]=i.height;this.vertexArray[2]=i.width;this.vertexArray[3]=i.height;this.vertexArray[4]=0;this.vertexArray[5]=0;this.vertexArray[6]=i.width;this.vertexArray[7]=0;t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray);t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=i.width/this.width;this.uvArray[5]=i.height/this.height;this.uvArray[6]=i.width/this.width;this.uvArray[7]=i.height/this.height;t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray);var o=r;var h=this.texturePool.pop();if(!h)h=new s.FilterTexture(this.gl,this.width*this.renderSession.resolution,this.height*this.renderSession.resolution);h.resize(this.width*this.renderSession.resolution,this.height*this.renderSession.resolution);t.bindFramebuffer(t.FRAMEBUFFER,h.frameBuffer);t.clear(t.COLOR_BUFFER_BIT);t.disable(t.BLEND);for(var l=0;l<e.filterPasses.length-1;l++){var u=e.filterPasses[l];t.bindFramebuffer(t.FRAMEBUFFER,h.frameBuffer);t.activeTexture(t.TEXTURE0);t.bindTexture(t.TEXTURE_2D,o.texture);this.applyFilterPass(u,i,i.width,i.height);var c=o;o=h;h=c}t.enable(t.BLEND);r=o;this.texturePool.push(h)}var d=e.filterPasses[e.filterPasses.length-1];this.offsetX-=i.x;this.offsetY-=i.y;var f=this.width;var p=this.height;var g=0;var m=0;var y=this.buffer;if(this.filterStack.length===0){t.colorMask(true,true,true,true)}else{var v=this.filterStack[this.filterStack.length-1];i=v._filterArea;f=i.width;p=i.height;g=i.x;m=i.y;y=v._glFilterTexture.frameBuffer}n.x=f/2;n.y=-p/2;a.x=g;a.y=m;i=e._filterArea;var b=i.x-g;var x=i.y-m;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=b;this.vertexArray[1]=x+i.height;this.vertexArray[2]=b+i.width;this.vertexArray[3]=x+i.height;this.vertexArray[4]=b;this.vertexArray[5]=x;this.vertexArray[6]=b+i.width;this.vertexArray[7]=x;t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray);t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=i.width/this.width;this.uvArray[5]=i.height/this.height;this.uvArray[6]=i.width/this.width;this.uvArray[7]=i.height/this.height;t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray);t.viewport(0,0,f*this.renderSession.resolution,p*this.renderSession.resolution);t.bindFramebuffer(t.FRAMEBUFFER,y);t.activeTexture(t.TEXTURE0);t.bindTexture(t.TEXTURE_2D,r.texture);if(this.renderSession.stencilManager){this.renderSession.stencilManager.destroy()}this.renderSession.stencilManager=e._previous_stencil_mgr;e._previous_stencil_mgr=null;if(this.renderSession.stencilManager.count>0){t.enable(t.STENCIL_TEST)}else{t.disable(t.STENCIL_TEST)}this.applyFilterPass(d,i,f,p);this.texturePool.push(r);e._glFilterTexture=null};s.WebGLFilterManager.prototype.applyFilterPass=function(t,e,i,r){var n=this.gl;var a=t.shaders[n.id];if(!a){a=new s.PixiShader(n);a.fragmentSrc=t.fragmentSrc;a.uniforms=t.uniforms;a.init();t.shaders[n.id]=a}this.renderSession.shaderManager.setShader(a);n.uniform2f(a.projectionVector,i/2,-r/2);n.uniform2f(a.offsetVector,0,0);if(t.uniforms.dimensions){t.uniforms.dimensions.value[0]=this.width;t.uniforms.dimensions.value[1]=this.height;t.uniforms.dimensions.value[2]=this.vertexArray[0];t.uniforms.dimensions.value[3]=this.vertexArray[5]}a.syncUniforms();n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer);n.vertexAttribPointer(a.aVertexPosition,2,n.FLOAT,false,0,0);n.bindBuffer(n.ARRAY_BUFFER,this.uvBuffer);n.vertexAttribPointer(a.aTextureCoord,2,n.FLOAT,false,0,0);n.bindBuffer(n.ARRAY_BUFFER,this.colorBuffer);n.vertexAttribPointer(a.colorAttribute,2,n.FLOAT,false,0,0);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer);n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0);this.renderSession.drawCount++};s.WebGLFilterManager.prototype.initShaderBuffers=function(){var t=this.gl;this.vertexBuffer=t.createBuffer();this.uvBuffer=t.createBuffer();this.colorBuffer=t.createBuffer();this.indexBuffer=t.createBuffer();this.vertexArray=new s.Float32Array([0,0,1,0,0,1,1,1]);t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);t.bufferData(t.ARRAY_BUFFER,this.vertexArray,t.STATIC_DRAW);this.uvArray=new s.Float32Array([0,0,1,0,0,1,1,1]);t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer);t.bufferData(t.ARRAY_BUFFER,this.uvArray,t.STATIC_DRAW);this.colorArray=new s.Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]);t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer);t.bufferData(t.ARRAY_BUFFER,this.colorArray,t.STATIC_DRAW);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),t.STATIC_DRAW)};s.WebGLFilterManager.prototype.destroy=function(){var t=this.gl;this.filterStack=null;this.offsetX=0;this.offsetY=0;for(var e=0;e<this.texturePool.length;e++){this.texturePool[e].destroy()}this.texturePool=null;t.deleteBuffer(this.vertexBuffer);t.deleteBuffer(this.uvBuffer);t.deleteBuffer(this.colorBuffer);t.deleteBuffer(this.indexBuffer)};s.FilterTexture=function(t,e,i,r){this.gl=t;this.frameBuffer=t.createFramebuffer();this.texture=t.createTexture();r=r||s.scaleModes.DEFAULT;t.bindTexture(t.TEXTURE_2D,this.texture);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,r===s.scaleModes.LINEAR?t.LINEAR:t.NEAREST);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,r===s.scaleModes.LINEAR?t.LINEAR:t.NEAREST);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer);t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer);t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0);this.renderBuffer=t.createRenderbuffer();t.bindRenderbuffer(t.RENDERBUFFER,this.renderBuffer);t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.renderBuffer);this.resize(e,i)};s.FilterTexture.prototype.constructor=s.FilterTexture;s.FilterTexture.prototype.clear=function(){var t=this.gl;t.clearColor(0,0,0,0);t.clear(t.COLOR_BUFFER_BIT)};s.FilterTexture.prototype.resize=function(t,e){if(this.width===t&&this.height===e)return;this.width=t;this.height=e;var i=this.gl;i.bindTexture(i.TEXTURE_2D,this.texture);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,null);i.bindRenderbuffer(i.RENDERBUFFER,this.renderBuffer);i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t,e)};s.FilterTexture.prototype.destroy=function(){var t=this.gl;t.deleteFramebuffer(this.frameBuffer);t.deleteTexture(this.texture);this.frameBuffer=null;this.texture=null};s.CanvasBuffer=function(t,e){this.width=t;this.height=e;this.canvas=s.CanvasPool.create(this,this.width,this.height);this.context=this.canvas.getContext("2d");this.canvas.width=t;this.canvas.height=e};s.CanvasBuffer.prototype.constructor=s.CanvasBuffer;s.CanvasBuffer.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0);this.context.clearRect(0,0,this.width,this.height)};s.CanvasBuffer.prototype.resize=function(t,e){this.width=this.canvas.width=t;this.height=this.canvas.height=e};s.CanvasBuffer.prototype.destroy=function(){s.CanvasPool.remove(this)};s.CanvasMaskManager=function(){};s.CanvasMaskManager.prototype.constructor=s.CanvasMaskManager;s.CanvasMaskManager.prototype.pushMask=function(t,e){var i=e.context;i.save();var r=t.alpha;var n=t.worldTransform;var a=e.resolution;i.setTransform(n.a*a,n.b*a,n.c*a,n.d*a,n.tx*a,n.ty*a);s.CanvasGraphics.renderGraphicsMask(t,i);i.clip();t.worldAlpha=r};s.CanvasMaskManager.prototype.popMask=function(t){t.context.restore()};s.CanvasTinter=function(){};s.CanvasTinter.getTintedTexture=function(t,e){var i=t.tintedTexture||s.CanvasPool.create(this);s.CanvasTinter.tintMethod(t.texture,e,i);return i};s.CanvasTinter.tintWithMultiply=function(t,e,i){var s=i.getContext("2d");var r=t.crop;if(i.width!==r.width||i.height!==r.height){i.width=r.width;i.height=r.height}s.clearRect(0,0,r.width,r.height);s.fillStyle="#"+("00000"+(e|0).toString(16)).substr(-6);s.fillRect(0,0,r.width,r.height);s.globalCompositeOperation="multiply";s.drawImage(t.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height);s.globalCompositeOperation="destination-atop";s.drawImage(t.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height)};s.CanvasTinter.tintWithPerPixel=function(t,e,i){var r=i.getContext("2d");var n=t.crop;i.width=n.width;i.height=n.height;r.globalCompositeOperation="copy";r.drawImage(t.baseTexture.source,n.x,n.y,n.width,n.height,0,0,n.width,n.height);var a=s.hex2rgb(e);var o=a[0],h=a[1],l=a[2];var u=r.getImageData(0,0,n.width,n.height);var c=u.data;for(var d=0;d<c.length;d+=4){c[d+0]*=o;c[d+1]*=h;c[d+2]*=l;if(!s.CanvasTinter.canHandleAlpha){var f=c[d+3];c[d+0]/=255/f;c[d+1]/=255/f;c[d+2]/=255/f}}r.putImageData(u,0,0)};s.CanvasTinter.checkInverseAlpha=function(){var t=new s.CanvasBuffer(2,1);t.context.fillStyle="rgba(10, 20, 30, 0.5)";t.context.fillRect(0,0,1,1);var e=t.context.getImageData(0,0,1,1);if(e===null){return false}t.context.putImageData(e,1,0);var i=t.context.getImageData(1,0,1,1);return i.data[0]===e.data[0]&&i.data[1]===e.data[1]&&i.data[2]===e.data[2]&&i.data[3]===e.data[3]};s.CanvasTinter.canHandleAlpha=s.CanvasTinter.checkInverseAlpha();s.CanvasTinter.canUseMultiply=s.canUseNewCanvasBlendModes();s.CanvasTinter.tintMethod=s.CanvasTinter.canUseMultiply?s.CanvasTinter.tintWithMultiply:s.CanvasTinter.tintWithPerPixel;s.CanvasRenderer=function(t){this.game=t;if(!s.defaultRenderer){s.defaultRenderer=this}this.type=s.CANVAS_RENDERER;this.resolution=t.resolution;this.clearBeforeRender=t.clearBeforeRender;this.transparent=t.transparent;this.autoResize=false;this.width=t.width*this.resolution;this.height=t.height*this.resolution;this.view=t.canvas;this.context=this.view.getContext("2d",{alpha:this.transparent});this.refresh=true;this.count=0;this.maskManager=new s.CanvasMaskManager;this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:Phaser.Canvas.getSmoothingPrefix(this.context),roundPixels:false};this.mapBlendModes();this.resize(this.width,this.height)};s.CanvasRenderer.prototype.constructor=s.CanvasRenderer;s.CanvasRenderer.prototype.render=function(t){this.context.setTransform(1,0,0,1,0,0);this.context.globalAlpha=1;this.renderSession.currentBlendMode=0;this.renderSession.shakeX=this.game.camera._shake.x;this.renderSession.shakeY=this.game.camera._shake.y;this.context.globalCompositeOperation="source-over";if(navigator.isCocoonJS&&this.view.screencanvas){this.context.fillStyle="black";this.context.clear()}if(this.clearBeforeRender){if(this.transparent){this.context.clearRect(0,0,this.width,this.height)}else if(t._bgColor){this.context.fillStyle=t._bgColor.rgba;this.context.fillRect(0,0,this.width,this.height)}}this.renderDisplayObject(t)};s.CanvasRenderer.prototype.destroy=function(t){if(t===undefined){t=true}if(t&&this.view.parent){this.view.parent.removeChild(this.view)}this.view=null;this.context=null;this.maskManager=null;this.renderSession=null};s.CanvasRenderer.prototype.resize=function(t,e){this.width=t*this.resolution;this.height=e*this.resolution;this.view.width=this.width;this.view.height=this.height;if(this.autoResize){this.view.style.width=this.width/this.resolution+"px";this.view.style.height=this.height/this.resolution+"px"}if(this.renderSession.smoothProperty){this.context[this.renderSession.smoothProperty]=this.renderSession.scaleMode===s.scaleModes.LINEAR}};s.CanvasRenderer.prototype.renderDisplayObject=function(t,e,i){this.renderSession.context=e||this.context;this.renderSession.resolution=this.resolution;t._renderCanvas(this.renderSession,i)};s.CanvasRenderer.prototype.mapBlendModes=function(){if(!s.blendModesCanvas){var t=[];var e=s.blendModes;var i=s.canUseNewCanvasBlendModes();t[e.NORMAL]="source-over";t[e.ADD]="lighter";t[e.MULTIPLY]=i?"multiply":"source-over";t[e.SCREEN]=i?"screen":"source-over";t[e.OVERLAY]=i?"overlay":"source-over";t[e.DARKEN]=i?"darken":"source-over";t[e.LIGHTEN]=i?"lighten":"source-over";t[e.COLOR_DODGE]=i?"color-dodge":"source-over";t[e.COLOR_BURN]=i?"color-burn":"source-over";t[e.HARD_LIGHT]=i?"hard-light":"source-over";t[e.SOFT_LIGHT]=i?"soft-light":"source-over";t[e.DIFFERENCE]=i?"difference":"source-over";t[e.EXCLUSION]=i?"exclusion":"source-over";t[e.HUE]=i?"hue":"source-over";t[e.SATURATION]=i?"saturation":"source-over";t[e.COLOR]=i?"color":"source-over";t[e.LUMINOSITY]=i?"luminosity":"source-over";s.blendModesCanvas=t}};s.BaseTexture=function(t,e){this.resolution=1;this.width=100;this.height=100;this.scaleMode=e||s.scaleModes.DEFAULT;this.hasLoaded=false;this.source=t;this.premultipliedAlpha=true;this._glTextures=[];this.mipmap=false;this._dirty=[true,true,true,true];if(!t){return}if((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height){this.hasLoaded=true;this.width=this.source.naturalWidth||this.source.width;this.height=this.source.naturalHeight||this.source.height;this.dirty()}this.skipRender=false;this._powerOf2=false};s.BaseTexture.prototype.constructor=s.BaseTexture;s.BaseTexture.prototype.forceLoaded=function(t,e){this.hasLoaded=true;this.width=t;this.height=e;this.dirty()};s.BaseTexture.prototype.destroy=function(){if(this.source){s.CanvasPool.removeByCanvas(this.source)}this.source=null;this.unloadFromGPU()};s.BaseTexture.prototype.updateSourceImage=function(t){console.warn("PIXI.BaseTexture.updateSourceImage is deprecated. Use Phaser.Sprite.loadTexture instead.")};s.BaseTexture.prototype.dirty=function(){for(var t=0;t<this._glTextures.length;t++){this._dirty[t]=true}};s.BaseTexture.prototype.unloadFromGPU=function(){this.dirty();for(var t=this._glTextures.length-1;t>=0;t--){var e=this._glTextures[t];var i=s.glContexts[t];if(i&&e){i.deleteTexture(e)}}this._glTextures.length=0;this.dirty()};s.BaseTexture.fromCanvas=function(t,e){if(t.width===0){t.width=1}if(t.height===0){t.height=1}return new s.BaseTexture(t,e)};s.TextureSilentFail=false;s.Texture=function(t,e,i,r){this.noFrame=false;if(!e){this.noFrame=true;e=new s.Rectangle(0,0,1,1)}if(t instanceof s.Texture){t=t.baseTexture}this.baseTexture=t;this.frame=e;this.trim=r;this.valid=false;this.isTiling=false;this.requiresUpdate=false;this.requiresReTint=false;this._uvs=null;this.width=0;this.height=0;this.crop=i||new s.Rectangle(0,0,1,1);if(t.hasLoaded){if(this.noFrame)e=new s.Rectangle(0,0,t.width,t.height);this.setFrame(e)}};s.Texture.prototype.constructor=s.Texture;s.Texture.prototype.onBaseTextureLoaded=function(){var t=this.baseTexture;if(this.noFrame){this.frame=new s.Rectangle(0,0,t.width,t.height)}this.setFrame(this.frame)};s.Texture.prototype.destroy=function(t){if(t)this.baseTexture.destroy();this.valid=false};s.Texture.prototype.setFrame=function(t){this.noFrame=false;this.frame=t;this.width=t.width;this.height=t.height;this.crop.x=t.x;this.crop.y=t.y;this.crop.width=t.width;this.crop.height=t.height;if(!this.trim&&(t.x+t.width>this.baseTexture.width||t.y+t.height>this.baseTexture.height)){if(!s.TextureSilentFail){throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this)}this.valid=false;return}this.valid=t&&t.width&&t.height&&this.baseTexture.source&&this.baseTexture.hasLoaded;if(this.trim){this.width=this.trim.width;this.height=this.trim.height;this.frame.width=this.trim.width;this.frame.height=this.trim.height}if(this.valid)this._updateUvs()};s.Texture.prototype._updateUvs=function(){if(!this._uvs)this._uvs=new s.TextureUvs;var t=this.crop;var e=this.baseTexture.width;var i=this.baseTexture.height;this._uvs.x0=t.x/e;this._uvs.y0=t.y/i;this._uvs.x1=(t.x+t.width)/e;this._uvs.y1=t.y/i;this._uvs.x2=(t.x+t.width)/e;this._uvs.y2=(t.y+t.height)/i;this._uvs.x3=t.x/e;this._uvs.y3=(t.y+t.height)/i};s.Texture.fromCanvas=function(t,e){var i=s.BaseTexture.fromCanvas(t,e);return new s.Texture(i)};s.TextureUvs=function(){this.x0=0;this.y0=0;this.x1=0;this.y1=0;this.x2=0;this.y2=0;this.x3=0;this.y3=0};s.RenderTexture=function(t,e,i,r,n){this.width=t||100;this.height=e||100;this.resolution=n||1;this.frame=new s.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution);this.crop=new s.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution);this.baseTexture=new s.BaseTexture;this.baseTexture.width=this.width*this.resolution;this.baseTexture.height=this.height*this.resolution;this.baseTexture._glTextures=[];this.baseTexture.resolution=this.resolution;this.baseTexture.scaleMode=r||s.scaleModes.DEFAULT;this.baseTexture.hasLoaded=true;s.Texture.call(this,this.baseTexture,new s.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution));this.renderer=i||s.defaultRenderer;if(this.renderer.type===s.WEBGL_RENDERER){var a=this.renderer.gl;this.baseTexture._dirty[a.id]=false;this.textureBuffer=new s.FilterTexture(a,this.width,this.height,this.baseTexture.scaleMode);this.baseTexture._glTextures[a.id]=this.textureBuffer.texture;this.render=this.renderWebGL;this.projection=new s.Point(this.width*.5,-this.height*.5)}else{this.render=this.renderCanvas;this.textureBuffer=new s.CanvasBuffer(this.width*this.resolution,this.height*this.resolution);this.baseTexture.source=this.textureBuffer.canvas}this.valid=true;this.tempMatrix=new Phaser.Matrix;this._updateUvs()};s.RenderTexture.prototype=Object.create(s.Texture.prototype);s.RenderTexture.prototype.constructor=s.RenderTexture;s.RenderTexture.prototype.resize=function(t,e,i){if(t===this.width&&e===this.height)return;this.valid=t>0&&e>0;this.width=t;this.height=e;this.frame.width=this.crop.width=t*this.resolution;this.frame.height=this.crop.height=e*this.resolution;if(i){this.baseTexture.width=this.width*this.resolution;this.baseTexture.height=this.height*this.resolution}if(this.renderer.type===s.WEBGL_RENDERER){this.projection.x=this.width/2;this.projection.y=-this.height/2}if(!this.valid)return;this.textureBuffer.resize(this.width,this.height)};s.RenderTexture.prototype.clear=function(){if(!this.valid){return}if(this.renderer.type===s.WEBGL_RENDERER){this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer)}this.textureBuffer.clear()};s.RenderTexture.prototype.renderWebGL=function(t,e,i){if(!this.valid||t.alpha===0){return}var s=t.worldTransform;s.identity();s.translate(0,this.projection.y*2);if(e){s.append(e)}s.scale(1,-1);for(var r=0;r<t.children.length;r++){t.children[r].updateTransform()}var n=this.renderer.gl;n.viewport(0,0,this.width*this.resolution,this.height*this.resolution);n.bindFramebuffer(n.FRAMEBUFFER,this.textureBuffer.frameBuffer);if(i){this.textureBuffer.clear()}this.renderer.spriteBatch.dirty=true;this.renderer.renderDisplayObject(t,this.projection,this.textureBuffer.frameBuffer,e);this.renderer.spriteBatch.dirty=true};s.RenderTexture.prototype.renderCanvas=function(t,e,i){if(!this.valid||t.alpha===0){return}var s=t.worldTransform;s.identity();if(e){s.append(e)}for(var r=0;r<t.children.length;r++){t.children[r].updateTransform()}if(i){this.textureBuffer.clear()}var n=this.renderer.resolution;this.renderer.resolution=this.resolution;this.renderer.renderDisplayObject(t,this.textureBuffer.context,e);this.renderer.resolution=n};s.RenderTexture.prototype.getImage=function(){var t=new Image;t.src=this.getBase64();return t};s.RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()};s.RenderTexture.prototype.getCanvas=function(){if(this.renderer.type===s.WEBGL_RENDERER){var t=this.renderer.gl;var e=this.textureBuffer.width;var i=this.textureBuffer.height;var r=new Uint8Array(4*e*i);t.bindFramebuffer(t.FRAMEBUFFER,this.textureBuffer.frameBuffer);t.readPixels(0,0,e,i,t.RGBA,t.UNSIGNED_BYTE,r);t.bindFramebuffer(t.FRAMEBUFFER,null);var n=new s.CanvasBuffer(e,i);var a=n.context.getImageData(0,0,e,i);a.data.set(r);n.context.putImageData(a,0,0);return n.canvas}else{return this.textureBuffer.canvas}};s.AbstractFilter=function(t,e){this.passes=[this];this.shaders=[];this.dirty=true;this.padding=0;this.uniforms=e||{};this.fragmentSrc=t||[]};s.AbstractFilter.prototype.constructor=s.AbstractFilter;s.AbstractFilter.prototype.syncUniforms=function(){for(var t=0,e=this.shaders.length;t<e;t++){this.shaders[t].dirty=true}};s.Strip=function(t){s.DisplayObjectContainer.call(this);this.texture=t;this.uvs=new s.Float32Array([0,1,1,1,1,0,0,1]);this.vertices=new s.Float32Array([0,0,100,0,100,100,0,100]);this.colors=new s.Float32Array([1,1,1,1]);this.indices=new s.Uint16Array([0,1,2,3]);this.dirty=true;this.blendMode=s.blendModes.NORMAL;this.canvasPadding=0;this.drawMode=s.Strip.DrawModes.TRIANGLE_STRIP};s.Strip.prototype=Object.create(s.DisplayObjectContainer.prototype);s.Strip.prototype.constructor=s.Strip;s.Strip.prototype._renderWebGL=function(t){if(!this.visible||this.alpha<=0)return;t.spriteBatch.stop();if(!this._vertexBuffer)this._initWebGL(t);t.shaderManager.setShader(t.shaderManager.stripShader);this._renderStrip(t);t.spriteBatch.start()};s.Strip.prototype._initWebGL=function(t){var e=t.gl;this._vertexBuffer=e.createBuffer();this._indexBuffer=e.createBuffer();this._uvBuffer=e.createBuffer();this._colorBuffer=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer);e.bufferData(e.ARRAY_BUFFER,this.vertices,e.DYNAMIC_DRAW);e.bindBuffer(e.ARRAY_BUFFER,this._uvBuffer);e.bufferData(e.ARRAY_BUFFER,this.uvs,e.STATIC_DRAW);e.bindBuffer(e.ARRAY_BUFFER,this._colorBuffer);e.bufferData(e.ARRAY_BUFFER,this.colors,e.STATIC_DRAW);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer);e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW)};s.Strip.prototype._renderStrip=function(t){var e=t.gl;var i=t.projection,r=t.offset,n=t.shaderManager.stripShader;var a=this.drawMode===s.Strip.DrawModes.TRIANGLE_STRIP?e.TRIANGLE_STRIP:e.TRIANGLES;t.blendModeManager.setBlendMode(this.blendMode);e.uniformMatrix3fv(n.translationMatrix,false,this.worldTransform.toArray(true));e.uniform2f(n.projectionVector,i.x,-i.y);e.uniform2f(n.offsetVector,-r.x,-r.y);e.uniform1f(n.alpha,this.worldAlpha);if(!this.dirty){e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer);e.bufferSubData(e.ARRAY_BUFFER,0,this.vertices);e.vertexAttribPointer(n.aVertexPosition,2,e.FLOAT,false,0,0);e.bindBuffer(e.ARRAY_BUFFER,this._uvBuffer);e.vertexAttribPointer(n.aTextureCoord,2,e.FLOAT,false,0,0);e.activeTexture(e.TEXTURE0);if(this.texture.baseTexture._dirty[e.id]){t.renderer.updateTexture(this.texture.baseTexture)}else{e.bindTexture(e.TEXTURE_2D,this.texture.baseTexture._glTextures[e.id])}e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer)}else{this.dirty=false;e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer);e.bufferData(e.ARRAY_BUFFER,this.vertices,e.STATIC_DRAW);e.vertexAttribPointer(n.aVertexPosition,2,e.FLOAT,false,0,0);e.bindBuffer(e.ARRAY_BUFFER,this._uvBuffer);e.bufferData(e.ARRAY_BUFFER,this.uvs,e.STATIC_DRAW);e.vertexAttribPointer(n.aTextureCoord,2,e.FLOAT,false,0,0);e.activeTexture(e.TEXTURE0);if(this.texture.baseTexture._dirty[e.id]){t.renderer.updateTexture(this.texture.baseTexture)}else{e.bindTexture(e.TEXTURE_2D,this.texture.baseTexture._glTextures[e.id])}e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer);e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW)}e.drawElements(a,this.indices.length,e.UNSIGNED_SHORT,0)};s.Strip.prototype._renderCanvas=function(t){var e=t.context;var i=this.worldTransform;var r=i.tx*t.resolution+t.shakeX;var n=i.ty*t.resolution+t.shakeY;if(t.roundPixels){e.setTransform(i.a,i.b,i.c,i.d,r|0,n|0)}else{e.setTransform(i.a,i.b,i.c,i.d,r,n)}if(this.drawMode===s.Strip.DrawModes.TRIANGLE_STRIP){this._renderCanvasTriangleStrip(e)}else{this._renderCanvasTriangles(e)}};s.Strip.prototype._renderCanvasTriangleStrip=function(t){var e=this.vertices;var i=this.uvs;var s=e.length/2;this.count++;for(var r=0;r<s-2;r++){var n=r*2;this._renderCanvasDrawTriangle(t,e,i,n,n+2,n+4)}};s.Strip.prototype._renderCanvasTriangles=function(t){var e=this.vertices;var i=this.uvs;var s=this.indices;var r=s.length;this.count++;for(var n=0;n<r;n+=3){var a=s[n]*2,o=s[n+1]*2,h=s[n+2]*2;this._renderCanvasDrawTriangle(t,e,i,a,o,h)}};s.Strip.prototype._renderCanvasDrawTriangle=function(t,e,i,s,r,n){var a=this.texture.baseTexture.source;var o=this.texture.width;var h=this.texture.height;var l=e[s],u=e[r],c=e[n];var d=e[s+1],f=e[r+1],p=e[n+1];var g=i[s]*o,m=i[r]*o,y=i[n]*o;var v=i[s+1]*h,b=i[r+1]*h,x=i[n+1]*h;if(this.canvasPadding>0){var w=this.canvasPadding/this.worldTransform.a;var _=this.canvasPadding/this.worldTransform.d;var P=(l+u+c)/3;var T=(d+f+p)/3;var C=l-P;var S=d-T;var A=Math.sqrt(C*C+S*S);l=P+C/A*(A+w);d=T+S/A*(A+_);C=u-P;S=f-T;A=Math.sqrt(C*C+S*S);u=P+C/A*(A+w);f=T+S/A*(A+_);C=c-P;S=p-T;A=Math.sqrt(C*C+S*S);c=P+C/A*(A+w);p=T+S/A*(A+_)}t.save();t.beginPath();t.moveTo(l,d);t.lineTo(u,f);t.lineTo(c,p);t.closePath();t.clip();var E=g*b+v*y+m*x-b*y-v*m-g*x;var I=l*b+v*c+u*x-b*c-v*u-l*x;var M=g*u+l*y+m*c-u*y-l*m-g*c;var R=g*b*c+v*u*y+l*m*x-l*b*y-v*m*c-g*u*x;var L=d*b+v*p+f*x-b*p-v*f-d*x;var B=g*f+d*y+m*p-f*y-d*m-g*p;var O=g*b*p+v*f*y+d*m*x-d*b*y-v*m*p-g*f*x;t.transform(I/E,L/E,M/E,B/E,R/E,O/E);t.drawImage(a,0,0);t.restore()};s.Strip.prototype.renderStripFlat=function(t){var e=this.context;var i=t.vertices;var s=i.length/2;this.count++;e.beginPath();for(var r=1;r<s-2;r++){var n=r*2;var a=i[n],o=i[n+2],h=i[n+4];var l=i[n+1],u=i[n+3],c=i[n+5];e.moveTo(a,l);e.lineTo(o,u);e.lineTo(h,c)}e.fillStyle="#FF0000";e.fill();e.closePath()};s.Strip.prototype.onTextureUpdate=function(){this.updateFrame=true};s.Strip.prototype.getBounds=function(t){var e=t||this.worldTransform;var i=e.a;var r=e.b;var n=e.c;var a=e.d;var o=e.tx;var h=e.ty;var l=-Infinity;var u=-Infinity;var c=Infinity;var d=Infinity;var f=this.vertices;for(var p=0,g=f.length;p<g;p+=2){var m=f[p],y=f[p+1];var v=i*m+n*y+o;var b=a*y+r*m+h;c=v<c?v:c;d=b<d?b:d;l=v>l?v:l;u=b>u?b:u}if(c===-Infinity||u===Infinity){return s.EmptyRectangle}var x=this._bounds;x.x=c;x.width=l-c;x.y=d;x.height=u-d;this._currentBounds=x;return x};s.Strip.DrawModes={TRIANGLE_STRIP:0,TRIANGLES:1};s.Rope=function(t,e){s.Strip.call(this,t);this.points=e;this.vertices=new s.Float32Array(e.length*4);this.uvs=new s.Float32Array(e.length*4);this.colors=new s.Float32Array(e.length*2);this.indices=new s.Uint16Array(e.length*2);this.refresh()};s.Rope.prototype=Object.create(s.Strip.prototype);s.Rope.prototype.constructor=s.Rope;s.Rope.prototype.refresh=function(){var t=this.points;if(t.length<1)return;var e=this.uvs;var i=t[0];var s=this.indices;var r=this.colors;this.count-=.2;e[0]=0;e[1]=0;e[2]=0;e[3]=1;r[0]=1;r[1]=1;s[0]=0;s[1]=1;var n=t.length,a,o,h;for(var l=1;l<n;l++){a=t[l];o=l*4;h=l/(n-1);if(l%2){e[o]=h;e[o+1]=0;e[o+2]=h;e[o+3]=1}else{e[o]=h;e[o+1]=0;e[o+2]=h;e[o+3]=1}o=l*2;r[o]=1;r[o+1]=1;o=l*2;s[o]=o;s[o+1]=o+1;i=a}};s.Rope.prototype.updateTransform=function(){var t=this.points;if(t.length<1)return;var e=t[0];var i;var r={x:0,y:0};this.count-=.2;var n=this.vertices;var a=t.length,o,h,l,u,c;for(var d=0;d<a;d++){o=t[d];h=d*4;if(d<t.length-1){i=t[d+1]}else{i=o}r.y=-(i.x-e.x);r.x=i.y-e.y;l=(1-d/(a-1))*10;if(l>1)l=1;u=Math.sqrt(r.x*r.x+r.y*r.y);c=this.texture.height/2;r.x/=u;r.y/=u;r.x*=c;r.y*=c;n[h]=o.x+r.x;n[h+1]=o.y+r.y;n[h+2]=o.x-r.x;n[h+3]=o.y-r.y;e=o}s.DisplayObjectContainer.prototype.updateTransform.call(this)};s.Rope.prototype.setTexture=function(t){this.texture=t};s.TilingSprite=function(t,e,i){s.Sprite.call(this,t);this._width=e||128;this._height=i||128;this.tileScale=new s.Point(1,1);this.tileScaleOffset=new s.Point(1,1);this.tilePosition=new s.Point;this.renderable=true;this.tint=16777215;this.textureDebug=false;this.blendMode=s.blendModes.NORMAL;this.canvasBuffer=null;this.tilingTexture=null;this.tilePattern=null;this.refreshTexture=true;this.frameWidth=0;this.frameHeight=0};s.TilingSprite.prototype=Object.create(s.Sprite.prototype);s.TilingSprite.prototype.constructor=s.TilingSprite;s.TilingSprite.prototype.setTexture=function(t){if(this.texture!==t){this.texture=t;this.refreshTexture=true;this.cachedTint=16777215}};s.TilingSprite.prototype._renderWebGL=function(t){if(!this.visible||!this.renderable||this.alpha===0){return}if(this._mask){t.spriteBatch.stop();t.maskManager.pushMask(this.mask,t);t.spriteBatch.start()}if(this._filters){t.spriteBatch.flush();t.filterManager.pushFilter(this._filterBlock)}if(this.refreshTexture){this.generateTilingTexture(true,t);if(this.tilingTexture){if(this.tilingTexture.needsUpdate){t.renderer.updateTexture(this.tilingTexture.baseTexture);this.tilingTexture.needsUpdate=false}}else{return}}t.spriteBatch.renderTilingSprite(this);for(var e=0;e<this.children.length;e++){this.children[e]._renderWebGL(t)}t.spriteBatch.stop();if(this._filters){t.filterManager.popFilter()}if(this._mask){t.maskManager.popMask(this._mask,t)}t.spriteBatch.start()};s.TilingSprite.prototype._renderCanvas=function(t){if(!this.visible||!this.renderable||this.alpha===0){return}var e=t.context;if(this._mask){t.maskManager.pushMask(this._mask,t)}e.globalAlpha=this.worldAlpha;var i=this.worldTransform;var r=t.resolution;var n=i.tx*r+t.shakeX;var a=i.ty*r+t.shakeY;e.setTransform(i.a*r,i.b*r,i.c*r,i.d*r,n,a);if(this.refreshTexture){this.generateTilingTexture(false,t);if(this.tilingTexture){this.tilePattern=e.createPattern(this.tilingTexture.baseTexture.source,"repeat")}else{return}}var o=t.currentBlendMode;if(this.blendMode!==t.currentBlendMode){t.currentBlendMode=this.blendMode;e.globalCompositeOperation=s.blendModesCanvas[t.currentBlendMode]}var h=this.tilePosition;var l=this.tileScale;h.x%=this.tilingTexture.baseTexture.width;h.y%=this.tilingTexture.baseTexture.height;e.scale(l.x,l.y);e.translate(h.x+this.anchor.x*-this._width,h.y+this.anchor.y*-this._height);e.fillStyle=this.tilePattern;var n=-h.x;var a=-h.y;var u=this._width/l.x;var c=this._height/l.y;if(t.roundPixels){n|=0;a|=0;u|=0;c|=0}e.fillRect(n,a,u,c);e.scale(1/l.x,1/l.y);e.translate(-h.x+this.anchor.x*this._width,-h.y+this.anchor.y*this._height);if(this._mask){t.maskManager.popMask(t)}for(var d=0;d<this.children.length;d++){this.children[d]._renderCanvas(t)}if(o!==this.blendMode){t.currentBlendMode=o;e.globalCompositeOperation=s.blendModesCanvas[o]}};s.TilingSprite.prototype.onTextureUpdate=function(){};s.TilingSprite.prototype.generateTilingTexture=function(t,e){if(!this.texture.baseTexture.hasLoaded){return}var i=this.texture;var r=i.frame;var n=this._frame.sourceSizeW||this._frame.width;var a=this._frame.sourceSizeH||this._frame.height;var o=0;var h=0;if(this._frame.trimmed){o=this._frame.spriteSourceSizeX;h=this._frame.spriteSourceSizeY}if(t){n=s.getNextPowerOfTwo(n);a=s.getNextPowerOfTwo(a)}if(this.canvasBuffer){this.canvasBuffer.resize(n,a);this.tilingTexture.baseTexture.width=n;this.tilingTexture.baseTexture.height=a;this.tilingTexture.needsUpdate=true}else{this.canvasBuffer=new s.CanvasBuffer(n,a);this.tilingTexture=s.Texture.fromCanvas(this.canvasBuffer.canvas);this.tilingTexture.isTiling=true;this.tilingTexture.needsUpdate=true}if(this.textureDebug){this.canvasBuffer.context.strokeStyle="#00ff00";this.canvasBuffer.context.strokeRect(0,0,n,a)}var l=i.crop.width;var u=i.crop.height;if(l!==n||u!==a){l=n;u=a}this.canvasBuffer.context.drawImage(i.baseTexture.source,i.crop.x,i.crop.y,i.crop.width,i.crop.height,o,h,l,u);this.tileScaleOffset.x=r.width/n;this.tileScaleOffset.y=r.height/a;this.refreshTexture=false;this.tilingTexture.baseTexture._powerOf2=true};s.TilingSprite.prototype.getBounds=function(){var t=this._width;var e=this._height;var i=t*(1-this.anchor.x);var s=t*-this.anchor.x;var r=e*(1-this.anchor.y);var n=e*-this.anchor.y;var a=this.worldTransform;var o=a.a;var h=a.b;var l=a.c;var u=a.d;var c=a.tx;var d=a.ty;var f=o*s+l*n+c;var p=u*n+h*s+d;var g=o*i+l*n+c;var m=u*n+h*i+d;var y=o*i+l*r+c;var v=u*r+h*i+d;var b=o*s+l*r+c;var x=u*r+h*s+d;var w=-Infinity;var _=-Infinity;var P=Infinity;var T=Infinity;P=f<P?f:P;P=g<P?g:P;P=y<P?y:P;P=b<P?b:P;T=p<T?p:T;T=m<T?m:T;T=v<T?v:T;T=x<T?x:T;w=f>w?f:w;w=g>w?g:w;w=y>w?y:w;w=b>w?b:w;_=p>_?p:_;_=m>_?m:_;_=v>_?v:_;_=x>_?x:_;var C=this._bounds;C.x=P;C.width=w-P;C.y=T;C.height=_-T;this._currentBounds=C;return C};s.TilingSprite.prototype.destroy=function(){s.Sprite.prototype.destroy.call(this);if(this.canvasBuffer){this.canvasBuffer.destroy();this.canvasBuffer=null}this.tileScale=null;this.tileScaleOffset=null;this.tilePosition=null;if(this.tilingTexture){this.tilingTexture.destroy(true);this.tilingTexture=null}};Object.defineProperty(s.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t}});Object.defineProperty(s.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t}});if(true){if(true&&t.exports){e=t.exports=s}e.PIXI=s}else{}return s}).call(this)},987:function(t,e,i){(function(e){t.exports=e["p2"]=i(988)}).call(this,i(14))},988:function(t,e,i){var s;var s;!function(e){if(true)t.exports=e();else{var i}}(function(){var t,e,i;return function t(e,i,r){function n(o,h){if(!i[o]){if(!e[o]){var l=typeof s=="function"&&s;if(!h&&l)return s(o,!0);if(a)return a(o,!0);throw new Error("Cannot find module '"+o+"'")}var u=i[o]={exports:{}};e[o][0].call(u.exports,function(t){var i=e[o][1][t];return n(i?i:t)},u,u.exports,t,e,i,r)}return i[o].exports}var a=typeof s=="function"&&s;for(var o=0;o<r.length;o++)n(r[o]);return n}({1:[function(t,e,i){var s=t("./Scalar");e.exports=r;function r(){}r.lineInt=function(t,e,i){i=i||0;var r=[0,0];var n,a,o,h,l,u,c;n=t[1][1]-t[0][1];a=t[0][0]-t[1][0];o=n*t[0][0]+a*t[0][1];h=e[1][1]-e[0][1];l=e[0][0]-e[1][0];u=h*e[0][0]+l*e[0][1];c=n*l-h*a;if(!s.eq(c,0,i)){r[0]=(l*o-a*u)/c;r[1]=(n*u-h*o)/c}return r};r.segmentsIntersect=function(t,e,i,s){var r=e[0]-t[0];var n=e[1]-t[1];var a=s[0]-i[0];var o=s[1]-i[1];if(a*n-o*r==0)return false;var h=(r*(i[1]-t[1])+n*(t[0]-i[0]))/(a*n-o*r);var l=(a*(t[1]-i[1])+o*(i[0]-t[0]))/(o*r-a*n);return h>=0&&h<=1&&l>=0&&l<=1}},{"./Scalar":4}],2:[function(t,e,i){e.exports=s;function s(){}s.area=function(t,e,i){return(e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1])};s.left=function(t,e,i){return s.area(t,e,i)>0};s.leftOn=function(t,e,i){return s.area(t,e,i)>=0};s.right=function(t,e,i){return s.area(t,e,i)<0};s.rightOn=function(t,e,i){return s.area(t,e,i)<=0};var r=[],n=[];s.collinear=function(t,e,i,a){if(!a)return s.area(t,e,i)==0;else{var o=r,h=n;o[0]=e[0]-t[0];o[1]=e[1]-t[1];h[0]=i[0]-e[0];h[1]=i[1]-e[1];var l=o[0]*h[0]+o[1]*h[1],u=Math.sqrt(o[0]*o[0]+o[1]*o[1]),c=Math.sqrt(h[0]*h[0]+h[1]*h[1]),d=Math.acos(l/(u*c));return d<a}};s.sqdist=function(t,e){var i=e[0]-t[0];var s=e[1]-t[1];return i*i+s*s}},{}],3:[function(t,e,i){var s=t("./Line"),r=t("./Point"),n=t("./Scalar");e.exports=a;function a(){this.vertices=[]}a.prototype.at=function(t){var e=this.vertices,i=e.length;return e[t<0?t%i+i:t%i]};a.prototype.first=function(){return this.vertices[0]};a.prototype.last=function(){return this.vertices[this.vertices.length-1]};a.prototype.clear=function(){this.vertices.length=0};a.prototype.append=function(t,e,i){if(typeof e=="undefined")throw new Error("From is not given!");if(typeof i=="undefined")throw new Error("To is not given!");if(i-1<e)throw new Error("lol1");if(i>t.vertices.length)throw new Error("lol2");if(e<0)throw new Error("lol3");for(var s=e;s<i;s++){this.vertices.push(t.vertices[s])}};a.prototype.makeCCW=function(){var t=0,e=this.vertices;for(var i=1;i<this.vertices.length;++i){if(e[i][1]<e[t][1]||e[i][1]==e[t][1]&&e[i][0]>e[t][0]){t=i}}if(!r.left(this.at(t-1),this.at(t),this.at(t+1))){this.reverse()}};a.prototype.reverse=function(){var t=[];for(var e=0,i=this.vertices.length;e!==i;e++){t.push(this.vertices.pop())}this.vertices=t};a.prototype.isReflex=function(t){return r.right(this.at(t-1),this.at(t),this.at(t+1))};var o=[],h=[];a.prototype.canSee=function(t,e){var i,n,a=o,l=h;if(r.leftOn(this.at(t+1),this.at(t),this.at(e))&&r.rightOn(this.at(t-1),this.at(t),this.at(e))){return false}n=r.sqdist(this.at(t),this.at(e));for(var u=0;u!==this.vertices.length;++u){if((u+1)%this.vertices.length===t||u===t)continue;if(r.leftOn(this.at(t),this.at(e),this.at(u+1))&&r.rightOn(this.at(t),this.at(e),this.at(u))){a[0]=this.at(t);a[1]=this.at(e);l[0]=this.at(u);l[1]=this.at(u+1);i=s.lineInt(a,l);if(r.sqdist(this.at(t),i)<n){return false}}}return true};a.prototype.copy=function(t,e,i){var s=i||new a;s.clear();if(t<e){for(var r=t;r<=e;r++)s.vertices.push(this.vertices[r])}else{for(var r=0;r<=e;r++)s.vertices.push(this.vertices[r]);for(var r=t;r<this.vertices.length;r++)s.vertices.push(this.vertices[r])}return s};a.prototype.getCutEdges=function(){var t=[],e=[],i=[],s=new a;var r=Number.MAX_VALUE;for(var n=0;n<this.vertices.length;++n){if(this.isReflex(n)){for(var o=0;o<this.vertices.length;++o){if(this.canSee(n,o)){e=this.copy(n,o,s).getCutEdges();i=this.copy(o,n,s).getCutEdges();for(var h=0;h<i.length;h++)e.push(i[h]);if(e.length<r){t=e;r=e.length;t.push([this.at(n),this.at(o)])}}}}}return t};a.prototype.decomp=function(){var t=this.getCutEdges();if(t.length>0)return this.slice(t);else return[this]};a.prototype.slice=function(t){if(t.length==0)return[this];if(t instanceof Array&&t.length&&t[0]instanceof Array&&t[0].length==2&&t[0][0]instanceof Array){var e=[this];for(var i=0;i<t.length;i++){var s=t[i];for(var r=0;r<e.length;r++){var n=e[r];var a=n.slice(s);if(a){e.splice(r,1);e.push(a[0],a[1]);break}}}return e}else{var s=t;var i=this.vertices.indexOf(s[0]);var r=this.vertices.indexOf(s[1]);if(i!=-1&&r!=-1){return[this.copy(i,r),this.copy(r,i)]}else{return false}}};a.prototype.isSimple=function(){var t=this.vertices;for(var e=0;e<t.length-1;e++){for(var i=0;i<e-1;i++){if(s.segmentsIntersect(t[e],t[e+1],t[i],t[i+1])){return false}}}for(var e=1;e<t.length-2;e++){if(s.segmentsIntersect(t[0],t[t.length-1],t[e],t[e+1])){return false}}return true};function l(t,e,i,s,r){r=r||0;var a=e[1]-t[1];var o=t[0]-e[0];var h=a*t[0]+o*t[1];var l=s[1]-i[1];var u=i[0]-s[0];var c=l*i[0]+u*i[1];var d=a*u-l*o;if(!n.eq(d,0,r))return[(u*h-o*c)/d,(a*c-l*h)/d];else return[0,0]}a.prototype.quickDecomp=function(t,e,i,s,n,o){n=n||100;o=o||0;s=s||25;t=typeof t!="undefined"?t:[];e=e||[];i=i||[];var h=[0,0],u=[0,0],c=[0,0];var d=0,f=0,p=0,g=0;var m=0,y=0,v=0;var b=new a,x=new a;var w=this,_=this.vertices;if(_.length<3)return t;o++;if(o>n){console.warn("quickDecomp: max level ("+n+") reached.");return t}for(var P=0;P<this.vertices.length;++P){if(w.isReflex(P)){e.push(w.vertices[P]);d=f=Number.MAX_VALUE;for(var T=0;T<this.vertices.length;++T){if(r.left(w.at(P-1),w.at(P),w.at(T))&&r.rightOn(w.at(P-1),w.at(P),w.at(T-1))){c=l(w.at(P-1),w.at(P),w.at(T),w.at(T-1));if(r.right(w.at(P+1),w.at(P),c)){p=r.sqdist(w.vertices[P],c);if(p<f){f=p;u=c;y=T}}}if(r.left(w.at(P+1),w.at(P),w.at(T+1))&&r.rightOn(w.at(P+1),w.at(P),w.at(T))){c=l(w.at(P+1),w.at(P),w.at(T),w.at(T+1));if(r.left(w.at(P-1),w.at(P),c)){p=r.sqdist(w.vertices[P],c);if(p<d){d=p;h=c;m=T}}}}if(y==(m+1)%this.vertices.length){c[0]=(u[0]+h[0])/2;c[1]=(u[1]+h[1])/2;i.push(c);if(P<m){b.append(w,P,m+1);b.vertices.push(c);x.vertices.push(c);if(y!=0){x.append(w,y,w.vertices.length)}x.append(w,0,P+1)}else{if(P!=0){b.append(w,P,w.vertices.length)}b.append(w,0,m+1);b.vertices.push(c);x.vertices.push(c);x.append(w,y,P+1)}}else{if(y>m){m+=this.vertices.length}g=Number.MAX_VALUE;if(m<y){return t}for(var T=y;T<=m;++T){if(r.leftOn(w.at(P-1),w.at(P),w.at(T))&&r.rightOn(w.at(P+1),w.at(P),w.at(T))){p=r.sqdist(w.at(P),w.at(T));if(p<g){g=p;v=T%this.vertices.length}}}if(P<v){b.append(w,P,v+1);if(v!=0){x.append(w,v,_.length)}x.append(w,0,P+1)}else{if(P!=0){b.append(w,P,_.length)}b.append(w,0,v+1);x.append(w,v,P+1)}}if(b.vertices.length<x.vertices.length){b.quickDecomp(t,e,i,s,n,o);x.quickDecomp(t,e,i,s,n,o)}else{x.quickDecomp(t,e,i,s,n,o);b.quickDecomp(t,e,i,s,n,o)}return t}}t.push(this);return t};a.prototype.removeCollinearPoints=function(t){var e=0;for(var i=this.vertices.length-1;this.vertices.length>3&&i>=0;--i){if(r.collinear(this.at(i-1),this.at(i),this.at(i+1),t)){this.vertices.splice(i%this.vertices.length,1);i--;e++}}return e}},{"./Line":1,"./Point":2,"./Scalar":4}],4:[function(t,e,i){e.exports=s;function s(){}s.eq=function(t,e,i){i=i||0;return Math.abs(t-e)<i}},{}],5:[function(t,e,i){e.exports={Polygon:t("./Polygon"),Point:t("./Point")}},{"./Point":2,"./Polygon":3}],6:[function(t,e,i){e.exports={name:"p2",version:"0.7.0",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"^0.4.5","grunt-contrib-jshint":"^0.11.2","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0"},dependencies:{"poly-decomp":"0.1.0"}}},{}],7:[function(t,e,i){var s=t("../math/vec2"),r=t("../utils/Utils");e.exports=n;function n(t){this.lowerBound=s.create();if(t&&t.lowerBound){s.copy(this.lowerBound,t.lowerBound)}this.upperBound=s.create();if(t&&t.upperBound){s.copy(this.upperBound,t.upperBound)}}var a=s.create();n.prototype.setFromPoints=function(t,e,i,r){var n=this.lowerBound,o=this.upperBound;if(typeof i!=="number"){i=0}if(i!==0){s.rotate(n,t[0],i)}else{s.copy(n,t[0])}s.copy(o,n);var h=Math.cos(i),l=Math.sin(i);for(var u=1;u<t.length;u++){var c=t[u];if(i!==0){var d=c[0],f=c[1];a[0]=h*d-l*f;a[1]=l*d+h*f;c=a}for(var p=0;p<2;p++){if(c[p]>o[p]){o[p]=c[p]}if(c[p]<n[p]){n[p]=c[p]}}}if(e){s.add(this.lowerBound,this.lowerBound,e);s.add(this.upperBound,this.upperBound,e)}if(r){this.lowerBound[0]-=r;this.lowerBound[1]-=r;this.upperBound[0]+=r;this.upperBound[1]+=r}};n.prototype.copy=function(t){s.copy(this.lowerBound,t.lowerBound);s.copy(this.upperBound,t.upperBound)};n.prototype.extend=function(t){var e=2;while(e--){var i=t.lowerBound[e];if(this.lowerBound[e]>i){this.lowerBound[e]=i}var s=t.upperBound[e];if(this.upperBound[e]<s){this.upperBound[e]=s}}};n.prototype.overlaps=function(t){var e=this.lowerBound,i=this.upperBound,s=t.lowerBound,r=t.upperBound;return(s[0]<=i[0]&&i[0]<=r[0]||e[0]<=r[0]&&r[0]<=i[0])&&(s[1]<=i[1]&&i[1]<=r[1]||e[1]<=r[1]&&r[1]<=i[1])};n.prototype.containsPoint=function(t){var e=this.lowerBound,i=this.upperBound;return e[0]<=t[0]&&t[0]<=i[0]&&e[1]<=t[1]&&t[1]<=i[1]};n.prototype.overlapsRay=function(t){var e=0;var i=1/t.direction[0];var s=1/t.direction[1];var r=(this.lowerBound[0]-t.from[0])*i;var n=(this.upperBound[0]-t.from[0])*i;var a=(this.lowerBound[1]-t.from[1])*s;var o=(this.upperBound[1]-t.from[1])*s;var h=Math.max(Math.max(Math.min(r,n),Math.min(a,o)));var l=Math.min(Math.min(Math.max(r,n),Math.max(a,o)));if(l<0){return-1}if(h>l){return-1}return h}},{"../math/vec2":30,"../utils/Utils":57}],8:[function(t,e,i){var s=t("../math/vec2");var r=t("../objects/Body");e.exports=n;function n(t){this.type=t;this.result=[];this.world=null;this.boundingVolumeType=n.AABB}n.AABB=1;n.BOUNDING_CIRCLE=2;n.prototype.setWorld=function(t){this.world=t};n.prototype.getCollisionPairs=function(t){};var a=s.create();n.boundingRadiusCheck=function(t,e){s.sub(a,t.position,e.position);var i=s.squaredLength(a),r=t.boundingRadius+e.boundingRadius;return i<=r*r};n.aabbCheck=function(t,e){return t.getAABB().overlaps(e.getAABB())};n.prototype.boundingVolumeCheck=function(t,e){var i;switch(this.boundingVolumeType){case n.BOUNDING_CIRCLE:i=n.boundingRadiusCheck(t,e);break;case n.AABB:i=n.aabbCheck(t,e);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return i};n.canCollide=function(t,e){var i=r.KINEMATIC;var s=r.STATIC;if(t.type===s&&e.type===s){return false}if(t.type===i&&e.type===s||t.type===s&&e.type===i){return false}if(t.type===i&&e.type===i){return false}if(t.sleepState===r.SLEEPING&&e.sleepState===r.SLEEPING){return false}if(t.sleepState===r.SLEEPING&&e.type===s||e.sleepState===r.SLEEPING&&t.type===s){return false}return true};n.NAIVE=1;n.SAP=2},{"../math/vec2":30,"../objects/Body":31}],9:[function(t,e,i){var s=t("../shapes/Circle"),r=t("../shapes/Plane"),n=t("../shapes/Shape"),a=t("../shapes/Particle"),o=t("../collision/Broadphase"),h=t("../math/vec2");e.exports=l;function l(){o.call(this,o.NAIVE)}l.prototype=new o;l.prototype.constructor=l;l.prototype.getCollisionPairs=function(t){var e=t.bodies,i=this.result;i.length=0;for(var s=0,r=e.length;s!==r;s++){var n=e[s];for(var a=0;a<s;a++){var h=e[a];if(o.canCollide(n,h)&&this.boundingVolumeCheck(n,h)){i.push(n,h)}}}return i};l.prototype.aabbQuery=function(t,e,i){i=i||[];var s=t.bodies;for(var r=0;r<s.length;r++){var n=s[r];if(n.aabbNeedsUpdate){n.updateAABB()}if(n.aabb.overlaps(e)){i.push(n)}}return i}},{"../collision/Broadphase":8,"../math/vec2":30,"../shapes/Circle":39,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45}],10:[function(t,e,i){var s=t("../math/vec2"),r=s.sub,n=s.add,a=s.dot,o=t("../utils/Utils"),h=t("../utils/ContactEquationPool"),l=t("../utils/FrictionEquationPool"),u=t("../utils/TupleDictionary"),c=t("../equations/Equation"),d=t("../equations/ContactEquation"),f=t("../equations/FrictionEquation"),p=t("../shapes/Circle"),g=t("../shapes/Convex"),m=t("../shapes/Shape"),y=t("../objects/Body"),v=t("../shapes/Box");e.exports=G;var b=s.fromValues(0,1);var x=s.fromValues(0,0),w=s.fromValues(0,0),_=s.fromValues(0,0),P=s.fromValues(0,0),T=s.fromValues(0,0),C=s.fromValues(0,0),S=s.fromValues(0,0),A=s.fromValues(0,0),E=s.fromValues(0,0),I=s.fromValues(0,0),M=s.fromValues(0,0),R=s.fromValues(0,0),L=s.fromValues(0,0),B=s.fromValues(0,0),O=s.fromValues(0,0),k=s.fromValues(0,0),F=s.fromValues(0,0),D=s.fromValues(0,0),U=[];function G(){this.contactEquations=[];this.frictionEquations=[];this.enableFriction=true;this.enabledEquations=true;this.slipForce=10;this.frictionCoefficient=.3;this.surfaceVelocity=0;this.contactEquationPool=new h({size:32});this.frictionEquationPool=new l({size:64});this.restitution=0;this.stiffness=c.DEFAULT_STIFFNESS;this.relaxation=c.DEFAULT_RELAXATION;this.frictionStiffness=c.DEFAULT_STIFFNESS;this.frictionRelaxation=c.DEFAULT_RELAXATION;this.enableFrictionReduction=true;this.collidingBodiesLastStep=new u;this.contactSkinSize=.01}var N=s.create();var X=s.create();G.prototype.bodiesOverlap=function(t,e){var i=N;var s=X;for(var r=0,n=t.shapes.length;r!==n;r++){var a=t.shapes[r];t.toWorldFrame(i,a.position);for(var o=0,h=e.shapes.length;o!==h;o++){var l=e.shapes[o];e.toWorldFrame(s,l.position);if(this[a.type|l.type](t,a,i,a.angle+t.angle,e,l,s,l.angle+e.angle,true)){return true}}}return false};G.prototype.collidedLastStep=function(t,e){var i=t.id|0,s=e.id|0;return!!this.collidingBodiesLastStep.get(i,s)};G.prototype.reset=function(){this.collidingBodiesLastStep.reset();var t=this.contactEquations;var e=t.length;while(e--){var i=t[e],s=i.bodyA.id,r=i.bodyB.id;this.collidingBodiesLastStep.set(s,r,true)}var n=this.contactEquations,a=this.frictionEquations;for(var o=0;o<n.length;o++){this.contactEquationPool.release(n[o])}for(var o=0;o<a.length;o++){this.frictionEquationPool.release(a[o])}this.contactEquations.length=this.frictionEquations.length=0};G.prototype.createContactEquation=function(t,e,i,s){var r=this.contactEquationPool.get();r.bodyA=t;r.bodyB=e;r.shapeA=i;r.shapeB=s;r.restitution=this.restitution;r.firstImpact=!this.collidedLastStep(t,e);r.stiffness=this.stiffness;r.relaxation=this.relaxation;r.needsUpdate=true;r.enabled=this.enabledEquations;r.offset=this.contactSkinSize;return r};G.prototype.createFrictionEquation=function(t,e,i,s){var r=this.frictionEquationPool.get();r.bodyA=t;r.bodyB=e;r.shapeA=i;r.shapeB=s;r.setSlipForce(this.slipForce);r.frictionCoefficient=this.frictionCoefficient;r.relativeVelocity=this.surfaceVelocity;r.enabled=this.enabledEquations;r.needsUpdate=true;r.stiffness=this.frictionStiffness;r.relaxation=this.frictionRelaxation;r.contactEquations.length=0;return r};G.prototype.createFrictionFromContact=function(t){var e=this.createFrictionEquation(t.bodyA,t.bodyB,t.shapeA,t.shapeB);s.copy(e.contactPointA,t.contactPointA);s.copy(e.contactPointB,t.contactPointB);s.rotate90cw(e.t,t.normalA);e.contactEquations.push(t);return e};G.prototype.createFrictionFromAverage=function(t){var e=this.contactEquations[this.contactEquations.length-1];var i=this.createFrictionEquation(e.bodyA,e.bodyB,e.shapeA,e.shapeB);var r=e.bodyA;var n=e.bodyB;s.set(i.contactPointA,0,0);s.set(i.contactPointB,0,0);s.set(i.t,0,0);for(var a=0;a!==t;a++){e=this.contactEquations[this.contactEquations.length-1-a];if(e.bodyA===r){s.add(i.t,i.t,e.normalA);s.add(i.contactPointA,i.contactPointA,e.contactPointA);s.add(i.contactPointB,i.contactPointB,e.contactPointB)}else{s.sub(i.t,i.t,e.normalA);s.add(i.contactPointA,i.contactPointA,e.contactPointB);s.add(i.contactPointB,i.contactPointB,e.contactPointA)}i.contactEquations.push(e)}var o=1/t;s.scale(i.contactPointA,i.contactPointA,o);s.scale(i.contactPointB,i.contactPointB,o);s.normalize(i.t,i.t);s.rotate90cw(i.t,i.t);return i};G.prototype[m.LINE|m.CONVEX]=G.prototype.convexLine=function(t,e,i,s,r,n,a,o,h){if(h){return false}else{return 0}};G.prototype[m.LINE|m.BOX]=G.prototype.lineBox=function(t,e,i,s,r,n,a,o,h){if(h){return false}else{return 0}};function W(t,e){s.set(t.vertices[0],-e.length*.5,-e.radius);s.set(t.vertices[1],e.length*.5,-e.radius);s.set(t.vertices[2],e.length*.5,e.radius);s.set(t.vertices[3],-e.length*.5,e.radius)}var j=new v({width:1,height:1}),V=s.create();G.prototype[m.CAPSULE|m.CONVEX]=G.prototype[m.CAPSULE|m.BOX]=G.prototype.convexCapsule=function(t,e,i,r,n,a,o,h,l){var u=V;s.set(u,a.length/2,0);s.rotate(u,u,h);s.add(u,u,o);var c=this.circleConvex(n,a,u,h,t,e,i,r,l,a.radius);s.set(u,-a.length/2,0);s.rotate(u,u,h);s.add(u,u,o);var d=this.circleConvex(n,a,u,h,t,e,i,r,l,a.radius);if(l&&(c||d)){return true}var f=j;W(f,a);var p=this.convexConvex(t,e,i,r,n,f,o,h,l);return p+c+d};G.prototype[m.CAPSULE|m.LINE]=G.prototype.lineCapsule=function(t,e,i,s,r,n,a,o,h){if(h){return false}else{return 0}};var q=s.create();var H=s.create();var Y=new v({width:1,height:1});G.prototype[m.CAPSULE|m.CAPSULE]=G.prototype.capsuleCapsule=function(t,e,i,r,n,a,o,h,l){var u;var c=q,d=H;var f=0;for(var p=0;p<2;p++){s.set(c,(p===0?-1:1)*e.length/2,0);s.rotate(c,c,r);s.add(c,c,i);for(var g=0;g<2;g++){s.set(d,(g===0?-1:1)*a.length/2,0);s.rotate(d,d,h);s.add(d,d,o);if(this.enableFrictionReduction){u=this.enableFriction;this.enableFriction=false}var m=this.circleCircle(t,e,c,r,n,a,d,h,l,e.radius,a.radius);if(this.enableFrictionReduction){this.enableFriction=u}if(l&&m){return true}f+=m}}if(this.enableFrictionReduction){u=this.enableFriction;this.enableFriction=false}var y=Y;W(y,e);var v=this.convexCapsule(t,y,i,r,n,a,o,h,l);if(this.enableFrictionReduction){this.enableFriction=u}if(l&&v){return true}f+=v;if(this.enableFrictionReduction){var u=this.enableFriction;this.enableFriction=false}W(y,a);var b=this.convexCapsule(n,y,o,h,t,e,i,r,l);if(this.enableFrictionReduction){this.enableFriction=u}if(l&&b){return true}f+=b;if(this.enableFrictionReduction){if(f&&this.enableFriction){this.frictionEquations.push(this.createFrictionFromAverage(f))}}return f};G.prototype[m.LINE|m.LINE]=G.prototype.lineLine=function(t,e,i,s,r,n,a,o,h){if(h){return false}else{return 0}};G.prototype[m.PLANE|m.LINE]=G.prototype.planeLine=function(t,e,i,o,h,l,u,c,d){var f=x,p=w,g=_,m=P,y=T,v=C,I=S,M=A,R=E,L=U,B=0;s.set(f,-l.length/2,0);s.set(p,l.length/2,0);s.rotate(g,f,c);s.rotate(m,p,c);n(g,g,u);n(m,m,u);s.copy(f,g);s.copy(p,m);r(y,p,f);s.normalize(v,y);s.rotate90cw(R,v);s.rotate(M,b,o);L[0]=f;L[1]=p;for(var O=0;O<L.length;O++){var k=L[O];r(I,k,i);var F=a(I,M);if(F<0){if(d){return true}var D=this.createContactEquation(t,h,e,l);B++;s.copy(D.normalA,M);s.normalize(D.normalA,D.normalA);s.scale(I,M,F);r(D.contactPointA,k,I);r(D.contactPointA,D.contactPointA,t.position);r(D.contactPointB,k,u);n(D.contactPointB,D.contactPointB,u);r(D.contactPointB,D.contactPointB,h.position);this.contactEquations.push(D);if(!this.enableFrictionReduction){if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(D))}}}}if(d){return false}if(!this.enableFrictionReduction){if(B&&this.enableFriction){this.frictionEquations.push(this.createFrictionFromAverage(B))}}return B};G.prototype[m.PARTICLE|m.CAPSULE]=G.prototype.particleCapsule=function(t,e,i,s,r,n,a,o,h){return this.circleLine(t,e,i,s,r,n,a,o,h,n.radius,0)};G.prototype[m.CIRCLE|m.LINE]=G.prototype.circleLine=function(t,e,i,o,h,l,u,c,d,f,p){var f=f||0,p=typeof p!=="undefined"?p:e.radius,g=x,m=w,y=_,v=P,b=T,O=C,k=S,F=A,D=E,G=I,N=M,X=R,W=L,j=B,V=U;s.set(F,-l.length/2,0);s.set(D,l.length/2,0);s.rotate(G,F,c);s.rotate(N,D,c);n(G,G,u);n(N,N,u);s.copy(F,G);s.copy(D,N);r(O,D,F);s.normalize(k,O);s.rotate90cw(b,k);r(X,i,F);var q=a(X,b);r(v,F,u);r(W,i,u);var H=p+f;if(Math.abs(q)<H){s.scale(g,b,q);r(y,i,g);s.scale(m,b,a(b,W));s.normalize(m,m);s.scale(m,m,f);n(y,y,m);var Y=a(k,y);var z=a(k,F);var K=a(k,D);if(Y>z&&Y<K){if(d){return true}var J=this.createContactEquation(t,h,e,l);s.scale(J.normalA,g,-1);s.normalize(J.normalA,J.normalA);s.scale(J.contactPointA,J.normalA,p);n(J.contactPointA,J.contactPointA,i);r(J.contactPointA,J.contactPointA,t.position);r(J.contactPointB,y,u);n(J.contactPointB,J.contactPointB,u);r(J.contactPointB,J.contactPointB,h.position);this.contactEquations.push(J);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(J))}return 1}}V[0]=F;V[1]=D;for(var Q=0;Q<V.length;Q++){var Z=V[Q];r(X,Z,i);if(s.squaredLength(X)<Math.pow(H,2)){if(d){return true}var J=this.createContactEquation(t,h,e,l);s.copy(J.normalA,X);s.normalize(J.normalA,J.normalA);s.scale(J.contactPointA,J.normalA,p);n(J.contactPointA,J.contactPointA,i);r(J.contactPointA,J.contactPointA,t.position);r(J.contactPointB,Z,u);s.scale(j,J.normalA,-f);n(J.contactPointB,J.contactPointB,j);n(J.contactPointB,J.contactPointB,u);r(J.contactPointB,J.contactPointB,h.position);this.contactEquations.push(J);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(J))}return 1}}return 0};G.prototype[m.CIRCLE|m.CAPSULE]=G.prototype.circleCapsule=function(t,e,i,s,r,n,a,o,h){return this.circleLine(t,e,i,s,r,n,a,o,h,n.radius)};G.prototype[m.CIRCLE|m.CONVEX]=G.prototype[m.CIRCLE|m.BOX]=G.prototype.circleConvex=function(t,e,i,a,o,h,l,u,c,d){var d=typeof d==="number"?d:e.radius;var f=x,p=w,g=_,m=P,y=T,v=C,b=S,F=A,D=E,U=I,G=M,N=-1,X=null,W=R,j=L,V=B,q=O,H=k,Y=false,z=Number.MAX_VALUE;var K=0;var J=h.vertices;for(var Q=0;Q!==J.length+1;Q++){var $=J[Q%J.length],tt=J[(Q+1)%J.length];s.rotate(f,$,u);s.rotate(p,tt,u);n(f,f,l);n(p,p,l);r(g,p,f);s.normalize(m,g);s.rotate90cw(y,m);s.scale(V,y,-e.radius);n(V,V,i);if(Z(V,h,l,u)){s.sub(q,f,V);var et=Math.abs(s.dot(q,y));if(et<z){s.copy(H,V);z=et;s.scale(j,y,et);s.add(j,j,V);Y=true}}}if(Y){if(c){return true}var it=this.createContactEquation(t,o,e,h);s.sub(it.normalA,H,i);s.normalize(it.normalA,it.normalA);s.scale(it.contactPointA,it.normalA,d);n(it.contactPointA,it.contactPointA,i);r(it.contactPointA,it.contactPointA,t.position);r(it.contactPointB,j,l);n(it.contactPointB,it.contactPointB,l);r(it.contactPointB,it.contactPointB,o.position);this.contactEquations.push(it);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(it))}return 1}if(d>0){for(var Q=0;Q<J.length;Q++){var st=J[Q];s.rotate(G,st,u);n(G,G,l);r(U,G,i);if(s.squaredLength(U)<Math.pow(d,2)){if(c){return true}var it=this.createContactEquation(t,o,e,h);s.copy(it.normalA,U);s.normalize(it.normalA,it.normalA);s.scale(it.contactPointA,it.normalA,d);n(it.contactPointA,it.contactPointA,i);r(it.contactPointA,it.contactPointA,t.position);r(it.contactPointB,G,l);n(it.contactPointB,it.contactPointB,l);r(it.contactPointB,it.contactPointB,o.position);this.contactEquations.push(it);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(it))}return 1}}}return 0};var z=s.create(),K=s.create(),J=s.create(),Q=s.create();function Z(t,e,i,a){var o=z,h=K,l=J,u=Q,c=t,d=e.vertices,f=null;for(var p=0;p!==d.length+1;p++){var g=d[p%d.length],m=d[(p+1)%d.length];s.rotate(o,g,a);s.rotate(h,m,a);n(o,o,i);n(h,h,i);r(l,o,c);r(u,h,c);var y=s.crossLength(l,u);if(f===null){f=y}if(y*f<=0){return false}f=y}return true}G.prototype[m.PARTICLE|m.CONVEX]=G.prototype[m.PARTICLE|m.BOX]=G.prototype.particleConvex=function(t,e,i,o,h,l,u,c,d){var f=x,p=w,g=_,m=P,y=T,v=C,b=S,U=A,G=E,N=I,X=M,W=-1,j=null,V=R,q=L,H=B,Y=O,z=k,K=F,J=D,Q=Number.MAX_VALUE;var $=0,tt=false,et=l.vertices;if(!Z(i,l,u,c)){return 0}if(d){return true}var it=null;for(var st=0;st!==et.length+1;st++){var rt=et[st%et.length],nt=et[(st+1)%et.length];s.rotate(f,rt,c);s.rotate(p,nt,c);n(f,f,u);n(p,p,u);r(g,p,f);s.normalize(m,g);s.rotate90cw(y,m);r(N,i,f);var at=a(N,y);r(v,f,u);r(b,i,u);s.sub(K,f,i);var ot=Math.abs(s.dot(K,y));if(ot<Q){Q=ot;s.scale(q,y,ot);s.add(q,q,i);s.copy(J,y);tt=true}}if(tt){var ht=this.createContactEquation(t,h,e,l);s.scale(ht.normalA,J,-1);s.normalize(ht.normalA,ht.normalA);s.set(ht.contactPointA,0,0);n(ht.contactPointA,ht.contactPointA,i);r(ht.contactPointA,ht.contactPointA,t.position);r(ht.contactPointB,q,u);n(ht.contactPointB,ht.contactPointB,u);r(ht.contactPointB,ht.contactPointB,h.position);this.contactEquations.push(ht);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(ht))}return 1}return 0};G.prototype[m.CIRCLE]=G.prototype.circleCircle=function(t,e,i,a,o,h,l,u,c,d,f){var p=x,d=d||e.radius,f=f||h.radius;r(p,i,l);var g=d+f;if(s.squaredLength(p)>Math.pow(g,2)){return 0}if(c){return true}var m=this.createContactEquation(t,o,e,h);r(m.normalA,l,i);s.normalize(m.normalA,m.normalA);s.scale(m.contactPointA,m.normalA,d);s.scale(m.contactPointB,m.normalA,-f);n(m.contactPointA,m.contactPointA,i);r(m.contactPointA,m.contactPointA,t.position);n(m.contactPointB,m.contactPointB,l);r(m.contactPointB,m.contactPointB,o.position);this.contactEquations.push(m);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(m))}return 1};G.prototype[m.PLANE|m.CONVEX]=G.prototype[m.PLANE|m.BOX]=G.prototype.planeConvex=function(t,e,i,o,h,l,u,c,d){var f=x,p=w,g=_;var m=0;s.rotate(p,b,o);for(var y=0;y!==l.vertices.length;y++){var v=l.vertices[y];s.rotate(f,v,c);n(f,f,u);r(g,f,i);if(a(g,p)<=0){if(d){return true}m++;var P=this.createContactEquation(t,h,e,l);r(g,f,i);s.copy(P.normalA,p);var T=a(g,P.normalA);s.scale(g,P.normalA,T);r(P.contactPointB,f,h.position);r(P.contactPointA,f,g);r(P.contactPointA,P.contactPointA,t.position);this.contactEquations.push(P);if(!this.enableFrictionReduction){if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(P))}}}}if(this.enableFrictionReduction){if(this.enableFriction&&m){this.frictionEquations.push(this.createFrictionFromAverage(m))}}return m};G.prototype[m.PARTICLE|m.PLANE]=G.prototype.particlePlane=function(t,e,i,n,o,h,l,u,c){var d=x,f=w;u=u||0;r(d,i,l);s.rotate(f,b,u);var p=a(d,f);if(p>0){return 0}if(c){return true}var g=this.createContactEquation(o,t,h,e);s.copy(g.normalA,f);s.scale(d,g.normalA,p);r(g.contactPointA,i,d);r(g.contactPointA,g.contactPointA,o.position);r(g.contactPointB,i,t.position);this.contactEquations.push(g);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(g))}return 1};G.prototype[m.CIRCLE|m.PARTICLE]=G.prototype.circleParticle=function(t,e,i,a,o,h,l,u,c){var d=x;r(d,l,i);if(s.squaredLength(d)>Math.pow(e.radius,2)){return 0}if(c){return true}var f=this.createContactEquation(t,o,e,h);s.copy(f.normalA,d);s.normalize(f.normalA,f.normalA);s.scale(f.contactPointA,f.normalA,e.radius);n(f.contactPointA,f.contactPointA,i);r(f.contactPointA,f.contactPointA,t.position);r(f.contactPointB,l,o.position);this.contactEquations.push(f);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(f))}return 1};var $=new p({radius:1}),tt=s.create(),et=s.create(),it=s.create();G.prototype[m.PLANE|m.CAPSULE]=G.prototype.planeCapsule=function(t,e,i,r,a,o,h,l,u){var c=tt,d=et,f=$,p=it;s.set(c,-o.length/2,0);s.rotate(c,c,l);n(c,c,h);s.set(d,o.length/2,0);s.rotate(d,d,l);n(d,d,h);f.radius=o.radius;var g;if(this.enableFrictionReduction){g=this.enableFriction;this.enableFriction=false}var m=this.circlePlane(a,f,c,0,t,e,i,r,u),y=this.circlePlane(a,f,d,0,t,e,i,r,u);if(this.enableFrictionReduction){this.enableFriction=g}if(u){return m||y}else{var v=m+y;if(this.enableFrictionReduction){if(v){this.frictionEquations.push(this.createFrictionFromAverage(v))}}return v}};G.prototype[m.CIRCLE|m.PLANE]=G.prototype.circlePlane=function(t,e,i,o,h,l,u,c,d){var f=t,p=e,g=i,m=h,y=l,v=u,P=c;P=P||0;var T=x,C=w,S=_;r(T,g,v);s.rotate(C,b,P);var A=a(C,T);if(A>p.radius){return 0}if(d){return true}var E=this.createContactEquation(m,f,l,e);s.copy(E.normalA,C);s.scale(E.contactPointB,E.normalA,-p.radius);n(E.contactPointB,E.contactPointB,g);r(E.contactPointB,E.contactPointB,f.position);s.scale(S,E.normalA,A);r(E.contactPointA,T,S);n(E.contactPointA,E.contactPointA,v);r(E.contactPointA,E.contactPointA,m.position);this.contactEquations.push(E);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(E))}return 1};G.prototype[m.CONVEX]=G.prototype[m.CONVEX|m.BOX]=G.prototype[m.BOX]=G.prototype.convexConvex=function(t,e,i,o,h,l,u,c,d,f){var p=x,g=w,m=_,y=P,v=T,b=C,I=S,M=A,R=E,L=0,f=typeof f==="number"?f:0;var B=G.findSeparatingAxis(e,i,o,l,u,c,p);if(!B){return 0}r(M,u,i);if(a(p,M)>0){s.scale(p,p,-1)}var O=G.getClosestEdge(e,o,p,true),k=G.getClosestEdge(l,c,p);if(O===-1||k===-1){return 0}for(var F=0;F<2;F++){var D=O,U=k,N=e,X=l,W=i,j=u,V=o,q=c,H=t,Y=h;if(F===0){var z;z=D;D=U;U=z;z=N;N=X;X=z;z=W;W=j;j=z;z=V;V=q;q=z;z=H;H=Y;Y=z}for(var K=U;K<U+2;K++){var J=X.vertices[(K+X.vertices.length)%X.vertices.length];s.rotate(g,J,q);n(g,g,j);var Q=0;for(var Z=D-1;Z<D+2;Z++){var $=N.vertices[(Z+N.vertices.length)%N.vertices.length],tt=N.vertices[(Z+1+N.vertices.length)%N.vertices.length];s.rotate(m,$,V);s.rotate(y,tt,V);n(m,m,W);n(y,y,W);r(v,y,m);s.rotate90cw(R,v);s.normalize(R,R);r(M,g,m);var et=a(R,M);if(Z===D&&et<=f||Z!==D&&et<=0){Q++}}if(Q>=3){if(d){return true}var it=this.createContactEquation(H,Y,N,X);L++;var $=N.vertices[D%N.vertices.length],tt=N.vertices[(D+1)%N.vertices.length];s.rotate(m,$,V);s.rotate(y,tt,V);n(m,m,W);n(y,y,W);r(v,y,m);s.rotate90cw(it.normalA,v);s.normalize(it.normalA,it.normalA);r(M,g,m);var et=a(it.normalA,M);s.scale(I,it.normalA,et);r(it.contactPointA,g,W);r(it.contactPointA,it.contactPointA,I);n(it.contactPointA,it.contactPointA,W);r(it.contactPointA,it.contactPointA,H.position);r(it.contactPointB,g,j);n(it.contactPointB,it.contactPointB,j);r(it.contactPointB,it.contactPointB,Y.position);this.contactEquations.push(it);if(!this.enableFrictionReduction){if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(it))}}}}}if(this.enableFrictionReduction){if(this.enableFriction&&L){this.frictionEquations.push(this.createFrictionFromAverage(L))}}return L};var st=s.fromValues(0,0);G.projectConvexOntoAxis=function(t,e,i,r,n){var o=null,h=null,l,u,c=st;s.rotate(c,r,-i);for(var d=0;d<t.vertices.length;d++){l=t.vertices[d];u=a(l,c);if(o===null||u>o){o=u}if(h===null||u<h){h=u}}if(h>o){var f=h;h=o;o=f}var p=a(e,r);s.set(n,h+p,o+p)};var rt=s.fromValues(0,0),nt=s.fromValues(0,0),at=s.fromValues(0,0),ot=s.fromValues(0,0),ht=s.fromValues(0,0),lt=s.fromValues(0,0);G.findSeparatingAxis=function(t,e,i,n,a,o,h){var l=null,u=false,c=false,d=rt,f=nt,p=at,g=ot,m=ht,y=lt;if(t instanceof v&&n instanceof v){for(var b=0;b!==2;b++){var x=t,w=i;if(b===1){x=n;w=o}for(var _=0;_!==2;_++){if(_===0){s.set(g,0,1)}else if(_===1){s.set(g,1,0)}if(w!==0){s.rotate(g,g,w)}G.projectConvexOntoAxis(t,e,i,g,m);G.projectConvexOntoAxis(n,a,o,g,y);var P=m,T=y,C=false;if(m[0]>y[0]){T=m;P=y;C=true}var S=T[0]-P[1];u=S<=0;if(l===null||S>l){s.copy(h,g);l=S;c=u}}}}else{for(var b=0;b!==2;b++){var x=t,w=i;if(b===1){x=n;w=o}for(var _=0;_!==x.vertices.length;_++){s.rotate(f,x.vertices[_],w);s.rotate(p,x.vertices[(_+1)%x.vertices.length],w);r(d,p,f);s.rotate90cw(g,d);s.normalize(g,g);G.projectConvexOntoAxis(t,e,i,g,m);G.projectConvexOntoAxis(n,a,o,g,y);var P=m,T=y,C=false;if(m[0]>y[0]){T=m;P=y;C=true}var S=T[0]-P[1];u=S<=0;if(l===null||S>l){s.copy(h,g);l=S;c=u}}}}return c};var ut=s.fromValues(0,0),ct=s.fromValues(0,0),dt=s.fromValues(0,0);G.getClosestEdge=function(t,e,i,n){var o=ut,h=ct,l=dt;s.rotate(o,i,-e);if(n){s.scale(o,o,-1)}var u=-1,c=t.vertices.length,d=-1;for(var f=0;f!==c;f++){r(h,t.vertices[(f+1)%c],t.vertices[f%c]);s.rotate90cw(l,h);s.normalize(l,l);var p=a(l,o);if(u===-1||p>d){u=f%c;d=p}}return u};var ft=s.create(),pt=s.create(),gt=s.create(),mt=s.create(),yt=s.create(),vt=s.create(),bt=s.create();G.prototype[m.CIRCLE|m.HEIGHTFIELD]=G.prototype.circleHeightfield=function(t,e,i,a,o,h,l,u,c,d){var f=h.heights,d=d||e.radius,p=h.elementWidth,g=pt,m=ft,y=yt,v=bt,b=vt,x=gt,w=mt;var _=Math.floor((i[0]-d-l[0])/p),P=Math.ceil((i[0]+d-l[0])/p);if(_<0){_=0}if(P>=f.length){P=f.length-1}var T=f[_],C=f[P];for(var S=_;S<P;S++){if(f[S]<C){C=f[S]}if(f[S]>T){T=f[S]}}if(i[1]-d>T){return c?false:0}var A=false;for(var S=_;S<P;S++){s.set(x,S*p,f[S]);s.set(w,(S+1)*p,f[S+1]);s.add(x,x,l);s.add(w,w,l);s.sub(b,w,x);s.rotate(b,b,Math.PI/2);s.normalize(b,b);s.scale(m,b,-d);s.add(m,m,i);s.sub(g,m,x);var E=s.dot(g,b);if(m[0]>=x[0]&&m[0]<w[0]&&E<=0){if(c){return true}A=true;s.scale(g,b,-E);s.add(y,m,g);s.copy(v,b);var I=this.createContactEquation(o,t,h,e);s.copy(I.normalA,v);s.scale(I.contactPointB,I.normalA,-d);n(I.contactPointB,I.contactPointB,i);r(I.contactPointB,I.contactPointB,t.position);s.copy(I.contactPointA,y);s.sub(I.contactPointA,I.contactPointA,o.position);this.contactEquations.push(I);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(I))}}}A=false;if(d>0){for(var S=_;S<=P;S++){s.set(x,S*p,f[S]);s.add(x,x,l);s.sub(g,i,x);if(s.squaredLength(g)<Math.pow(d,2)){if(c){return true}A=true;var I=this.createContactEquation(o,t,h,e);s.copy(I.normalA,g);s.normalize(I.normalA,I.normalA);s.scale(I.contactPointB,I.normalA,-d);n(I.contactPointB,I.contactPointB,i);r(I.contactPointB,I.contactPointB,t.position);r(I.contactPointA,x,l);n(I.contactPointA,I.contactPointA,l);r(I.contactPointA,I.contactPointA,o.position);this.contactEquations.push(I);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(I))}}}}if(A){return 1}return 0};var xt=s.create(),wt=s.create(),_t=s.create(),Pt=new g({vertices:[s.create(),s.create(),s.create(),s.create()]});G.prototype[m.BOX|m.HEIGHTFIELD]=G.prototype[m.CONVEX|m.HEIGHTFIELD]=G.prototype.convexHeightfield=function(t,e,i,r,n,a,o,h,l){var u=a.heights,c=a.elementWidth,d=xt,f=wt,p=_t,g=Pt;var m=Math.floor((t.aabb.lowerBound[0]-o[0])/c),y=Math.ceil((t.aabb.upperBound[0]-o[0])/c);if(m<0){m=0}if(y>=u.length){y=u.length-1}var v=u[m],b=u[y];for(var x=m;x<y;x++){if(u[x]<b){b=u[x]}if(u[x]>v){v=u[x]}}if(t.aabb.lowerBound[1]>v){return l?false:0}var w=false;var _=0;for(var x=m;x<y;x++){s.set(d,x*c,u[x]);s.set(f,(x+1)*c,u[x+1]);s.add(d,d,o);s.add(f,f,o);var P=100;s.set(p,(f[0]+d[0])*.5,(f[1]+d[1]-P)*.5);s.sub(g.vertices[0],f,p);s.sub(g.vertices[1],d,p);s.copy(g.vertices[2],g.vertices[1]);s.copy(g.vertices[3],g.vertices[0]);g.vertices[2][1]-=P;g.vertices[3][1]-=P;_+=this.convexConvex(t,e,i,r,n,g,p,0,l)}return _}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../shapes/Box":37,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Shape":45,"../utils/ContactEquationPool":48,"../utils/FrictionEquationPool":49,"../utils/TupleDictionary":56,"../utils/Utils":57}],11:[function(t,e,i){e.exports=o;var s=t("../math/vec2");var r=t("../collision/RaycastResult");var n=t("../shapes/Shape");var a=t("../collision/AABB");function o(t){t=t||{};this.from=t.from?s.fromValues(t.from[0],t.from[1]):s.create();this.to=t.to?s.fromValues(t.to[0],t.to[1]):s.create();this.checkCollisionResponse=t.checkCollisionResponse!==undefined?t.checkCollisionResponse:true;this.skipBackfaces=!!t.skipBackfaces;this.collisionMask=t.collisionMask!==undefined?t.collisionMask:-1;this.collisionGroup=t.collisionGroup!==undefined?t.collisionGroup:-1;this.mode=t.mode!==undefined?t.mode:o.ANY;this.callback=t.callback||function(t){};this.direction=s.create();this.length=1;this.update()}o.prototype.constructor=o;o.CLOSEST=1;o.ANY=2;o.ALL=4;o.prototype.update=function(){var t=this.direction;s.sub(t,this.to,this.from);this.length=s.length(t);s.normalize(t,t)};o.prototype.intersectBodies=function(t,e){for(var i=0,s=e.length;!t.shouldStop(this)&&i<s;i++){var r=e[i];var n=r.getAABB();if(n.overlapsRay(this)>=0||n.containsPoint(this.from)){this.intersectBody(t,r)}}};var h=s.create();o.prototype.intersectBody=function(t,e){var i=this.checkCollisionResponse;if(i&&!e.collisionResponse){return}var r=h;for(var n=0,a=e.shapes.length;n<a;n++){var o=e.shapes[n];if(i&&!o.collisionResponse){continue}if((this.collisionGroup&o.collisionMask)===0||(o.collisionGroup&this.collisionMask)===0){continue}s.rotate(r,o.position,e.angle);s.add(r,r,e.position);var l=o.angle+e.angle;this.intersectShape(t,o,l,r,e);if(t.shouldStop(this)){break}}};o.prototype.intersectShape=function(t,e,i,s,r){var n=this.from;var a=d(n,this.direction,s);if(a>e.boundingRadius*e.boundingRadius){return}this._currentBody=r;this._currentShape=e;e.raycast(t,this,s,i);this._currentBody=this._currentShape=null};o.prototype.getAABB=function(t){var e=this.to;var i=this.from;s.set(t.lowerBound,Math.min(e[0],i[0]),Math.min(e[1],i[1]));s.set(t.upperBound,Math.max(e[0],i[0]),Math.max(e[1],i[1]))};var l=s.create();o.prototype.reportIntersection=function(t,e,i,r){var n=this.from;var a=this.to;var h=this._currentShape;var l=this._currentBody;if(this.skipBackfaces&&s.dot(i,this.direction)>0){return}switch(this.mode){case o.ALL:t.set(i,h,l,e,r);this.callback(t);break;case o.CLOSEST:if(e<t.fraction||!t.hasHit()){t.set(i,h,l,e,r)}break;case o.ANY:t.set(i,h,l,e,r);break}};var u=s.create(),c=s.create();function d(t,e,i){s.sub(u,i,t);var r=s.dot(u,e);s.scale(c,e,r);s.add(c,c,t);return s.squaredDistance(i,c)}},{"../collision/AABB":7,"../collision/RaycastResult":12,"../math/vec2":30,"../shapes/Shape":45}],12:[function(t,e,i){var s=t("../math/vec2");var r=t("../collision/Ray");e.exports=n;function n(){this.normal=s.create();this.shape=null;this.body=null;this.faceIndex=-1;this.fraction=-1;this.isStopped=false}n.prototype.reset=function(){s.set(this.normal,0,0);this.shape=null;this.body=null;this.faceIndex=-1;this.fraction=-1;this.isStopped=false};n.prototype.getHitDistance=function(t){return s.distance(t.from,t.to)*this.fraction};n.prototype.hasHit=function(){return this.fraction!==-1};n.prototype.getHitPoint=function(t,e){s.lerp(t,e.from,e.to,this.fraction)};n.prototype.stop=function(){this.isStopped=true};n.prototype.shouldStop=function(t){return this.isStopped||this.fraction!==-1&&t.mode===r.ANY};n.prototype.set=function(t,e,i,r,n){s.copy(this.normal,t);this.shape=e;this.body=i;this.fraction=r;this.faceIndex=n}},{"../collision/Ray":11,"../math/vec2":30}],13:[function(t,e,i){var s=t("../utils/Utils"),r=t("../collision/Broadphase");e.exports=n;function n(){r.call(this,r.SAP);this.axisList=[];this.axisIndex=0;var t=this;this._addBodyHandler=function(e){t.axisList.push(e.body)};this._removeBodyHandler=function(e){var i=t.axisList.indexOf(e.body);if(i!==-1){t.axisList.splice(i,1)}}}n.prototype=new r;n.prototype.constructor=n;n.prototype.setWorld=function(t){this.axisList.length=0;s.appendArray(this.axisList,t.bodies);t.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler);t.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler);this.world=t};n.sortAxisList=function(t,e){e=e|0;for(var i=1,s=t.length;i<s;i++){var r=t[i];for(var n=i-1;n>=0;n--){if(t[n].aabb.lowerBound[e]<=r.aabb.lowerBound[e]){break}t[n+1]=t[n]}t[n+1]=r}return t};n.prototype.sortList=function(){var t=this.axisList,e=this.axisIndex;n.sortAxisList(t,e)};n.prototype.getCollisionPairs=function(t){var e=this.axisList,i=this.result,s=this.axisIndex;i.length=0;var n=e.length;while(n--){var a=e[n];if(a.aabbNeedsUpdate){a.updateAABB()}}this.sortList();for(var o=0,h=e.length|0;o!==h;o++){var l=e[o];for(var u=o+1;u<h;u++){var c=e[u];var d=c.aabb.lowerBound[s]<=l.aabb.upperBound[s];if(!d){break}if(r.canCollide(l,c)&&this.boundingVolumeCheck(l,c)){i.push(l,c)}}}return i};n.prototype.aabbQuery=function(t,e,i){i=i||[];this.sortList();var s=this.axisIndex;var r="x";if(s===1){r="y"}if(s===2){r="z"}var n=this.axisList;var a=e.lowerBound[r];var o=e.upperBound[r];for(var h=0;h<n.length;h++){var l=n[h];if(l.aabbNeedsUpdate){l.updateAABB()}if(l.aabb.overlaps(e)){i.push(l)}}return i}},{"../collision/Broadphase":8,"../utils/Utils":57}],14:[function(t,e,i){e.exports=r;var s=t("../utils/Utils");function r(t,e,i,r){this.type=i;r=s.defaults(r,{collideConnected:true,wakeUpBodies:true});this.equations=[];this.bodyA=t;this.bodyB=e;this.collideConnected=r.collideConnected;if(r.wakeUpBodies){if(t){t.wakeUp()}if(e){e.wakeUp()}}}r.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")};r.DISTANCE=1;r.GEAR=2;r.LOCK=3;r.PRISMATIC=4;r.REVOLUTE=5;r.prototype.setStiffness=function(t){var e=this.equations;for(var i=0;i!==e.length;i++){var s=e[i];s.stiffness=t;s.needsUpdate=true}};r.prototype.setRelaxation=function(t){var e=this.equations;for(var i=0;i!==e.length;i++){var s=e[i];s.relaxation=t;s.needsUpdate=true}}},{"../utils/Utils":57}],15:[function(t,e,i){var s=t("./Constraint"),r=t("../equations/Equation"),n=t("../math/vec2"),a=t("../utils/Utils");e.exports=o;function o(t,e,i){i=a.defaults(i,{localAnchorA:[0,0],localAnchorB:[0,0]});s.call(this,t,e,s.DISTANCE,i);this.localAnchorA=n.fromValues(i.localAnchorA[0],i.localAnchorA[1]);this.localAnchorB=n.fromValues(i.localAnchorB[0],i.localAnchorB[1]);var o=this.localAnchorA;var h=this.localAnchorB;this.distance=0;if(typeof i.distance==="number"){this.distance=i.distance}else{var l=n.create(),u=n.create(),c=n.create();n.rotate(l,o,t.angle);n.rotate(u,h,e.angle);n.add(c,e.position,u);n.sub(c,c,l);n.sub(c,c,t.position);this.distance=n.length(c)}var d;if(typeof i.maxForce==="undefined"){d=Number.MAX_VALUE}else{d=i.maxForce}var f=new r(t,e,-d,d);this.equations=[f];this.maxForce=d;var c=n.create();var p=n.create();var g=n.create();var m=this;f.computeGq=function(){var t=this.bodyA,e=this.bodyB,i=t.position,s=e.position;n.rotate(p,o,t.angle);n.rotate(g,h,e.angle);n.add(c,s,g);n.sub(c,c,p);n.sub(c,c,i);return n.length(c)-m.distance};this.setMaxForce(d);this.upperLimitEnabled=false;this.upperLimit=1;this.lowerLimitEnabled=false;this.lowerLimit=0;this.position=0}o.prototype=new s;o.prototype.constructor=o;var h=n.create();var l=n.create();var u=n.create();o.prototype.update=function(){var t=this.equations[0],e=this.bodyA,i=this.bodyB,s=this.distance,r=e.position,a=i.position,o=this.equations[0],c=t.G;n.rotate(l,this.localAnchorA,e.angle);n.rotate(u,this.localAnchorB,i.angle);n.add(h,a,u);n.sub(h,h,l);n.sub(h,h,r);this.position=n.length(h);var d=false;if(this.upperLimitEnabled){if(this.position>this.upperLimit){o.maxForce=0;o.minForce=-this.maxForce;this.distance=this.upperLimit;d=true}}if(this.lowerLimitEnabled){if(this.position<this.lowerLimit){o.maxForce=this.maxForce;o.minForce=0;this.distance=this.lowerLimit;d=true}}if((this.lowerLimitEnabled||this.upperLimitEnabled)&&!d){o.enabled=false;return}o.enabled=true;n.normalize(h,h);var f=n.crossLength(l,h),p=n.crossLength(u,h);c[0]=-h[0];c[1]=-h[1];c[2]=-f;c[3]=h[0];c[4]=h[1];c[5]=p};o.prototype.setMaxForce=function(t){var e=this.equations[0];e.minForce=-t;e.maxForce=t};o.prototype.getMaxForce=function(){var t=this.equations[0];return t.maxForce}},{"../equations/Equation":22,"../math/vec2":30,"../utils/Utils":57,"./Constraint":14}],16:[function(t,e,i){var s=t("./Constraint"),r=t("../equations/Equation"),n=t("../equations/AngleLockEquation"),a=t("../math/vec2");e.exports=o;function o(t,e,i){i=i||{};s.call(this,t,e,s.GEAR,i);this.ratio=i.ratio!==undefined?i.ratio:1;this.angle=i.angle!==undefined?i.angle:e.angle-this.ratio*t.angle;i.angle=this.angle;i.ratio=this.ratio;this.equations=[new n(t,e,i)];if(i.maxTorque!==undefined){this.setMaxTorque(i.maxTorque)}}o.prototype=new s;o.prototype.constructor=o;o.prototype.update=function(){var t=this.equations[0];if(t.ratio!==this.ratio){t.setRatio(this.ratio)}t.angle=this.angle};o.prototype.setMaxTorque=function(t){this.equations[0].setMaxTorque(t)};o.prototype.getMaxTorque=function(t){return this.equations[0].maxForce}},{"../equations/AngleLockEquation":20,"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],17:[function(t,e,i){var s=t("./Constraint"),r=t("../math/vec2"),n=t("../equations/Equation");e.exports=a;function a(t,e,i){i=i||{};s.call(this,t,e,s.LOCK,i);var a=typeof i.maxForce==="undefined"?Number.MAX_VALUE:i.maxForce;var o=i.localAngleB||0;var h=new n(t,e,-a,a),l=new n(t,e,-a,a),u=new n(t,e,-a,a);var c=r.create(),d=r.create(),f=this;h.computeGq=function(){r.rotate(c,f.localOffsetB,t.angle);r.sub(d,e.position,t.position);r.sub(d,d,c);return d[0]};l.computeGq=function(){r.rotate(c,f.localOffsetB,t.angle);r.sub(d,e.position,t.position);r.sub(d,d,c);return d[1]};var p=r.create(),g=r.create();u.computeGq=function(){r.rotate(p,f.localOffsetB,e.angle-f.localAngleB);r.scale(p,p,-1);r.sub(d,t.position,e.position);r.add(d,d,p);r.rotate(g,p,-Math.PI/2);r.normalize(g,g);return r.dot(d,g)};this.localOffsetB=r.create();if(i.localOffsetB){r.copy(this.localOffsetB,i.localOffsetB)}else{r.sub(this.localOffsetB,e.position,t.position);r.rotate(this.localOffsetB,this.localOffsetB,-t.angle)}this.localAngleB=0;if(typeof i.localAngleB==="number"){this.localAngleB=i.localAngleB}else{this.localAngleB=e.angle-t.angle}this.equations.push(h,l,u);this.setMaxForce(a)}a.prototype=new s;a.prototype.constructor=a;a.prototype.setMaxForce=function(t){var e=this.equations;for(var i=0;i<this.equations.length;i++){e[i].maxForce=t;e[i].minForce=-t}};a.prototype.getMaxForce=function(){return this.equations[0].maxForce};var o=r.create();var h=r.create();var l=r.create();var u=r.fromValues(1,0);var c=r.fromValues(0,1);a.prototype.update=function(){var t=this.equations[0],e=this.equations[1],i=this.equations[2],s=this.bodyA,n=this.bodyB;r.rotate(o,this.localOffsetB,s.angle);r.rotate(h,this.localOffsetB,n.angle-this.localAngleB);r.scale(h,h,-1);r.rotate(l,h,Math.PI/2);r.normalize(l,l);t.G[0]=-1;t.G[1]=0;t.G[2]=-r.crossLength(o,u);t.G[3]=1;e.G[0]=0;e.G[1]=-1;e.G[2]=-r.crossLength(o,c);e.G[4]=1;i.G[0]=-l[0];i.G[1]=-l[1];i.G[3]=l[0];i.G[4]=l[1];i.G[5]=r.crossLength(h,l)}},{"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],18:[function(t,e,i){var s=t("./Constraint"),r=t("../equations/ContactEquation"),n=t("../equations/Equation"),a=t("../math/vec2"),o=t("../equations/RotationalLockEquation");e.exports=h;function h(t,e,i){i=i||{};s.call(this,t,e,s.PRISMATIC,i);var h=a.fromValues(0,0),l=a.fromValues(1,0),u=a.fromValues(0,0);if(i.localAnchorA){a.copy(h,i.localAnchorA)}if(i.localAxisA){a.copy(l,i.localAxisA)}if(i.localAnchorB){a.copy(u,i.localAnchorB)}this.localAnchorA=h;this.localAnchorB=u;this.localAxisA=l;var c=this.maxForce=typeof i.maxForce!=="undefined"?i.maxForce:Number.MAX_VALUE;var d=new n(t,e,-c,c);var f=new a.create,p=new a.create,g=new a.create,m=new a.create;d.computeGq=function(){return a.dot(g,m)};d.updateJacobian=function(){var i=this.G,s=t.position,r=e.position;a.rotate(f,h,t.angle);a.rotate(p,u,e.angle);a.add(g,r,p);a.sub(g,g,s);a.sub(g,g,f);a.rotate(m,l,t.angle+Math.PI/2);i[0]=-m[0];i[1]=-m[1];i[2]=-a.crossLength(f,m)+a.crossLength(m,g);i[3]=m[0];i[4]=m[1];i[5]=a.crossLength(p,m)};this.equations.push(d);if(!i.disableRotationalLock){var y=new o(t,e,-c,c);this.equations.push(y)}this.position=0;this.velocity=0;this.lowerLimitEnabled=typeof i.lowerLimit!=="undefined"?true:false;this.upperLimitEnabled=typeof i.upperLimit!=="undefined"?true:false;this.lowerLimit=typeof i.lowerLimit!=="undefined"?i.lowerLimit:0;this.upperLimit=typeof i.upperLimit!=="undefined"?i.upperLimit:1;this.upperLimitEquation=new r(t,e);this.lowerLimitEquation=new r(t,e);this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0;this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=c;this.motorEquation=new n(t,e);this.motorEnabled=false;this.motorSpeed=0;var v=this;var b=this.motorEquation;var x=b.computeGW;b.computeGq=function(){return 0};b.computeGW=function(){var t=this.G,e=this.bodyA,i=this.bodyB,s=e.velocity,r=i.velocity,n=e.angularVelocity,a=i.angularVelocity;return this.gmult(t,s,n,r,a)+v.motorSpeed}}h.prototype=new s;h.prototype.constructor=h;var l=a.create(),u=a.create(),c=a.create(),d=a.create(),f=a.create(),p=a.create();h.prototype.update=function(){var t=this.equations,e=t[0],i=this.upperLimit,s=this.lowerLimit,r=this.upperLimitEquation,n=this.lowerLimitEquation,o=this.bodyA,h=this.bodyB,g=this.localAxisA,m=this.localAnchorA,y=this.localAnchorB;e.updateJacobian();a.rotate(l,g,o.angle);a.rotate(d,m,o.angle);a.add(u,d,o.position);a.rotate(f,y,h.angle);a.add(c,f,h.position);var v=this.position=a.dot(c,l)-a.dot(u,l);if(this.motorEnabled){var b=this.motorEquation.G;b[0]=l[0];b[1]=l[1];b[2]=a.crossLength(l,f);b[3]=-l[0];b[4]=-l[1];b[5]=-a.crossLength(l,d)}if(this.upperLimitEnabled&&v>i){a.scale(r.normalA,l,-1);a.sub(r.contactPointA,u,o.position);a.sub(r.contactPointB,c,h.position);a.scale(p,l,i);a.add(r.contactPointA,r.contactPointA,p);if(t.indexOf(r)===-1){t.push(r)}}else{var x=t.indexOf(r);if(x!==-1){t.splice(x,1)}}if(this.lowerLimitEnabled&&v<s){a.scale(n.normalA,l,1);a.sub(n.contactPointA,u,o.position);a.sub(n.contactPointB,c,h.position);a.scale(p,l,s);a.sub(n.contactPointB,n.contactPointB,p);if(t.indexOf(n)===-1){t.push(n)}}else{var x=t.indexOf(n);if(x!==-1){t.splice(x,1)}}};h.prototype.enableMotor=function(){if(this.motorEnabled){return}this.equations.push(this.motorEquation);this.motorEnabled=true};h.prototype.disableMotor=function(){if(!this.motorEnabled){return}var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1);this.motorEnabled=false};h.prototype.setLimits=function(t,e){if(typeof t==="number"){this.lowerLimit=t;this.lowerLimitEnabled=true}else{this.lowerLimit=t;this.lowerLimitEnabled=false}if(typeof e==="number"){this.upperLimit=e;this.upperLimitEnabled=true}else{this.upperLimit=e;this.upperLimitEnabled=false}}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../math/vec2":30,"./Constraint":14}],19:[function(t,e,i){var s=t("./Constraint"),r=t("../equations/Equation"),n=t("../equations/RotationalVelocityEquation"),a=t("../equations/RotationalLockEquation"),o=t("../math/vec2");e.exports=f;var h=o.create(),l=o.create(),u=o.fromValues(1,0),c=o.fromValues(0,1),d=o.create();function f(t,e,i){i=i||{};s.call(this,t,e,s.REVOLUTE,i);var f=this.maxForce=typeof i.maxForce!=="undefined"?i.maxForce:Number.MAX_VALUE;this.pivotA=o.create();this.pivotB=o.create();if(i.worldPivot){o.sub(this.pivotA,i.worldPivot,t.position);o.sub(this.pivotB,i.worldPivot,e.position);o.rotate(this.pivotA,this.pivotA,-t.angle);o.rotate(this.pivotB,this.pivotB,-e.angle)}else{o.copy(this.pivotA,i.localPivotA);o.copy(this.pivotB,i.localPivotB)}var p=this.equations=[new r(t,e,-f,f),new r(t,e,-f,f)];var g=p[0];var m=p[1];var y=this;g.computeGq=function(){o.rotate(h,y.pivotA,t.angle);o.rotate(l,y.pivotB,e.angle);o.add(d,e.position,l);o.sub(d,d,t.position);o.sub(d,d,h);return o.dot(d,u)};m.computeGq=function(){o.rotate(h,y.pivotA,t.angle);o.rotate(l,y.pivotB,e.angle);o.add(d,e.position,l);o.sub(d,d,t.position);o.sub(d,d,h);return o.dot(d,c)};m.minForce=g.minForce=-f;m.maxForce=g.maxForce=f;this.motorEquation=new n(t,e);this.motorEnabled=false;this.angle=0;this.lowerLimitEnabled=false;this.upperLimitEnabled=false;this.lowerLimit=0;this.upperLimit=0;this.upperLimitEquation=new a(t,e);this.lowerLimitEquation=new a(t,e);this.upperLimitEquation.minForce=0;this.lowerLimitEquation.maxForce=0}f.prototype=new s;f.prototype.constructor=f;f.prototype.setLimits=function(t,e){if(typeof t==="number"){this.lowerLimit=t;this.lowerLimitEnabled=true}else{this.lowerLimit=t;this.lowerLimitEnabled=false}if(typeof e==="number"){this.upperLimit=e;this.upperLimitEnabled=true}else{this.upperLimit=e;this.upperLimitEnabled=false}};f.prototype.update=function(){var t=this.bodyA,e=this.bodyB,i=this.pivotA,s=this.pivotB,r=this.equations,n=r[0],a=r[1],d=r[0],f=r[1],p=this.upperLimit,g=this.lowerLimit,m=this.upperLimitEquation,y=this.lowerLimitEquation;var v=this.angle=e.angle-t.angle;if(this.upperLimitEnabled&&v>p){m.angle=p;if(r.indexOf(m)===-1){r.push(m)}}else{var b=r.indexOf(m);if(b!==-1){r.splice(b,1)}}if(this.lowerLimitEnabled&&v<g){y.angle=g;if(r.indexOf(y)===-1){r.push(y)}}else{var b=r.indexOf(y);if(b!==-1){r.splice(b,1)}}o.rotate(h,i,t.angle);o.rotate(l,s,e.angle);d.G[0]=-1;d.G[1]=0;d.G[2]=-o.crossLength(h,u);d.G[3]=1;d.G[4]=0;d.G[5]=o.crossLength(l,u);f.G[0]=0;f.G[1]=-1;f.G[2]=-o.crossLength(h,c);f.G[3]=0;f.G[4]=1;f.G[5]=o.crossLength(l,c)};f.prototype.enableMotor=function(){if(this.motorEnabled){return}this.equations.push(this.motorEquation);this.motorEnabled=true};f.prototype.disableMotor=function(){if(!this.motorEnabled){return}var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1);this.motorEnabled=false};f.prototype.motorIsEnabled=function(){return!!this.motorEnabled};f.prototype.setMotorSpeed=function(t){if(!this.motorEnabled){return}var e=this.equations.indexOf(this.motorEquation);this.equations[e].relativeVelocity=t};f.prototype.getMotorSpeed=function(){if(!this.motorEnabled){return false}return this.motorEquation.relativeVelocity}},{"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../equations/RotationalVelocityEquation":25,"../math/vec2":30,"./Constraint":14}],20:[function(t,e,i){var s=t("./Equation"),r=t("../math/vec2");e.exports=n;function n(t,e,i){i=i||{};s.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE);this.angle=i.angle||0;this.ratio=typeof i.ratio==="number"?i.ratio:1;this.setRatio(this.ratio)}n.prototype=new s;n.prototype.constructor=n;n.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle};n.prototype.setRatio=function(t){var e=this.G;e[2]=t;e[5]=-1;this.ratio=t};n.prototype.setMaxTorque=function(t){this.maxForce=t;this.minForce=-t}},{"../math/vec2":30,"./Equation":22}],21:[function(t,e,i){var s=t("./Equation"),r=t("../math/vec2");e.exports=n;function n(t,e){s.call(this,t,e,0,Number.MAX_VALUE);this.contactPointA=r.create();this.penetrationVec=r.create();this.contactPointB=r.create();this.normalA=r.create();this.restitution=0;this.firstImpact=false;this.shapeA=null;this.shapeB=null}n.prototype=new s;n.prototype.constructor=n;n.prototype.computeB=function(t,e,i){var s=this.bodyA,n=this.bodyB,a=this.contactPointA,o=this.contactPointB,h=s.position,l=n.position;var u=this.penetrationVec,c=this.normalA,d=this.G;var f=r.crossLength(a,c),p=r.crossLength(o,c);d[0]=-c[0];d[1]=-c[1];d[2]=-f;d[3]=c[0];d[4]=c[1];d[5]=p;r.add(u,l,o);r.sub(u,u,h);r.sub(u,u,a);var g,m;if(this.firstImpact&&this.restitution!==0){m=0;g=1/e*(1+this.restitution)*this.computeGW()}else{m=r.dot(c,u)+this.offset;g=this.computeGW()}var y=this.computeGiMf();var v=-m*t-g*e-i*y;return v}},{"../math/vec2":30,"./Equation":22}],22:[function(t,e,i){e.exports=a;var s=t("../math/vec2"),r=t("../utils/Utils"),n=t("../objects/Body");function a(t,e,i,s){this.minForce=typeof i==="undefined"?-Number.MAX_VALUE:i;this.maxForce=typeof s==="undefined"?Number.MAX_VALUE:s;this.bodyA=t;this.bodyB=e;this.stiffness=a.DEFAULT_STIFFNESS;this.relaxation=a.DEFAULT_RELAXATION;this.G=new r.ARRAY_TYPE(6);for(var n=0;n<6;n++){this.G[n]=0}this.offset=0;this.a=0;this.b=0;this.epsilon=0;this.timeStep=1/60;this.needsUpdate=true;this.multiplier=0;this.relativeVelocity=0;this.enabled=true}a.prototype.constructor=a;a.DEFAULT_STIFFNESS=1e6;a.DEFAULT_RELAXATION=4;a.prototype.update=function(){var t=this.stiffness,e=this.relaxation,i=this.timeStep;this.a=4/(i*(1+4*e));this.b=4*e/(1+4*e);this.epsilon=4/(i*i*t*(1+4*e));this.needsUpdate=false};a.prototype.gmult=function(t,e,i,s,r){return t[0]*e[0]+t[1]*e[1]+t[2]*i+t[3]*s[0]+t[4]*s[1]+t[5]*r};a.prototype.computeB=function(t,e,i){var s=this.computeGW();var r=this.computeGq();var n=this.computeGiMf();return-r*t-s*e-n*i};var o=s.create(),h=s.create();a.prototype.computeGq=function(){var t=this.G,e=this.bodyA,i=this.bodyB,s=e.position,r=i.position,n=e.angle,a=i.angle;return this.gmult(t,o,n,h,a)+this.offset};a.prototype.computeGW=function(){var t=this.G,e=this.bodyA,i=this.bodyB,s=e.velocity,r=i.velocity,n=e.angularVelocity,a=i.angularVelocity;return this.gmult(t,s,n,r,a)+this.relativeVelocity};a.prototype.computeGWlambda=function(){var t=this.G,e=this.bodyA,i=this.bodyB,s=e.vlambda,r=i.vlambda,n=e.wlambda,a=i.wlambda;return this.gmult(t,s,n,r,a)};var l=s.create(),u=s.create();a.prototype.computeGiMf=function(){var t=this.bodyA,e=this.bodyB,i=t.force,r=t.angularForce,n=e.force,a=e.angularForce,o=t.invMassSolve,h=e.invMassSolve,c=t.invInertiaSolve,d=e.invInertiaSolve,f=this.G;s.scale(l,i,o);s.multiply(l,t.massMultiplier,l);s.scale(u,n,h);s.multiply(u,e.massMultiplier,u);return this.gmult(f,l,r*c,u,a*d)};a.prototype.computeGiMGt=function(){var t=this.bodyA,e=this.bodyB,i=t.invMassSolve,s=e.invMassSolve,r=t.invInertiaSolve,n=e.invInertiaSolve,a=this.G;return a[0]*a[0]*i*t.massMultiplier[0]+a[1]*a[1]*i*t.massMultiplier[1]+a[2]*a[2]*r+a[3]*a[3]*s*e.massMultiplier[0]+a[4]*a[4]*s*e.massMultiplier[1]+a[5]*a[5]*n};var c=s.create(),d=s.create(),f=s.create(),p=s.create(),g=s.create(),m=s.create();a.prototype.addToWlambda=function(t){var e=this.bodyA,i=this.bodyB,r=c,n=d,a=f,o=p,h=g,l=e.invMassSolve,u=i.invMassSolve,y=e.invInertiaSolve,v=i.invInertiaSolve,b=m,x=this.G;n[0]=x[0];n[1]=x[1];a[0]=x[3];a[1]=x[4];s.scale(r,n,l*t);s.multiply(r,r,e.massMultiplier);s.add(e.vlambda,e.vlambda,r);e.wlambda+=y*x[2]*t;s.scale(r,a,u*t);s.multiply(r,r,i.massMultiplier);s.add(i.vlambda,i.vlambda,r);i.wlambda+=v*x[5]*t};a.prototype.computeInvC=function(t){return 1/(this.computeGiMGt()+t)}},{"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],23:[function(t,e,i){var s=t("../math/vec2"),r=t("./Equation"),n=t("../utils/Utils");e.exports=a;function a(t,e,i){r.call(this,t,e,-i,i);this.contactPointA=s.create();this.contactPointB=s.create();this.t=s.create();this.contactEquations=[];this.shapeA=null;this.shapeB=null;this.frictionCoefficient=.3}a.prototype=new r;a.prototype.constructor=a;a.prototype.setSlipForce=function(t){this.maxForce=t;this.minForce=-t};a.prototype.getSlipForce=function(){return this.maxForce};a.prototype.computeB=function(t,e,i){var r=this.bodyA,n=this.bodyB,a=this.contactPointA,o=this.contactPointB,h=this.t,l=this.G;l[0]=-h[0];l[1]=-h[1];l[2]=-s.crossLength(a,h);l[3]=h[0];l[4]=h[1];l[5]=s.crossLength(o,h);var u=this.computeGW(),c=this.computeGiMf();var d=-u*e-i*c;return d}},{"../math/vec2":30,"../utils/Utils":57,"./Equation":22}],24:[function(t,e,i){var s=t("./Equation"),r=t("../math/vec2");e.exports=n;function n(t,e,i){i=i||{};s.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE);this.angle=i.angle||0;var r=this.G;r[2]=1;r[5]=-1}n.prototype=new s;n.prototype.constructor=n;var a=r.create(),o=r.create(),h=r.fromValues(1,0),l=r.fromValues(0,1);n.prototype.computeGq=function(){r.rotate(a,h,this.bodyA.angle+this.angle);r.rotate(o,l,this.bodyB.angle);return r.dot(a,o)}},{"../math/vec2":30,"./Equation":22}],25:[function(t,e,i){var s=t("./Equation"),r=t("../math/vec2");e.exports=n;function n(t,e){s.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE);this.relativeVelocity=1;this.ratio=1}n.prototype=new s;n.prototype.constructor=n;n.prototype.computeB=function(t,e,i){var s=this.G;s[2]=-1;s[5]=this.ratio;var r=this.computeGiMf();var n=this.computeGW();var a=-n*e-i*r;return a}},{"../math/vec2":30,"./Equation":22}],26:[function(t,e,i){var s=function(){};e.exports=s;s.prototype={constructor:s,on:function(t,e,i){e.context=i||this;if(this._listeners===undefined){this._listeners={}}var s=this._listeners;if(s[t]===undefined){s[t]=[]}if(s[t].indexOf(e)===-1){s[t].push(e)}return this},has:function(t,e){if(this._listeners===undefined){return false}var i=this._listeners;if(e){if(i[t]!==undefined&&i[t].indexOf(e)!==-1){return true}}else{if(i[t]!==undefined){return true}}return false},off:function(t,e){if(this._listeners===undefined){return this}var i=this._listeners;var s=i[t].indexOf(e);if(s!==-1){i[t].splice(s,1)}return this},emit:function(t){if(this._listeners===undefined){return this}var e=this._listeners;var i=e[t.type];if(i!==undefined){t.target=this;for(var s=0,r=i.length;s<r;s++){var n=i[s];n.call(n.context,t)}}return this}}},{}],27:[function(t,e,i){var s=t("./Material");var r=t("../equations/Equation");e.exports=n;function n(t,e,i){i=i||{};if(!(t instanceof s)||!(e instanceof s)){throw new Error("First two arguments must be Material instances.")}this.id=n.idCounter++;this.materialA=t;this.materialB=e;this.friction=typeof i.friction!=="undefined"?Number(i.friction):.3;this.restitution=typeof i.restitution!=="undefined"?Number(i.restitution):0;this.stiffness=typeof i.stiffness!=="undefined"?Number(i.stiffness):r.DEFAULT_STIFFNESS;this.relaxation=typeof i.relaxation!=="undefined"?Number(i.relaxation):r.DEFAULT_RELAXATION;this.frictionStiffness=typeof i.frictionStiffness!=="undefined"?Number(i.frictionStiffness):r.DEFAULT_STIFFNESS;this.frictionRelaxation=typeof i.frictionRelaxation!=="undefined"?Number(i.frictionRelaxation):r.DEFAULT_RELAXATION;this.surfaceVelocity=typeof i.surfaceVelocity!=="undefined"?Number(i.surfaceVelocity):0;this.contactSkinSize=.005}n.idCounter=0},{"../equations/Equation":22,"./Material":28}],28:[function(t,e,i){e.exports=s;function s(t){this.id=t||s.idCounter++}s.idCounter=0},{}],29:[function(t,e,i){var s={};s.GetArea=function(t){if(t.length<6)return 0;var e=t.length-2;var i=0;for(var s=0;s<e;s+=2)i+=(t[s+2]-t[s])*(t[s+1]+t[s+3]);i+=(t[0]-t[e])*(t[e+1]+t[1]);return-i*.5};s.Triangulate=function(t){var e=t.length>>1;if(e<3)return[];var i=[];var r=[];for(var n=0;n<e;n++)r.push(n);var n=0;var a=e;while(a>3){var o=r[(n+0)%a];var h=r[(n+1)%a];var l=r[(n+2)%a];var u=t[2*o],c=t[2*o+1];var d=t[2*h],f=t[2*h+1];var p=t[2*l],g=t[2*l+1];var m=false;if(s._convex(u,c,d,f,p,g)){m=true;for(var y=0;y<a;y++){var v=r[y];if(v==o||v==h||v==l)continue;if(s._PointInTriangle(t[2*v],t[2*v+1],u,c,d,f,p,g)){m=false;break}}}if(m){i.push(o,h,l);r.splice((n+1)%a,1);a--;n=0}else if(n++>3*a)break}i.push(r[0],r[1],r[2]);return i};s._PointInTriangle=function(t,e,i,s,r,n,a,o){var h=a-i;var l=o-s;var u=r-i;var c=n-s;var d=t-i;var f=e-s;var p=h*h+l*l;var g=h*u+l*c;var m=h*d+l*f;var y=u*u+c*c;var v=u*d+c*f;var b=1/(p*y-g*g);var x=(y*m-g*v)*b;var w=(p*v-g*m)*b;return x>=0&&w>=0&&x+w<1};s._convex=function(t,e,i,s,r,n){return(e-s)*(r-i)+(i-t)*(n-s)>=0};e.exports=s},{}],30:[function(t,e,i){var s=e.exports={};var r=t("../utils/Utils");s.crossLength=function(t,e){return t[0]*e[1]-t[1]*e[0]};s.crossVZ=function(t,e,i){s.rotate(t,e,-Math.PI/2);s.scale(t,t,i);return t};s.crossZV=function(t,e,i){s.rotate(t,i,Math.PI/2);s.scale(t,t,e);return t};s.rotate=function(t,e,i){if(i!==0){var s=Math.cos(i),r=Math.sin(i),n=e[0],a=e[1];t[0]=s*n-r*a;t[1]=r*n+s*a}else{t[0]=e[0];t[1]=e[1]}};s.rotate90cw=function(t,e){var i=e[0];var s=e[1];t[0]=s;t[1]=-i};s.toLocalFrame=function(t,e,i,r){s.copy(t,e);s.sub(t,t,i);s.rotate(t,t,-r)};s.toGlobalFrame=function(t,e,i,r){s.copy(t,e);s.rotate(t,t,r);s.add(t,t,i)};s.vectorToLocalFrame=function(t,e,i){s.rotate(t,e,-i)};s.vectorToGlobalFrame=function(t,e,i){s.rotate(t,e,i)};s.centroid=function(t,e,i,r){s.add(t,e,i);s.add(t,t,r);s.scale(t,t,1/3);return t};s.create=function(){var t=new r.ARRAY_TYPE(2);t[0]=0;t[1]=0;return t};s.clone=function(t){var e=new r.ARRAY_TYPE(2);e[0]=t[0];e[1]=t[1];return e};s.fromValues=function(t,e){var i=new r.ARRAY_TYPE(2);i[0]=t;i[1]=e;return i};s.copy=function(t,e){t[0]=e[0];t[1]=e[1];return t};s.set=function(t,e,i){t[0]=e;t[1]=i;return t};s.add=function(t,e,i){t[0]=e[0]+i[0];t[1]=e[1]+i[1];return t};s.subtract=function(t,e,i){t[0]=e[0]-i[0];t[1]=e[1]-i[1];return t};s.sub=s.subtract;s.multiply=function(t,e,i){t[0]=e[0]*i[0];t[1]=e[1]*i[1];return t};s.mul=s.multiply;s.divide=function(t,e,i){t[0]=e[0]/i[0];t[1]=e[1]/i[1];return t};s.div=s.divide;s.scale=function(t,e,i){t[0]=e[0]*i;t[1]=e[1]*i;return t};s.distance=function(t,e){var i=e[0]-t[0],s=e[1]-t[1];return Math.sqrt(i*i+s*s)};s.dist=s.distance;s.squaredDistance=function(t,e){var i=e[0]-t[0],s=e[1]-t[1];return i*i+s*s};s.sqrDist=s.squaredDistance;s.length=function(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)};s.len=s.length;s.squaredLength=function(t){var e=t[0],i=t[1];return e*e+i*i};s.sqrLen=s.squaredLength;s.negate=function(t,e){t[0]=-e[0];t[1]=-e[1];return t};s.normalize=function(t,e){var i=e[0],s=e[1];var r=i*i+s*s;if(r>0){r=1/Math.sqrt(r);t[0]=e[0]*r;t[1]=e[1]*r}return t};s.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]};s.str=function(t){return"vec2("+t[0]+", "+t[1]+")"};s.lerp=function(t,e,i,s){var r=e[0],n=e[1];t[0]=r+s*(i[0]-r);t[1]=n+s*(i[1]-n);return t};s.reflect=function(t,e,i){var s=e[0]*i[0]+e[1]*i[1];t[0]=e[0]-2*i[0]*s;t[1]=e[1]-2*i[1]*s};s.getLineSegmentsIntersection=function(t,e,i,r,n){var a=s.getLineSegmentsIntersectionFraction(e,i,r,n);if(a<0){return false}else{t[0]=e[0]+a*(i[0]-e[0]);t[1]=e[1]+a*(i[1]-e[1]);return true}};s.getLineSegmentsIntersectionFraction=function(t,e,i,s){var r=e[0]-t[0];var n=e[1]-t[1];var a=s[0]-i[0];var o=s[1]-i[1];var h,l;h=(-n*(t[0]-i[0])+r*(t[1]-i[1]))/(-a*n+r*o);l=(a*(t[1]-i[1])-o*(t[0]-i[0]))/(-a*n+r*o);if(h>=0&&h<=1&&l>=0&&l<=1){return l}return-1}},{"../utils/Utils":57}],31:[function(t,e,i){var s=t("../math/vec2"),r=t("poly-decomp"),n=t("../shapes/Convex"),a=t("../collision/RaycastResult"),o=t("../collision/Ray"),h=t("../collision/AABB"),l=t("../events/EventEmitter");e.exports=u;function u(t){t=t||{};l.call(this);this.id=t.id||++u._idCounter;this.world=null;this.shapes=[];this.mass=t.mass||0;this.invMass=0;this.inertia=0;this.invInertia=0;this.invMassSolve=0;this.invInertiaSolve=0;this.fixedRotation=!!t.fixedRotation;this.fixedX=!!t.fixedX;this.fixedY=!!t.fixedY;this.massMultiplier=s.create();this.position=s.fromValues(0,0);if(t.position){s.copy(this.position,t.position)}this.interpolatedPosition=s.fromValues(0,0);this.interpolatedAngle=0;this.previousPosition=s.fromValues(0,0);this.previousAngle=0;this.velocity=s.fromValues(0,0);if(t.velocity){s.copy(this.velocity,t.velocity)}this.vlambda=s.fromValues(0,0);this.wlambda=0;this.angle=t.angle||0;this.angularVelocity=t.angularVelocity||0;this.force=s.create();if(t.force){s.copy(this.force,t.force)}this.angularForce=t.angularForce||0;this.damping=typeof t.damping==="number"?t.damping:.1;this.angularDamping=typeof t.angularDamping==="number"?t.angularDamping:.1;this.type=u.STATIC;if(typeof t.type!=="undefined"){this.type=t.type}else if(!t.mass){this.type=u.STATIC}else{this.type=u.DYNAMIC}this.boundingRadius=0;this.aabb=new h;this.aabbNeedsUpdate=true;this.allowSleep=t.allowSleep!==undefined?t.allowSleep:true;this.wantsToSleep=false;this.sleepState=u.AWAKE;this.sleepSpeedLimit=t.sleepSpeedLimit!==undefined?t.sleepSpeedLimit:.2;this.sleepTimeLimit=t.sleepTimeLimit!==undefined?t.sleepTimeLimit:1;this.gravityScale=t.gravityScale!==undefined?t.gravityScale:1;this.collisionResponse=t.collisionResponse!==undefined?t.collisionResponse:true;this.idleTime=0;this.timeLastSleepy=0;this.ccdSpeedThreshold=t.ccdSpeedThreshold!==undefined?t.ccdSpeedThreshold:-1;this.ccdIterations=t.ccdIterations!==undefined?t.ccdIterations:10;this.concavePath=null;this._wakeUpAfterNarrowphase=false;this.updateMassProperties()}u.prototype=new l;u.prototype.constructor=u;u._idCounter=0;u.prototype.updateSolveMassProperties=function(){if(this.sleepState===u.SLEEPING||this.type===u.KINEMATIC){this.invMassSolve=0;this.invInertiaSolve=0}else{this.invMassSolve=this.invMass;this.invInertiaSolve=this.invInertia}};u.prototype.setDensity=function(t){var e=this.getArea();this.mass=e*t;this.updateMassProperties()};u.prototype.getArea=function(){var t=0;for(var e=0;e<this.shapes.length;e++){t+=this.shapes[e].area}return t};u.prototype.getAABB=function(){if(this.aabbNeedsUpdate){this.updateAABB()}return this.aabb};var c=new h,d=s.create();u.prototype.updateAABB=function(){var t=this.shapes,e=t.length,i=d,r=this.angle;for(var n=0;n!==e;n++){var a=t[n],o=a.angle+r;s.rotate(i,a.position,r);s.add(i,i,this.position);a.computeAABB(c,i,o);if(n===0){this.aabb.copy(c)}else{this.aabb.extend(c)}}this.aabbNeedsUpdate=false};u.prototype.updateBoundingRadius=function(){var t=this.shapes,e=t.length,i=0;for(var r=0;r!==e;r++){var n=t[r],a=s.length(n.position),o=n.boundingRadius;if(a+o>i){i=a+o}}this.boundingRadius=i};u.prototype.addShape=function(t,e,i){if(t.body){throw new Error("A shape can only be added to one body.")}t.body=this;if(e){s.copy(t.position,e)}else{s.set(t.position,0,0)}t.angle=i||0;this.shapes.push(t);this.updateMassProperties();this.updateBoundingRadius();this.aabbNeedsUpdate=true};u.prototype.removeShape=function(t){var e=this.shapes.indexOf(t);if(e!==-1){this.shapes.splice(e,1);this.aabbNeedsUpdate=true;t.body=null;return true}else{return false}};u.prototype.updateMassProperties=function(){if(this.type===u.STATIC||this.type===u.KINEMATIC){this.mass=Number.MAX_VALUE;this.invMass=0;this.inertia=Number.MAX_VALUE;this.invInertia=0}else{var t=this.shapes,e=t.length,i=this.mass/e,r=0;if(!this.fixedRotation){for(var n=0;n<e;n++){var a=t[n],o=s.squaredLength(a.position),h=a.computeMomentOfInertia(i);r+=h+i*o}this.inertia=r;this.invInertia=r>0?1/r:0}else{this.inertia=Number.MAX_VALUE;this.invInertia=0}this.invMass=1/this.mass;s.set(this.massMultiplier,this.fixedX?0:1,this.fixedY?0:1)}};var f=s.create();u.prototype.applyForce=function(t,e){s.add(this.force,this.force,t);if(e){var i=s.crossLength(e,t);this.angularForce+=i}};var p=s.create();var g=s.create();var m=s.create();u.prototype.applyForceLocal=function(t,e){e=e||m;var i=p;var s=g;this.vectorToWorldFrame(i,t);this.vectorToWorldFrame(s,e);this.applyForce(i,s)};var y=s.create();u.prototype.applyImpulse=function(t,e){if(this.type!==u.DYNAMIC){return}var i=y;s.scale(i,t,this.invMass);s.multiply(i,this.massMultiplier,i);s.add(this.velocity,i,this.velocity);if(e){var r=s.crossLength(e,t);r*=this.invInertia;this.angularVelocity+=r}};var v=s.create();var b=s.create();var x=s.create();u.prototype.applyImpulseLocal=function(t,e){e=e||x;var i=v;var s=b;this.vectorToWorldFrame(i,t);this.vectorToWorldFrame(s,e);this.applyImpulse(i,s)};u.prototype.toLocalFrame=function(t,e){s.toLocalFrame(t,e,this.position,this.angle)};u.prototype.toWorldFrame=function(t,e){s.toGlobalFrame(t,e,this.position,this.angle)};u.prototype.vectorToLocalFrame=function(t,e){s.vectorToLocalFrame(t,e,this.angle)};u.prototype.vectorToWorldFrame=function(t,e){s.vectorToGlobalFrame(t,e,this.angle)};u.prototype.fromPolygon=function(t,e){e=e||{};for(var i=this.shapes.length;i>=0;--i){this.removeShape(this.shapes[i])}var a=new r.Polygon;a.vertices=t;a.makeCCW();if(typeof e.removeCollinearPoints==="number"){a.removeCollinearPoints(e.removeCollinearPoints)}if(typeof e.skipSimpleCheck==="undefined"){if(!a.isSimple()){return false}}this.concavePath=a.vertices.slice(0);for(var i=0;i<this.concavePath.length;i++){var o=[0,0];s.copy(o,this.concavePath[i]);this.concavePath[i]=o}var h;if(e.optimalDecomp){h=a.decomp()}else{h=a.quickDecomp()}var l=s.create();for(var i=0;i!==h.length;i++){var u=new n({vertices:h[i].vertices});for(var c=0;c!==u.vertices.length;c++){var o=u.vertices[c];s.sub(o,o,u.centerOfMass)}s.scale(l,u.centerOfMass,1);u.updateTriangles();u.updateCenterOfMass();u.updateBoundingRadius();this.addShape(u,l)}this.adjustCenterOfMass();this.aabbNeedsUpdate=true;return true};var w=s.fromValues(0,0),_=s.fromValues(0,0),P=s.fromValues(0,0),T=s.fromValues(0,0);u.prototype.adjustCenterOfMass=function(){var t=_,e=P,i=T,r=0;s.set(e,0,0);for(var n=0;n!==this.shapes.length;n++){var a=this.shapes[n];s.scale(t,a.position,a.area);s.add(e,e,t);r+=a.area}s.scale(i,e,1/r);for(var n=0;n!==this.shapes.length;n++){var a=this.shapes[n];s.sub(a.position,a.position,i)}s.add(this.position,this.position,i);for(var n=0;this.concavePath&&n<this.concavePath.length;n++){s.sub(this.concavePath[n],this.concavePath[n],i)}this.updateMassProperties();this.updateBoundingRadius()};u.prototype.setZeroForce=function(){s.set(this.force,0,0);this.angularForce=0};u.prototype.resetConstraintVelocity=function(){var t=this,e=t.vlambda;s.set(e,0,0);t.wlambda=0};u.prototype.addConstraintVelocity=function(){var t=this,e=t.velocity;s.add(e,e,t.vlambda);t.angularVelocity+=t.wlambda};u.prototype.applyDamping=function(t){if(this.type===u.DYNAMIC){var e=this.velocity;s.scale(e,e,Math.pow(1-this.damping,t));this.angularVelocity*=Math.pow(1-this.angularDamping,t)}};u.prototype.wakeUp=function(){var t=this.sleepState;this.sleepState=u.AWAKE;this.idleTime=0;if(t!==u.AWAKE){this.emit(u.wakeUpEvent)}};u.prototype.sleep=function(){this.sleepState=u.SLEEPING;this.angularVelocity=0;this.angularForce=0;s.set(this.velocity,0,0);s.set(this.force,0,0);this.emit(u.sleepEvent)};u.prototype.sleepTick=function(t,e,i){if(!this.allowSleep||this.type===u.SLEEPING){return}this.wantsToSleep=false;var r=this.sleepState,n=s.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2),a=Math.pow(this.sleepSpeedLimit,2);if(n>=a){this.idleTime=0;this.sleepState=u.AWAKE}else{this.idleTime+=i;this.sleepState=u.SLEEPY}if(this.idleTime>this.sleepTimeLimit){if(!e){this.sleep()}else{this.wantsToSleep=true}}};u.prototype.overlaps=function(t){return this.world.overlapKeeper.bodiesAreOverlapping(this,t)};var C=s.create();var S=s.create();u.prototype.integrate=function(t){var e=this.invMass,i=this.force,r=this.position,n=this.velocity;s.copy(this.previousPosition,this.position);this.previousAngle=this.angle;if(!this.fixedRotation){this.angularVelocity+=this.angularForce*this.invInertia*t}s.scale(C,i,t*e);s.multiply(C,this.massMultiplier,C);s.add(n,C,n);if(!this.integrateToTimeOfImpact(t)){s.scale(S,n,t);s.add(r,r,S);if(!this.fixedRotation){this.angle+=this.angularVelocity*t}}this.aabbNeedsUpdate=true};var A=new a;var E=new o({mode:o.ALL});var I=s.create();var M=s.create();var R=s.create();var L=s.create();u.prototype.integrateToTimeOfImpact=function(t){if(this.ccdSpeedThreshold<0||s.squaredLength(this.velocity)<Math.pow(this.ccdSpeedThreshold,2)){return false}s.normalize(I,this.velocity);s.scale(M,this.velocity,t);s.add(M,M,this.position);s.sub(R,M,this.position);var e=this.angularVelocity*t;var i=s.length(R);var r=1;var n;var a=this;A.reset();E.callback=function(t){if(t.body===a){return}n=t.body;t.getHitPoint(M,E);s.sub(R,M,a.position);r=s.length(R)/i;t.stop()};s.copy(E.from,this.position);s.copy(E.to,M);E.update();this.world.raycast(A,E);if(!n){return false}var o=this.angle;s.copy(L,this.position);var h=0;var l=0;var u=0;var c=r;while(c>=l&&h<this.ccdIterations){h++;u=(c-l)/2;s.scale(S,R,r);s.add(this.position,L,S);this.angle=o+e*r;this.updateAABB();var d=this.aabb.overlaps(n.aabb)&&this.world.narrowphase.bodiesOverlap(this,n);if(d){l=u}else{c=u}}r=u;s.copy(this.position,L);this.angle=o;s.scale(S,R,r);s.add(this.position,this.position,S);if(!this.fixedRotation){this.angle+=e*r}return true};u.prototype.getVelocityAtPoint=function(t,e){s.crossVZ(t,e,this.angularVelocity);s.subtract(t,this.velocity,t);return t};u.sleepyEvent={type:"sleepy"};u.sleepEvent={type:"sleep"};u.wakeUpEvent={type:"wakeup"};u.DYNAMIC=1;u.STATIC=2;u.KINEMATIC=4;u.AWAKE=0;u.SLEEPY=1;u.SLEEPING=2},{"../collision/AABB":7,"../collision/Ray":11,"../collision/RaycastResult":12,"../events/EventEmitter":26,"../math/vec2":30,"../shapes/Convex":40,"poly-decomp":5}],32:[function(t,e,i){var s=t("../math/vec2");var r=t("./Spring");var n=t("../utils/Utils");e.exports=a;function a(t,e,i){i=i||{};r.call(this,t,e,i);this.localAnchorA=s.fromValues(0,0);this.localAnchorB=s.fromValues(0,0);if(i.localAnchorA){s.copy(this.localAnchorA,i.localAnchorA)}if(i.localAnchorB){s.copy(this.localAnchorB,i.localAnchorB)}if(i.worldAnchorA){this.setWorldAnchorA(i.worldAnchorA)}if(i.worldAnchorB){this.setWorldAnchorB(i.worldAnchorB)}var n=s.create();var a=s.create();this.getWorldAnchorA(n);this.getWorldAnchorB(a);var o=s.distance(n,a);this.restLength=typeof i.restLength==="number"?i.restLength:o}a.prototype=new r;a.prototype.constructor=a;a.prototype.setWorldAnchorA=function(t){this.bodyA.toLocalFrame(this.localAnchorA,t)};a.prototype.setWorldAnchorB=function(t){this.bodyB.toLocalFrame(this.localAnchorB,t)};a.prototype.getWorldAnchorA=function(t){this.bodyA.toWorldFrame(t,this.localAnchorA)};a.prototype.getWorldAnchorB=function(t){this.bodyB.toWorldFrame(t,this.localAnchorB)};var o=s.create(),h=s.create(),l=s.create(),u=s.create(),c=s.create(),d=s.create(),f=s.create(),p=s.create(),g=s.create();a.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,i=this.restLength,r=this.bodyA,n=this.bodyB,a=o,m=h,y=l,v=u,b=g;var x=c,w=d,_=f,P=p;this.getWorldAnchorA(x);this.getWorldAnchorB(w);s.sub(_,x,r.position);s.sub(P,w,n.position);s.sub(a,w,x);var T=s.len(a);s.normalize(m,a);s.sub(y,n.velocity,r.velocity);s.crossZV(b,n.angularVelocity,P);s.add(y,y,b);s.crossZV(b,r.angularVelocity,_);s.sub(y,y,b);s.scale(v,m,-t*(T-i)-e*s.dot(y,m));s.sub(r.force,r.force,v);s.add(n.force,n.force,v);var C=s.crossLength(_,v);var S=s.crossLength(P,v);r.angularForce-=C;n.angularForce+=S}},{"../math/vec2":30,"../utils/Utils":57,"./Spring":34}],33:[function(t,e,i){var s=t("../math/vec2");var r=t("./Spring");e.exports=n;function n(t,e,i){i=i||{};r.call(this,t,e,i);this.restAngle=typeof i.restAngle==="number"?i.restAngle:e.angle-t.angle}n.prototype=new r;n.prototype.constructor=n;n.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,i=this.restAngle,s=this.bodyA,r=this.bodyB,n=r.angle-s.angle,a=r.angularVelocity-s.angularVelocity;var o=-t*(n-i)-e*a*0;s.angularForce-=o;r.angularForce+=o}},{"../math/vec2":30,"./Spring":34}],34:[function(t,e,i){var s=t("../math/vec2");var r=t("../utils/Utils");e.exports=n;function n(t,e,i){i=r.defaults(i,{stiffness:100,damping:1});this.stiffness=i.stiffness;this.damping=i.damping;this.bodyA=t;this.bodyB=e}n.prototype.applyForce=function(){}},{"../math/vec2":30,"../utils/Utils":57}],35:[function(t,e,i){var s=t("../math/vec2");var r=t("../utils/Utils");var n=t("../constraints/Constraint");var a=t("../equations/FrictionEquation");var o=t("../objects/Body");e.exports=h;function h(t,e){e=e||{};this.chassisBody=t;this.wheels=[];this.groundBody=new o({mass:0});this.world=null;var i=this;this.preStepCallback=function(){i.update()}}h.prototype.addToWorld=function(t){this.world=t;t.addBody(this.groundBody);t.on("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var i=this.wheels[e];t.addConstraint(i)}};h.prototype.removeFromWorld=function(){var t=this.world;t.removeBody(this.groundBody);t.off("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var i=this.wheels[e];t.removeConstraint(i)}this.world=null};h.prototype.addWheel=function(t){var e=new l(this,t);this.wheels.push(e);return e};h.prototype.update=function(){for(var t=0;t<this.wheels.length;t++){this.wheels[t].update()}};function l(t,e){e=e||{};this.vehicle=t;this.forwardEquation=new a(t.chassisBody,t.groundBody);this.sideEquation=new a(t.chassisBody,t.groundBody);this.steerValue=0;this.engineForce=0;this.setSideFriction(e.sideFriction!==undefined?e.sideFriction:5);this.localForwardVector=s.fromValues(0,1);if(e.localForwardVector){s.copy(this.localForwardVector,e.localForwardVector)}this.localPosition=s.fromValues(0,0);if(e.localPosition){s.copy(this.localPosition,e.localPosition)}n.apply(this,t.chassisBody,t.groundBody);this.equations.push(this.forwardEquation,this.sideEquation);this.setBrakeForce(0)}l.prototype=new n;l.prototype.setBrakeForce=function(t){this.forwardEquation.setSlipForce(t)};l.prototype.setSideFriction=function(t){this.sideEquation.setSlipForce(t)};var u=s.create();var c=s.create();l.prototype.getSpeed=function(){this.vehicle.chassisBody.vectorToWorldFrame(c,this.localForwardVector);this.vehicle.chassisBody.getVelocityAtPoint(u,c);return s.dot(u,c)};var d=s.create();l.prototype.update=function(){this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.t,this.localForwardVector);s.rotate(this.sideEquation.t,this.localForwardVector,Math.PI/2);this.vehicle.chassisBody.vectorToWorldFrame(this.sideEquation.t,this.sideEquation.t);s.rotate(this.forwardEquation.t,this.forwardEquation.t,this.steerValue);s.rotate(this.sideEquation.t,this.sideEquation.t,this.steerValue);this.vehicle.chassisBody.toWorldFrame(this.forwardEquation.contactPointB,this.localPosition);s.copy(this.sideEquation.contactPointB,this.forwardEquation.contactPointB);this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.contactPointA,this.localPosition);s.copy(this.sideEquation.contactPointA,this.forwardEquation.contactPointA);s.normalize(d,this.forwardEquation.t);s.scale(d,d,this.engineForce);this.vehicle.chassisBody.applyForce(d,this.forwardEquation.contactPointA)}},{"../constraints/Constraint":14,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],36:[function(t,e,i){var s=e.exports={AABB:t("./collision/AABB"),AngleLockEquation:t("./equations/AngleLockEquation"),Body:t("./objects/Body"),Broadphase:t("./collision/Broadphase"),Capsule:t("./shapes/Capsule"),Circle:t("./shapes/Circle"),Constraint:t("./constraints/Constraint"),ContactEquation:t("./equations/ContactEquation"),ContactEquationPool:t("./utils/ContactEquationPool"),ContactMaterial:t("./material/ContactMaterial"),Convex:t("./shapes/Convex"),DistanceConstraint:t("./constraints/DistanceConstraint"),Equation:t("./equations/Equation"),EventEmitter:t("./events/EventEmitter"),FrictionEquation:t("./equations/FrictionEquation"),FrictionEquationPool:t("./utils/FrictionEquationPool"),GearConstraint:t("./constraints/GearConstraint"),GSSolver:t("./solver/GSSolver"),Heightfield:t("./shapes/Heightfield"),Line:t("./shapes/Line"),LockConstraint:t("./constraints/LockConstraint"),Material:t("./material/Material"),Narrowphase:t("./collision/Narrowphase"),NaiveBroadphase:t("./collision/NaiveBroadphase"),Particle:t("./shapes/Particle"),Plane:t("./shapes/Plane"),Pool:t("./utils/Pool"),RevoluteConstraint:t("./constraints/RevoluteConstraint"),PrismaticConstraint:t("./constraints/PrismaticConstraint"),Ray:t("./collision/Ray"),RaycastResult:t("./collision/RaycastResult"),Box:t("./shapes/Box"),RotationalVelocityEquation:t("./equations/RotationalVelocityEquation"),SAPBroadphase:t("./collision/SAPBroadphase"),Shape:t("./shapes/Shape"),Solver:t("./solver/Solver"),Spring:t("./objects/Spring"),TopDownVehicle:t("./objects/TopDownVehicle"),LinearSpring:t("./objects/LinearSpring"),RotationalSpring:t("./objects/RotationalSpring"),Utils:t("./utils/Utils"),World:t("./world/World"),vec2:t("./math/vec2"),version:t("../package.json").version};Object.defineProperty(s,"Rectangle",{get:function(){console.warn("The Rectangle class has been renamed to Box.");return this.Box}})},{"../package.json":6,"./collision/AABB":7,"./collision/Broadphase":8,"./collision/NaiveBroadphase":9,"./collision/Narrowphase":10,"./collision/Ray":11,"./collision/RaycastResult":12,"./collision/SAPBroadphase":13,"./constraints/Constraint":14,"./constraints/DistanceConstraint":15,"./constraints/GearConstraint":16,"./constraints/LockConstraint":17,"./constraints/PrismaticConstraint":18,"./constraints/RevoluteConstraint":19,"./equations/AngleLockEquation":20,"./equations/ContactEquation":21,"./equations/Equation":22,"./equations/FrictionEquation":23,"./equations/RotationalVelocityEquation":25,"./events/EventEmitter":26,"./material/ContactMaterial":27,"./material/Material":28,"./math/vec2":30,"./objects/Body":31,"./objects/LinearSpring":32,"./objects/RotationalSpring":33,"./objects/Spring":34,"./objects/TopDownVehicle":35,"./shapes/Box":37,"./shapes/Capsule":38,"./shapes/Circle":39,"./shapes/Convex":40,"./shapes/Heightfield":41,"./shapes/Line":42,"./shapes/Particle":43,"./shapes/Plane":44,"./shapes/Shape":45,"./solver/GSSolver":46,"./solver/Solver":47,"./utils/ContactEquationPool":48,"./utils/FrictionEquationPool":49,"./utils/Pool":55,"./utils/Utils":57,"./world/World":61}],37:[function(t,e,i){var s=t("../math/vec2"),r=t("./Shape"),n=t("./Convex");e.exports=a;function a(t){if(typeof arguments[0]==="number"&&typeof arguments[1]==="number"){t={width:arguments[0],height:arguments[1]};console.warn("The Rectangle has been renamed to Box and its constructor signature has changed. Please use the following format: new Box({ width: 1, height: 1, ... })")}t=t||{};var e=this.width=t.width||1;var i=this.height=t.height||1;var a=[s.fromValues(-e/2,-i/2),s.fromValues(e/2,-i/2),s.fromValues(e/2,i/2),s.fromValues(-e/2,i/2)];var o=[s.fromValues(1,0),s.fromValues(0,1)];t.vertices=a;t.axes=o;t.type=r.BOX;n.call(this,t)}a.prototype=new n;a.prototype.constructor=a;a.prototype.computeMomentOfInertia=function(t){var e=this.width,i=this.height;return t*(i*i+e*e)/12};a.prototype.updateBoundingRadius=function(){var t=this.width,e=this.height;this.boundingRadius=Math.sqrt(t*t+e*e)/2};var o=s.create(),h=s.create(),l=s.create(),u=s.create();a.prototype.computeAABB=function(t,e,i){t.setFromPoints(this.vertices,e,i,0)};a.prototype.updateArea=function(){this.area=this.width*this.height}},{"../math/vec2":30,"./Convex":40,"./Shape":45}],38:[function(t,e,i){var s=t("./Shape"),r=t("../math/vec2");e.exports=n;function n(t){if(typeof arguments[0]==="number"&&typeof arguments[1]==="number"){t={length:arguments[0],radius:arguments[1]};console.warn("The Capsule constructor signature has changed. Please use the following format: new Capsule({ radius: 1, length: 1 })")}t=t||{};this.length=t.length||1;this.radius=t.radius||1;t.type=s.CAPSULE;s.call(this,t)}n.prototype=new s;n.prototype.constructor=n;n.prototype.computeMomentOfInertia=function(t){var e=this.radius,i=this.length+e,s=e*2;return t*(s*s+i*i)/12};n.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2};n.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+this.radius*2*this.length};var a=r.create();n.prototype.computeAABB=function(t,e,i){var s=this.radius;r.set(a,this.length/2,0);if(i!==0){r.rotate(a,a,i)}r.set(t.upperBound,Math.max(a[0]+s,-a[0]+s),Math.max(a[1]+s,-a[1]+s));r.set(t.lowerBound,Math.min(a[0]-s,-a[0]-s),Math.min(a[1]-s,-a[1]-s));r.add(t.lowerBound,t.lowerBound,e);r.add(t.upperBound,t.upperBound,e)};var o=r.create();var h=r.create();var l=r.create();var u=r.create();var c=r.fromValues(0,1);n.prototype.raycast=function(t,e,i,s){var n=e.from;var a=e.to;var d=e.direction;var f=o;var p=h;var g=l;var m=u;var y=this.length/2;for(var v=0;v<2;v++){var b=this.radius*(v*2-1);r.set(g,-y,b);r.set(m,y,b);r.toGlobalFrame(g,g,i,s);r.toGlobalFrame(m,m,i,s);var x=r.getLineSegmentsIntersectionFraction(n,a,g,m);if(x>=0){r.rotate(p,c,s);r.scale(p,p,v*2-1);e.reportIntersection(t,x,p,-1);if(t.shouldStop(e)){return}}}var w=Math.pow(this.radius,2)+Math.pow(y,2);for(var v=0;v<2;v++){r.set(g,y*(v*2-1),0);r.toGlobalFrame(g,g,i,s);var _=Math.pow(a[0]-n[0],2)+Math.pow(a[1]-n[1],2);var P=2*((a[0]-n[0])*(n[0]-g[0])+(a[1]-n[1])*(n[1]-g[1]));var T=Math.pow(n[0]-g[0],2)+Math.pow(n[1]-g[1],2)-Math.pow(this.radius,2);var x=Math.pow(P,2)-4*_*T;if(x<0){continue}else if(x===0){r.lerp(f,n,a,x);if(r.squaredDistance(f,i)>w){r.sub(p,f,g);r.normalize(p,p);e.reportIntersection(t,x,p,-1);if(t.shouldStop(e)){return}}}else{var C=Math.sqrt(x);var S=1/(2*_);var A=(-P-C)*S;var E=(-P+C)*S;if(A>=0&&A<=1){r.lerp(f,n,a,A);if(r.squaredDistance(f,i)>w){r.sub(p,f,g);r.normalize(p,p);e.reportIntersection(t,A,p,-1);if(t.shouldStop(e)){return}}}if(E>=0&&E<=1){r.lerp(f,n,a,E);if(r.squaredDistance(f,i)>w){r.sub(p,f,g);r.normalize(p,p);e.reportIntersection(t,E,p,-1);if(t.shouldStop(e)){return}}}}}}},{"../math/vec2":30,"./Shape":45}],39:[function(t,e,i){var s=t("./Shape"),r=t("../math/vec2");e.exports=n;function n(t){if(typeof arguments[0]==="number"){t={radius:arguments[0]};console.warn("The Circle constructor signature has changed. Please use the following format: new Circle({ radius: 1 })")}t=t||{};this.radius=t.radius||1;t.type=s.CIRCLE;s.call(this,t)}n.prototype=new s;n.prototype.constructor=n;n.prototype.computeMomentOfInertia=function(t){var e=this.radius;return t*e*e/2};n.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius};n.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius};n.prototype.computeAABB=function(t,e,i){var s=this.radius;r.set(t.upperBound,s,s);r.set(t.lowerBound,-s,-s);if(e){r.add(t.lowerBound,t.lowerBound,e);r.add(t.upperBound,t.upperBound,e)}};var a=r.create();var o=r.create();n.prototype.raycast=function(t,e,i,s){var n=e.from,h=e.to,l=this.radius;var u=Math.pow(h[0]-n[0],2)+Math.pow(h[1]-n[1],2);var c=2*((h[0]-n[0])*(n[0]-i[0])+(h[1]-n[1])*(n[1]-i[1]));var d=Math.pow(n[0]-i[0],2)+Math.pow(n[1]-i[1],2)-Math.pow(l,2);var f=Math.pow(c,2)-4*u*d;var p=a;var g=o;if(f<0){return}else if(f===0){r.lerp(p,n,h,f);r.sub(g,p,i);r.normalize(g,g);e.reportIntersection(t,f,g,-1)}else{var m=Math.sqrt(f);var y=1/(2*u);var v=(-c-m)*y;var b=(-c+m)*y;if(v>=0&&v<=1){r.lerp(p,n,h,v);r.sub(g,p,i);r.normalize(g,g);e.reportIntersection(t,v,g,-1);if(t.shouldStop(e)){return}}if(b>=0&&b<=1){r.lerp(p,n,h,b);r.sub(g,p,i);r.normalize(g,g);e.reportIntersection(t,b,g,-1)}}}},{"../math/vec2":30,"./Shape":45}],40:[function(t,e,i){var s=t("./Shape"),r=t("../math/vec2"),n=t("../math/polyk"),a=t("poly-decomp");e.exports=o;function o(t){if(Array.isArray(arguments[0])){t={vertices:arguments[0],axes:arguments[1]};console.warn("The Convex constructor signature has changed. Please use the following format: new Convex({ vertices: [...], ... })")}t=t||{};this.vertices=[];var e=t.vertices!==undefined?t.vertices:[];for(var i=0;i<e.length;i++){var n=r.create();r.copy(n,e[i]);this.vertices.push(n)}this.axes=[];if(t.axes){for(var i=0;i<t.axes.length;i++){var a=r.create();r.copy(a,t.axes[i]);this.axes.push(a)}}else{for(var i=0;i<this.vertices.length;i++){var o=this.vertices[i];var h=this.vertices[(i+1)%this.vertices.length];var l=r.create();r.sub(l,h,o);r.rotate90cw(l,l);r.normalize(l,l);this.axes.push(l)}}this.centerOfMass=r.fromValues(0,0);this.triangles=[];if(this.vertices.length){this.updateTriangles();this.updateCenterOfMass()}this.boundingRadius=0;t.type=s.CONVEX;s.call(this,t);this.updateBoundingRadius();this.updateArea();if(this.area<0){throw new Error("Convex vertices must be given in conter-clockwise winding.")}}o.prototype=new s;o.prototype.constructor=o;var h=r.create();var l=r.create();o.prototype.projectOntoLocalAxis=function(t,e){var i=null,s=null,n,a,t=h;for(var o=0;o<this.vertices.length;o++){n=this.vertices[o];a=r.dot(n,t);if(i===null||a>i){i=a}if(s===null||a<s){s=a}}if(s>i){var l=s;s=i;i=l}r.set(e,s,i)};o.prototype.projectOntoWorldAxis=function(t,e,i,s){var n=l;this.projectOntoLocalAxis(t,s);if(i!==0){r.rotate(n,t,i)}else{n=t}var a=r.dot(e,n);r.set(s,s[0]+a,s[1]+a)};o.prototype.updateTriangles=function(){this.triangles.length=0;var t=[];for(var e=0;e<this.vertices.length;e++){var i=this.vertices[e];t.push(i[0],i[1])}var s=n.Triangulate(t);for(var e=0;e<s.length;e+=3){var r=s[e],a=s[e+1],o=s[e+2];this.triangles.push([r,a,o])}};var u=r.create(),c=r.create(),d=r.create(),f=r.create(),p=r.create(),g=r.create(),m=r.create(),y=r.create(),v=r.create();o.prototype.updateCenterOfMass=function(){var t=this.triangles,e=this.vertices,i=this.centerOfMass,s=u,n=v,a=d,h=f,l=p,b=g,x=m,w=y,_=c;r.set(i,0,0);var P=0;for(var T=0;T!==t.length;T++){var C=t[T],a=e[C[0]],h=e[C[1]],l=e[C[2]];r.centroid(s,a,h,l);var S=o.triangleArea(a,h,l);P+=S;r.scale(_,s,S);r.add(i,i,_)}r.scale(i,i,1/P)};o.prototype.computeMomentOfInertia=function(t){var e=0,i=0,s=this.vertices.length;for(var n=s-1,a=0;a<s;n=a,a++){var o=this.vertices[n];var h=this.vertices[a];var l=Math.abs(r.crossLength(o,h));var u=r.dot(h,h)+r.dot(h,o)+r.dot(o,o);e+=l*u;i+=l}return t/6*(e/i)};o.prototype.updateBoundingRadius=function(){var t=this.vertices,e=0;for(var i=0;i!==t.length;i++){var s=r.squaredLength(t[i]);if(s>e){e=s}}this.boundingRadius=Math.sqrt(e)};o.triangleArea=function(t,e,i){return((e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1]))*.5};o.prototype.updateArea=function(){this.updateTriangles();this.area=0;var t=this.triangles,e=this.vertices;for(var i=0;i!==t.length;i++){var s=t[i],r=e[s[0]],n=e[s[1]],a=e[s[2]];var h=o.triangleArea(r,n,a);this.area+=h}};o.prototype.computeAABB=function(t,e,i){t.setFromPoints(this.vertices,e,i,0)};var b=r.create();var x=r.create();var w=r.create();o.prototype.raycast=function(t,e,i,s){var n=b;var a=x;var o=w;var h=this.vertices;r.toLocalFrame(n,e.from,i,s);r.toLocalFrame(a,e.to,i,s);var l=h.length;for(var u=0;u<l&&!t.shouldStop(e);u++){var c=h[u];var d=h[(u+1)%l];var f=r.getLineSegmentsIntersectionFraction(n,a,c,d);if(f>=0){r.sub(o,d,c);r.rotate(o,o,-Math.PI/2+s);r.normalize(o,o);e.reportIntersection(t,f,o,u)}}}},{"../math/polyk":29,"../math/vec2":30,"./Shape":45,"poly-decomp":5}],41:[function(t,e,i){var s=t("./Shape"),r=t("../math/vec2"),n=t("../utils/Utils");e.exports=a;function a(t){if(Array.isArray(arguments[0])){t={heights:arguments[0]};if(typeof arguments[1]==="object"){for(var e in arguments[1]){t[e]=arguments[1][e]}}console.warn("The Heightfield constructor signature has changed. Please use the following format: new Heightfield({ heights: [...], ... })")}t=t||{};this.heights=t.heights?t.heights.slice(0):[];this.maxValue=t.maxValue||null;this.minValue=t.minValue||null;this.elementWidth=t.elementWidth||.1;if(t.maxValue===undefined||t.minValue===undefined){this.updateMaxMinValues()}t.type=s.HEIGHTFIELD;s.call(this,t)}a.prototype=new s;a.prototype.constructor=a;a.prototype.updateMaxMinValues=function(){var t=this.heights;var e=t[0];var i=t[0];for(var s=0;s!==t.length;s++){var r=t[s];if(r>e){e=r}if(r<i){i=r}}this.maxValue=e;this.minValue=i};a.prototype.computeMomentOfInertia=function(t){return Number.MAX_VALUE};a.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE};a.prototype.updateArea=function(){var t=this.heights,e=0;for(var i=0;i<t.length-1;i++){e+=(t[i]+t[i+1])/2*this.elementWidth}this.area=e};var o=[r.create(),r.create(),r.create(),r.create()];a.prototype.computeAABB=function(t,e,i){r.set(o[0],0,this.maxValue);r.set(o[1],this.elementWidth*this.heights.length,this.maxValue);r.set(o[2],this.elementWidth*this.heights.length,this.minValue);r.set(o[3],0,this.minValue);t.setFromPoints(o,e,i)};a.prototype.getLineSegment=function(t,e,i){var s=this.heights;var n=this.elementWidth;r.set(t,i*n,s[i]);r.set(e,(i+1)*n,s[i+1])};a.prototype.getSegmentIndex=function(t){return Math.floor(t[0]/this.elementWidth)};a.prototype.getClampedSegmentIndex=function(t){var e=this.getSegmentIndex(t);e=Math.min(this.heights.length,Math.max(e,0));return e};var h=r.create();var l=r.create();var u=r.create();var c=r.create();var d=r.create();var f=r.create();var p=r.fromValues(0,1);function g(t,e,i,s,r){var n,a,o,h;n=i[0]-e[0];a=i[1]-e[1];o=r[0]-s[0];h=r[1]-s[1];var l,u;l=(-a*(e[0]-s[0])+n*(e[1]-s[1]))/(-o*a+n*h);u=(o*(e[1]-s[1])-h*(e[0]-s[0]))/(-o*a+n*h);if(l>=0&&l<=1&&u>=0&&u<=1){var c=e[0]+u*n;var d=e[1]+u*a;t[0]=c;t[1]=d;return u}return-1}a.prototype.raycast=function(t,e,i,s){var n=e.from;var a=e.to;var o=e.direction;var p=h;var g=l;var m=u;var y=c;var v=d;var b=f;r.toLocalFrame(v,n,i,s);r.toLocalFrame(b,a,i,s);var x=this.getClampedSegmentIndex(v);var w=this.getClampedSegmentIndex(b);if(x>w){var _=x;x=w;w=_}for(var P=0;P<this.heights.length-1;P++){this.getLineSegment(m,y,P);var T=r.getLineSegmentsIntersectionFraction(v,b,m,y);if(T>=0){r.sub(g,y,m);r.rotate(g,g,s+Math.PI/2);r.normalize(g,g);e.reportIntersection(t,T,g,-1);if(t.shouldStop(e)){return}}}}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],42:[function(t,e,i){var s=t("./Shape"),r=t("../math/vec2");e.exports=n;function n(t){if(typeof arguments[0]==="number"){t={length:arguments[0]};console.warn("The Line constructor signature has changed. Please use the following format: new Line({ length: 1, ... })")}t=t||{};this.length=t.length||1;t.type=s.LINE;s.call(this,t)}n.prototype=new s;n.prototype.constructor=n;n.prototype.computeMomentOfInertia=function(t){return t*Math.pow(this.length,2)/12};n.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var a=[r.create(),r.create()];n.prototype.computeAABB=function(t,e,i){var s=this.length/2;r.set(a[0],-s,0);r.set(a[1],s,0);t.setFromPoints(a,e,i,0)};var o=r.create();var h=r.create();var l=r.create();var u=r.create();var c=r.fromValues(0,1);n.prototype.raycast=function(t,e,i,s){var n=e.from;var a=e.to;var o=l;var d=u;var f=this.length/2;r.set(o,-f,0);r.set(d,f,0);r.toGlobalFrame(o,o,i,s);r.toGlobalFrame(d,d,i,s);var p=r.getLineSegmentsIntersectionFraction(o,d,n,a);if(p>=0){var g=h;r.rotate(g,c,s);e.reportIntersection(t,p,g,-1)}}},{"../math/vec2":30,"./Shape":45}],43:[function(t,e,i){var s=t("./Shape"),r=t("../math/vec2");e.exports=n;function n(t){t=t||{};t.type=s.PARTICLE;s.call(this,t)}n.prototype=new s;n.prototype.constructor=n;n.prototype.computeMomentOfInertia=function(t){return 0};n.prototype.updateBoundingRadius=function(){this.boundingRadius=0};n.prototype.computeAABB=function(t,e,i){r.copy(t.lowerBound,e);r.copy(t.upperBound,e)}},{"../math/vec2":30,"./Shape":45}],44:[function(t,e,i){var s=t("./Shape"),r=t("../math/vec2"),n=t("../utils/Utils");e.exports=a;function a(t){t=t||{};t.type=s.PLANE;s.call(this,t)}a.prototype=new s;a.prototype.constructor=a;a.prototype.computeMomentOfInertia=function(t){return 0};a.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE};a.prototype.computeAABB=function(t,e,i){var s=i%(2*Math.PI);var n=r.set;var a=Number.MAX_VALUE;var o=t.lowerBound;var h=t.upperBound;if(s===0){n(o,-a,-a);n(h,a,0)}else if(s===Math.PI/2){n(o,0,-a);n(h,a,a)}else if(s===Math.PI){n(o,-a,0);n(h,a,a)}else if(s===3*Math.PI/2){n(o,-a,-a);n(h,0,a)}else{n(o,-a,-a);n(h,a,a)}r.add(o,o,e);r.add(h,h,e)};a.prototype.updateArea=function(){this.area=Number.MAX_VALUE};var o=r.create();var h=r.create();var l=r.create();var u=r.create();var c=r.create();a.prototype.raycast=function(t,e,i,s){var n=e.from;var a=e.to;var d=e.direction;var f=o;var p=h;var g=l;var m=u;var y=c;r.set(m,0,1);r.rotate(m,m,s);r.sub(y,n,i);var v=r.dot(y,m);r.sub(y,a,i);var b=r.dot(y,m);if(v*b>0){return}if(r.squaredDistance(n,a)<v*v){return}var x=r.dot(m,d);r.sub(f,n,i);var w=-r.dot(m,f)/x/e.length;e.reportIntersection(t,w,m,-1)}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],45:[function(t,e,i){e.exports=r;var s=t("../math/vec2");function r(t){t=t||{};this.body=null;this.position=s.fromValues(0,0);if(t.position){s.copy(this.position,t.position)}this.angle=t.angle||0;this.type=t.type||0;this.id=r.idCounter++;this.boundingRadius=0;this.collisionGroup=t.collisionGroup!==undefined?t.collisionGroup:1;this.collisionResponse=t.collisionResponse!==undefined?t.collisionResponse:true;this.collisionMask=t.collisionMask!==undefined?t.collisionMask:1;this.material=t.material||null;this.area=0;this.sensor=t.sensor!==undefined?t.sensor:false;if(this.type){this.updateBoundingRadius()}this.updateArea()}r.idCounter=0;r.CIRCLE=1;r.PARTICLE=2;r.PLANE=4;r.CONVEX=8;r.LINE=16;r.BOX=32;Object.defineProperty(r,"RECTANGLE",{get:function(){console.warn("Shape.RECTANGLE is deprecated, use Shape.BOX instead.");return r.BOX}});r.CAPSULE=64;r.HEIGHTFIELD=128;r.prototype.computeMomentOfInertia=function(t){};r.prototype.updateBoundingRadius=function(){};r.prototype.updateArea=function(){};r.prototype.computeAABB=function(t,e,i){};r.prototype.raycast=function(t,e,i,s){}},{"../math/vec2":30}],46:[function(t,e,i){var s=t("../math/vec2"),r=t("./Solver"),n=t("../utils/Utils"),a=t("../equations/FrictionEquation");e.exports=o;function o(t){r.call(this,t,r.GS);t=t||{};this.iterations=t.iterations||10;this.tolerance=t.tolerance||1e-7;this.arrayStep=30;this.lambda=new n.ARRAY_TYPE(this.arrayStep);this.Bs=new n.ARRAY_TYPE(this.arrayStep);this.invCs=new n.ARRAY_TYPE(this.arrayStep);this.useZeroRHS=false;this.frictionIterations=0;this.usedIterations=0}o.prototype=new r;o.prototype.constructor=o;function h(t){var e=t.length;while(e--){t[e]=+0}}o.prototype.solve=function(t,e){this.sortEquations();var i=0,r=this.iterations,l=this.frictionIterations,u=this.equations,c=u.length,d=Math.pow(this.tolerance*c,2),f=e.bodies,p=e.bodies.length,g=s.add,m=s.set,y=this.useZeroRHS,v=this.lambda;this.usedIterations=0;if(c){for(var b=0;b!==p;b++){var x=f[b];x.updateSolveMassProperties()}}if(v.length<c){v=this.lambda=new n.ARRAY_TYPE(c+this.arrayStep);this.Bs=new n.ARRAY_TYPE(c+this.arrayStep);this.invCs=new n.ARRAY_TYPE(c+this.arrayStep)}h(v);var w=this.invCs,_=this.Bs,v=this.lambda;for(var b=0;b!==u.length;b++){var P=u[b];if(P.timeStep!==t||P.needsUpdate){P.timeStep=t;P.update()}_[b]=P.computeB(P.a,P.b,t);w[b]=P.computeInvC(P.epsilon)}var T,C,P,S,b,A;if(c!==0){for(b=0;b!==p;b++){var x=f[b];x.resetConstraintVelocity()}if(l){for(i=0;i!==l;i++){S=0;for(A=0;A!==c;A++){P=u[A];var E=o.iterateEquation(A,P,P.epsilon,_,w,v,y,t,i);S+=Math.abs(E)}this.usedIterations++;if(S*S<=d){break}}o.updateMultipliers(u,v,1/t);for(A=0;A!==c;A++){var I=u[A];if(I instanceof a){var M=0;for(var R=0;R!==I.contactEquations.length;R++){M+=I.contactEquations[R].multiplier}M*=I.frictionCoefficient/I.contactEquations.length;I.maxForce=M;I.minForce=-M}}}for(i=0;i!==r;i++){S=0;for(A=0;A!==c;A++){P=u[A];var E=o.iterateEquation(A,P,P.epsilon,_,w,v,y,t,i);S+=Math.abs(E)}this.usedIterations++;if(S*S<=d){break}}for(b=0;b!==p;b++){f[b].addConstraintVelocity()}o.updateMultipliers(u,v,1/t)}};o.updateMultipliers=function(t,e,i){var s=t.length;while(s--){t[s].multiplier=e[s]*i}};o.iterateEquation=function(t,e,i,s,r,n,a,o,h){var l=s[t],u=r[t],c=n[t],d=e.computeGWlambda();var f=e.maxForce,p=e.minForce;if(a){l=0}var g=u*(l-d-i*c);var m=c+g;if(m<p*o){g=p*o-c}else if(m>f*o){g=f*o-c}n[t]+=g;e.addToWlambda(g);return g}},{"../equations/FrictionEquation":23,"../math/vec2":30,"../utils/Utils":57,"./Solver":47}],47:[function(t,e,i){var s=t("../utils/Utils"),r=t("../events/EventEmitter");e.exports=n;function n(t,e){t=t||{};r.call(this);this.type=e;this.equations=[];this.equationSortFunction=t.equationSortFunction||false}n.prototype=new r;n.prototype.constructor=n;n.prototype.solve=function(t,e){throw new Error("Solver.solve should be implemented by subclasses!")};var a={bodies:[]};n.prototype.solveIsland=function(t,e){this.removeAllEquations();if(e.equations.length){this.addEquations(e.equations);a.bodies.length=0;e.getBodies(a.bodies);if(a.bodies.length){this.solve(t,a)}}};n.prototype.sortEquations=function(){if(this.equationSortFunction){this.equations.sort(this.equationSortFunction)}};n.prototype.addEquation=function(t){if(t.enabled){this.equations.push(t)}};n.prototype.addEquations=function(t){for(var e=0,i=t.length;e!==i;e++){var s=t[e];if(s.enabled){this.equations.push(s)}}};n.prototype.removeEquation=function(t){var e=this.equations.indexOf(t);if(e!==-1){this.equations.splice(e,1)}};n.prototype.removeAllEquations=function(){this.equations.length=0};n.GS=1;n.ISLAND=2},{"../events/EventEmitter":26,"../utils/Utils":57}],48:[function(t,e,i){var s=t("../equations/ContactEquation");var r=t("./Pool");e.exports=n;function n(){r.apply(this,arguments)}n.prototype=new r;n.prototype.constructor=n;n.prototype.create=function(){return new s};n.prototype.destroy=function(t){t.bodyA=t.bodyB=null;return this}},{"../equations/ContactEquation":21,"./Pool":55}],49:[function(t,e,i){var s=t("../equations/FrictionEquation");var r=t("./Pool");e.exports=n;function n(){r.apply(this,arguments)}n.prototype=new r;n.prototype.constructor=n;n.prototype.create=function(){return new s};n.prototype.destroy=function(t){t.bodyA=t.bodyB=null;return this}},{"../equations/FrictionEquation":23,"./Pool":55}],50:[function(t,e,i){var s=t("../world/IslandNode");var r=t("./Pool");e.exports=n;function n(){r.apply(this,arguments)}n.prototype=new r;n.prototype.constructor=n;n.prototype.create=function(){return new s};n.prototype.destroy=function(t){t.reset();return this}},{"../world/IslandNode":60,"./Pool":55}],51:[function(t,e,i){var s=t("../world/Island");var r=t("./Pool");e.exports=n;function n(){r.apply(this,arguments)}n.prototype=new r;n.prototype.constructor=n;n.prototype.create=function(){return new s};n.prototype.destroy=function(t){t.reset();return this}},{"../world/Island":58,"./Pool":55}],52:[function(t,e,i){var s=t("./TupleDictionary");var r=t("./OverlapKeeperRecord");var n=t("./OverlapKeeperRecordPool");var a=t("./Utils");e.exports=o;function o(){this.overlappingShapesLastState=new s;this.overlappingShapesCurrentState=new s;this.recordPool=new n({size:16});this.tmpDict=new s;this.tmpArray1=[]}o.prototype.tick=function(){var t=this.overlappingShapesLastState;var e=this.overlappingShapesCurrentState;var i=t.keys.length;while(i--){var s=t.keys[i];var r=t.getByKey(s);var n=e.getByKey(s);if(r){this.recordPool.release(r)}}t.reset();t.copy(e);e.reset()};o.prototype.setOverlapping=function(t,e,i,s){var r=this.overlappingShapesLastState;var n=this.overlappingShapesCurrentState;if(!n.get(e.id,s.id)){var a=this.recordPool.get();a.set(t,e,i,s);n.set(e.id,s.id,a)}};o.prototype.getNewOverlaps=function(t){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,t)};o.prototype.getEndOverlaps=function(t){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,t)};o.prototype.bodiesAreOverlapping=function(t,e){var i=this.overlappingShapesCurrentState;var s=i.keys.length;while(s--){var r=i.keys[s];var n=i.data[r];if(n.bodyA===t&&n.bodyB===e||n.bodyA===e&&n.bodyB===t){return true}}return false};o.prototype.getDiff=function(t,e,i){var i=i||[];var s=t;var r=e;i.length=0;var n=r.keys.length;while(n--){var a=r.keys[n];var o=r.data[a];if(!o){throw new Error("Key "+a+" had no data!")}var h=s.data[a];if(!h){i.push(o)}}return i};o.prototype.isNewOverlap=function(t,e){var i=t.id|0,s=e.id|0;var r=this.overlappingShapesLastState;var n=this.overlappingShapesCurrentState;return!!!r.get(i,s)&&!!n.get(i,s)};o.prototype.getNewBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)};o.prototype.getEndBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)};o.prototype.getBodyDiff=function(t,e){e=e||[];var i=this.tmpDict;var s=t.length;while(s--){var r=t[s];i.set(r.bodyA.id|0,r.bodyB.id|0,r)}s=i.keys.length;while(s--){var r=i.getByKey(i.keys[s]);if(r){e.push(r.bodyA,r.bodyB)}}i.reset();return e}},{"./OverlapKeeperRecord":53,"./OverlapKeeperRecordPool":54,"./TupleDictionary":56,"./Utils":57}],53:[function(t,e,i){e.exports=s;function s(t,e,i,s){this.shapeA=e;this.shapeB=s;this.bodyA=t;this.bodyB=i}s.prototype.set=function(t,e,i,r){s.call(this,t,e,i,r)}},{}],54:[function(t,e,i){var s=t("./OverlapKeeperRecord");var r=t("./Pool");e.exports=n;function n(){r.apply(this,arguments)}n.prototype=new r;n.prototype.constructor=n;n.prototype.create=function(){return new s};n.prototype.destroy=function(t){t.bodyA=t.bodyB=t.shapeA=t.shapeB=null;return this}},{"./OverlapKeeperRecord":53,"./Pool":55}],55:[function(t,e,i){e.exports=s;function s(t){t=t||{};this.objects=[];if(t.size!==undefined){this.resize(t.size)}}s.prototype.resize=function(t){var e=this.objects;while(e.length>t){e.pop()}while(e.length<t){e.push(this.create())}return this};s.prototype.get=function(){var t=this.objects;return t.length?t.pop():this.create()};s.prototype.release=function(t){this.destroy(t);this.objects.push(t);return this}},{}],56:[function(t,e,i){var s=t("./Utils");e.exports=r;function r(){this.data={};this.keys=[]}r.prototype.getKey=function(t,e){t=t|0;e=e|0;if((t|0)===(e|0)){return-1}return((t|0)>(e|0)?t<<16|e&65535:e<<16|t&65535)|0};r.prototype.getByKey=function(t){t=t|0;return this.data[t]};r.prototype.get=function(t,e){return this.data[this.getKey(t,e)]};r.prototype.set=function(t,e,i){if(!i){throw new Error("No data!")}var s=this.getKey(t,e);if(!this.data[s]){this.keys.push(s)}this.data[s]=i;return s};r.prototype.reset=function(){var t=this.data,e=this.keys;var i=e.length;while(i--){delete t[e[i]]}e.length=0};r.prototype.copy=function(t){this.reset();s.appendArray(this.keys,t.keys);var e=t.keys.length;while(e--){var i=t.keys[e];this.data[i]=t.data[i]}}},{"./Utils":57}],57:[function(t,e,i){e.exports=s;function s(){}s.appendArray=function(t,e){if(e.length<15e4){t.push.apply(t,e)}else{for(var i=0,s=e.length;i!==s;++i){t.push(e[i])}}};s.splice=function(t,e,i){i=i||1;for(var s=e,r=t.length-i;s<r;s++){t[s]=t[s+i]}t.length=r};if(typeof P2_ARRAY_TYPE!=="undefined"){s.ARRAY_TYPE=P2_ARRAY_TYPE}else if(typeof Float32Array!=="undefined"){s.ARRAY_TYPE=Float32Array}else{s.ARRAY_TYPE=Array}s.extend=function(t,e){for(var i in e){t[i]=e[i]}};s.defaults=function(t,e){t=t||{};for(var i in e){if(!(i in t)){t[i]=e[i]}}return t}},{}],58:[function(t,e,i){var s=t("../objects/Body");e.exports=r;function r(){this.equations=[];this.bodies=[]}r.prototype.reset=function(){this.equations.length=this.bodies.length=0};var n=[];r.prototype.getBodies=function(t){var e=t||[],i=this.equations;n.length=0;for(var s=0;s!==i.length;s++){var r=i[s];if(n.indexOf(r.bodyA.id)===-1){e.push(r.bodyA);n.push(r.bodyA.id)}if(n.indexOf(r.bodyB.id)===-1){e.push(r.bodyB);n.push(r.bodyB.id)}}return e};r.prototype.wantsToSleep=function(){for(var t=0;t<this.bodies.length;t++){var e=this.bodies[t];if(e.type===s.DYNAMIC&&!e.wantsToSleep){return false}}return true};r.prototype.sleep=function(){for(var t=0;t<this.bodies.length;t++){var e=this.bodies[t];e.sleep()}return true}},{"../objects/Body":31}],59:[function(t,e,i){var s=t("../math/vec2"),r=t("./Island"),n=t("./IslandNode"),a=t("./../utils/IslandNodePool"),o=t("./../utils/IslandPool"),h=t("../objects/Body");e.exports=l;function l(t){this.nodePool=new a({size:16});this.islandPool=new o({size:8});this.equations=[];this.islands=[];this.nodes=[];this.queue=[]}l.getUnvisitedNode=function(t){var e=t.length;for(var i=0;i!==e;i++){var s=t[i];if(!s.visited&&s.body.type===h.DYNAMIC){return s}}return false};l.prototype.visit=function(t,e,i){e.push(t.body);var s=t.equations.length;for(var r=0;r!==s;r++){var n=t.equations[r];if(i.indexOf(n)===-1){i.push(n)}}};l.prototype.bfs=function(t,e,i){var s=this.queue;s.length=0;s.push(t);t.visited=true;this.visit(t,e,i);while(s.length){var r=s.pop();var n;while(n=l.getUnvisitedNode(r.neighbors)){n.visited=true;this.visit(n,e,i);if(n.body.type===h.DYNAMIC){s.push(n)}}}};l.prototype.split=function(t){var e=t.bodies,i=this.nodes,s=this.equations;while(i.length){this.nodePool.release(i.pop())}for(var r=0;r!==e.length;r++){var n=this.nodePool.get();n.body=e[r];i.push(n)}for(var a=0;a!==s.length;a++){var o=s[a],r=e.indexOf(o.bodyA),h=e.indexOf(o.bodyB),u=i[r],c=i[h];u.neighbors.push(c);c.neighbors.push(u);u.equations.push(o);c.equations.push(o)}var d=this.islands;for(var r=0;r<d.length;r++){this.islandPool.release(d[r])}d.length=0;var f;while(f=l.getUnvisitedNode(i)){var p=this.islandPool.get();this.bfs(f,p.bodies,p.equations);d.push(p)}return d}},{"../math/vec2":30,"../objects/Body":31,"./../utils/IslandNodePool":50,"./../utils/IslandPool":51,"./Island":58,"./IslandNode":60}],60:[function(t,e,i){e.exports=s;function s(t){this.body=t;this.neighbors=[];this.equations=[];this.visited=false}s.prototype.reset=function(){this.equations.length=0;this.neighbors.length=0;this.visited=false;this.body=null}},{}],61:[function(t,e,i){var s=t("../solver/GSSolver"),r=t("../solver/Solver"),n=t("../collision/Ray"),a=t("../math/vec2"),o=t("../shapes/Circle"),h=t("../shapes/Convex"),l=t("../shapes/Line"),u=t("../shapes/Plane"),c=t("../shapes/Capsule"),d=t("../shapes/Particle"),f=t("../events/EventEmitter"),p=t("../objects/Body"),g=t("../shapes/Shape"),m=t("../objects/LinearSpring"),y=t("../material/Material"),v=t("../material/ContactMaterial"),b=t("../constraints/DistanceConstraint"),x=t("../constraints/Constraint"),w=t("../constraints/LockConstraint"),_=t("../constraints/RevoluteConstraint"),P=t("../constraints/PrismaticConstraint"),T=t("../constraints/GearConstraint"),C=t("../../package.json"),S=t("../collision/Broadphase"),A=t("../collision/AABB"),E=t("../collision/SAPBroadphase"),I=t("../collision/Narrowphase"),M=t("../utils/Utils"),R=t("../utils/OverlapKeeper"),L=t("./IslandManager"),B=t("../objects/RotationalSpring");e.exports=O;function O(t){f.apply(this);t=t||{};this.springs=[];this.bodies=[];this.disabledBodyCollisionPairs=[];this.solver=t.solver||new s;this.narrowphase=new I(this);this.islandManager=new L;this.gravity=a.fromValues(0,-9.78);if(t.gravity){a.copy(this.gravity,t.gravity)}this.frictionGravity=a.length(this.gravity)||10;this.useWorldGravityAsFrictionGravity=true;this.useFrictionGravityOnZeroGravity=true;this.broadphase=t.broadphase||new E;this.broadphase.setWorld(this);this.constraints=[];this.defaultMaterial=new y;this.defaultContactMaterial=new v(this.defaultMaterial,this.defaultMaterial);this.lastTimeStep=1/60;this.applySpringForces=true;this.applyDamping=true;this.applyGravity=true;this.solveConstraints=true;this.contactMaterials=[];this.time=0;this.accumulator=0;this.stepping=false;this.bodiesToBeRemoved=[];this.islandSplit=typeof t.islandSplit!=="undefined"?!!t.islandSplit:true;this.emitImpactEvent=true;this._constraintIdCounter=0;this._bodyIdCounter=0;this.postStepEvent={type:"postStep"};this.addBodyEvent={type:"addBody",body:null};this.removeBodyEvent={type:"removeBody",body:null};this.addSpringEvent={type:"addSpring",spring:null};this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null};this.postBroadphaseEvent={type:"postBroadphase",pairs:null};this.sleepMode=O.NO_SLEEPING;this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]};this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null};this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null};this.overlappingShapesLastState={keys:[]};this.overlappingShapesCurrentState={keys:[]};this.overlapKeeper=new R}O.prototype=new Object(f.prototype);O.prototype.constructor=O;O.NO_SLEEPING=1;O.BODY_SLEEPING=2;O.ISLAND_SLEEPING=4;O.prototype.addConstraint=function(t){this.constraints.push(t)};O.prototype.addContactMaterial=function(t){this.contactMaterials.push(t)};O.prototype.removeContactMaterial=function(t){var e=this.contactMaterials.indexOf(t);if(e!==-1){M.splice(this.contactMaterials,e,1)}};O.prototype.getContactMaterial=function(t,e){var i=this.contactMaterials;for(var s=0,r=i.length;s!==r;s++){var n=i[s];if(n.materialA.id===t.id&&n.materialB.id===e.id||n.materialA.id===e.id&&n.materialB.id===t.id){return n}}return false};O.prototype.removeConstraint=function(t){var e=this.constraints.indexOf(t);if(e!==-1){M.splice(this.constraints,e,1)}};var k=a.create(),F=a.create(),D=a.create(),U=a.create(),G=a.create(),N=a.create(),X=a.create(),W=a.fromValues(0,0),j=a.fromValues(0,0),V=a.fromValues(0,0),q=a.fromValues(0,0);O.prototype.step=function(t,e,i){i=i||10;e=e||0;if(e===0){this.internalStep(t);this.time+=t}else{this.accumulator+=e;var s=0;while(this.accumulator>=t&&s<i){this.internalStep(t);this.time+=t;this.accumulator-=t;s++}var r=this.accumulator%t/t;for(var n=0;n!==this.bodies.length;n++){var o=this.bodies[n];a.lerp(o.interpolatedPosition,o.previousPosition,o.position,r);o.interpolatedAngle=o.previousAngle+r*(o.angle-o.previousAngle)}}};var H=[];O.prototype.internalStep=function(t){this.stepping=true;var e=this,i=this.springs.length,s=this.springs,r=this.bodies,n=this.gravity,o=this.solver,h=this.bodies.length,l=this.broadphase,u=this.narrowphase,c=this.constraints,d,f,g=G,m=N,y=X,v=a.scale,b=a.add,x=a.rotate,w=this.islandManager;this.overlapKeeper.tick();this.lastTimeStep=t;if(this.useWorldGravityAsFrictionGravity){var _=a.length(this.gravity);if(!(_===0&&this.useFrictionGravityOnZeroGravity)){this.frictionGravity=_}}if(this.applyGravity){for(var P=0;P!==h;P++){var T=r[P],C=T.force;if(T.type!==p.DYNAMIC||T.sleepState===p.SLEEPING){continue}a.scale(y,n,T.mass*T.gravityScale);b(C,C,y)}}if(this.applySpringForces){for(var P=0;P!==i;P++){var S=s[P];S.applyForce()}}if(this.applyDamping){for(var P=0;P!==h;P++){var T=r[P];if(T.type===p.DYNAMIC){T.applyDamping(t)}}}var A=l.getCollisionPairs(this);var E=this.disabledBodyCollisionPairs;for(var P=E.length-2;P>=0;P-=2){for(var I=A.length-2;I>=0;I-=2){if(E[P]===A[I]&&E[P+1]===A[I+1]||E[P+1]===A[I]&&E[P]===A[I+1]){A.splice(I,2)}}}var R=c.length;for(P=0;P!==R;P++){var L=c[P];if(!L.collideConnected){for(var I=A.length-2;I>=0;I-=2){if(L.bodyA===A[I]&&L.bodyB===A[I+1]||L.bodyB===A[I]&&L.bodyA===A[I+1]){A.splice(I,2)}}}}this.postBroadphaseEvent.pairs=A;this.emit(this.postBroadphaseEvent);this.postBroadphaseEvent.pairs=null;u.reset(this);for(var P=0,B=A.length;P!==B;P+=2){var k=A[P],F=A[P+1];for(var D=0,U=k.shapes.length;D!==U;D++){var W=k.shapes[D],j=W.position,V=W.angle;for(var q=0,Y=F.shapes.length;q!==Y;q++){var z=F.shapes[q],K=z.position,J=z.angle;var Q=this.defaultContactMaterial;if(W.material&&z.material){var Z=this.getContactMaterial(W.material,z.material);if(Z){Q=Z}}this.runNarrowphase(u,k,W,j,V,F,z,K,J,Q,this.frictionGravity)}}}for(var P=0;P!==h;P++){var $=r[P];if($._wakeUpAfterNarrowphase){$.wakeUp();$._wakeUpAfterNarrowphase=false}}if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(H);var tt=this.endContactEvent;var q=H.length;while(q--){var et=H[q];tt.shapeA=et.shapeA;tt.shapeB=et.shapeB;tt.bodyA=et.bodyA;tt.bodyB=et.bodyB;this.emit(tt)}H.length=0}var it=this.preSolveEvent;it.contactEquations=u.contactEquations;it.frictionEquations=u.frictionEquations;this.emit(it);it.contactEquations=it.frictionEquations=null;var R=c.length;for(P=0;P!==R;P++){c[P].update()}if(u.contactEquations.length||u.frictionEquations.length||R){if(this.islandSplit){w.equations.length=0;M.appendArray(w.equations,u.contactEquations);M.appendArray(w.equations,u.frictionEquations);for(P=0;P!==R;P++){M.appendArray(w.equations,c[P].equations)}w.split(this);for(var P=0;P!==w.islands.length;P++){var st=w.islands[P];if(st.equations.length){o.solveIsland(t,st)}}}else{o.addEquations(u.contactEquations);o.addEquations(u.frictionEquations);for(P=0;P!==R;P++){o.addEquations(c[P].equations)}if(this.solveConstraints){o.solve(t,this)}o.removeAllEquations()}}for(var P=0;P!==h;P++){var $=r[P];$.integrate(t)}for(var P=0;P!==h;P++){r[P].setZeroForce()}if(this.emitImpactEvent&&this.has("impact")){var rt=this.impactEvent;for(var P=0;P!==u.contactEquations.length;P++){var nt=u.contactEquations[P];if(nt.firstImpact){rt.bodyA=nt.bodyA;rt.bodyB=nt.bodyB;rt.shapeA=nt.shapeA;rt.shapeB=nt.shapeB;rt.contactEquation=nt;this.emit(rt)}}}if(this.sleepMode===O.BODY_SLEEPING){for(P=0;P!==h;P++){r[P].sleepTick(this.time,false,t)}}else if(this.sleepMode===O.ISLAND_SLEEPING&&this.islandSplit){for(P=0;P!==h;P++){r[P].sleepTick(this.time,true,t)}for(var P=0;P<this.islandManager.islands.length;P++){var st=this.islandManager.islands[P];if(st.wantsToSleep()){st.sleep()}}}this.stepping=false;var at=this.bodiesToBeRemoved;for(var P=0;P!==at.length;P++){this.removeBody(at[P])}at.length=0;this.emit(this.postStepEvent)};O.prototype.runNarrowphase=function(t,e,i,s,r,n,o,h,l,u,c){if(!((i.collisionGroup&o.collisionMask)!==0&&(o.collisionGroup&i.collisionMask)!==0)){return}a.rotate(W,s,e.angle);a.rotate(j,h,n.angle);a.add(W,W,e.position);a.add(j,j,n.position);var d=r+e.angle;var f=l+n.angle;t.enableFriction=u.friction>0;t.frictionCoefficient=u.friction;var g;if(e.type===p.STATIC||e.type===p.KINEMATIC){g=n.mass}else if(n.type===p.STATIC||n.type===p.KINEMATIC){g=e.mass}else{g=e.mass*n.mass/(e.mass+n.mass)}t.slipForce=u.friction*c*g;t.restitution=u.restitution;t.surfaceVelocity=u.surfaceVelocity;t.frictionStiffness=u.frictionStiffness;t.frictionRelaxation=u.frictionRelaxation;t.stiffness=u.stiffness;t.relaxation=u.relaxation;t.contactSkinSize=u.contactSkinSize;t.enabledEquations=e.collisionResponse&&n.collisionResponse&&i.collisionResponse&&o.collisionResponse;var m=t[i.type|o.type],y=0;if(m){var v=i.sensor||o.sensor;var b=t.frictionEquations.length;if(i.type<o.type){y=m.call(t,e,i,W,d,n,o,j,f,v)}else{y=m.call(t,n,o,j,f,e,i,W,d,v)}var x=t.frictionEquations.length-b;if(y){if(e.allowSleep&&e.type===p.DYNAMIC&&e.sleepState===p.SLEEPING&&n.sleepState===p.AWAKE&&n.type!==p.STATIC){var w=a.squaredLength(n.velocity)+Math.pow(n.angularVelocity,2);var _=Math.pow(n.sleepSpeedLimit,2);if(w>=_*2){e._wakeUpAfterNarrowphase=true}}if(n.allowSleep&&n.type===p.DYNAMIC&&n.sleepState===p.SLEEPING&&e.sleepState===p.AWAKE&&e.type!==p.STATIC){var P=a.squaredLength(e.velocity)+Math.pow(e.angularVelocity,2);var T=Math.pow(e.sleepSpeedLimit,2);if(P>=T*2){n._wakeUpAfterNarrowphase=true}}this.overlapKeeper.setOverlapping(e,i,n,o);if(this.has("beginContact")&&this.overlapKeeper.isNewOverlap(i,o)){var C=this.beginContactEvent;C.shapeA=i;C.shapeB=o;C.bodyA=e;C.bodyB=n;C.contactEquations.length=0;if(typeof y==="number"){for(var S=t.contactEquations.length-y;S<t.contactEquations.length;S++){C.contactEquations.push(t.contactEquations[S])}}this.emit(C)}if(typeof y==="number"&&x>1){for(var S=t.frictionEquations.length-x;S<t.frictionEquations.length;S++){var A=t.frictionEquations[S];A.setSlipForce(A.getSlipForce()/x)}}}}};O.prototype.addSpring=function(t){this.springs.push(t);var e=this.addSpringEvent;e.spring=t;this.emit(e);e.spring=null};O.prototype.removeSpring=function(t){var e=this.springs.indexOf(t);if(e!==-1){M.splice(this.springs,e,1)}};O.prototype.addBody=function(t){if(this.bodies.indexOf(t)===-1){this.bodies.push(t);t.world=this;var e=this.addBodyEvent;e.body=t;this.emit(e);e.body=null}};O.prototype.removeBody=function(t){if(this.stepping){this.bodiesToBeRemoved.push(t)}else{t.world=null;var e=this.bodies.indexOf(t);if(e!==-1){M.splice(this.bodies,e,1);this.removeBodyEvent.body=t;t.resetConstraintVelocity();this.emit(this.removeBodyEvent);this.removeBodyEvent.body=null}}};O.prototype.getBodyById=function(t){var e=this.bodies;for(var i=0;i<e.length;i++){var s=e[i];if(s.id===t){return s}}return false};O.prototype.disableBodyCollision=function(t,e){this.disabledBodyCollisionPairs.push(t,e)};O.prototype.enableBodyCollision=function(t,e){var i=this.disabledBodyCollisionPairs;for(var s=0;s<i.length;s+=2){if(i[s]===t&&i[s+1]===e||i[s+1]===t&&i[s]===e){i.splice(s,2);return}}};O.prototype.clear=function(){this.time=0;if(this.solver&&this.solver.equations.length){this.solver.removeAllEquations()}var t=this.constraints;for(var e=t.length-1;e>=0;e--){this.removeConstraint(t[e])}var i=this.bodies;for(var e=i.length-1;e>=0;e--){this.removeBody(i[e])}var s=this.springs;for(var e=s.length-1;e>=0;e--){this.removeSpring(s[e])}var r=this.contactMaterials;for(var e=r.length-1;e>=0;e--){this.removeContactMaterial(r[e])}O.apply(this)};var Y=a.create(),z=a.fromValues(0,0),K=a.fromValues(0,0);O.prototype.hitTest=function(t,e,i){i=i||0;var s=new p({position:t}),r=new d,n=t,l=0,f=Y,g=z,m=K;s.addShape(r);var y=this.narrowphase,v=[];for(var b=0,x=e.length;b!==x;b++){var w=e[b];for(var _=0,P=w.shapes.length;_!==P;_++){var T=w.shapes[_];a.rotate(f,T.position,w.angle);a.add(f,f,w.position);var C=T.angle+w.angle;if(T instanceof o&&y.circleParticle(w,T,f,C,s,r,n,l,true)||T instanceof h&&y.particleConvex(s,r,n,l,w,T,f,C,true)||T instanceof u&&y.particlePlane(s,r,n,l,w,T,f,C,true)||T instanceof c&&y.particleCapsule(s,r,n,l,w,T,f,C,true)||T instanceof d&&a.squaredLength(a.sub(m,f,t))<i*i){v.push(w)}}}return v};O.prototype.setGlobalStiffness=function(t){var e=this.constraints;for(var i=0;i!==e.length;i++){var s=e[i];for(var r=0;r!==s.equations.length;r++){var n=s.equations[r];n.stiffness=t;n.needsUpdate=true}}var a=this.contactMaterials;for(var i=0;i!==a.length;i++){var s=a[i];s.stiffness=s.frictionStiffness=t}var s=this.defaultContactMaterial;s.stiffness=s.frictionStiffness=t};O.prototype.setGlobalRelaxation=function(t){for(var e=0;e!==this.constraints.length;e++){var i=this.constraints[e];for(var s=0;s!==i.equations.length;s++){var r=i.equations[s];r.relaxation=t;r.needsUpdate=true}}for(var e=0;e!==this.contactMaterials.length;e++){var i=this.contactMaterials[e];i.relaxation=i.frictionRelaxation=t}var i=this.defaultContactMaterial;i.relaxation=i.frictionRelaxation=t};var J=new A;var Q=[];O.prototype.raycast=function(t,e){e.getAABB(J);this.broadphase.aabbQuery(this,J,Q);e.intersectBodies(t,Q);Q.length=0;return t.hasHit()}},{"../../package.json":6,"../collision/AABB":7,"../collision/Broadphase":8,"../collision/Narrowphase":10,"../collision/Ray":11,"../collision/SAPBroadphase":13,"../constraints/Constraint":14,"../constraints/DistanceConstraint":15,"../constraints/GearConstraint":16,"../constraints/LockConstraint":17,"../constraints/PrismaticConstraint":18,"../constraints/RevoluteConstraint":19,"../events/EventEmitter":26,"../material/ContactMaterial":27,"../material/Material":28,"../math/vec2":30,"../objects/Body":31,"../objects/LinearSpring":32,"../objects/RotationalSpring":33,"../shapes/Capsule":38,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Line":42,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45,"../solver/GSSolver":46,"../solver/Solver":47,"../utils/OverlapKeeper":52,"../utils/Utils":57,"./IslandManager":59}]},{},[36])(36)})},989:function(t,e,i){(function(e){t.exports=e["Phaser"]=i(990)}).call(this,i(14))},990:function(t,e,i){(function(i){(function(){var s=this;var r=r||{VERSION:"2.6.2",GAMES:[],AUTO:0,CANVAS:1,WEBGL:2,HEADLESS:3,NONE:0,LEFT:1,RIGHT:2,UP:3,DOWN:4,SPRITE:0,BUTTON:1,IMAGE:2,GRAPHICS:3,TEXT:4,TILESPRITE:5,BITMAPTEXT:6,GROUP:7,RENDERTEXTURE:8,TILEMAP:9,TILEMAPLAYER:10,EMITTER:11,POLYGON:12,BITMAPDATA:13,CANVAS_FILTER:14,WEBGL_FILTER:15,ELLIPSE:16,SPRITEBATCH:17,RETROFONT:18,POINTER:19,ROPE:20,CIRCLE:21,RECTANGLE:22,LINE:23,MATRIX:24,POINT:25,ROUNDEDRECTANGLE:26,CREATURE:27,VIDEO:28,PENDING_ATLAS:-1,HORIZONTAL:0,VERTICAL:1,LANDSCAPE:0,PORTRAIT:1,ANGLE_UP:270,ANGLE_DOWN:90,ANGLE_LEFT:180,ANGLE_RIGHT:0,ANGLE_NORTH_EAST:315,ANGLE_NORTH_WEST:225,ANGLE_SOUTH_EAST:45,ANGLE_SOUTH_WEST:135,TOP_LEFT:0,TOP_CENTER:1,TOP_RIGHT:2,LEFT_TOP:3,LEFT_CENTER:4,LEFT_BOTTOM:5,CENTER:6,RIGHT_TOP:7,RIGHT_CENTER:8,RIGHT_BOTTOM:9,BOTTOM_LEFT:10,BOTTOM_CENTER:11,BOTTOM_RIGHT:12,blendModes:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},scaleModes:{DEFAULT:0,LINEAR:0,NEAREST:1},PIXI:PIXI||{}};if(!Math.trunc){Math.trunc=function t(e){return e<0?Math.ceil(e):Math.floor(e)}}if(!Function.prototype.bind){Function.prototype.bind=function(){var t=Array.prototype.slice;return function(e){var i=this,s=t.call(arguments,1);if(typeof i!=="function"){throw new TypeError}function r(){var n=s.concat(t.call(arguments));i.apply(this instanceof r?this:e,n)}r.prototype=function t(e){if(e){t.prototype=e}if(!(this instanceof t)){return new t}}(i.prototype);return r}}()}if(!Array.isArray){Array.isArray=function(t){return Object.prototype.toString.call(t)==="[object Array]"}}if(!Array.prototype.forEach){Array.prototype.forEach=function(t){"use strict";if(this===void 0||this===null){throw new TypeError}var e=Object(this);var i=e.length>>>0;if(typeof t!=="function"){throw new TypeError}var s=arguments.length>=2?arguments[1]:void 0;for(var r=0;r<i;r++){if(r in e){t.call(s,e[r],r,e)}}}}if(typeof window.Uint32Array!=="function"&&typeof window.Uint32Array!=="object"){var n=function(t){var e=new Array;window[t]=function(t){if(typeof t==="number"){Array.call(this,t);this.length=t;for(var e=0;e<this.length;e++){this[e]=0}}else{Array.call(this,t.length);this.length=t.length;for(var e=0;e<this.length;e++){this[e]=t[e]}}};window[t].prototype=e;window[t].constructor=window[t]};n("Uint32Array");n("Int16Array")}if(!window.console){window.console={};window.console.log=window.console.assert=function(){};window.console.warn=window.console.assert=function(){}}r.Utils={reverseString:function(t){return t.split("").reverse().join("")},getProperty:function(t,e){var i=e.split("."),s=i.pop(),r=i.length,n=1,a=i[0];while(n<r&&(t=t[a])){a=i[n];n++}if(t){return t[s]}else{return null}},setProperty:function(t,e,i){var s=e.split("."),r=s.pop(),n=s.length,a=1,o=s[0];while(a<n&&(t=t[o])){o=s[a];a++}if(t){t[r]=i}return t},chanceRoll:function(t){if(t===undefined){t=50}return t>0&&Math.random()*100<=t},randomChoice:function(t,e){return Math.random()<.5?t:e},parseDimension:function(t,e){var i=0;var s=0;if(typeof t==="string"){if(t.substr(-1)==="%"){i=parseInt(t,10)/100;if(e===0){s=window.innerWidth*i}else{s=window.innerHeight*i}}else{s=parseInt(t,10)}}else{s=t}return s},pad:function(t,e,i,s){if(e===undefined){var e=0}if(i===undefined){var i=" "}if(s===undefined){var s=3}t=t.toString();var r=0;if(e+1>=t.length){switch(s){case 1:t=new Array(e+1-t.length).join(i)+t;break;case 3:var n=Math.ceil((r=e-t.length)/2);var a=r-n;t=new Array(a+1).join(i)+t+new Array(n+1).join(i);break;default:t=t+new Array(e+1-t.length).join(i);break}}return t},isPlainObject:function(t){if(typeof t!=="object"||t.nodeType||t===t.window){return false}try{if(t.constructor&&!{}.hasOwnProperty.call(t.constructor.prototype,"isPrototypeOf")){return false}}catch(t){return false}return true},extend:function(){var t,e,i,s,n,a,o=arguments[0]||{},h=1,l=arguments.length,u=false;if(typeof o==="boolean"){u=o;o=arguments[1]||{};h=2}if(l===h){o=this;--h}for(;h<l;h++){if((t=arguments[h])!=null){for(e in t){i=o[e];s=t[e];if(o===s){continue}if(u&&s&&(r.Utils.isPlainObject(s)||(n=Array.isArray(s)))){if(n){n=false;a=i&&Array.isArray(i)?i:[]}else{a=i&&r.Utils.isPlainObject(i)?i:{}}o[e]=r.Utils.extend(u,a,s)}else if(s!==undefined){o[e]=s}}}}return o},mixinPrototype:function(t,e,i){if(i===undefined){i=false}var s=Object.keys(e);for(var r=0;r<s.length;r++){var n=s[r];var a=e[n];if(!i&&n in t){continue}else{if(a&&(typeof a.get==="function"||typeof a.set==="function")){if(typeof a.clone==="function"){t[n]=a.clone()}else{Object.defineProperty(t,n,a)}}else{t[n]=a}}}},mixin:function(t,e){if(!t||typeof t!=="object"){return e}for(var i in t){var s=t[i];if(s.childNodes||s.cloneNode){continue}var n=typeof t[i];if(!t[i]||n!=="object"){e[i]=t[i]}else{if(typeof e[i]===n){e[i]=r.Utils.mixin(t[i],e[i])}else{e[i]=r.Utils.mixin(t[i],new s.constructor)}}}return e}};r.Circle=function(t,e,i){t=t||0;e=e||0;i=i||0;this.x=t;this.y=e;this._diameter=i;this._radius=0;if(i>0){this._radius=i*.5}this.type=r.CIRCLE};r.Circle.prototype={circumference:function(){return 2*(Math.PI*this._radius)},random:function(t){if(t===undefined){t=new r.Point}var e=2*Math.PI*Math.random();var i=Math.random()+Math.random();var s=i>1?2-i:i;var n=s*Math.cos(e);var a=s*Math.sin(e);t.x=this.x+n*this.radius;t.y=this.y+a*this.radius;return t},getBounds:function(){return new r.Rectangle(this.x-this.radius,this.y-this.radius,this.diameter,this.diameter)},setTo:function(t,e,i){this.x=t;this.y=e;this._diameter=i;this._radius=i*.5;return this},copyFrom:function(t){return this.setTo(t.x,t.y,t.diameter)},copyTo:function(t){t.x=this.x;t.y=this.y;t.diameter=this._diameter;return t},distance:function(t,e){var i=r.Math.distance(this.x,this.y,t.x,t.y);return e?Math.round(i):i},clone:function(t){if(t===undefined||t===null){t=new r.Circle(this.x,this.y,this.diameter)}else{t.setTo(this.x,this.y,this.diameter)}return t},contains:function(t,e){return r.Circle.contains(this,t,e)},circumferencePoint:function(t,e,i){return r.Circle.circumferencePoint(this,t,e,i)},offset:function(t,e){this.x+=t;this.y+=e;return this},offsetPoint:function(t){return this.offset(t.x,t.y)},toString:function(){return"[{Phaser.Circle (x="+this.x+" y="+this.y+" diameter="+this.diameter+" radius="+this.radius+")}]"}};r.Circle.prototype.constructor=r.Circle;Object.defineProperty(r.Circle.prototype,"diameter",{get:function(){return this._diameter},set:function(t){if(t>0){this._diameter=t;this._radius=t*.5}}});Object.defineProperty(r.Circle.prototype,"radius",{get:function(){return this._radius},set:function(t){if(t>0){this._radius=t;this._diameter=t*2}}});Object.defineProperty(r.Circle.prototype,"left",{get:function(){return this.x-this._radius},set:function(t){if(t>this.x){this._radius=0;this._diameter=0}else{this.radius=this.x-t}}});Object.defineProperty(r.Circle.prototype,"right",{get:function(){return this.x+this._radius},set:function(t){if(t<this.x){this._radius=0;this._diameter=0}else{this.radius=t-this.x}}});Object.defineProperty(r.Circle.prototype,"top",{get:function(){return this.y-this._radius},set:function(t){if(t>this.y){this._radius=0;this._diameter=0}else{this.radius=this.y-t}}});Object.defineProperty(r.Circle.prototype,"bottom",{get:function(){return this.y+this._radius},set:function(t){if(t<this.y){this._radius=0;this._diameter=0}else{this.radius=t-this.y}}});Object.defineProperty(r.Circle.prototype,"area",{get:function(){if(this._radius>0){return Math.PI*this._radius*this._radius}else{return 0}}});Object.defineProperty(r.Circle.prototype,"empty",{get:function(){return this._diameter===0},set:function(t){if(t===true){this.setTo(0,0,0)}}});r.Circle.contains=function(t,e,i){if(t.radius>0&&e>=t.left&&e<=t.right&&i>=t.top&&i<=t.bottom){var s=(t.x-e)*(t.x-e);var r=(t.y-i)*(t.y-i);return s+r<=t.radius*t.radius}else{return false}};r.Circle.equals=function(t,e){return t.x===e.x&&t.y===e.y&&t.diameter===e.diameter};r.Circle.intersects=function(t,e){return r.Math.distance(t.x,t.y,e.x,e.y)<=t.radius+e.radius};r.Circle.circumferencePoint=function(t,e,i,s){if(i===undefined){i=false}if(s===undefined){s=new r.Point}if(i===true){e=r.Math.degToRad(e)}s.x=t.x+t.radius*Math.cos(e);s.y=t.y+t.radius*Math.sin(e);return s};r.Circle.intersectsRectangle=function(t,e){var i=Math.abs(t.x-e.x-e.halfWidth);var s=e.halfWidth+t.radius;if(i>s){return false}var r=Math.abs(t.y-e.y-e.halfHeight);var n=e.halfHeight+t.radius;if(r>n){return false}if(i<=e.halfWidth||r<=e.halfHeight){return true}var a=i-e.halfWidth;var o=r-e.halfHeight;var h=a*a;var l=o*o;var u=t.radius*t.radius;return h+l<=u};PIXI.Circle=r.Circle;r.Ellipse=function(t,e,i,s){t=t||0;e=e||0;i=i||0;s=s||0;this.x=t;this.y=e;this.width=i;this.height=s;this.type=r.ELLIPSE};r.Ellipse.prototype={setTo:function(t,e,i,s){this.x=t;this.y=e;this.width=i;this.height=s;return this},getBounds:function(){return new r.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},copyFrom:function(t){return this.setTo(t.x,t.y,t.width,t.height)},copyTo:function(t){t.x=this.x;t.y=this.y;t.width=this.width;t.height=this.height;return t},clone:function(t){if(t===undefined||t===null){t=new r.Ellipse(this.x,this.y,this.width,this.height)}else{t.setTo(this.x,this.y,this.width,this.height)}return t},contains:function(t,e){return r.Ellipse.contains(this,t,e)},random:function(t){if(t===undefined){t=new r.Point}var e=Math.random()*Math.PI*2;var i=Math.random();t.x=Math.sqrt(i)*Math.cos(e);t.y=Math.sqrt(i)*Math.sin(e);t.x=this.x+t.x*this.width/2;t.y=this.y+t.y*this.height/2;return t},toString:function(){return"[{Phaser.Ellipse (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")}]"}};r.Ellipse.prototype.constructor=r.Ellipse;Object.defineProperty(r.Ellipse.prototype,"left",{get:function(){return this.x},set:function(t){this.x=t}});Object.defineProperty(r.Ellipse.prototype,"right",{get:function(){return this.x+this.width},set:function(t){if(t<this.x){this.width=0}else{this.width=t-this.x}}});Object.defineProperty(r.Ellipse.prototype,"top",{get:function(){return this.y},set:function(t){this.y=t}});Object.defineProperty(r.Ellipse.prototype,"bottom",{get:function(){return this.y+this.height},set:function(t){if(t<this.y){this.height=0}else{this.height=t-this.y}}});Object.defineProperty(r.Ellipse.prototype,"empty",{get:function(){return this.width===0||this.height===0},set:function(t){if(t===true){this.setTo(0,0,0,0)}}});r.Ellipse.contains=function(t,e,i){if(t.width<=0||t.height<=0){return false}var s=(e-t.x)/t.width-.5;var r=(i-t.y)/t.height-.5;s*=s;r*=r;return s+r<.25};PIXI.Ellipse=r.Ellipse;r.Line=function(t,e,i,s){t=t||0;e=e||0;i=i||0;s=s||0;this.start=new r.Point(t,e);this.end=new r.Point(i,s);this.type=r.LINE};r.Line.prototype={setTo:function(t,e,i,s){this.start.setTo(t,e);this.end.setTo(i,s);return this},fromSprite:function(t,e,i){if(i===undefined){i=false}if(i){return this.setTo(t.center.x,t.center.y,e.center.x,e.center.y)}return this.setTo(t.x,t.y,e.x,e.y)},fromAngle:function(t,e,i,s){this.start.setTo(t,e);this.end.setTo(t+Math.cos(i)*s,e+Math.sin(i)*s);return this},rotate:function(t,e){var i=(this.start.x+this.end.x)/2;var s=(this.start.y+this.end.y)/2;this.start.rotate(i,s,t,e);this.end.rotate(i,s,t,e);return this},rotateAround:function(t,e,i,s){this.start.rotate(t,e,i,s);this.end.rotate(t,e,i,s);return this},intersects:function(t,e,i){return r.Line.intersectsPoints(this.start,this.end,t.start,t.end,e,i)},reflect:function(t){return r.Line.reflect(this,t)},midPoint:function(t){if(t===undefined){t=new r.Point}t.x=(this.start.x+this.end.x)/2;t.y=(this.start.y+this.end.y)/2;return t},centerOn:function(t,e){var i=(this.start.x+this.end.x)/2;var s=(this.start.y+this.end.y)/2;var r=t-i;var n=e-s;this.start.add(r,n);this.end.add(r,n)},pointOnLine:function(t,e){return(t-this.start.x)*(this.end.y-this.start.y)===(this.end.x-this.start.x)*(e-this.start.y)},pointOnSegment:function(t,e){var i=Math.min(this.start.x,this.end.x);var s=Math.max(this.start.x,this.end.x);var r=Math.min(this.start.y,this.end.y);var n=Math.max(this.start.y,this.end.y);return this.pointOnLine(t,e)&&(t>=i&&t<=s)&&(e>=r&&e<=n)},random:function(t){if(t===undefined){t=new r.Point}var e=Math.random();t.x=this.start.x+e*(this.end.x-this.start.x);t.y=this.start.y+e*(this.end.y-this.start.y);return t},coordinatesOnLine:function(t,e){if(t===undefined){t=1}if(e===undefined){e=[]}var i=Math.round(this.start.x);var s=Math.round(this.start.y);var r=Math.round(this.end.x);var n=Math.round(this.end.y);var a=Math.abs(r-i);var o=Math.abs(n-s);var h=i<r?1:-1;var l=s<n?1:-1;var u=a-o;e.push([i,s]);var c=1;while(!(i===r&&s===n)){var d=u<<1;if(d>-o){u-=o;i+=h}if(d<a){u+=a;s+=l}if(c%t===0){e.push([i,s])}c++}return e},clone:function(t){if(t===undefined||t===null){t=new r.Line(this.start.x,this.start.y,this.end.x,this.end.y)}else{t.setTo(this.start.x,this.start.y,this.end.x,this.end.y)}return t}};Object.defineProperty(r.Line.prototype,"length",{get:function(){return Math.sqrt((this.end.x-this.start.x)*(this.end.x-this.start.x)+(this.end.y-this.start.y)*(this.end.y-this.start.y))}});Object.defineProperty(r.Line.prototype,"angle",{get:function(){return Math.atan2(this.end.y-this.start.y,this.end.x-this.start.x)}});Object.defineProperty(r.Line.prototype,"slope",{get:function(){return(this.end.y-this.start.y)/(this.end.x-this.start.x)}});Object.defineProperty(r.Line.prototype,"perpSlope",{get:function(){return-((this.end.x-this.start.x)/(this.end.y-this.start.y))}});Object.defineProperty(r.Line.prototype,"x",{get:function(){return Math.min(this.start.x,this.end.x)}});Object.defineProperty(r.Line.prototype,"y",{get:function(){return Math.min(this.start.y,this.end.y)}});Object.defineProperty(r.Line.prototype,"left",{get:function(){return Math.min(this.start.x,this.end.x)}});Object.defineProperty(r.Line.prototype,"right",{get:function(){return Math.max(this.start.x,this.end.x)}});Object.defineProperty(r.Line.prototype,"top",{get:function(){return Math.min(this.start.y,this.end.y)}});Object.defineProperty(r.Line.prototype,"bottom",{get:function(){return Math.max(this.start.y,this.end.y)}});Object.defineProperty(r.Line.prototype,"width",{get:function(){return Math.abs(this.start.x-this.end.x)}});Object.defineProperty(r.Line.prototype,"height",{get:function(){return Math.abs(this.start.y-this.end.y)}});Object.defineProperty(r.Line.prototype,"normalX",{get:function(){return Math.cos(this.angle-1.5707963267948966)}});Object.defineProperty(r.Line.prototype,"normalY",{get:function(){return Math.sin(this.angle-1.5707963267948966)}});Object.defineProperty(r.Line.prototype,"normalAngle",{get:function(){return r.Math.wrap(this.angle-1.5707963267948966,-Math.PI,Math.PI)}});r.Line.intersectsPoints=function(t,e,i,s,n,a){if(n===undefined){n=true}if(a===undefined){a=new r.Point}var o=e.y-t.y;var h=s.y-i.y;var l=t.x-e.x;var u=i.x-s.x;var c=e.x*t.y-t.x*e.y;var d=s.x*i.y-i.x*s.y;var f=o*u-h*l;if(f===0){return null}a.x=(l*d-u*c)/f;a.y=(h*c-o*d)/f;if(n){var p=(s.y-i.y)*(e.x-t.x)-(s.x-i.x)*(e.y-t.y);var g=((s.x-i.x)*(t.y-i.y)-(s.y-i.y)*(t.x-i.x))/p;var m=((e.x-t.x)*(t.y-i.y)-(e.y-t.y)*(t.x-i.x))/p;if(g>=0&&g<=1&&m>=0&&m<=1){return a}else{return null}}return a};r.Line.intersects=function(t,e,i,s){return r.Line.intersectsPoints(t.start,t.end,e.start,e.end,i,s)};r.Line.intersectsRectangle=function(t,e){if(!r.Rectangle.intersects(t,e)){return false}var i=t.start.x;var s=t.start.y;var n=t.end.x;var a=t.end.y;var o=e.x;var h=e.y;var l=e.right;var u=e.bottom;var c=0;if(i>=o&&i<=l&&s>=h&&s<=u||n>=o&&n<=l&&a>=h&&a<=u){return true}if(i<o&&n>=o){c=s+(a-s)*(o-i)/(n-i);if(c>h&&c<=u){return true}}else if(i>l&&n<=l){c=s+(a-s)*(l-i)/(n-i);if(c>=h&&c<=u){return true}}if(s<h&&a>=h){c=i+(n-i)*(h-s)/(a-s);if(c>=o&&c<=l){return true}}else if(s>u&&a<=u){c=i+(n-i)*(u-s)/(a-s);if(c>=o&&c<=l){return true}}return false};r.Line.reflect=function(t,e){return 2*e.normalAngle-3.141592653589793-t.angle};r.Matrix=function(t,e,i,s,n,a){if(t===undefined||t===null){t=1}if(e===undefined||e===null){e=0}if(i===undefined||i===null){i=0}if(s===undefined||s===null){s=1}if(n===undefined||n===null){n=0}if(a===undefined||a===null){a=0}this.a=t;this.b=e;this.c=i;this.d=s;this.tx=n;this.ty=a;this.type=r.MATRIX};r.Matrix.prototype={fromArray:function(t){return this.setTo(t[0],t[1],t[3],t[4],t[2],t[5])},setTo:function(t,e,i,s,r,n){this.a=t;this.b=e;this.c=i;this.d=s;this.tx=r;this.ty=n;return this},clone:function(t){if(t===undefined||t===null){t=new r.Matrix(this.a,this.b,this.c,this.d,this.tx,this.ty)}else{t.a=this.a;t.b=this.b;t.c=this.c;t.d=this.d;t.tx=this.tx;t.ty=this.ty}return t},copyTo:function(t){t.copyFrom(this);return t},copyFrom:function(t){this.a=t.a;this.b=t.b;this.c=t.c;this.d=t.d;this.tx=t.tx;this.ty=t.ty;return this},toArray:function(t,e){if(e===undefined){e=new PIXI.Float32Array(9)}if(t){e[0]=this.a;e[1]=this.b;e[2]=0;e[3]=this.c;e[4]=this.d;e[5]=0;e[6]=this.tx;e[7]=this.ty;e[8]=1}else{e[0]=this.a;e[1]=this.c;e[2]=this.tx;e[3]=this.b;e[4]=this.d;e[5]=this.ty;e[6]=0;e[7]=0;e[8]=1}return e},apply:function(t,e){if(e===undefined){e=new r.Point}e.x=this.a*t.x+this.c*t.y+this.tx;e.y=this.b*t.x+this.d*t.y+this.ty;return e},applyInverse:function(t,e){if(e===undefined){e=new r.Point}var i=1/(this.a*this.d+this.c*-this.b);var s=t.x;var n=t.y;e.x=this.d*i*s+-this.c*i*n+(this.ty*this.c-this.tx*this.d)*i;e.y=this.a*i*n+-this.b*i*s+(-this.ty*this.a+this.tx*this.b)*i;return e},translate:function(t,e){this.tx+=t;this.ty+=e;return this},scale:function(t,e){this.a*=t;this.d*=e;this.c*=t;this.b*=e;this.tx*=t;this.ty*=e;return this},rotate:function(t){var e=Math.cos(t);var i=Math.sin(t);var s=this.a;var r=this.c;var n=this.tx;this.a=s*e-this.b*i;this.b=s*i+this.b*e;this.c=r*e-this.d*i;this.d=r*i+this.d*e;this.tx=n*e-this.ty*i;this.ty=n*i+this.ty*e;return this},append:function(t){var e=this.a;var i=this.b;var s=this.c;var r=this.d;this.a=t.a*e+t.b*s;this.b=t.a*i+t.b*r;this.c=t.c*e+t.d*s;this.d=t.c*i+t.d*r;this.tx=t.tx*e+t.ty*s+this.tx;this.ty=t.tx*i+t.ty*r+this.ty;return this},identity:function(){return this.setTo(1,0,0,1,0,0)}};r.identityMatrix=new r.Matrix;PIXI.Matrix=r.Matrix;PIXI.identityMatrix=r.identityMatrix;r.Point=function(t,e){t=t||0;e=e||0;this.x=t;this.y=e;this.type=r.POINT};r.Point.prototype={copyFrom:function(t){return this.setTo(t.x,t.y)},invert:function(){return this.setTo(this.y,this.x)},setTo:function(t,e){this.x=t||0;this.y=e||(e!==0?this.x:0);return this},set:function(t,e){this.x=t||0;this.y=e||(e!==0?this.x:0);return this},add:function(t,e){this.x+=t;this.y+=e;return this},subtract:function(t,e){this.x-=t;this.y-=e;return this},multiply:function(t,e){this.x*=t;this.y*=e;return this},divide:function(t,e){this.x/=t;this.y/=e;return this},clampX:function(t,e){this.x=r.Math.clamp(this.x,t,e);return this},clampY:function(t,e){this.y=r.Math.clamp(this.y,t,e);return this},clamp:function(t,e){this.x=r.Math.clamp(this.x,t,e);this.y=r.Math.clamp(this.y,t,e);return this},clone:function(t){if(t===undefined||t===null){t=new r.Point(this.x,this.y)}else{t.setTo(this.x,this.y)}return t},copyTo:function(t){t.x=this.x;t.y=this.y;return t},distance:function(t,e){return r.Point.distance(this,t,e)},equals:function(t){return t.x===this.x&&t.y===this.y},angle:function(t,e){if(e===undefined){e=false}if(e){return r.Math.radToDeg(Math.atan2(t.y-this.y,t.x-this.x))}else{return Math.atan2(t.y-this.y,t.x-this.x)}},rotate:function(t,e,i,s,n){return r.Point.rotate(this,t,e,i,s,n)},getMagnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},getMagnitudeSq:function(){return this.x*this.x+this.y*this.y},setMagnitude:function(t){return this.normalize().multiply(t,t)},normalize:function(){if(!this.isZero()){var t=this.getMagnitude();this.x/=t;this.y/=t}return this},isZero:function(){return this.x===0&&this.y===0},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},perp:function(){return this.setTo(-this.y,this.x)},rperp:function(){return this.setTo(this.y,-this.x)},normalRightHand:function(){return this.setTo(this.y*-1,this.x)},floor:function(){return this.setTo(Math.floor(this.x),Math.floor(this.y))},ceil:function(){return this.setTo(Math.ceil(this.x),Math.ceil(this.y))},toString:function(){return"[{Point (x="+this.x+" y="+this.y+")}]"}};r.Point.prototype.constructor=r.Point;r.Point.add=function(t,e,i){if(i===undefined){i=new r.Point}i.x=t.x+e.x;i.y=t.y+e.y;return i};r.Point.subtract=function(t,e,i){if(i===undefined){i=new r.Point}i.x=t.x-e.x;i.y=t.y-e.y;return i};r.Point.multiply=function(t,e,i){if(i===undefined){i=new r.Point}i.x=t.x*e.x;i.y=t.y*e.y;return i};r.Point.divide=function(t,e,i){if(i===undefined){i=new r.Point}i.x=t.x/e.x;i.y=t.y/e.y;return i};r.Point.equals=function(t,e){return t.x===e.x&&t.y===e.y};r.Point.angle=function(t,e){return Math.atan2(t.y-e.y,t.x-e.x)};r.Point.negative=function(t,e){if(e===undefined){e=new r.Point}return e.setTo(-t.x,-t.y)};r.Point.multiplyAdd=function(t,e,i,s){if(s===undefined){s=new r.Point}return s.setTo(t.x+e.x*i,t.y+e.y*i)};r.Point.interpolate=function(t,e,i,s){if(s===undefined){s=new r.Point}return s.setTo(t.x+(e.x-t.x)*i,t.y+(e.y-t.y)*i)};r.Point.perp=function(t,e){if(e===undefined){e=new r.Point}return e.setTo(-t.y,t.x)};r.Point.rperp=function(t,e){if(e===undefined){e=new r.Point}return e.setTo(t.y,-t.x)};r.Point.distance=function(t,e,i){var s=r.Math.distance(t.x,t.y,e.x,e.y);return i?Math.round(s):s};r.Point.project=function(t,e,i){if(i===undefined){i=new r.Point}var s=t.dot(e)/e.getMagnitudeSq();if(s!==0){i.setTo(s*e.x,s*e.y)}return i};r.Point.projectUnit=function(t,e,i){if(i===undefined){i=new r.Point}var s=t.dot(e);if(s!==0){i.setTo(s*e.x,s*e.y)}return i};r.Point.normalRightHand=function(t,e){if(e===undefined){e=new r.Point}return e.setTo(t.y*-1,t.x)};r.Point.normalize=function(t,e){if(e===undefined){e=new r.Point}var i=t.getMagnitude();if(i!==0){e.setTo(t.x/i,t.y/i)}return e};r.Point.rotate=function(t,e,i,s,n,a){if(n){s=r.Math.degToRad(s)}if(a===undefined){t.subtract(e,i);var o=Math.sin(s);var h=Math.cos(s);var l=h*t.x-o*t.y;var u=o*t.x+h*t.y;t.x=l+e;t.y=u+i}else{var c=s+Math.atan2(t.y-i,t.x-e);t.x=e+a*Math.cos(c);t.y=i+a*Math.sin(c)}return t};r.Point.centroid=function(t,e){if(e===undefined){e=new r.Point}if(Object.prototype.toString.call(t)!=="[object Array]"){throw new Error("Phaser.Point. Parameter 'points' must be an array")}var i=t.length;if(i<1){throw new Error("Phaser.Point. Parameter 'points' array must not be empty")}if(i===1){e.copyFrom(t[0]);return e}for(var s=0;s<i;s++){r.Point.add(e,t[s],e)}e.divide(i,i);return e};r.Point.parse=function(t,e,i){e=e||"x";i=i||"y";var s=new r.Point;if(t[e]){s.x=parseInt(t[e],10)}if(t[i]){s.y=parseInt(t[i],10)}return s};PIXI.Point=r.Point;r.Polygon=function(){this.area=0;this._points=[];if(arguments.length>0){this.setTo.apply(this,arguments)}this.closed=true;this.flattened=false;this.type=r.POLYGON};r.Polygon.prototype={toNumberArray:function(t){if(t===undefined){t=[]}for(var e=0;e<this._points.length;e++){if(typeof this._points[e]==="number"){t.push(this._points[e]);t.push(this._points[e+1]);e++}else{t.push(this._points[e].x);t.push(this._points[e].y)}}return t},flatten:function(){this._points=this.toNumberArray();this.flattened=true;return this},clone:function(t){var e=this._points.slice();if(t===undefined||t===null){t=new r.Polygon(e)}else{t.setTo(e)}return t},contains:function(t,e){var i=false;if(this.flattened){for(var s=-2,r=this._points.length-2;(s+=2)<this._points.length;r=s){var n=this._points[s];var a=this._points[s+1];var o=this._points[r];var h=this._points[r+1];if((a<=e&&e<h||h<=e&&e<a)&&t<(o-n)*(e-a)/(h-a)+n){i=!i}}}else{for(var s=-1,r=this._points.length-1;++s<this._points.length;r=s){var n=this._points[s].x;var a=this._points[s].y;var o=this._points[r].x;var h=this._points[r].y;if((a<=e&&e<h||h<=e&&e<a)&&t<(o-n)*(e-a)/(h-a)+n){i=!i}}}return i},setTo:function(t){this.area=0;this._points=[];if(arguments.length>0){if(!Array.isArray(t)){t=Array.prototype.slice.call(arguments)}var e=Number.MAX_VALUE;for(var i=0,s=t.length;i<s;i++){if(typeof t[i]==="number"){var r=new PIXI.Point(t[i],t[i+1]);i++}else if(Array.isArray(t[i])){var r=new PIXI.Point(t[i][0],t[i][1])}else{var r=new PIXI.Point(t[i].x,t[i].y)}this._points.push(r);if(r.y<e){e=r.y}}this.calculateArea(e)}return this},calculateArea:function(t){var e;var i;var s;var r;for(var n=0,a=this._points.length;n<a;n++){e=this._points[n];if(n===a-1){i=this._points[0]}else{i=this._points[n+1]}s=(e.y-t+(i.y-t))/2;r=e.x-i.x;this.area+=s*r}return this.area}};r.Polygon.prototype.constructor=r.Polygon;Object.defineProperty(r.Polygon.prototype,"points",{get:function(){return this._points},set:function(t){if(t!=null){this.setTo(t)}else{this.setTo()}}});PIXI.Polygon=r.Polygon;r.Rectangle=function(t,e,i,s){t=t||0;e=e||0;i=i||0;s=s||0;this.x=t;this.y=e;this.width=i;this.height=s;this.type=r.RECTANGLE};r.Rectangle.prototype={offset:function(t,e){this.x+=t;this.y+=e;return this},offsetPoint:function(t){return this.offset(t.x,t.y)},setTo:function(t,e,i,s){this.x=t;this.y=e;this.width=i;this.height=s;return this},scale:function(t,e){if(e===undefined){e=t}this.width*=t;this.height*=e;return this},centerOn:function(t,e){this.centerX=t;this.centerY=e;return this},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y)},floorAll:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.width=Math.floor(this.width);this.height=Math.floor(this.height)},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y)},ceilAll:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.width=Math.ceil(this.width);this.height=Math.ceil(this.height)},copyFrom:function(t){return this.setTo(t.x,t.y,t.width,t.height)},copyTo:function(t){t.x=this.x;t.y=this.y;t.width=this.width;t.height=this.height;return t},inflate:function(t,e){return r.Rectangle.inflate(this,t,e)},size:function(t){return r.Rectangle.size(this,t)},resize:function(t,e){this.width=t;this.height=e;return this},clone:function(t){return r.Rectangle.clone(this,t)},contains:function(t,e){return r.Rectangle.contains(this,t,e)},containsRect:function(t){return r.Rectangle.containsRect(t,this)},equals:function(t){return r.Rectangle.equals(this,t)},intersection:function(t,e){return r.Rectangle.intersection(this,t,e)},intersects:function(t){return r.Rectangle.intersects(this,t)},intersectsRaw:function(t,e,i,s,n){return r.Rectangle.intersectsRaw(this,t,e,i,s,n)},union:function(t,e){return r.Rectangle.union(this,t,e)},random:function(t){if(t===undefined){t=new r.Point}t.x=this.randomX;t.y=this.randomY;return t},getPoint:function(t,e){if(e===undefined){e=new r.Point}switch(t){default:case r.TOP_LEFT:return e.set(this.x,this.y);case r.TOP_CENTER:return e.set(this.centerX,this.y);case r.TOP_RIGHT:return e.set(this.right,this.y);case r.LEFT_CENTER:return e.set(this.x,this.centerY);case r.CENTER:return e.set(this.centerX,this.centerY);case r.RIGHT_CENTER:return e.set(this.right,this.centerY);case r.BOTTOM_LEFT:return e.set(this.x,this.bottom);case r.BOTTOM_CENTER:return e.set(this.centerX,this.bottom);case r.BOTTOM_RIGHT:return e.set(this.right,this.bottom)}},toString:function(){return"[{Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+" empty="+this.empty+")}]"}};Object.defineProperty(r.Rectangle.prototype,"halfWidth",{get:function(){return Math.round(this.width/2)}});Object.defineProperty(r.Rectangle.prototype,"halfHeight",{get:function(){return Math.round(this.height/2)}});Object.defineProperty(r.Rectangle.prototype,"bottom",{get:function(){return this.y+this.height},set:function(t){if(t<=this.y){this.height=0}else{this.height=t-this.y}}});Object.defineProperty(r.Rectangle.prototype,"bottomLeft",{get:function(){return new r.Point(this.x,this.bottom)},set:function(t){this.x=t.x;this.bottom=t.y}});Object.defineProperty(r.Rectangle.prototype,"bottomRight",{get:function(){return new r.Point(this.right,this.bottom)},set:function(t){this.right=t.x;this.bottom=t.y}});Object.defineProperty(r.Rectangle.prototype,"left",{get:function(){return this.x},set:function(t){if(t>=this.right){this.width=0}else{this.width=this.right-t}this.x=t}});Object.defineProperty(r.Rectangle.prototype,"right",{get:function(){return this.x+this.width},set:function(t){if(t<=this.x){this.width=0}else{this.width=t-this.x}}});Object.defineProperty(r.Rectangle.prototype,"volume",{get:function(){return this.width*this.height}});Object.defineProperty(r.Rectangle.prototype,"perimeter",{get:function(){return this.width*2+this.height*2}});Object.defineProperty(r.Rectangle.prototype,"centerX",{get:function(){return this.x+this.halfWidth},set:function(t){this.x=t-this.halfWidth}});Object.defineProperty(r.Rectangle.prototype,"centerY",{get:function(){return this.y+this.halfHeight},set:function(t){this.y=t-this.halfHeight}});Object.defineProperty(r.Rectangle.prototype,"randomX",{get:function(){return this.x+Math.random()*this.width}});Object.defineProperty(r.Rectangle.prototype,"randomY",{get:function(){return this.y+Math.random()*this.height}});Object.defineProperty(r.Rectangle.prototype,"top",{get:function(){return this.y},set:function(t){if(t>=this.bottom){this.height=0;this.y=t}else{this.height=this.bottom-t}}});Object.defineProperty(r.Rectangle.prototype,"topLeft",{get:function(){return new r.Point(this.x,this.y)},set:function(t){this.x=t.x;this.y=t.y}});Object.defineProperty(r.Rectangle.prototype,"topRight",{get:function(){return new r.Point(this.x+this.width,this.y)},set:function(t){this.right=t.x;this.y=t.y}});Object.defineProperty(r.Rectangle.prototype,"empty",{get:function(){return!this.width||!this.height},set:function(t){if(t===true){this.setTo(0,0,0,0)}}});r.Rectangle.prototype.constructor=r.Rectangle;r.Rectangle.inflate=function(t,e,i){t.x-=e;t.width+=2*e;t.y-=i;t.height+=2*i;return t};r.Rectangle.inflatePoint=function(t,e){return r.Rectangle.inflate(t,e.x,e.y)};r.Rectangle.size=function(t,e){if(e===undefined||e===null){e=new r.Point(t.width,t.height)}else{e.setTo(t.width,t.height)}return e};r.Rectangle.clone=function(t,e){if(e===undefined||e===null){e=new r.Rectangle(t.x,t.y,t.width,t.height)}else{e.setTo(t.x,t.y,t.width,t.height)}return e};r.Rectangle.contains=function(t,e,i){if(t.width<=0||t.height<=0){return false}return e>=t.x&&e<t.right&&i>=t.y&&i<t.bottom};r.Rectangle.containsRaw=function(t,e,i,s,r,n){return r>=t&&r<t+i&&n>=e&&n<e+s};r.Rectangle.containsPoint=function(t,e){return r.Rectangle.contains(t,e.x,e.y)};r.Rectangle.containsRect=function(t,e){if(t.volume>e.volume){return false}return t.x>=e.x&&t.y>=e.y&&t.right<e.right&&t.bottom<e.bottom};r.Rectangle.equals=function(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height};r.Rectangle.sameDimensions=function(t,e){return t.width===e.width&&t.height===e.height};r.Rectangle.intersection=function(t,e,i){if(i===undefined){i=new r.Rectangle}if(r.Rectangle.intersects(t,e)){i.x=Math.max(t.x,e.x);i.y=Math.max(t.y,e.y);i.width=Math.min(t.right,e.right)-i.x;i.height=Math.min(t.bottom,e.bottom)-i.y}return i};r.Rectangle.intersects=function(t,e){if(t.width<=0||t.height<=0||e.width<=0||e.height<=0){return false}return!(t.right<e.x||t.bottom<e.y||t.x>e.right||t.y>e.bottom)};r.Rectangle.intersectsRaw=function(t,e,i,s,r,n){if(n===undefined){n=0}return!(e>t.right+n||i<t.left-n||s>t.bottom+n||r<t.top-n)};r.Rectangle.union=function(t,e,i){if(i===undefined){i=new r.Rectangle}return i.setTo(Math.min(t.x,e.x),Math.min(t.y,e.y),Math.max(t.right,e.right)-Math.min(t.left,e.left),Math.max(t.bottom,e.bottom)-Math.min(t.top,e.top))};r.Rectangle.aabb=function(t,e){if(e===undefined){e=new r.Rectangle}var i=Number.NEGATIVE_INFINITY,s=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,a=Number.POSITIVE_INFINITY;t.forEach(function(t){if(t.x>i){i=t.x}if(t.x<s){s=t.x}if(t.y>n){n=t.y}if(t.y<a){a=t.y}});e.setTo(s,a,i-s,n-a);return e};PIXI.Rectangle=r.Rectangle;PIXI.EmptyRectangle=new r.Rectangle(0,0,0,0);r.RoundedRectangle=function(t,e,i,s,n){if(t===undefined){t=0}if(e===undefined){e=0}if(i===undefined){i=0}if(s===undefined){s=0}if(n===undefined){n=20}this.x=t;this.y=e;this.width=i;this.height=s;this.radius=n||20;this.type=r.ROUNDEDRECTANGLE};r.RoundedRectangle.prototype={clone:function(){return new r.RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)},contains:function(t,e){if(this.width<=0||this.height<=0){return false}var i=this.x;if(t>=i&&t<=i+this.width){var s=this.y;if(e>=s&&e<=s+this.height){return true}}return false}};r.RoundedRectangle.prototype.constructor=r.RoundedRectangle;PIXI.RoundedRectangle=r.RoundedRectangle;r.Camera=function(t,e,i,s,n,a){this.game=t;this.world=t.world;this.id=0;this.view=new r.Rectangle(i,s,n,a);this.bounds=new r.Rectangle(i,s,n,a);this.deadzone=null;this.visible=true;this.roundPx=true;this.atLimit={x:false,y:false};this.target=null;this.displayObject=null;this.scale=null;this.totalInView=0;this.lerp=new r.Point(1,1);this.onShakeComplete=new r.Signal;this.onFlashComplete=new r.Signal;this.onFadeComplete=new r.Signal;this.fx=null;this._targetPosition=new r.Point;this._edge=0;this._position=new r.Point;this._shake={intensity:0,duration:0,horizontal:false,vertical:false,shakeBounds:true,x:0,y:0};this._fxDuration=0;this._fxType=0};r.Camera.FOLLOW_LOCKON=0;r.Camera.FOLLOW_PLATFORMER=1;r.Camera.FOLLOW_TOPDOWN=2;r.Camera.FOLLOW_TOPDOWN_TIGHT=3;r.Camera.SHAKE_BOTH=4;r.Camera.SHAKE_HORIZONTAL=5;r.Camera.SHAKE_VERTICAL=6;r.Camera.ENABLE_FX=true;r.Camera.prototype={boot:function(){this.displayObject=this.game.world;this.scale=this.game.world.scale;this.game.camera=this;if(r.Graphics&&r.Camera.ENABLE_FX){this.fx=new r.Graphics(this.game);this.game.stage.addChild(this.fx)}},preUpdate:function(){this.totalInView=0},follow:function(t,e,i,s){if(e===undefined){e=r.Camera.FOLLOW_LOCKON}if(i===undefined){i=1}if(s===undefined){s=1}this.target=t;this.lerp.set(i,s);var n;switch(e){case r.Camera.FOLLOW_PLATFORMER:var a=this.width/8;var o=this.height/3;this.deadzone=new r.Rectangle((this.width-a)/2,(this.height-o)/2-o*.25,a,o);break;case r.Camera.FOLLOW_TOPDOWN:n=Math.max(this.width,this.height)/4;this.deadzone=new r.Rectangle((this.width-n)/2,(this.height-n)/2,n,n);break;case r.Camera.FOLLOW_TOPDOWN_TIGHT:n=Math.max(this.width,this.height)/8;this.deadzone=new r.Rectangle((this.width-n)/2,(this.height-n)/2,n,n);break;case r.Camera.FOLLOW_LOCKON:this.deadzone=null;break;default:this.deadzone=null;break}},unfollow:function(){this.target=null},focusOn:function(t){this.setPosition(Math.round(t.x-this.view.halfWidth),Math.round(t.y-this.view.halfHeight))},focusOnXY:function(t,e){this.setPosition(Math.round(t-this.view.halfWidth),Math.round(e-this.view.halfHeight))},shake:function(t,e,i,s,n){if(t===undefined){t=.05}if(e===undefined){e=500}if(i===undefined){i=true}if(s===undefined){s=r.Camera.SHAKE_BOTH}if(n===undefined){n=true}if(!i&&this._shake.duration>0){return false}this._shake.intensity=t;this._shake.duration=e;this._shake.shakeBounds=n;this._shake.x=0;this._shake.y=0;this._shake.horizontal=s===r.Camera.SHAKE_BOTH||s===r.Camera.SHAKE_HORIZONTAL;this._shake.vertical=s===r.Camera.SHAKE_BOTH||s===r.Camera.SHAKE_VERTICAL;return true},flash:function(t,e,i){if(t===undefined){t=16777215}if(e===undefined){e=500}if(i===undefined){i=false}if(!this.fx||!i&&this._fxDuration>0){return false}this.fx.clear();this.fx.beginFill(t);this.fx.drawRect(0,0,this.width,this.height);this.fx.endFill();this.fx.alpha=1;this._fxDuration=e;this._fxType=0;return true},fade:function(t,e,i){if(t===undefined){t=0}if(e===undefined){e=500}if(i===undefined){i=false}if(!this.fx||!i&&this._fxDuration>0){return false}this.fx.clear();this.fx.beginFill(t);this.fx.drawRect(0,0,this.width,this.height);this.fx.endFill();this.fx.alpha=0;this._fxDuration=e;this._fxType=1;return true},update:function(){if(this._fxDuration>0){this.updateFX()}if(this._shake.duration>0){this.updateShake()}if(this.bounds){this.checkBounds()}if(this.roundPx){this.view.floor();this._shake.x=Math.floor(this._shake.x);this._shake.y=Math.floor(this._shake.y)}this.displayObject.position.x=-this.view.x;this.displayObject.position.y=-this.view.y},updateFX:function(){if(this._fxType===0){this.fx.alpha-=this.game.time.elapsedMS/this._fxDuration;if(this.fx.alpha<=0){this._fxDuration=0;this.fx.alpha=0;this.onFlashComplete.dispatch()}}else{this.fx.alpha+=this.game.time.elapsedMS/this._fxDuration;if(this.fx.alpha>=1){this._fxDuration=0;this.fx.alpha=1;this.onFadeComplete.dispatch()}}},updateShake:function(){this._shake.duration-=this.game.time.elapsedMS;if(this._shake.duration<=0){this.onShakeComplete.dispatch();this._shake.x=0;this._shake.y=0}else{if(this._shake.horizontal){this._shake.x=this.game.rnd.frac()*this._shake.intensity*this.view.width*2-this._shake.intensity*this.view.width}if(this._shake.vertical){this._shake.y=this.game.rnd.frac()*this._shake.intensity*this.view.height*2-this._shake.intensity*this.view.height}}},updateTarget:function(){this._targetPosition.x=this.view.x+this.target.worldPosition.x;this._targetPosition.y=this.view.y+this.target.worldPosition.y;if(this.deadzone){this._edge=this._targetPosition.x-this.view.x;if(this._edge<this.deadzone.left){this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.deadzone.left,this.lerp.x)}else if(this._edge>this.deadzone.right){this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.deadzone.right,this.lerp.x)}this._edge=this._targetPosition.y-this.view.y;if(this._edge<this.deadzone.top){this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.deadzone.top,this.lerp.y)}else if(this._edge>this.deadzone.bottom){this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.deadzone.bottom,this.lerp.y)}}else{this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.view.halfWidth,this.lerp.x);this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.view.halfHeight,this.lerp.y)}if(this.bounds){this.checkBounds()}if(this.roundPx){this.view.floor()}this.displayObject.position.x=-this.view.x;this.displayObject.position.y=-this.view.y},setBoundsToWorld:function(){if(this.bounds){this.bounds.copyFrom(this.game.world.bounds)}},checkBounds:function(){this.atLimit.x=false;this.atLimit.y=false;var t=this.view.x+this._shake.x;var e=this.view.right+this._shake.x;var i=this.view.y+this._shake.y;var s=this.view.bottom+this._shake.y;if(t<=this.bounds.x*this.scale.x){this.atLimit.x=true;this.view.x=this.bounds.x*this.scale.x;if(!this._shake.shakeBounds){this._shake.x=0}}if(e>=this.bounds.right*this.scale.x){this.atLimit.x=true;this.view.x=this.bounds.right*this.scale.x-this.width;if(!this._shake.shakeBounds){this._shake.x=0}}if(i<=this.bounds.top*this.scale.y){this.atLimit.y=true;this.view.y=this.bounds.top*this.scale.y;if(!this._shake.shakeBounds){this._shake.y=0}}if(s>=this.bounds.bottom*this.scale.y){this.atLimit.y=true;this.view.y=this.bounds.bottom*this.scale.y-this.height;if(!this._shake.shakeBounds){this._shake.y=0}}},setPosition:function(t,e){this.view.x=t;this.view.y=e;if(this.bounds){this.checkBounds()}},setSize:function(t,e){this.view.width=t;this.view.height=e},reset:function(){this.target=null;this.view.x=0;this.view.y=0;this._shake.duration=0;this.resetFX()},resetFX:function(){this.fx.clear();this.fx.alpha=0;this._fxDuration=0}};r.Camera.prototype.constructor=r.Camera;Object.defineProperty(r.Camera.prototype,"x",{get:function(){return this.view.x},set:function(t){this.view.x=t;if(this.bounds){this.checkBounds()}}});Object.defineProperty(r.Camera.prototype,"y",{get:function(){return this.view.y},set:function(t){this.view.y=t;if(this.bounds){this.checkBounds()}}});Object.defineProperty(r.Camera.prototype,"position",{get:function(){this._position.set(this.view.x,this.view.y);return this._position},set:function(t){if(typeof t.x!=="undefined"){this.view.x=t.x}if(typeof t.y!=="undefined"){this.view.y=t.y}if(this.bounds){this.checkBounds()}}});Object.defineProperty(r.Camera.prototype,"width",{get:function(){return this.view.width},set:function(t){this.view.width=t}});Object.defineProperty(r.Camera.prototype,"height",{get:function(){return this.view.height},set:function(t){this.view.height=t}});Object.defineProperty(r.Camera.prototype,"shakeIntensity",{get:function(){return this._shake.intensity},set:function(t){this._shake.intensity=t}});r.State=function(){this.game=null;this.key="";this.add=null;this.make=null;this.camera=null;this.cache=null;this.input=null;this.load=null;this.math=null;this.sound=null;this.scale=null;this.stage=null;this.state=null;this.time=null;this.tweens=null;this.world=null;this.particles=null;this.physics=null;this.rnd=null};r.State.prototype={init:function(){},preload:function(){},loadUpdate:function(){},loadRender:function(){},create:function(){},update:function(){},preRender:function(){},render:function(){},resize:function(){},paused:function(){},resumed:function(){},pauseUpdate:function(){},shutdown:function(){}};r.State.prototype.constructor=r.State;r.StateManager=function(t,e){this.game=t;this.states={};this._pendingState=null;if(typeof e!=="undefined"&&e!==null){this._pendingState=e}this._clearWorld=false;this._clearCache=false;this._created=false;this._args=[];this.current="";this.onStateChange=new r.Signal;this.onInitCallback=null;this.onPreloadCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onRenderCallback=null;this.onResizeCallback=null;this.onPreRenderCallback=null;this.onLoadUpdateCallback=null;this.onLoadRenderCallback=null;this.onPausedCallback=null;this.onResumedCallback=null;this.onPauseUpdateCallback=null;this.onShutDownCallback=null};r.StateManager.prototype={boot:function(){this.game.onPause.add(this.pause,this);this.game.onResume.add(this.resume,this);if(this._pendingState!==null&&typeof this._pendingState!=="string"){this.add("default",this._pendingState,true)}},add:function(t,e,i){if(i===undefined){i=false}var s;if(e instanceof r.State){s=e}else if(typeof e==="object"){s=e;s.game=this.game}else if(typeof e==="function"){s=new e(this.game)}this.states[t]=s;if(i){if(this.game.isBooted){this.start(t)}else{this._pendingState=t}}return s},remove:function(t){if(this.current===t){this.callbackContext=null;this.onInitCallback=null;this.onShutDownCallback=null;this.onPreloadCallback=null;this.onLoadRenderCallback=null;this.onLoadUpdateCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onPreRenderCallback=null;this.onRenderCallback=null;this.onResizeCallback=null;this.onPausedCallback=null;this.onResumedCallback=null;this.onPauseUpdateCallback=null}delete this.states[t]},start:function(t,e,i){if(e===undefined){e=true}if(i===undefined){i=false}if(this.checkState(t)){this._pendingState=t;this._clearWorld=e;this._clearCache=i;if(arguments.length>3){this._args=Array.prototype.splice.call(arguments,3)}}},restart:function(t,e){if(t===undefined){t=true}if(e===undefined){e=false}this._pendingState=this.current;this._clearWorld=t;this._clearCache=e;if(arguments.length>2){this._args=Array.prototype.slice.call(arguments,2)}},dummy:function(){},preUpdate:function(){if(this._pendingState&&this.game.isBooted){var t=this.current;this.clearCurrentState();this.setCurrentState(this._pendingState);this.onStateChange.dispatch(this.current,t);if(this.current!==this._pendingState){return}else{this._pendingState=null}if(this.onPreloadCallback){this.game.load.reset(true);this.onPreloadCallback.call(this.callbackContext,this.game);if(this.game.load.totalQueuedFiles()===0&&this.game.load.totalQueuedPacks()===0){this.loadComplete()}else{this.game.load.start()}}else{this.loadComplete()}}},clearCurrentState:function(){if(this.current){if(this.onShutDownCallback){this.onShutDownCallback.call(this.callbackContext,this.game)}this.game.tweens.removeAll();this.game.camera.reset();this.game.input.reset(true);this.game.physics.clear();this.game.time.removeAll();this.game.scale.reset(this._clearWorld);if(this.game.debug){this.game.debug.reset()}if(this._clearWorld){this.game.world.shutdown();if(this._clearCache){this.game.cache.destroy()}}}},checkState:function(t){if(this.states[t]){if(this.states[t]["preload"]||this.states[t]["create"]||this.states[t]["update"]||this.states[t]["render"]){return true}else{console.warn("Invalid Phaser State object given. Must contain at least a one of the required functions: preload, create, update or render");return false}}else{console.warn("Phaser.StateManager - No state found with the key: "+t);return false}},link:function(t){this.states[t].game=this.game;this.states[t].add=this.game.add;this.states[t].make=this.game.make;this.states[t].camera=this.game.camera;this.states[t].cache=this.game.cache;this.states[t].input=this.game.input;this.states[t].load=this.game.load;this.states[t].math=this.game.math;this.states[t].sound=this.game.sound;this.states[t].scale=this.game.scale;this.states[t].state=this;this.states[t].stage=this.game.stage;this.states[t].time=this.game.time;this.states[t].tweens=this.game.tweens;this.states[t].world=this.game.world;this.states[t].particles=this.game.particles;this.states[t].rnd=this.game.rnd;this.states[t].physics=this.game.physics;this.states[t].key=t},unlink:function(t){if(this.states[t]){this.states[t].game=null;this.states[t].add=null;this.states[t].make=null;this.states[t].camera=null;this.states[t].cache=null;this.states[t].input=null;this.states[t].load=null;this.states[t].math=null;this.states[t].sound=null;this.states[t].scale=null;this.states[t].state=null;this.states[t].stage=null;this.states[t].time=null;this.states[t].tweens=null;this.states[t].world=null;this.states[t].particles=null;this.states[t].rnd=null;this.states[t].physics=null}},setCurrentState:function(t){this.callbackContext=this.states[t];this.link(t);this.onInitCallback=this.states[t]["init"]||this.dummy;this.onPreloadCallback=this.states[t]["preload"]||null;this.onLoadRenderCallback=this.states[t]["loadRender"]||null;this.onLoadUpdateCallback=this.states[t]["loadUpdate"]||null;this.onCreateCallback=this.states[t]["create"]||null;this.onUpdateCallback=this.states[t]["update"]||null;this.onPreRenderCallback=this.states[t]["preRender"]||null;this.onRenderCallback=this.states[t]["render"]||null;this.onResizeCallback=this.states[t]["resize"]||null;this.onPausedCallback=this.states[t]["paused"]||null;this.onResumedCallback=this.states[t]["resumed"]||null;this.onPauseUpdateCallback=this.states[t]["pauseUpdate"]||null;this.onShutDownCallback=this.states[t]["shutdown"]||this.dummy;if(this.current!==""){this.game.physics.reset()}this.current=t;this._created=false;this.onInitCallback.apply(this.callbackContext,this._args);if(t===this._pendingState){this._args=[]}this.game._kickstart=true},getCurrentState:function(){return this.states[this.current]},loadComplete:function(){if(this._created===false&&this.onLoadUpdateCallback){this.onLoadUpdateCallback.call(this.callbackContext,this.game)}if(this._created===false&&this.onCreateCallback){this._created=true;this.onCreateCallback.call(this.callbackContext,this.game)}else{this._created=true}},pause:function(){if(this._created&&this.onPausedCallback){this.onPausedCallback.call(this.callbackContext,this.game)}},resume:function(){if(this._created&&this.onResumedCallback){this.onResumedCallback.call(this.callbackContext,this.game)}},update:function(){if(this._created){if(this.onUpdateCallback){this.onUpdateCallback.call(this.callbackContext,this.game)}}else{if(this.onLoadUpdateCallback){this.onLoadUpdateCallback.call(this.callbackContext,this.game)}}},pauseUpdate:function(){if(this._created){if(this.onPauseUpdateCallback){this.onPauseUpdateCallback.call(this.callbackContext,this.game)}}else{if(this.onLoadUpdateCallback){this.onLoadUpdateCallback.call(this.callbackContext,this.game)}}},preRender:function(t){if(this._created&&this.onPreRenderCallback){this.onPreRenderCallback.call(this.callbackContext,this.game,t)}},resize:function(t,e){if(this.onResizeCallback){this.onResizeCallback.call(this.callbackContext,t,e)}},render:function(){if(this._created){if(this.onRenderCallback){if(this.game.renderType===r.CANVAS){this.game.context.save();this.game.context.setTransform(1,0,0,1,0,0);this.onRenderCallback.call(this.callbackContext,this.game);this.game.context.restore()}else{this.onRenderCallback.call(this.callbackContext,this.game)}}}else{if(this.onLoadRenderCallback){this.onLoadRenderCallback.call(this.callbackContext,this.game)}}},destroy:function(){this._clearWorld=true;this._clearCache=true;this.clearCurrentState();this.callbackContext=null;this.onInitCallback=null;this.onShutDownCallback=null;this.onPreloadCallback=null;this.onLoadRenderCallback=null;this.onLoadUpdateCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onRenderCallback=null;this.onPausedCallback=null;this.onResumedCallback=null;this.onPauseUpdateCallback=null;this.game=null;this.states={};this._pendingState=null;this.current=""}};r.StateManager.prototype.constructor=r.StateManager;Object.defineProperty(r.StateManager.prototype,"created",{get:function(){return this._created}});r.Signal=function(){};r.Signal.prototype={_bindings:null,_prevParams:null,memorize:false,_shouldPropagate:true,active:true,_boundDispatch:false,validateListener:function(t,e){if(typeof t!=="function"){throw new Error("Phaser.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",e))}},_registerListener:function(t,e,i,s,n){var a=this._indexOfListener(t,i);var o;if(a!==-1){o=this._bindings[a];if(o.isOnce()!==e){throw new Error("You cannot add"+(e?"":"Once")+"() then add"+(!e?"":"Once")+"() the same listener without removing the relationship first.")}}else{o=new r.SignalBinding(this,t,e,i,s,n);this._addBinding(o)}if(this.memorize&&this._prevParams){o.execute(this._prevParams)}return o},_addBinding:function(t){if(!this._bindings){this._bindings=[]}var e=this._bindings.length;do{e--}while(this._bindings[e]&&t._priority<=this._bindings[e]._priority);this._bindings.splice(e+1,0,t)},_indexOfListener:function(t,e){if(!this._bindings){return-1}if(e===undefined){e=null}var i=this._bindings.length;var s;while(i--){s=this._bindings[i];if(s._listener===t&&s.context===e){return i}}return-1},has:function(t,e){return this._indexOfListener(t,e)!==-1},add:function(t,e,i){this.validateListener(t,"add");var s=[];if(arguments.length>3){for(var r=3;r<arguments.length;r++){s.push(arguments[r])}}return this._registerListener(t,false,e,i,s)},addOnce:function(t,e,i){this.validateListener(t,"addOnce");var s=[];if(arguments.length>3){for(var r=3;r<arguments.length;r++){s.push(arguments[r])}}return this._registerListener(t,true,e,i,s)},remove:function(t,e){this.validateListener(t,"remove");var i=this._indexOfListener(t,e);if(i!==-1){this._bindings[i]._destroy();this._bindings.splice(i,1)}return t},removeAll:function(t){if(t===undefined){t=null}if(!this._bindings){return}var e=this._bindings.length;while(e--){if(t){if(this._bindings[e].context===t){this._bindings[e]._destroy();this._bindings.splice(e,1)}}else{this._bindings[e]._destroy()}}if(!t){this._bindings.length=0}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=false},dispatch:function(){if(!this.active||!this._bindings){return}var t=Array.prototype.slice.call(arguments);var e=this._bindings.length;var i;if(this.memorize){this._prevParams=t}if(!e){return}i=this._bindings.slice();this._shouldPropagate=true;do{e--}while(i[e]&&this._shouldPropagate&&i[e].execute(t)!==false)},forget:function(){if(this._prevParams){this._prevParams=null}},dispose:function(){this.removeAll();this._bindings=null;if(this._prevParams){this._prevParams=null}},toString:function(){return"[Phaser.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};Object.defineProperty(r.Signal.prototype,"boundDispatch",{get:function(){var t=this;return this._boundDispatch||(this._boundDispatch=function(){return t.dispatch.apply(t,arguments)})}});r.Signal.prototype.constructor=r.Signal;r.SignalBinding=function(t,e,i,s,r,n){this._listener=e;if(i){this._isOnce=true}if(s!=null){this.context=s}this._signal=t;if(r){this._priority=r}if(n&&n.length){this._args=n}};r.SignalBinding.prototype={context:null,_isOnce:false,_priority:0,_args:null,callCount:0,active:true,params:null,execute:function(t){var e,i;if(this.active&&!!this._listener){i=this.params?this.params.concat(t):t;if(this._args){i=i.concat(this._args)}e=this._listener.apply(this.context,i);this.callCount++;if(this._isOnce){this.detach()}}return e},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal;delete this._listener;delete this.context},toString:function(){return"[Phaser.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}};r.SignalBinding.prototype.constructor=r.SignalBinding;r.Filter=function(t,e,i){this.game=t;this.type=r.WEBGL_FILTER;this.passes=[this];this.shaders=[];this.dirty=true;this.padding=0;this.prevPoint=new r.Point;var s=new Date;this.uniforms={resolution:{type:"2f",value:{x:256,y:256}},time:{type:"1f",value:0},mouse:{type:"2f",value:{x:0,y:0}},date:{type:"4fv",value:[s.getFullYear(),s.getMonth(),s.getDate(),s.getHours()*60*60+s.getMinutes()*60+s.getSeconds()]},sampleRate:{type:"1f",value:44100},iChannel0:{type:"sampler2D",value:null,textureData:{repeat:true}},iChannel1:{type:"sampler2D",value:null,textureData:{repeat:true}},iChannel2:{type:"sampler2D",value:null,textureData:{repeat:true}},iChannel3:{type:"sampler2D",value:null,textureData:{repeat:true}}};if(e){for(var n in e){this.uniforms[n]=e[n]}}this.fragmentSrc=i||""};r.Filter.prototype={init:function(){},setResolution:function(t,e){this.uniforms.resolution.value.x=t;this.uniforms.resolution.value.y=e},update:function(t){if(typeof t!=="undefined"){var e=t.x/this.game.width;var i=1-t.y/this.game.height;if(e!==this.prevPoint.x||i!==this.prevPoint.y){this.uniforms.mouse.value.x=e.toFixed(2);this.uniforms.mouse.value.y=i.toFixed(2);this.prevPoint.set(e,i)}}this.uniforms.time.value=this.game.time.totalElapsedSeconds()},addToWorld:function(t,e,i,s,r,n){if(r===undefined){r=0}if(n===undefined){n=0}if(i!==undefined&&i!==null){this.width=i}else{i=this.width}if(s!==undefined&&s!==null){this.height=s}else{s=this.height}var a=this.game.add.image(t,e,"__default");a.width=i;a.height=s;a.anchor.set(r,n);a.filters=[this];return a},destroy:function(){this.game=null}};r.Filter.prototype.constructor=r.Filter;Object.defineProperty(r.Filter.prototype,"width",{get:function(){return this.uniforms.resolution.value.x},set:function(t){this.uniforms.resolution.value.x=t}});Object.defineProperty(r.Filter.prototype,"height",{get:function(){return this.uniforms.resolution.value.y},set:function(t){this.uniforms.resolution.value.y=t}});r.Plugin=function(t,e){if(e===undefined){e=null}this.game=t;this.parent=e;this.active=false;this.visible=false;this.hasPreUpdate=false;this.hasUpdate=false;this.hasPostUpdate=false;this.hasRender=false;this.hasPostRender=false};r.Plugin.prototype={preUpdate:function(){},update:function(){},render:function(){},postRender:function(){},destroy:function(){this.game=null;this.parent=null;this.active=false;this.visible=false}};r.Plugin.prototype.constructor=r.Plugin;r.PluginManager=function(t){this.game=t;this.plugins=[];this._len=0;this._i=0};r.PluginManager.prototype={add:function(t){var e=Array.prototype.slice.call(arguments,1);var i=false;if(typeof t==="function"){t=new t(this.game,this)}else{t.game=this.game;t.parent=this}if(typeof t["preUpdate"]==="function"){t.hasPreUpdate=true;i=true}if(typeof t["update"]==="function"){t.hasUpdate=true;i=true}if(typeof t["postUpdate"]==="function"){t.hasPostUpdate=true;i=true}if(typeof t["render"]==="function"){t.hasRender=true;i=true}if(typeof t["postRender"]==="function"){t.hasPostRender=true;i=true}if(i){if(t.hasPreUpdate||t.hasUpdate||t.hasPostUpdate){t.active=true}if(t.hasRender||t.hasPostRender){t.visible=true}this._len=this.plugins.push(t);if(typeof t["init"]==="function"){t.init.apply(t,e)}return t}else{return null}},remove:function(t,e){if(e===undefined){e=true}this._i=this._len;while(this._i--){if(this.plugins[this._i]===t){if(e){t.destroy()}this.plugins.splice(this._i,1);this._len--;return}}},removeAll:function(){this._i=this._len;while(this._i--){this.plugins[this._i].destroy()}this.plugins.length=0;this._len=0},preUpdate:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].active&&this.plugins[this._i].hasPreUpdate){this.plugins[this._i].preUpdate()}}},update:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].active&&this.plugins[this._i].hasUpdate){this.plugins[this._i].update()}}},postUpdate:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].active&&this.plugins[this._i].hasPostUpdate){this.plugins[this._i].postUpdate()}}},render:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].visible&&this.plugins[this._i].hasRender){this.plugins[this._i].render()}}},postRender:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].visible&&this.plugins[this._i].hasPostRender){this.plugins[this._i].postRender()}}},destroy:function(){this.removeAll();this.game=null}};r.PluginManager.prototype.constructor=r.PluginManager;r.Stage=function(t){this.game=t;PIXI.DisplayObjectContainer.call(this);this.name="_stage_root";this.disableVisibilityChange=false;this.exists=true;this.worldTransform=new PIXI.Matrix;this.stage=this;this.currentRenderOrderID=0;this._hiddenVar="hidden";this._onChange=null;this._bgColor={r:0,g:0,b:0,a:0,color:0,rgba:"#000000"};if(!this.game.transparent){this._bgColor.a=1}if(t.config){this.parseConfig(t.config)}};r.Stage.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);r.Stage.prototype.constructor=r.Stage;r.Stage.prototype.parseConfig=function(t){if(t["disableVisibilityChange"]){this.disableVisibilityChange=t["disableVisibilityChange"]}if(t["backgroundColor"]){this.setBackgroundColor(t["backgroundColor"])}};r.Stage.prototype.boot=function(){r.DOM.getOffset(this.game.canvas,this.offset);r.Canvas.setUserSelect(this.game.canvas,"none");r.Canvas.setTouchAction(this.game.canvas,"none");this.checkVisibility()};r.Stage.prototype.preUpdate=function(){this.currentRenderOrderID=0;for(var t=0;t<this.children.length;t++){this.children[t].preUpdate()}};r.Stage.prototype.update=function(){var t=this.children.length;while(t--){this.children[t].update()}};r.Stage.prototype.postUpdate=function(){this.game.camera.update();if(this.game.camera.target){this.game.camera.target.postUpdate();this.updateTransform();this.game.camera.updateTarget()}for(var t=0;t<this.children.length;t++){this.children[t].postUpdate()}this.updateTransform()};r.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var t=0;t<this.children.length;t++){this.children[t].updateTransform()}};r.Stage.prototype.checkVisibility=function(){if(document.hidden!==undefined){this._hiddenVar="visibilitychange"}else if(document.webkitHidden!==undefined){this._hiddenVar="webkitvisibilitychange"}else if(document.mozHidden!==undefined){this._hiddenVar="mozvisibilitychange"}else if(document.msHidden!==undefined){this._hiddenVar="msvisibilitychange"}else{this._hiddenVar=null}var t=this;this._onChange=function(e){return t.visibilityChange(e)};if(this._hiddenVar){document.addEventListener(this._hiddenVar,this._onChange,false)}window.onblur=this._onChange;window.onfocus=this._onChange;window.onpagehide=this._onChange;window.onpageshow=this._onChange;if(this.game.device.cocoonJSApp){CocoonJS.App.onSuspended.addEventListener(function(){r.Stage.prototype.visibilityChange.call(t,{type:"pause"})});CocoonJS.App.onActivated.addEventListener(function(){r.Stage.prototype.visibilityChange.call(t,{type:"resume"})})}};r.Stage.prototype.visibilityChange=function(t){if(t.type==="pagehide"||t.type==="blur"||t.type==="pageshow"||t.type==="focus"){if(t.type==="pagehide"||t.type==="blur"){this.game.focusLoss(t)}else if(t.type==="pageshow"||t.type==="focus"){this.game.focusGain(t)}return}if(this.disableVisibilityChange){return}if(document.hidden||document.mozHidden||document.msHidden||document.webkitHidden||t.type==="pause"){this.game.gamePaused(t)}else{this.game.gameResumed(t)}};r.Stage.prototype.setBackgroundColor=function(t){if(this.game.transparent){return}r.Color.valueToColor(t,this._bgColor);r.Color.updateColor(this._bgColor);this._bgColor.r/=255;this._bgColor.g/=255;this._bgColor.b/=255;this._bgColor.a=1};r.Stage.prototype.destroy=function(){if(this._hiddenVar){document.removeEventListener(this._hiddenVar,this._onChange,false)}window.onpagehide=null;window.onpageshow=null;window.onblur=null;window.onfocus=null};Object.defineProperty(r.Stage.prototype,"backgroundColor",{get:function(){return this._bgColor.color},set:function(t){this.setBackgroundColor(t)}});Object.defineProperty(r.Stage.prototype,"smoothed",{get:function(){return PIXI.scaleModes.DEFAULT===PIXI.scaleModes.LINEAR},set:function(t){if(t){PIXI.scaleModes.DEFAULT=PIXI.scaleModes.LINEAR}else{PIXI.scaleModes.DEFAULT=PIXI.scaleModes.NEAREST}}});r.Group=function(t,e,i,s,n,a){if(s===undefined){s=false}if(n===undefined){n=false}if(a===undefined){a=r.Physics.ARCADE}this.game=t;if(e===undefined){e=t.world}this.name=i||"group";this.z=0;PIXI.DisplayObjectContainer.call(this);if(s){this.game.stage.addChild(this);this.z=this.game.stage.children.length}else{if(e){e.addChild(this);this.z=e.children.length}}this.type=r.GROUP;this.physicsType=r.GROUP;this.alive=true;this.exists=true;this.ignoreDestroy=false;this.pendingDestroy=false;this.classType=r.Sprite;this.cursor=null;this.inputEnableChildren=false;this.onChildInputDown=new r.Signal;this.onChildInputUp=new r.Signal;this.onChildInputOver=new r.Signal;this.onChildInputOut=new r.Signal;this.enableBody=n;this.enableBodyDebug=false;this.physicsBodyType=a;this.physicsSortDirection=null;this.onDestroy=new r.Signal;this.cursorIndex=0;this.fixedToCamera=false;this.cameraOffset=new r.Point;this.hash=[];this._sortProperty="z"};r.Group.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);r.Group.prototype.constructor=r.Group;r.Group.RETURN_NONE=0;r.Group.RETURN_TOTAL=1;r.Group.RETURN_CHILD=2;r.Group.RETURN_ALL=3;r.Group.SORT_ASCENDING=-1;r.Group.SORT_DESCENDING=1;r.Group.prototype.add=function(t,e,i){if(e===undefined){e=false}if(t.parent===this){return t}if(t.body&&t.parent&&t.parent.hash){t.parent.removeFromHash(t)}if(i===undefined){t.z=this.children.length;this.addChild(t)}else{this.addChildAt(t,i);this.updateZ()}if(this.enableBody&&t.hasOwnProperty("body")&&t.body===null){this.game.physics.enable(t,this.physicsBodyType)}else if(t.body){this.addToHash(t)}if(this.inputEnableChildren&&(!t.input||t.inputEnabled)){t.inputEnabled=true}if(!e&&t.events){t.events.onAddedToGroup$dispatch(t,this)}if(this.cursor===null){this.cursor=t}return t};r.Group.prototype.addAt=function(t,e,i){this.add(t,i,e)};r.Group.prototype.addToHash=function(t){if(t.parent===this){var e=this.hash.indexOf(t);if(e===-1){this.hash.push(t);return true}}return false};r.Group.prototype.removeFromHash=function(t){if(t){var e=this.hash.indexOf(t);if(e!==-1){this.hash.splice(e,1);return true}}return false};r.Group.prototype.addMultiple=function(t,e){if(t instanceof r.Group){t.moveAll(this,e)}else if(Array.isArray(t)){for(var i=0;i<t.length;i++){this.add(t[i],e)}}return t};r.Group.prototype.getAt=function(t){if(t<0||t>=this.children.length){return-1}else{return this.getChildAt(t)}};r.Group.prototype.create=function(t,e,i,s,r,n){if(r===undefined){r=true}var a=new this.classType(this.game,t,e,i,s);a.exists=r;a.visible=r;a.alive=r;return this.add(a,false,n)};r.Group.prototype.createMultiple=function(t,e,i,s){if(i===undefined){i=0}if(s===undefined){s=false}if(!Array.isArray(e)){e=[e]}if(!Array.isArray(i)){i=[i]}var r=this;var n=[];e.forEach(function(e){i.forEach(function(i){for(var a=0;a<t;a++){n.push(r.create(0,0,e,i,s))}})});return n};r.Group.prototype.updateZ=function(){var t=this.children.length;while(t--){this.children[t].z=t}};r.Group.prototype.align=function(t,e,i,s,n,a){if(n===undefined){n=r.TOP_LEFT}if(a===undefined){a=0}if(this.children.length===0||a>this.children.length||t===-1&&e===-1){return false}var o=new r.Rectangle(0,0,i,s);var h=t*i;var l=e*s;for(var u=a;u<this.children.length;u++){var c=this.children[u];if(c["alignIn"]){c.alignIn(o,n)}else{continue}if(t===-1){o.y+=s;if(o.y===l){o.x+=i;o.y=0}}else if(e===-1){o.x+=i;if(o.x===h){o.x=0;o.y+=s}}else{o.x+=i;if(o.x===h){o.x=0;o.y+=s;if(o.y===l){return true}}}}return true};r.Group.prototype.resetCursor=function(t){if(t===undefined){t=0}if(t>this.children.length-1){t=0}if(this.cursor){this.cursorIndex=t;this.cursor=this.children[this.cursorIndex];return this.cursor}};r.Group.prototype.next=function(){if(this.cursor){if(this.cursorIndex>=this.children.length-1){this.cursorIndex=0}else{this.cursorIndex++}this.cursor=this.children[this.cursorIndex];return this.cursor}};r.Group.prototype.previous=function(){if(this.cursor){if(this.cursorIndex===0){this.cursorIndex=this.children.length-1}else{this.cursorIndex--}this.cursor=this.children[this.cursorIndex];return this.cursor}};r.Group.prototype.swap=function(t,e){this.swapChildren(t,e);this.updateZ()};r.Group.prototype.bringToTop=function(t){if(t.parent===this&&this.getIndex(t)<this.children.length){this.remove(t,false,true);this.add(t,true)}return t};r.Group.prototype.sendToBack=function(t){if(t.parent===this&&this.getIndex(t)>0){this.remove(t,false,true);this.addAt(t,0,true)}return t};r.Group.prototype.moveUp=function(t){if(t.parent===this&&this.getIndex(t)<this.children.length-1){var e=this.getIndex(t);var i=this.getAt(e+1);if(i){this.swap(t,i)}}return t};r.Group.prototype.moveDown=function(t){if(t.parent===this&&this.getIndex(t)>0){var e=this.getIndex(t);var i=this.getAt(e-1);if(i){this.swap(t,i)}}return t};r.Group.prototype.xy=function(t,e,i){if(t<0||t>this.children.length){return-1}else{this.getChildAt(t).x=e;this.getChildAt(t).y=i}};r.Group.prototype.reverse=function(){this.children.reverse();this.updateZ()};r.Group.prototype.getIndex=function(t){return this.children.indexOf(t)};r.Group.prototype.getByName=function(t){for(var e=0;e<this.children.length;e++){if(this.children[e].name===t){return this.children[e]}}return null};r.Group.prototype.replace=function(t,e){var i=this.getIndex(t);if(i!==-1){if(e.parent){if(e.parent instanceof r.Group){e.parent.remove(e)}else{e.parent.removeChild(e)}}this.remove(t);this.addAt(e,i);return t}};r.Group.prototype.hasProperty=function(t,e){var i=e.length;if(i===1&&e[0]in t){return true}else if(i===2&&e[0]in t&&e[1]in t[e[0]]){return true}else if(i===3&&e[0]in t&&e[1]in t[e[0]]&&e[2]in t[e[0]][e[1]]){return true}else if(i===4&&e[0]in t&&e[1]in t[e[0]]&&e[2]in t[e[0]][e[1]]&&e[3]in t[e[0]][e[1]][e[2]]){return true}return false};r.Group.prototype.setProperty=function(t,e,i,s,r){if(r===undefined){r=false}s=s||0;if(!this.hasProperty(t,e)&&(!r||s>0)){return false}var n=e.length;if(n===1){if(s===0){t[e[0]]=i}else if(s===1){t[e[0]]+=i}else if(s===2){t[e[0]]-=i}else if(s===3){t[e[0]]*=i}else if(s===4){t[e[0]]/=i}}else if(n===2){if(s===0){t[e[0]][e[1]]=i}else if(s===1){t[e[0]][e[1]]+=i}else if(s===2){t[e[0]][e[1]]-=i}else if(s===3){t[e[0]][e[1]]*=i}else if(s===4){t[e[0]][e[1]]/=i}}else if(n===3){if(s===0){t[e[0]][e[1]][e[2]]=i}else if(s===1){t[e[0]][e[1]][e[2]]+=i}else if(s===2){t[e[0]][e[1]][e[2]]-=i}else if(s===3){t[e[0]][e[1]][e[2]]*=i}else if(s===4){t[e[0]][e[1]][e[2]]/=i}}else if(n===4){if(s===0){t[e[0]][e[1]][e[2]][e[3]]=i}else if(s===1){t[e[0]][e[1]][e[2]][e[3]]+=i}else if(s===2){t[e[0]][e[1]][e[2]][e[3]]-=i}else if(s===3){t[e[0]][e[1]][e[2]][e[3]]*=i}else if(s===4){t[e[0]][e[1]][e[2]][e[3]]/=i}}return true};r.Group.prototype.checkProperty=function(t,e,i,s){if(s===undefined){s=false}if(!r.Utils.getProperty(t,e)&&s){return false}if(r.Utils.getProperty(t,e)!==i){return false}return true};r.Group.prototype.set=function(t,e,i,s,r,n,a){if(a===undefined){a=false}e=e.split(".");if(s===undefined){s=false}if(r===undefined){r=false}if((s===false||s&&t.alive)&&(r===false||r&&t.visible)){return this.setProperty(t,e,i,n,a)}};r.Group.prototype.setAll=function(t,e,i,s,r,n){if(i===undefined){i=false}if(s===undefined){s=false}if(n===undefined){n=false}t=t.split(".");r=r||0;for(var a=0;a<this.children.length;a++){if((!i||i&&this.children[a].alive)&&(!s||s&&this.children[a].visible)){this.setProperty(this.children[a],t,e,r,n)}}};r.Group.prototype.setAllChildren=function(t,e,i,s,n,a){if(i===undefined){i=false}if(s===undefined){s=false}if(a===undefined){a=false}n=n||0;for(var o=0;o<this.children.length;o++){if((!i||i&&this.children[o].alive)&&(!s||s&&this.children[o].visible)){if(this.children[o]instanceof r.Group){this.children[o].setAllChildren(t,e,i,s,n,a)}else{this.setProperty(this.children[o],t.split("."),e,n,a)}}}};r.Group.prototype.checkAll=function(t,e,i,s,r){if(i===undefined){i=false}if(s===undefined){s=false}if(r===undefined){r=false}for(var n=0;n<this.children.length;n++){if((!i||i&&this.children[n].alive)&&(!s||s&&this.children[n].visible)){if(!this.checkProperty(this.children[n],t,e,r)){return false}}}return true};r.Group.prototype.addAll=function(t,e,i,s){this.setAll(t,e,i,s,1)};r.Group.prototype.subAll=function(t,e,i,s){this.setAll(t,e,i,s,2)};r.Group.prototype.multiplyAll=function(t,e,i,s){this.setAll(t,e,i,s,3)};r.Group.prototype.divideAll=function(t,e,i,s){this.setAll(t,e,i,s,4)};r.Group.prototype.callAllExists=function(t,e){var i;if(arguments.length>2){i=[];for(var s=2;s<arguments.length;s++){i.push(arguments[s])}}for(var s=0;s<this.children.length;s++){if(this.children[s].exists===e&&this.children[s][t]){this.children[s][t].apply(this.children[s],i)}}};r.Group.prototype.callbackFromArray=function(t,e,i){if(i===1){if(t[e[0]]){return t[e[0]]}}else if(i===2){if(t[e[0]][e[1]]){return t[e[0]][e[1]]}}else if(i===3){if(t[e[0]][e[1]][e[2]]){return t[e[0]][e[1]][e[2]]}}else if(i===4){if(t[e[0]][e[1]][e[2]][e[3]]){return t[e[0]][e[1]][e[2]][e[3]]}}else if(t[e]){return t[e]}return false};r.Group.prototype.callAll=function(t,e){if(t===undefined){return}t=t.split(".");var i=t.length;if(e===undefined||e===null||e===""){e=null}else{if(typeof e==="string"){e=e.split(".");var s=e.length}}var r;if(arguments.length>2){r=[];for(var n=2;n<arguments.length;n++){r.push(arguments[n])}}var a=null;var o=null;for(var n=0;n<this.children.length;n++){a=this.callbackFromArray(this.children[n],t,i);if(e&&a){o=this.callbackFromArray(this.children[n],e,s);if(a){a.apply(o,r)}}else if(a){a.apply(this.children[n],r)}}};r.Group.prototype.preUpdate=function(){if(this.pendingDestroy){this.destroy();return false}if(!this.exists||!this.parent.exists){this.renderOrderID=-1;return false}for(var t=0;t<this.children.length;t++){this.children[t].preUpdate()}return true};r.Group.prototype.update=function(){var t=this.children.length;while(t--){this.children[t].update()}};r.Group.prototype.postUpdate=function(){if(this.fixedToCamera){this.x=this.game.camera.view.x+this.cameraOffset.x;this.y=this.game.camera.view.y+this.cameraOffset.y}for(var t=0;t<this.children.length;t++){this.children[t].postUpdate()}};r.Group.prototype.filter=function(t,e){var i=-1;var s=this.children.length;var n=[];while(++i<s){var a=this.children[i];if(!e||e&&a.exists){if(t(a,i,this.children)){n.push(a)}}}return new r.ArraySet(n)};r.Group.prototype.forEach=function(t,e,i){if(i===undefined){i=false}if(arguments.length<=3){for(var s=0;s<this.children.length;s++){if(!i||i&&this.children[s].exists){t.call(e,this.children[s])}}}else{var r=[null];for(var s=3;s<arguments.length;s++){r.push(arguments[s])}for(var s=0;s<this.children.length;s++){if(!i||i&&this.children[s].exists){r[0]=this.children[s];t.apply(e,r)}}}};r.Group.prototype.forEachExists=function(t,e){var i;if(arguments.length>2){i=[null];for(var s=2;s<arguments.length;s++){i.push(arguments[s])}}this.iterate("exists",true,r.Group.RETURN_TOTAL,t,e,i)};r.Group.prototype.forEachAlive=function(t,e){var i;if(arguments.length>2){i=[null];for(var s=2;s<arguments.length;s++){i.push(arguments[s])}}this.iterate("alive",true,r.Group.RETURN_TOTAL,t,e,i)};r.Group.prototype.forEachDead=function(t,e){var i;if(arguments.length>2){i=[null];for(var s=2;s<arguments.length;s++){i.push(arguments[s])}}this.iterate("alive",false,r.Group.RETURN_TOTAL,t,e,i)};r.Group.prototype.sort=function(t,e){if(this.children.length<2){return}if(t===undefined){t="z"}if(e===undefined){e=r.Group.SORT_ASCENDING}this._sortProperty=t;if(e===r.Group.SORT_ASCENDING){this.children.sort(this.ascendingSortHandler.bind(this))}else{this.children.sort(this.descendingSortHandler.bind(this))}this.updateZ()};r.Group.prototype.customSort=function(t,e){if(this.children.length<2){return}this.children.sort(t.bind(e));this.updateZ()};r.Group.prototype.ascendingSortHandler=function(t,e){if(t[this._sortProperty]<e[this._sortProperty]){return-1}else if(t[this._sortProperty]>e[this._sortProperty]){return 1}else{if(t.z<e.z){return-1}else{return 1}}};r.Group.prototype.descendingSortHandler=function(t,e){if(t[this._sortProperty]<e[this._sortProperty]){return 1}else if(t[this._sortProperty]>e[this._sortProperty]){return-1}else{return 0}};r.Group.prototype.iterate=function(t,e,i,s,n,a){if(this.children.length===0){if(i===r.Group.RETURN_TOTAL){return 0}else if(i===r.Group.RETURN_ALL){return[]}}var o=0;if(i===r.Group.RETURN_ALL){var h=[]}for(var l=0;l<this.children.length;l++){if(this.children[l][t]===e){o++;if(s){if(a){a[0]=this.children[l];s.apply(n,a)}else{s.call(n,this.children[l])}}if(i===r.Group.RETURN_CHILD){return this.children[l]}else if(i===r.Group.RETURN_ALL){h.push(this.children[l])}}}if(i===r.Group.RETURN_TOTAL){return o}else if(i===r.Group.RETURN_ALL){return h}else{return null}};r.Group.prototype.getFirstExists=function(t,e,i,s,n,a){if(e===undefined){e=false}if(typeof t!=="boolean"){t=true}var o=this.iterate("exists",t,r.Group.RETURN_CHILD);return o===null&&e?this.create(i,s,n,a):this.resetChild(o,i,s,n,a)};r.Group.prototype.getFirstAlive=function(t,e,i,s,n){if(t===undefined){t=false}var a=this.iterate("alive",true,r.Group.RETURN_CHILD);return a===null&&t?this.create(e,i,s,n):this.resetChild(a,e,i,s,n)};r.Group.prototype.getFirstDead=function(t,e,i,s,n){if(t===undefined){t=false}var a=this.iterate("alive",false,r.Group.RETURN_CHILD);return a===null&&t?this.create(e,i,s,n):this.resetChild(a,e,i,s,n)};r.Group.prototype.resetChild=function(t,e,i,s,r){if(t===null){return null}if(e===undefined){e=null}if(i===undefined){i=null}if(e!==null&&i!==null){t.reset(e,i)}if(s!==undefined){t.loadTexture(s,r)}return t};r.Group.prototype.getTop=function(){if(this.children.length>0){return this.children[this.children.length-1]}};r.Group.prototype.getBottom=function(){if(this.children.length>0){return this.children[0]}};r.Group.prototype.getClosestTo=function(t,e,i){var s=Number.MAX_VALUE;var n=0;var a=null;for(var o=0;o<this.children.length;o++){var h=this.children[o];if(h.exists){n=Math.abs(r.Point.distance(t,h));if(n<s&&(!e||e.call(i,h,n))){s=n;a=h}}}return a};r.Group.prototype.getFurthestFrom=function(t,e,i){var s=0;var n=0;var a=null;for(var o=0;o<this.children.length;o++){var h=this.children[o];if(h.exists){n=Math.abs(r.Point.distance(t,h));if(n>s&&(!e||e.call(i,h,n))){s=n;a=h}}}return a};r.Group.prototype.countLiving=function(){return this.iterate("alive",true,r.Group.RETURN_TOTAL)};r.Group.prototype.countDead=function(){return this.iterate("alive",false,r.Group.RETURN_TOTAL)};r.Group.prototype.getRandom=function(t,e){if(t===undefined){t=0}if(e===undefined){e=this.children.length}if(e===0){return null}return r.ArrayUtils.getRandomItem(this.children,t,e)};r.Group.prototype.getRandomExists=function(t,e){var i=this.getAll("exists",true,t,e);return this.game.rnd.pick(i)};r.Group.prototype.getAll=function(t,e,i,s){if(i===undefined){i=0}if(s===undefined){s=this.children.length}var r=[];for(var n=i;n<s;n++){var a=this.children[n];if(t&&a[t]===e){r.push(a)}}return r};r.Group.prototype.remove=function(t,e,i){if(e===undefined){e=false}if(i===undefined){i=false}if(this.children.length===0||this.children.indexOf(t)===-1){return false}if(!i&&t.events&&!t.destroyPhase){t.events.onRemovedFromGroup$dispatch(t,this)}var s=this.removeChild(t);this.removeFromHash(t);this.updateZ();if(this.cursor===t){this.next()}if(e&&s){s.destroy(true)}return true};r.Group.prototype.moveAll=function(t,e){if(e===undefined){e=false}if(this.children.length>0&&t instanceof r.Group){do{t.add(this.children[0],e)}while(this.children.length>0);this.hash=[];this.cursor=null}return t};r.Group.prototype.removeAll=function(t,e,i){if(t===undefined){t=false}if(e===undefined){e=false}if(i===undefined){i=false}if(this.children.length===0){return}do{if(!e&&this.children[0].events){this.children[0].events.onRemovedFromGroup$dispatch(this.children[0],this)}var s=this.removeChild(this.children[0]);this.removeFromHash(s);if(t&&s){s.destroy(true,i)}}while(this.children.length>0);this.hash=[];this.cursor=null};r.Group.prototype.removeBetween=function(t,e,i,s){if(e===undefined){e=this.children.length-1}if(i===undefined){i=false}if(s===undefined){s=false}if(this.children.length===0){return}if(t>e||t<0||e>this.children.length){return false}var r=e;while(r>=t){if(!s&&this.children[r].events){this.children[r].events.onRemovedFromGroup$dispatch(this.children[r],this)}var n=this.removeChild(this.children[r]);this.removeFromHash(n);if(i&&n){n.destroy(true)}if(this.cursor===this.children[r]){this.cursor=null}r--}this.updateZ()};r.Group.prototype.destroy=function(t,e){if(this.game===null||this.ignoreDestroy){return}if(t===undefined){t=true}if(e===undefined){e=false}this.onDestroy.dispatch(this,t,e);this.removeAll(t);this.cursor=null;this.filters=null;this.pendingDestroy=false;if(!e){if(this.parent){this.parent.removeChild(this)}this.game=null;this.exists=false}};Object.defineProperty(r.Group.prototype,"total",{get:function(){return this.iterate("exists",true,r.Group.RETURN_TOTAL)}});Object.defineProperty(r.Group.prototype,"length",{get:function(){return this.children.length}});Object.defineProperty(r.Group.prototype,"angle",{get:function(){return r.Math.radToDeg(this.rotation)},set:function(t){this.rotation=r.Math.degToRad(t)}});Object.defineProperty(r.Group.prototype,"centerX",{get:function(){return this.getBounds(this.parent).centerX},set:function(t){var e=this.getBounds(this.parent);var i=this.x-e.x;this.x=t+i-e.halfWidth}});Object.defineProperty(r.Group.prototype,"centerY",{get:function(){return this.getBounds(this.parent).centerY},set:function(t){var e=this.getBounds(this.parent);var i=this.y-e.y;this.y=t+i-e.halfHeight}});Object.defineProperty(r.Group.prototype,"left",{get:function(){return this.getBounds(this.parent).left},set:function(t){var e=this.getBounds(this.parent);var i=this.x-e.x;this.x=t+i}});Object.defineProperty(r.Group.prototype,"right",{get:function(){return this.getBounds(this.parent).right},set:function(t){var e=this.getBounds(this.parent);var i=this.x-e.x;this.x=t+i-e.width}});Object.defineProperty(r.Group.prototype,"top",{get:function(){return this.getBounds(this.parent).top},set:function(t){var e=this.getBounds(this.parent);var i=this.y-e.y;this.y=t+i}});Object.defineProperty(r.Group.prototype,"bottom",{get:function(){return this.getBounds(this.parent).bottom},set:function(t){var e=this.getBounds(this.parent);var i=this.y-e.y;this.y=t+i-e.height}});r.World=function(t){r.Group.call(this,t,null,"__world",false);this.bounds=new r.Rectangle(0,0,t.width,t.height);this.camera=null;this._definedSize=false;this._width=t.width;this._height=t.height;this.game.state.onStateChange.add(this.stateChange,this)};r.World.prototype=Object.create(r.Group.prototype);r.World.prototype.constructor=r.World;r.World.prototype.boot=function(){this.camera=new r.Camera(this.game,0,0,0,this.game.width,this.game.height);this.game.stage.addChild(this);this.camera.boot()};r.World.prototype.stateChange=function(){this.x=0;this.y=0;this.camera.reset()};r.World.prototype.setBounds=function(t,e,i,s){this._definedSize=true;this._width=i;this._height=s;this.bounds.setTo(t,e,i,s);this.x=t;this.y=e;if(this.camera.bounds){this.camera.bounds.setTo(t,e,Math.max(i,this.game.width),Math.max(s,this.game.height))}this.game.physics.setBoundsToWorld()};r.World.prototype.resize=function(t,e){if(this._definedSize){if(t<this._width){t=this._width}if(e<this._height){e=this._height}}this.bounds.width=t;this.bounds.height=e;this.game.camera.setBoundsToWorld();this.game.physics.setBoundsToWorld()};r.World.prototype.shutdown=function(){this.destroy(true,true)};r.World.prototype.wrap=function(t,e,i,s,r){if(e===undefined){e=0}if(i===undefined){i=false}if(s===undefined){s=true}if(r===undefined){r=true}if(!i){if(s&&t.x+e<this.bounds.x){t.x=this.bounds.right+e}else if(s&&t.x-e>this.bounds.right){t.x=this.bounds.left-e}if(r&&t.y+e<this.bounds.top){t.y=this.bounds.bottom+e}else if(r&&t.y-e>this.bounds.bottom){t.y=this.bounds.top-e}}else{t.getBounds();if(s){if(t.x+t._currentBounds.width<this.bounds.x){t.x=this.bounds.right}else if(t.x>this.bounds.right){t.x=this.bounds.left}}if(r){if(t.y+t._currentBounds.height<this.bounds.top){t.y=this.bounds.bottom}else if(t.y>this.bounds.bottom){t.y=this.bounds.top}}}};Object.defineProperty(r.World.prototype,"width",{get:function(){return this.bounds.width},set:function(t){if(t<this.game.width){t=this.game.width}this.bounds.width=t;this._width=t;this._definedSize=true}});Object.defineProperty(r.World.prototype,"height",{get:function(){return this.bounds.height},set:function(t){if(t<this.game.height){t=this.game.height}this.bounds.height=t;this._height=t;this._definedSize=true}});Object.defineProperty(r.World.prototype,"centerX",{get:function(){return this.bounds.halfWidth+this.bounds.x}});Object.defineProperty(r.World.prototype,"centerY",{get:function(){return this.bounds.halfHeight+this.bounds.y}});Object.defineProperty(r.World.prototype,"randomX",{get:function(){if(this.bounds.x<0){return this.game.rnd.between(this.bounds.x,this.bounds.width-Math.abs(this.bounds.x))}else{return this.game.rnd.between(this.bounds.x,this.bounds.width)}}});Object.defineProperty(r.World.prototype,"randomY",{get:function(){if(this.bounds.y<0){return this.game.rnd.between(this.bounds.y,this.bounds.height-Math.abs(this.bounds.y))}else{return this.game.rnd.between(this.bounds.y,this.bounds.height)}}});r.Game=function(t,e,i,s,n,a,o,h){this.id=r.GAMES.push(this)-1;this.config=null;this.physicsConfig=h;this.parent="";this.width=800;this.height=600;this.resolution=1;this._width=800;this._height=600;this.transparent=false;this.antialias=true;this.preserveDrawingBuffer=false;this.clearBeforeRender=true;this.renderer=null;this.renderType=r.AUTO;this.state=null;this.isBooted=false;this.isRunning=false;this.raf=null;this.add=null;this.make=null;this.cache=null;this.input=null;this.load=null;this.math=null;this.net=null;this.scale=null;this.sound=null;this.stage=null;this.time=null;this.tweens=null;this.world=null;this.physics=null;this.plugins=null;this.rnd=null;this.device=r.Device;this.camera=null;this.canvas=null;this.context=null;this.debug=null;this.particles=null;this.create=null;this.lockRender=false;this.stepping=false;this.pendingStep=false;this.stepCount=0;this.onPause=null;this.onResume=null;this.onBlur=null;this.onFocus=null;this._paused=false;this._codePaused=false;this.currentUpdateID=0;this.updatesThisFrame=1;this._deltaTime=0;this._lastCount=0;this._spiraling=0;this._kickstart=true;this.fpsProblemNotifier=new r.Signal;this.forceSingleUpdate=true;this._nextFpsNotification=0;if(arguments.length===1&&typeof arguments[0]==="object"){this.parseConfig(arguments[0])}else{this.config={enableDebug:true};if(typeof t!=="undefined"){this._width=t}if(typeof e!=="undefined"){this._height=e}if(typeof i!=="undefined"){this.renderType=i}if(typeof s!=="undefined"){this.parent=s}if(typeof a!=="undefined"){this.transparent=a}if(typeof o!=="undefined"){this.antialias=o}this.rnd=new r.RandomDataGenerator([(Date.now()*Math.random()).toString()]);this.state=new r.StateManager(this,n)}this.device.whenReady(this.boot,this);return this};r.Game.prototype={parseConfig:function(t){this.config=t;if(t["enableDebug"]===undefined){this.config.enableDebug=true}if(t["width"]){this._width=t["width"]}if(t["height"]){this._height=t["height"]}if(t["renderer"]){this.renderType=t["renderer"]}if(t["parent"]){this.parent=t["parent"]}if(t["transparent"]!==undefined){this.transparent=t["transparent"]}if(t["antialias"]!==undefined){this.antialias=t["antialias"]}if(t["resolution"]){this.resolution=t["resolution"]}if(t["preserveDrawingBuffer"]!==undefined){this.preserveDrawingBuffer=t["preserveDrawingBuffer"]}if(t["physicsConfig"]){this.physicsConfig=t["physicsConfig"]}var e=[(Date.now()*Math.random()).toString()];if(t["seed"]){e=t["seed"]}this.rnd=new r.RandomDataGenerator(e);var i=null;if(t["state"]){i=t["state"]}this.state=new r.StateManager(this,i)},boot:function(){if(this.isBooted){return}this.onPause=new r.Signal;this.onResume=new r.Signal;this.onBlur=new r.Signal;this.onFocus=new r.Signal;this.isBooted=true;PIXI.game=this;this.math=r.Math;this.scale=new r.ScaleManager(this,this._width,this._height);this.stage=new r.Stage(this);this.setUpRenderer();this.world=new r.World(this);this.add=new r.GameObjectFactory(this);this.make=new r.GameObjectCreator(this);this.cache=new r.Cache(this);this.load=new r.Loader(this);this.time=new r.Time(this);this.tweens=new r.TweenManager(this);this.input=new r.Input(this);this.sound=new r.SoundManager(this);this.physics=new r.Physics(this,this.physicsConfig);this.particles=new r.Particles(this);this.create=new r.Create(this);this.plugins=new r.PluginManager(this);this.net=new r.Net(this);this.time.boot();this.stage.boot();this.world.boot();this.scale.boot();this.input.boot();this.sound.boot();this.state.boot();if(this.config["enableDebug"]){this.debug=new r.Utils.Debug(this);this.debug.boot()}else{this.debug={preUpdate:function(){},update:function(){},reset:function(){}}}this.showDebugHeader();this.isRunning=true;if(this.config&&this.config["forceSetTimeOut"]){this.raf=new r.RequestAnimationFrame(this,this.config["forceSetTimeOut"])}else{this.raf=new r.RequestAnimationFrame(this,false)}this._kickstart=true;if(window["focus"]){if(!window["PhaserGlobal"]||window["PhaserGlobal"]&&!window["PhaserGlobal"].stopFocus){window.focus()}}this.raf.start()},showDebugHeader:function(){if(window["PhaserGlobal"]&&window["PhaserGlobal"].hideBanner){return}var t=r.VERSION;var e="Canvas";var i="HTML Audio";var s=1;if(this.renderType===r.WEBGL){e="WebGL";s++}else if(this.renderType===r.HEADLESS){e="Headless"}if(this.device.webAudio){i="WebAudio";s++}if(this.device.chrome){var n=["%c %c %c Phaser v"+t+" | Pixi.js | "+e+" | "+i+"  %c %c "+"%c http://phaser.io %c%c%c","background: #fb8cb3","background: #d44a52","color: #ffffff; background: #871905;","background: #d44a52","background: #fb8cb3","background: #ffffff"];for(var a=0;a<3;a++){if(a<s){n.push("color: #ff2424; background: #fff")}else{n.push("color: #959595; background: #fff")}}console.log.apply(console,n)}else if(window["console"]){console.log("Phaser v"+t+" | Pixi.js "+PIXI.VERSION+" | "+e+" | "+i+" | http://phaser.io")}},setUpRenderer:function(){if(this.config["canvas"]){this.canvas=this.config["canvas"]}else{this.canvas=r.Canvas.create(this,this.width,this.height,this.config["canvasID"],true)}if(this.config["canvasStyle"]){this.canvas.style=this.config["canvasStyle"]}else{this.canvas.style["-webkit-full-screen"]="width: 100%; height: 100%"}if(this.renderType===r.HEADLESS||this.renderType===r.CANVAS||this.renderType===r.AUTO&&!this.device.webGL){if(this.device.canvas){this.renderType=r.CANVAS;this.renderer=new PIXI.CanvasRenderer(this);this.context=this.renderer.context}else{throw new Error("Phaser.Game - Cannot create Canvas or WebGL context, aborting.")}}else{this.renderType=r.WEBGL;this.renderer=new PIXI.WebGLRenderer(this);this.context=null;this.canvas.addEventListener("webglcontextlost",this.contextLost.bind(this),false);this.canvas.addEventListener("webglcontextrestored",this.contextRestored.bind(this),false)}if(this.device.cocoonJS){this.canvas.screencanvas=this.renderType===r.CANVAS?true:false}if(this.renderType!==r.HEADLESS){this.stage.smoothed=this.antialias;r.Canvas.addToDOM(this.canvas,this.parent,false);r.Canvas.setTouchAction(this.canvas)}},contextLost:function(t){t.preventDefault();this.renderer.contextLost=true},contextRestored:function(){this.renderer.initContext();this.cache.clearGLTextures();this.renderer.contextLost=false},update:function(t){this.time.update(t);if(this._kickstart){this.updateLogic(this.time.desiredFpsMult);this.updateRender(this.time.slowMotion*this.time.desiredFps);this._kickstart=false;return}if(this._spiraling>1&&!this.forceSingleUpdate){if(this.time.time>this._nextFpsNotification){this._nextFpsNotification=this.time.time+1e4;this.fpsProblemNotifier.dispatch()}this._deltaTime=0;this._spiraling=0;this.updateRender(this.time.slowMotion*this.time.desiredFps)}else{var e=this.time.slowMotion*1e3/this.time.desiredFps;this._deltaTime+=Math.max(Math.min(e*3,this.time.elapsed),0);var i=0;this.updatesThisFrame=Math.floor(this._deltaTime/e);if(this.forceSingleUpdate){this.updatesThisFrame=Math.min(1,this.updatesThisFrame)}while(this._deltaTime>=e){this._deltaTime-=e;this.currentUpdateID=i;this.updateLogic(this.time.desiredFpsMult);i++;if(this.forceSingleUpdate&&i===1){break}else{this.time.refresh()}}if(i>this._lastCount){this._spiraling++}else if(i<this._lastCount){this._spiraling=0}this._lastCount=i;this.updateRender(this._deltaTime/e)}},updateLogic:function(t){if(!this._paused&&!this.pendingStep){if(this.stepping){this.pendingStep=true}this.scale.preUpdate();this.debug.preUpdate();this.camera.preUpdate();this.physics.preUpdate();this.state.preUpdate(t);this.plugins.preUpdate(t);this.stage.preUpdate();this.state.update();this.stage.update();this.tweens.update();this.sound.update();this.input.update();this.physics.update();this.particles.update();this.plugins.update();this.stage.postUpdate();this.plugins.postUpdate()}else{this.scale.pauseUpdate();this.state.pauseUpdate();this.debug.preUpdate()}this.stage.updateTransform()},updateRender:function(t){if(this.lockRender){return}this.state.preRender(t);if(this.renderType!==r.HEADLESS){this.renderer.render(this.stage);this.plugins.render(t);this.state.render(t)}this.plugins.postRender(t)},enableStep:function(){this.stepping=true;this.pendingStep=false;this.stepCount=0},disableStep:function(){this.stepping=false;this.pendingStep=false},step:function(){this.pendingStep=false;this.stepCount++},destroy:function(){this.raf.stop();this.state.destroy();this.sound.destroy();this.scale.destroy();this.stage.destroy();this.input.destroy();this.physics.destroy();this.plugins.destroy();this.state=null;this.sound=null;this.scale=null;this.stage=null;this.input=null;this.physics=null;this.plugins=null;this.cache=null;this.load=null;this.time=null;this.world=null;this.isBooted=false;this.renderer.destroy(false);r.Canvas.removeFromDOM(this.canvas);PIXI.defaultRenderer=null;r.GAMES[this.id]=null},gamePaused:function(t){if(!this._paused){this._paused=true;this.time.gamePaused();if(this.sound.muteOnPause){this.sound.setMute()}this.onPause.dispatch(t);if(this.device.cordova&&this.device.iOS){this.lockRender=true}}},gameResumed:function(t){if(this._paused&&!this._codePaused){this._paused=false;this.time.gameResumed();this.input.reset();if(this.sound.muteOnPause){this.sound.unsetMute()}this.onResume.dispatch(t);if(this.device.cordova&&this.device.iOS){this.lockRender=false}}},focusLoss:function(t){this.onBlur.dispatch(t);if(!this.stage.disableVisibilityChange){this.gamePaused(t)}},focusGain:function(t){this.onFocus.dispatch(t);if(!this.stage.disableVisibilityChange){this.gameResumed(t)}}};r.Game.prototype.constructor=r.Game;Object.defineProperty(r.Game.prototype,"paused",{get:function(){return this._paused},set:function(t){if(t===true){if(this._paused===false){this._paused=true;this.sound.setMute();this.time.gamePaused();this.onPause.dispatch(this)}this._codePaused=true}else{if(this._paused){this._paused=false;this.input.reset();this.sound.unsetMute();this.time.gameResumed();this.onResume.dispatch(this)}this._codePaused=false}}});r.Input=function(t){this.game=t;this.hitCanvas=null;this.hitContext=null;this.moveCallbacks=[];this.customCandidateHandler=null;this.customCandidateHandlerContext=null;this.pollRate=0;this.enabled=true;this.multiInputOverride=r.Input.MOUSE_TOUCH_COMBINE;this.position=null;this.speed=null;this.circle=null;this.scale=null;this.maxPointers=-1;this.tapRate=200;this.doubleTapRate=300;this.holdRate=2e3;this.justPressedRate=200;this.justReleasedRate=200;this.recordPointerHistory=false;this.recordRate=100;this.recordLimit=100;this.pointer1=null;this.pointer2=null;this.pointer3=null;this.pointer4=null;this.pointer5=null;this.pointer6=null;this.pointer7=null;this.pointer8=null;this.pointer9=null;this.pointer10=null;this.pointers=[];this.activePointer=null;this.mousePointer=null;this.mouse=null;this.keyboard=null;this.touch=null;this.mspointer=null;this.gamepad=null;this.resetLocked=false;this.onDown=null;this.onUp=null;this.onTap=null;this.onHold=null;this.minPriorityID=0;this.interactiveItems=new r.ArraySet;this._localPoint=new r.Point;this._pollCounter=0;this._oldPosition=null;this._x=0;this._y=0};r.Input.MOUSE_OVERRIDES_TOUCH=0;r.Input.TOUCH_OVERRIDES_MOUSE=1;r.Input.MOUSE_TOUCH_COMBINE=2;r.Input.MAX_POINTERS=10;r.Input.prototype={boot:function(){this.mousePointer=new r.Pointer(this.game,0,r.PointerMode.CURSOR);this.addPointer();this.addPointer();this.mouse=new r.Mouse(this.game);this.touch=new r.Touch(this.game);this.mspointer=new r.MSPointer(this.game);if(r.Keyboard){this.keyboard=new r.Keyboard(this.game)}if(r.Gamepad){this.gamepad=new r.Gamepad(this.game)}this.onDown=new r.Signal;this.onUp=new r.Signal;this.onTap=new r.Signal;this.onHold=new r.Signal;this.scale=new r.Point(1,1);this.speed=new r.Point;this.position=new r.Point;this._oldPosition=new r.Point;this.circle=new r.Circle(0,0,44);this.activePointer=this.mousePointer;this.hitCanvas=PIXI.CanvasPool.create(this,1,1);this.hitContext=this.hitCanvas.getContext("2d");this.mouse.start();this.touch.start();this.mspointer.start();this.mousePointer.active=true;if(this.keyboard){this.keyboard.start()}var t=this;this._onClickTrampoline=function(e){t.onClickTrampoline(e)};this.game.canvas.addEventListener("click",this._onClickTrampoline,false)},destroy:function(){this.mouse.stop();this.touch.stop();this.mspointer.stop();if(this.keyboard){this.keyboard.stop()}if(this.gamepad){this.gamepad.stop()}this.moveCallbacks=[];PIXI.CanvasPool.remove(this);this.game.canvas.removeEventListener("click",this._onClickTrampoline)},setInteractiveCandidateHandler:function(t,e){this.customCandidateHandler=t;this.customCandidateHandlerContext=e},addMoveCallback:function(t,e){this.moveCallbacks.push({callback:t,context:e})},deleteMoveCallback:function(t,e){var i=this.moveCallbacks.length;while(i--){if(this.moveCallbacks[i].callback===t&&this.moveCallbacks[i].context===e){this.moveCallbacks.splice(i,1);return}}},addPointer:function(){if(this.pointers.length>=r.Input.MAX_POINTERS){console.warn("Phaser.Input.addPointer: Maximum limit of "+r.Input.MAX_POINTERS+" pointers reached.");return null}var t=this.pointers.length+1;var e=new r.Pointer(this.game,t,r.PointerMode.TOUCH);this.pointers.push(e);this["pointer"+t]=e;return e},update:function(){if(this.keyboard){this.keyboard.update()}if(this.pollRate>0&&this._pollCounter<this.pollRate){this._pollCounter++;return}this.speed.x=this.position.x-this._oldPosition.x;this.speed.y=this.position.y-this._oldPosition.y;this._oldPosition.copyFrom(this.position);this.mousePointer.update();if(this.gamepad&&this.gamepad.active){this.gamepad.update()}for(var t=0;t<this.pointers.length;t++){this.pointers[t].update()}this._pollCounter=0},reset:function(t){if(!this.game.isBooted||this.resetLocked){return}if(t===undefined){t=false}this.mousePointer.reset();if(this.keyboard){this.keyboard.reset(t)}if(this.gamepad){this.gamepad.reset()}for(var e=0;e<this.pointers.length;e++){this.pointers[e].reset()}if(this.game.canvas.style.cursor!=="none"){this.game.canvas.style.cursor="inherit"}if(t){this.onDown.dispose();this.onUp.dispose();this.onTap.dispose();this.onHold.dispose();this.onDown=new r.Signal;this.onUp=new r.Signal;this.onTap=new r.Signal;this.onHold=new r.Signal;this.moveCallbacks=[]}this._pollCounter=0},resetSpeed:function(t,e){this._oldPosition.setTo(t,e);this.speed.setTo(0,0)},startPointer:function(t){if(this.maxPointers>=0&&this.countActivePointers(this.maxPointers)>=this.maxPointers){return null}if(!this.pointer1.active){return this.pointer1.start(t)}if(!this.pointer2.active){return this.pointer2.start(t)}for(var e=2;e<this.pointers.length;e++){var i=this.pointers[e];if(!i.active){return i.start(t)}}return null},updatePointer:function(t){if(this.pointer1.active&&this.pointer1.identifier===t.identifier){return this.pointer1.move(t)}if(this.pointer2.active&&this.pointer2.identifier===t.identifier){return this.pointer2.move(t)}for(var e=2;e<this.pointers.length;e++){var i=this.pointers[e];if(i.active&&i.identifier===t.identifier){return i.move(t)}}return null},stopPointer:function(t){if(this.pointer1.active&&this.pointer1.identifier===t.identifier){return this.pointer1.stop(t)}if(this.pointer2.active&&this.pointer2.identifier===t.identifier){return this.pointer2.stop(t)}for(var e=2;e<this.pointers.length;e++){var i=this.pointers[e];if(i.active&&i.identifier===t.identifier){return i.stop(t)}}return null},countActivePointers:function(t){if(t===undefined){t=this.pointers.length}var e=t;for(var i=0;i<this.pointers.length&&e>0;i++){var s=this.pointers[i];if(s.active){e--}}return t-e},getPointer:function(t){if(t===undefined){t=false}for(var e=0;e<this.pointers.length;e++){var i=this.pointers[e];if(i.active===t){return i}}return null},getPointerFromIdentifier:function(t){for(var e=0;e<this.pointers.length;e++){var i=this.pointers[e];if(i.identifier===t){return i}}return null},getPointerFromId:function(t){for(var e=0;e<this.pointers.length;e++){var i=this.pointers[e];if(i.pointerId===t){return i}}return null},getLocalPosition:function(t,e,i){if(i===undefined){i=new r.Point}var s=t.worldTransform;var n=1/(s.a*s.d+s.c*-s.b);return i.setTo(s.d*n*e.x+-s.c*n*e.y+(s.ty*s.c-s.tx*s.d)*n,s.a*n*e.y+-s.b*n*e.x+(-s.ty*s.a+s.tx*s.b)*n)},hitTest:function(t,e,i){if(!t.worldVisible){return false}this.getLocalPosition(t,e,this._localPoint);i.copyFrom(this._localPoint);if(t.hitArea&&t.hitArea.contains){return t.hitArea.contains(this._localPoint.x,this._localPoint.y)}else if(t instanceof r.TileSprite){var s=t.width;var n=t.height;var a=-s*t.anchor.x;if(this._localPoint.x>=a&&this._localPoint.x<a+s){var o=-n*t.anchor.y;if(this._localPoint.y>=o&&this._localPoint.y<o+n){return true}}}else if(t instanceof PIXI.Sprite){var s=t.texture.frame.width;var n=t.texture.frame.height;var a=-s*t.anchor.x;if(this._localPoint.x>=a&&this._localPoint.x<a+s){var o=-n*t.anchor.y;if(this._localPoint.y>=o&&this._localPoint.y<o+n){return true}}}else if(t instanceof r.Graphics){for(var h=0;h<t.graphicsData.length;h++){var l=t.graphicsData[h];if(!l.fill){continue}if(l.shape&&l.shape.contains(this._localPoint.x,this._localPoint.y)){return true}}}for(var h=0;h<t.children.length;h++){if(this.hitTest(t.children[h],e,i)){return true}}return false},onClickTrampoline:function(){this.activePointer.processClickTrampolines()}};r.Input.prototype.constructor=r.Input;Object.defineProperty(r.Input.prototype,"x",{get:function(){return this._x},set:function(t){this._x=Math.floor(t)}});Object.defineProperty(r.Input.prototype,"y",{get:function(){return this._y},set:function(t){this._y=Math.floor(t)}});Object.defineProperty(r.Input.prototype,"pollLocked",{get:function(){return this.pollRate>0&&this._pollCounter<this.pollRate}});Object.defineProperty(r.Input.prototype,"totalInactivePointers",{get:function(){return this.pointers.length-this.countActivePointers()}});Object.defineProperty(r.Input.prototype,"totalActivePointers",{get:function(){return this.countActivePointers()}});Object.defineProperty(r.Input.prototype,"worldX",{get:function(){return this.game.camera.view.x+this.x}});Object.defineProperty(r.Input.prototype,"worldY",{get:function(){return this.game.camera.view.y+this.y}});r.Mouse=function(t){this.game=t;this.input=t.input;this.callbackContext=this.game;this.mouseDownCallback=null;this.mouseUpCallback=null;this.mouseOutCallback=null;this.mouseOverCallback=null;this.mouseWheelCallback=null;this.capture=false;this.button=-1;this.wheelDelta=0;this.enabled=true;this.locked=false;this.stopOnGameOut=false;this.pointerLock=new r.Signal;this.event=null;this._onMouseDown=null;this._onMouseMove=null;this._onMouseUp=null;this._onMouseOut=null;this._onMouseOver=null;this._onMouseWheel=null;this._wheelEvent=null};r.Mouse.NO_BUTTON=-1;r.Mouse.LEFT_BUTTON=0;r.Mouse.MIDDLE_BUTTON=1;r.Mouse.RIGHT_BUTTON=2;r.Mouse.BACK_BUTTON=3;r.Mouse.FORWARD_BUTTON=4;r.Mouse.WHEEL_UP=1;r.Mouse.WHEEL_DOWN=-1;r.Mouse.prototype={start:function(){if(this.game.device.android&&this.game.device.chrome===false){return}if(this._onMouseDown!==null){return}var t=this;this._onMouseDown=function(e){return t.onMouseDown(e)};this._onMouseMove=function(e){return t.onMouseMove(e)};this._onMouseUp=function(e){return t.onMouseUp(e)};this._onMouseUpGlobal=function(e){return t.onMouseUpGlobal(e)};this._onMouseOutGlobal=function(e){return t.onMouseOutGlobal(e)};this._onMouseOut=function(e){return t.onMouseOut(e)};this._onMouseOver=function(e){return t.onMouseOver(e)};this._onMouseWheel=function(e){return t.onMouseWheel(e)};var e=this.game.canvas;e.addEventListener("mousedown",this._onMouseDown,true);e.addEventListener("mousemove",this._onMouseMove,true);e.addEventListener("mouseup",this._onMouseUp,true);if(!this.game.device.cocoonJS){window.addEventListener("mouseup",this._onMouseUpGlobal,true);window.addEventListener("mouseout",this._onMouseOutGlobal,true);e.addEventListener("mouseover",this._onMouseOver,true);e.addEventListener("mouseout",this._onMouseOut,true)}var i=this.game.device.wheelEvent;if(i){e.addEventListener(i,this._onMouseWheel,true);if(i==="mousewheel"){this._wheelEvent=new a(-1/40,1)}else if(i==="DOMMouseScroll"){this._wheelEvent=new a(1,1)}}},onMouseDown:function(t){this.event=t;if(this.capture){t.preventDefault()}if(this.mouseDownCallback){this.mouseDownCallback.call(this.callbackContext,t)}if(!this.input.enabled||!this.enabled){return}t["identifier"]=0;this.input.mousePointer.start(t)},onMouseMove:function(t){this.event=t;if(this.capture){t.preventDefault()}if(this.mouseMoveCallback){this.mouseMoveCallback.call(this.callbackContext,t)}if(!this.input.enabled||!this.enabled){return}t["identifier"]=0;this.input.mousePointer.move(t)},onMouseUp:function(t){this.event=t;if(this.capture){t.preventDefault()}if(this.mouseUpCallback){this.mouseUpCallback.call(this.callbackContext,t)}if(!this.input.enabled||!this.enabled){return}t["identifier"]=0;this.input.mousePointer.stop(t)},onMouseUpGlobal:function(t){if(!this.input.mousePointer.withinGame){if(this.mouseUpCallback){this.mouseUpCallback.call(this.callbackContext,t)}t["identifier"]=0;this.input.mousePointer.stop(t)}},onMouseOutGlobal:function(t){this.event=t;if(this.capture){t.preventDefault()}this.input.mousePointer.withinGame=false;if(!this.input.enabled||!this.enabled){return}this.input.mousePointer.stop(t);this.input.mousePointer.leftButton.stop(t);this.input.mousePointer.rightButton.stop(t)},onMouseOut:function(t){this.event=t;if(this.capture){t.preventDefault()}this.input.mousePointer.withinGame=false;if(this.mouseOutCallback){this.mouseOutCallback.call(this.callbackContext,t)}if(!this.input.enabled||!this.enabled){return}if(this.stopOnGameOut){t["identifier"]=0;this.input.mousePointer.stop(t)}},onMouseOver:function(t){this.event=t;if(this.capture){t.preventDefault()}this.input.mousePointer.withinGame=true;if(this.mouseOverCallback){this.mouseOverCallback.call(this.callbackContext,t)}},onMouseWheel:function(t){if(this._wheelEvent){t=this._wheelEvent.bindEvent(t)}this.event=t;if(this.capture){t.preventDefault()}this.wheelDelta=r.Math.clamp(-t.deltaY,-1,1);if(this.mouseWheelCallback){this.mouseWheelCallback.call(this.callbackContext,t)}},requestPointerLock:function(){if(this.game.device.pointerLock){var t=this.game.canvas;t.requestPointerLock=t.requestPointerLock||t.mozRequestPointerLock||t.webkitRequestPointerLock;t.requestPointerLock();var e=this;this._pointerLockChange=function(t){return e.pointerLockChange(t)};document.addEventListener("pointerlockchange",this._pointerLockChange,true);document.addEventListener("mozpointerlockchange",this._pointerLockChange,true);document.addEventListener("webkitpointerlockchange",this._pointerLockChange,true)}},pointerLockChange:function(t){var e=this.game.canvas;if(document.pointerLockElement===e||document.mozPointerLockElement===e||document.webkitPointerLockElement===e){this.locked=true;this.pointerLock.dispatch(true,t)}else{this.locked=false;this.pointerLock.dispatch(false,t)}},releasePointerLock:function(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock;document.exitPointerLock();document.removeEventListener("pointerlockchange",this._pointerLockChange,true);document.removeEventListener("mozpointerlockchange",this._pointerLockChange,true);document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,true)},stop:function(){var t=this.game.canvas;t.removeEventListener("mousedown",this._onMouseDown,true);t.removeEventListener("mousemove",this._onMouseMove,true);t.removeEventListener("mouseup",this._onMouseUp,true);t.removeEventListener("mouseover",this._onMouseOver,true);t.removeEventListener("mouseout",this._onMouseOut,true);var e=this.game.device.wheelEvent;if(e){t.removeEventListener(e,this._onMouseWheel,true)}window.removeEventListener("mouseup",this._onMouseUpGlobal,true);window.removeEventListener("mouseout",this._onMouseOutGlobal,true);document.removeEventListener("pointerlockchange",this._pointerLockChange,true);document.removeEventListener("mozpointerlockchange",this._pointerLockChange,true);document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,true)}};r.Mouse.prototype.constructor=r.Mouse;function a(t,e){this._scaleFactor=t;this._deltaMode=e;this.originalEvent=null}a.prototype={};a.prototype.constructor=a;a.prototype.bindEvent=function(t){if(!a._stubsGenerated&&t){var e=function(t){return function(){var e=this.originalEvent[t];return typeof e!=="function"?e:e.bind(this.originalEvent)}};for(var i in t){if(!(i in a.prototype)){Object.defineProperty(a.prototype,i,{get:e(i)})}}a._stubsGenerated=true}this.originalEvent=t;return this};Object.defineProperties(a.prototype,{type:{value:"wheel"},deltaMode:{get:function(){return this._deltaMode}},deltaY:{get:function(){return this._scaleFactor*(this.originalEvent.wheelDelta||this.originalEvent.detail)||0}},deltaX:{get:function(){return this._scaleFactor*this.originalEvent.wheelDeltaX||0}},deltaZ:{value:0}});r.MSPointer=function(t){this.game=t;this.input=t.input;this.callbackContext=this.game;this.pointerDownCallback=null;this.pointerMoveCallback=null;this.pointerUpCallback=null;this.capture=true;this.button=-1;this.event=null;this.enabled=true;this._onMSPointerDown=null;this._onMSPointerMove=null;this._onMSPointerUp=null;this._onMSPointerUpGlobal=null;this._onMSPointerOut=null;this._onMSPointerOver=null};r.MSPointer.prototype={start:function(){if(this._onMSPointerDown!==null){return}var t=this;if(this.game.device.mspointer){this._onMSPointerDown=function(e){return t.onPointerDown(e)};this._onMSPointerMove=function(e){return t.onPointerMove(e)};this._onMSPointerUp=function(e){return t.onPointerUp(e)};this._onMSPointerUpGlobal=function(e){return t.onPointerUpGlobal(e)};this._onMSPointerOut=function(e){return t.onPointerOut(e)};this._onMSPointerOver=function(e){return t.onPointerOver(e)};var e=this.game.canvas;e.addEventListener("MSPointerDown",this._onMSPointerDown,false);e.addEventListener("MSPointerMove",this._onMSPointerMove,false);e.addEventListener("MSPointerUp",this._onMSPointerUp,false);e.addEventListener("pointerdown",this._onMSPointerDown,false);e.addEventListener("pointermove",this._onMSPointerMove,false);e.addEventListener("pointerup",this._onMSPointerUp,false);e.style["-ms-content-zooming"]="none";e.style["-ms-touch-action"]="none";if(!this.game.device.cocoonJS){window.addEventListener("MSPointerUp",this._onMSPointerUpGlobal,true);e.addEventListener("MSPointerOver",this._onMSPointerOver,true);e.addEventListener("MSPointerOut",this._onMSPointerOut,true);window.addEventListener("pointerup",this._onMSPointerUpGlobal,true);e.addEventListener("pointerover",this._onMSPointerOver,true);e.addEventListener("pointerout",this._onMSPointerOut,true)}}},onPointerDown:function(t){this.event=t;if(this.capture){t.preventDefault()}if(this.pointerDownCallback){this.pointerDownCallback.call(this.callbackContext,t)}if(!this.input.enabled||!this.enabled){return}t.identifier=t.pointerId;if(t.pointerType==="mouse"||t.pointerType===4){this.input.mousePointer.start(t)}else{this.input.startPointer(t)}},onPointerMove:function(t){this.event=t;if(this.capture){t.preventDefault()}if(this.pointerMoveCallback){this.pointerMoveCallback.call(this.callbackContext,t)}if(!this.input.enabled||!this.enabled){return}t.identifier=t.pointerId;if(t.pointerType==="mouse"||t.pointerType===4){this.input.mousePointer.move(t)}else{this.input.updatePointer(t)}},onPointerUp:function(t){this.event=t;if(this.capture){t.preventDefault()}if(this.pointerUpCallback){this.pointerUpCallback.call(this.callbackContext,t)}if(!this.input.enabled||!this.enabled){return}t.identifier=t.pointerId;if(t.pointerType==="mouse"||t.pointerType===4){this.input.mousePointer.stop(t)}else{this.input.stopPointer(t)}},onPointerUpGlobal:function(t){if((t.pointerType==="mouse"||t.pointerType===4)&&!this.input.mousePointer.withinGame){this.onPointerUp(t)}else{var e=this.input.getPointerFromIdentifier(t.identifier);if(e&&e.withinGame){this.onPointerUp(t)}}},onPointerOut:function(t){this.event=t;if(this.capture){t.preventDefault()}if(t.pointerType==="mouse"||t.pointerType===4){this.input.mousePointer.withinGame=false}else{var e=this.input.getPointerFromIdentifier(t.identifier);if(e){e.withinGame=false}}if(this.input.mouse.mouseOutCallback){this.input.mouse.mouseOutCallback.call(this.input.mouse.callbackContext,t)}if(!this.input.enabled||!this.enabled){return}if(this.input.mouse.stopOnGameOut){t["identifier"]=0;if(e){e.stop(t)}else{this.input.mousePointer.stop(t)}}},onPointerOver:function(t){this.event=t;if(this.capture){t.preventDefault()}if(t.pointerType==="mouse"||t.pointerType===4){this.input.mousePointer.withinGame=true}else{var e=this.input.getPointerFromIdentifier(t.identifier);if(e){e.withinGame=true}}if(this.input.mouse.mouseOverCallback){this.input.mouse.mouseOverCallback.call(this.input.mouse.callbackContext,t)}},stop:function(){var t=this.game.canvas;t.removeEventListener("MSPointerDown",this._onMSPointerDown,false);t.removeEventListener("MSPointerMove",this._onMSPointerMove,false);t.removeEventListener("MSPointerUp",this._onMSPointerUp,false);t.removeEventListener("pointerdown",this._onMSPointerDown,false);t.removeEventListener("pointermove",this._onMSPointerMove,false);t.removeEventListener("pointerup",this._onMSPointerUp,false);window.removeEventListener("MSPointerUp",this._onMSPointerUpGlobal,true);t.removeEventListener("MSPointerOver",this._onMSPointerOver,true);t.removeEventListener("MSPointerOut",this._onMSPointerOut,true);window.removeEventListener("pointerup",this._onMSPointerUpGlobal,true);t.removeEventListener("pointerover",this._onMSPointerOver,true);t.removeEventListener("pointerout",this._onMSPointerOut,true)}};r.MSPointer.prototype.constructor=r.MSPointer;r.DeviceButton=function(t,e){this.parent=t;this.game=t.game;this.event=null;this.isDown=false;this.isUp=true;this.timeDown=0;this.timeUp=0;this.repeats=0;this.altKey=false;this.shiftKey=false;this.ctrlKey=false;this.value=0;this.buttonCode=e;this.onDown=new r.Signal;this.onUp=new r.Signal;this.onFloat=new r.Signal};r.DeviceButton.prototype={start:function(t,e){if(this.isDown){return}this.isDown=true;this.isUp=false;this.timeDown=this.game.time.time;this.repeats=0;this.event=t;this.value=e;if(t){this.altKey=t.altKey;this.shiftKey=t.shiftKey;this.ctrlKey=t.ctrlKey}this.onDown.dispatch(this,e)},stop:function(t,e){if(this.isUp){return}this.isDown=false;this.isUp=true;this.timeUp=this.game.time.time;this.event=t;this.value=e;if(t){this.altKey=t.altKey;this.shiftKey=t.shiftKey;this.ctrlKey=t.ctrlKey}this.onUp.dispatch(this,e)},padFloat:function(t){this.value=t;this.onFloat.dispatch(this,t)},justPressed:function(t){t=t||250;return this.isDown&&this.timeDown+t>this.game.time.time},justReleased:function(t){t=t||250;return this.isUp&&this.timeUp+t>this.game.time.time},reset:function(){this.isDown=false;this.isUp=true;this.timeDown=this.game.time.time;this.repeats=0;this.altKey=false;this.shiftKey=false;this.ctrlKey=false},destroy:function(){this.onDown.dispose();this.onUp.dispose();this.onFloat.dispose();this.parent=null;this.game=null}};r.DeviceButton.prototype.constructor=r.DeviceButton;Object.defineProperty(r.DeviceButton.prototype,"duration",{get:function(){if(this.isUp){return-1}return this.game.time.time-this.timeDown}});r.Pointer=function(t,e,i){this.game=t;this.id=e;this.type=r.POINTER;this.exists=true;this.identifier=0;this.pointerId=null;this.pointerMode=i||r.PointerMode.CURSOR|r.PointerMode.CONTACT;this.target=null;this.button=null;this.leftButton=new r.DeviceButton(this,r.Pointer.LEFT_BUTTON);this.middleButton=new r.DeviceButton(this,r.Pointer.MIDDLE_BUTTON);this.rightButton=new r.DeviceButton(this,r.Pointer.RIGHT_BUTTON);this.backButton=new r.DeviceButton(this,r.Pointer.BACK_BUTTON);this.forwardButton=new r.DeviceButton(this,r.Pointer.FORWARD_BUTTON);this.eraserButton=new r.DeviceButton(this,r.Pointer.ERASER_BUTTON);this._holdSent=false;this._history=[];this._nextDrop=0;this._stateReset=false;this.withinGame=false;this.clientX=-1;this.clientY=-1;this.pageX=-1;this.pageY=-1;this.screenX=-1;this.screenY=-1;this.rawMovementX=0;this.rawMovementY=0;this.movementX=0;this.movementY=0;this.x=-1;this.y=-1;this.isMouse=e===0;this.isDown=false;this.isUp=true;this.timeDown=0;this.timeUp=0;this.previousTapTime=0;this.totalTouches=0;this.msSinceLastClick=Number.MAX_VALUE;this.targetObject=null;this.interactiveCandidates=[];this.active=false;this.dirty=false;this.position=new r.Point;this.positionDown=new r.Point;this.positionUp=new r.Point;this.circle=new r.Circle(0,0,44);this._clickTrampolines=null;this._trampolineTargetObject=null};r.Pointer.NO_BUTTON=0;r.Pointer.LEFT_BUTTON=1;r.Pointer.RIGHT_BUTTON=2;r.Pointer.MIDDLE_BUTTON=4;r.Pointer.BACK_BUTTON=8;r.Pointer.FORWARD_BUTTON=16;r.Pointer.ERASER_BUTTON=32;r.Pointer.prototype={resetButtons:function(){this.isDown=false;this.isUp=true;if(this.isMouse){this.leftButton.reset();this.middleButton.reset();this.rightButton.reset();this.backButton.reset();this.forwardButton.reset();this.eraserButton.reset()}},processButtonsDown:function(t,e){if(r.Pointer.LEFT_BUTTON&t){this.leftButton.start(e)}if(r.Pointer.RIGHT_BUTTON&t){this.rightButton.start(e)}if(r.Pointer.MIDDLE_BUTTON&t){this.middleButton.start(e)}if(r.Pointer.BACK_BUTTON&t){this.backButton.start(e)}if(r.Pointer.FORWARD_BUTTON&t){this.forwardButton.start(e)}if(r.Pointer.ERASER_BUTTON&t){this.eraserButton.start(e)}},processButtonsUp:function(t,e){if(t===r.Mouse.LEFT_BUTTON){this.leftButton.stop(e)}if(t===r.Mouse.RIGHT_BUTTON){this.rightButton.stop(e)}if(t===r.Mouse.MIDDLE_BUTTON){this.middleButton.stop(e)}if(t===r.Mouse.BACK_BUTTON){this.backButton.stop(e)}if(t===r.Mouse.FORWARD_BUTTON){this.forwardButton.stop(e)}if(t===5){this.eraserButton.stop(e)}},updateButtons:function(t){this.button=t.button;var e=t.type.toLowerCase().substr(-4)==="down";if(t.buttons!==undefined){if(e){this.processButtonsDown(t.buttons,t)}else{this.processButtonsUp(t.button,t)}}else{if(e){this.leftButton.start(t)}else{this.leftButton.stop(t);this.rightButton.stop(t)}}if(t.buttons===1&&t.ctrlKey&&this.leftButton.isDown){this.leftButton.stop(t);this.rightButton.start(t)}this.isUp=true;this.isDown=false;if(this.leftButton.isDown||this.rightButton.isDown||this.middleButton.isDown||this.backButton.isDown||this.forwardButton.isDown||this.eraserButton.isDown){this.isUp=false;this.isDown=true}},start:function(t){var e=this.game.input;if(t["pointerId"]){this.pointerId=t.pointerId}this.identifier=t.identifier;this.target=t.target;if(this.isMouse){this.updateButtons(t)}else{this.isDown=true;this.isUp=false}this.active=true;this.withinGame=true;this.dirty=false;this._history=[];this._clickTrampolines=null;this._trampolineTargetObject=null;this.msSinceLastClick=this.game.time.time-this.timeDown;this.timeDown=this.game.time.time;this._holdSent=false;this.move(t,true);this.positionDown.setTo(this.x,this.y);if(e.multiInputOverride===r.Input.MOUSE_OVERRIDES_TOUCH||e.multiInputOverride===r.Input.MOUSE_TOUCH_COMBINE||e.multiInputOverride===r.Input.TOUCH_OVERRIDES_MOUSE&&e.totalActivePointers===0){e.x=this.x;e.y=this.y;e.position.setTo(this.x,this.y);e.onDown.dispatch(this,t);e.resetSpeed(this.x,this.y)}this._stateReset=false;this.totalTouches++;if(this.targetObject!==null){this.targetObject._touchedHandler(this)}return this},update:function(){var t=this.game.input;if(this.active){if(this.dirty){if(t.interactiveItems.total>0){this.processInteractiveObjects(false)}this.dirty=false}if(this._holdSent===false&&this.duration>=t.holdRate){if(t.multiInputOverride===r.Input.MOUSE_OVERRIDES_TOUCH||t.multiInputOverride===r.Input.MOUSE_TOUCH_COMBINE||t.multiInputOverride===r.Input.TOUCH_OVERRIDES_MOUSE&&t.totalActivePointers===0){t.onHold.dispatch(this)}this._holdSent=true}if(t.recordPointerHistory&&this.game.time.time>=this._nextDrop){this._nextDrop=this.game.time.time+t.recordRate;this._history.push({x:this.position.x,y:this.position.y});if(this._history.length>t.recordLimit){this._history.shift()}}}},move:function(t,e){var i=this.game.input;if(i.pollLocked){return}if(e===undefined){e=false}if(t.button!==undefined){this.button=t.button}if(e&&this.isMouse){this.updateButtons(t)}this.clientX=t.clientX;this.clientY=t.clientY;this.pageX=t.pageX;this.pageY=t.pageY;this.screenX=t.screenX;this.screenY=t.screenY;if(this.isMouse&&i.mouse.locked&&!e){this.rawMovementX=t.movementX||t.mozMovementX||t.webkitMovementX||0;this.rawMovementY=t.movementY||t.mozMovementY||t.webkitMovementY||0;this.movementX+=this.rawMovementX;this.movementY+=this.rawMovementY}this.x=(this.pageX-this.game.scale.offset.x)*i.scale.x;this.y=(this.pageY-this.game.scale.offset.y)*i.scale.y;this.position.setTo(this.x,this.y);this.circle.x=this.x;this.circle.y=this.y;if(i.multiInputOverride===r.Input.MOUSE_OVERRIDES_TOUCH||i.multiInputOverride===r.Input.MOUSE_TOUCH_COMBINE||i.multiInputOverride===r.Input.TOUCH_OVERRIDES_MOUSE&&i.totalActivePointers===0){i.activePointer=this;i.x=this.x;i.y=this.y;i.position.setTo(i.x,i.y);i.circle.x=i.x;i.circle.y=i.y}this.withinGame=this.game.scale.bounds.contains(this.pageX,this.pageY);if(this.game.paused){return this}var s=i.moveCallbacks.length;while(s--){i.moveCallbacks[s].callback.call(i.moveCallbacks[s].context,this,this.x,this.y,e)}if(this.targetObject!==null&&this.targetObject.isDragged===true){if(this.targetObject.update(this)===false){this.targetObject=null}}else if(i.interactiveItems.total>0){this.processInteractiveObjects(e)}return this},processInteractiveObjects:function(t){var e=0;var i=-1;var s=null;var r=this.game.input.interactiveItems.first;this.interactiveCandidates=[];while(r){r.checked=false;if(r.validForInput(i,e,false)){r.checked=true;if(t&&r.checkPointerDown(this,true)||!t&&r.checkPointerOver(this,true)){e=r.sprite.renderOrderID;i=r.priorityID;s=r;this.interactiveCandidates.push(r)}}r=this.game.input.interactiveItems.next}r=this.game.input.interactiveItems.first;while(r){if(!r.checked&&r.validForInput(i,e,true)){if(t&&r.checkPointerDown(this,false)||!t&&r.checkPointerOver(this,false)){e=r.sprite.renderOrderID;i=r.priorityID;s=r;this.interactiveCandidates.push(r)}}r=this.game.input.interactiveItems.next}if(this.game.input.customCandidateHandler){s=this.game.input.customCandidateHandler.call(this.game.input.customCandidateHandlerContext,this,this.interactiveCandidates,s)}this.swapTarget(s,false);return this.targetObject!==null},swapTarget:function(t,e){if(e===undefined){e=false}if(t===null){if(this.targetObject){this.targetObject._pointerOutHandler(this,e);this.targetObject=null}}else{if(this.targetObject===null){this.targetObject=t;t._pointerOverHandler(this,e)}else{if(this.targetObject===t){if(t.update(this)===false){this.targetObject=null}}else{this.targetObject._pointerOutHandler(this,e);this.targetObject=t;this.targetObject._pointerOverHandler(this,e)}}}},leave:function(t){this.withinGame=false;this.move(t,false)},stop:function(t){var e=this.game.input;if(this._stateReset&&this.withinGame){t.preventDefault();return}this.timeUp=this.game.time.time;if(e.multiInputOverride===r.Input.MOUSE_OVERRIDES_TOUCH||e.multiInputOverride===r.Input.MOUSE_TOUCH_COMBINE||e.multiInputOverride===r.Input.TOUCH_OVERRIDES_MOUSE&&e.totalActivePointers===0){e.onUp.dispatch(this,t);if(this.duration>=0&&this.duration<=e.tapRate){if(this.timeUp-this.previousTapTime<e.doubleTapRate){e.onTap.dispatch(this,true)}else{e.onTap.dispatch(this,false)}this.previousTapTime=this.timeUp}}if(this.isMouse){this.updateButtons(t)}else{this.isDown=false;this.isUp=true}if(this.id>0){this.active=false}this.withinGame=this.game.scale.bounds.contains(t.pageX,t.pageY);this.pointerId=null;this.identifier=null;this.positionUp.setTo(this.x,this.y);if(this.isMouse===false){e.currentPointers--}e.interactiveItems.callAll("_releasedHandler",this);if(this._clickTrampolines){this._trampolineTargetObject=this.targetObject}this.targetObject=null;return this},justPressed:function(t){t=t||this.game.input.justPressedRate;return this.isDown===true&&this.timeDown+t>this.game.time.time},justReleased:function(t){t=t||this.game.input.justReleasedRate;return this.isUp&&this.timeUp+t>this.game.time.time},addClickTrampoline:function(t,e,i,s){if(!this.isDown){return}var r=this._clickTrampolines=this._clickTrampolines||[];for(var n=0;n<r.length;n++){if(r[n].name===t){r.splice(n,1);break}}r.push({name:t,targetObject:this.targetObject,callback:e,callbackContext:i,callbackArgs:s})},processClickTrampolines:function(){var t=this._clickTrampolines;if(!t){return}for(var e=0;e<t.length;e++){var i=t[e];if(i.targetObject===this._trampolineTargetObject){i.callback.apply(i.callbackContext,i.callbackArgs)}}this._clickTrampolines=null;this._trampolineTargetObject=null},reset:function(){if(this.isMouse===false){this.active=false}this.pointerId=null;this.identifier=null;this.dirty=false;this.totalTouches=0;this._holdSent=false;this._history.length=0;this._stateReset=true;this.resetButtons();if(this.targetObject){this.targetObject._releasedHandler(this)}this.targetObject=null},resetMovement:function(){this.movementX=0;this.movementY=0}};r.Pointer.prototype.constructor=r.Pointer;Object.defineProperty(r.Pointer.prototype,"duration",{get:function(){if(this.isUp){return-1}return this.game.time.time-this.timeDown}});Object.defineProperty(r.Pointer.prototype,"worldX",{get:function(){return this.game.world.camera.x+this.x}});Object.defineProperty(r.Pointer.prototype,"worldY",{get:function(){return this.game.world.camera.y+this.y}});r.PointerMode={CURSOR:1<<0,CONTACT:1<<1};r.Touch=function(t){this.game=t;this.enabled=true;this.touchLockCallbacks=[];this.callbackContext=this.game;this.touchStartCallback=null;this.touchMoveCallback=null;this.touchEndCallback=null;this.touchEnterCallback=null;this.touchLeaveCallback=null;this.touchCancelCallback=null;this.preventDefault=true;this.event=null;this._onTouchStart=null;this._onTouchMove=null;this._onTouchEnd=null;this._onTouchEnter=null;this._onTouchLeave=null;this._onTouchCancel=null;this._onTouchMove=null};r.Touch.prototype={start:function(){if(this._onTouchStart!==null){return}var t=this;if(this.game.device.touch){this._onTouchStart=function(e){return t.onTouchStart(e)};this._onTouchMove=function(e){return t.onTouchMove(e)};this._onTouchEnd=function(e){return t.onTouchEnd(e)};this._onTouchEnter=function(e){return t.onTouchEnter(e)};this._onTouchLeave=function(e){return t.onTouchLeave(e)};this._onTouchCancel=function(e){return t.onTouchCancel(e)};this.game.canvas.addEventListener("touchstart",this._onTouchStart,false);this.game.canvas.addEventListener("touchmove",this._onTouchMove,false);this.game.canvas.addEventListener("touchend",this._onTouchEnd,false);this.game.canvas.addEventListener("touchcancel",this._onTouchCancel,false);if(!this.game.device.cocoonJS){this.game.canvas.addEventListener("touchenter",this._onTouchEnter,false);this.game.canvas.addEventListener("touchleave",this._onTouchLeave,false)}}},consumeDocumentTouches:function(){this._documentTouchMove=function(t){t.preventDefault()};document.addEventListener("touchmove",this._documentTouchMove,false)},addTouchLockCallback:function(t,e,i){if(i===undefined){i=false}this.touchLockCallbacks.push({callback:t,context:e,onEnd:i})},removeTouchLockCallback:function(t,e){var i=this.touchLockCallbacks.length;while(i--){if(this.touchLockCallbacks[i].callback===t&&this.touchLockCallbacks[i].context===e){this.touchLockCallbacks.splice(i,1);return true}}return false},onTouchStart:function(t){var e=this.touchLockCallbacks.length;while(e--){var i=this.touchLockCallbacks[e];if(!i.onEnd&&i.callback.call(i.context,this,t)){this.touchLockCallbacks.splice(e,1)}}this.event=t;if(!this.game.input.enabled||!this.enabled){return}if(this.touchStartCallback){this.touchStartCallback.call(this.callbackContext,t)}if(this.preventDefault){t.preventDefault()}for(var e=0;e<t.changedTouches.length;e++){this.game.input.startPointer(t.changedTouches[e])}},onTouchCancel:function(t){this.event=t;if(this.touchCancelCallback){this.touchCancelCallback.call(this.callbackContext,t)}if(!this.game.input.enabled||!this.enabled){return}if(this.preventDefault){t.preventDefault()}for(var e=0;e<t.changedTouches.length;e++){this.game.input.stopPointer(t.changedTouches[e])}},onTouchEnter:function(t){this.event=t;if(this.touchEnterCallback){this.touchEnterCallback.call(this.callbackContext,t)}if(!this.game.input.enabled||!this.enabled){return}if(this.preventDefault){t.preventDefault()}},onTouchLeave:function(t){this.event=t;if(this.touchLeaveCallback){this.touchLeaveCallback.call(this.callbackContext,t)}if(this.preventDefault){t.preventDefault()}},onTouchMove:function(t){this.event=t;if(this.touchMoveCallback){this.touchMoveCallback.call(this.callbackContext,t)}if(this.preventDefault){t.preventDefault()}for(var e=0;e<t.changedTouches.length;e++){this.game.input.updatePointer(t.changedTouches[e])}},onTouchEnd:function(t){var e=this.touchLockCallbacks.length;while(e--){var i=this.touchLockCallbacks[e];if(i.onEnd&&i.callback.call(i.context,this,t)){this.touchLockCallbacks.splice(e,1)}}this.event=t;if(this.touchEndCallback){this.touchEndCallback.call(this.callbackContext,t)}if(this.preventDefault){t.preventDefault()}for(var e=0;e<t.changedTouches.length;e++){this.game.input.stopPointer(t.changedTouches[e])}},stop:function(){if(this.game.device.touch){this.game.canvas.removeEventListener("touchstart",this._onTouchStart);this.game.canvas.removeEventListener("touchmove",this._onTouchMove);this.game.canvas.removeEventListener("touchend",this._onTouchEnd);this.game.canvas.removeEventListener("touchenter",this._onTouchEnter);this.game.canvas.removeEventListener("touchleave",this._onTouchLeave);this.game.canvas.removeEventListener("touchcancel",this._onTouchCancel)}}};r.Touch.prototype.constructor=r.Touch;r.InputHandler=function(t){this.sprite=t;this.game=t.game;this.enabled=false;this.checked=false;this.priorityID=0;this.useHandCursor=false;this._setHandCursor=false;this.isDragged=false;this.allowHorizontalDrag=true;this.allowVerticalDrag=true;this.bringToTop=false;this.snapOffset=null;this.snapOnDrag=false;this.snapOnRelease=false;this.snapX=0;this.snapY=0;this.snapOffsetX=0;this.snapOffsetY=0;this.pixelPerfectOver=false;this.pixelPerfectClick=false;this.pixelPerfectAlpha=255;this.draggable=false;this.boundsRect=null;this.boundsSprite=null;this.scaleLayer=false;this.dragOffset=new r.Point;this.dragFromCenter=false;this.dragStopBlocksInputUp=false;this.dragStartPoint=new r.Point;this.dragDistanceThreshold=0;this.dragTimeThreshold=0;this.downPoint=new r.Point;this.snapPoint=new r.Point;this._dragPoint=new r.Point;this._dragPhase=false;this._pendingDrag=false;this._dragTimePass=false;this._dragDistancePass=false;this._wasEnabled=false;this._tempPoint=new r.Point;this._pointerData=[];this._pointerData.push({id:0,x:0,y:0,camX:0,camY:0,isDown:false,isUp:false,isOver:false,isOut:false,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:false})};r.InputHandler.prototype={start:function(t,e){t=t||0;if(e===undefined){e=false}if(this.enabled===false){this.game.input.interactiveItems.add(this);this.useHandCursor=e;this.priorityID=t;for(var i=0;i<10;i++){this._pointerData[i]={id:i,x:0,y:0,isDown:false,isUp:false,isOver:false,isOut:false,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:false}}this.snapOffset=new r.Point;this.enabled=true;this._wasEnabled=true}this.sprite.events.onAddedToGroup.add(this.addedToGroup,this);this.sprite.events.onRemovedFromGroup.add(this.removedFromGroup,this);return this.sprite},addedToGroup:function(){if(this._dragPhase){return}if(this._wasEnabled&&!this.enabled){this.start()}},removedFromGroup:function(){if(this._dragPhase){return}if(this.enabled){this._wasEnabled=true;this.stop()}else{this._wasEnabled=false}},reset:function(){this.enabled=false;for(var t=0;t<10;t++){this._pointerData[t]={id:t,x:0,y:0,isDown:false,isUp:false,isOver:false,isOut:false,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:false}}},stop:function(){if(this.enabled===false){return}else{this.enabled=false;this.game.input.interactiveItems.remove(this)}},destroy:function(){if(this.sprite){if(this._setHandCursor){this.game.canvas.style.cursor="default";this._setHandCursor=false}this.enabled=false;this.game.input.interactiveItems.remove(this);this._pointerData.length=0;this.boundsRect=null;this.boundsSprite=null;this.sprite=null}},validForInput:function(t,e,i){if(i===undefined){i=true}if(!this.enabled||this.sprite.scale.x===0||this.sprite.scale.y===0||this.priorityID<this.game.input.minPriorityID||this.sprite.parent&&this.sprite.parent.ignoreChildInput){return false}if(!i&&(this.pixelPerfectClick||this.pixelPerfectOver)){return false}if(this.priorityID>t||this.priorityID===t&&this.sprite.renderOrderID>e){return true}return false},isPixelPerfect:function(){return this.pixelPerfectClick||this.pixelPerfectOver},pointerX:function(t){t=t||0;return this._pointerData[t].x},pointerY:function(t){t=t||0;return this._pointerData[t].y},pointerDown:function(t){t=t||0;return this._pointerData[t].isDown},pointerUp:function(t){t=t||0;return this._pointerData[t].isUp},pointerTimeDown:function(t){t=t||0;return this._pointerData[t].timeDown},pointerTimeUp:function(t){t=t||0;return this._pointerData[t].timeUp},pointerOver:function(t){if(!this.enabled){return false}if(t===undefined){for(var e=0;e<10;e++){if(this._pointerData[e].isOver){return true}}return false}else{return this._pointerData[t].isOver}},pointerOut:function(t){if(!this.enabled){return false}if(t===undefined){for(var e=0;e<10;e++){if(this._pointerData[e].isOut){return true}}}else{return this._pointerData[t].isOut}},pointerTimeOver:function(t){t=t||0;return this._pointerData[t].timeOver},pointerTimeOut:function(t){t=t||0;return this._pointerData[t].timeOut},pointerDragged:function(t){t=t||0;return this._pointerData[t].isDragged},checkPointerDown:function(t,e){if(!t.isDown||!this.enabled||!this.sprite||!this.sprite.parent||!this.sprite.visible||!this.sprite.parent.visible||this.sprite.worldScale.x===0||this.sprite.worldScale.y===0){return false}if(this.game.input.hitTest(this.sprite,t,this._tempPoint)){if(e===undefined){e=false}if(!e&&this.pixelPerfectClick){return this.checkPixel(this._tempPoint.x,this._tempPoint.y)}else{return true}}return false},checkPointerOver:function(t,e){if(!this.enabled||!this.sprite||!this.sprite.parent||!this.sprite.visible||!this.sprite.parent.visible||this.sprite.worldScale.x===0||this.sprite.worldScale.y===0){return false}if(this.game.input.hitTest(this.sprite,t,this._tempPoint)){if(e===undefined){e=false}if(!e&&this.pixelPerfectOver){return this.checkPixel(this._tempPoint.x,this._tempPoint.y)}else{return true}}return false},checkPixel:function(t,e,i){if(this.sprite.texture.baseTexture.source){if(t===null&&e===null){this.game.input.getLocalPosition(this.sprite,i,this._tempPoint);var t=this._tempPoint.x;var e=this._tempPoint.y}if(this.sprite.anchor.x!==0){t-=-this.sprite.texture.frame.width*this.sprite.anchor.x}if(this.sprite.anchor.y!==0){e-=-this.sprite.texture.frame.height*this.sprite.anchor.y}t+=this.sprite.texture.frame.x;e+=this.sprite.texture.frame.y;if(this.sprite.texture.trim){t-=this.sprite.texture.trim.x;e-=this.sprite.texture.trim.y;if(t<this.sprite.texture.crop.x||t>this.sprite.texture.crop.right||e<this.sprite.texture.crop.y||e>this.sprite.texture.crop.bottom){this._dx=t;this._dy=e;return false}}this._dx=t;this._dy=e;this.game.input.hitContext.clearRect(0,0,1,1);this.game.input.hitContext.drawImage(this.sprite.texture.baseTexture.source,t,e,1,1,0,0,1,1);var s=this.game.input.hitContext.getImageData(0,0,1,1);if(s.data[3]>=this.pixelPerfectAlpha){return true}}return false},update:function(t){if(this.sprite===null||this.sprite.parent===undefined){return}if(!this.enabled||!this.sprite.visible||!this.sprite.parent.visible){this._pointerOutHandler(t);return false}if(this._pendingDrag){if(!this._dragDistancePass){this._dragDistancePass=r.Math.distance(t.x,t.y,this.downPoint.x,this.downPoint.y)>=this.dragDistanceThreshold}if(this._dragDistancePass&&this._dragTimePass){this.startDrag(t)}return true}else if(this.draggable&&this._draggedPointerID===t.id){return this.updateDrag(t,false)}else if(this._pointerData[t.id].isOver){if(this.checkPointerOver(t)){this._pointerData[t.id].x=t.x-this.sprite.x;this._pointerData[t.id].y=t.y-this.sprite.y;return true}else{this._pointerOutHandler(t);return false}}},_pointerOverHandler:function(t,e){if(this.sprite===null){return}var i=this._pointerData[t.id];if(i.isOver===false||t.dirty){var s=i.isOver===false;i.isOver=true;i.isOut=false;i.timeOver=this.game.time.time;i.x=t.x-this.sprite.x;i.y=t.y-this.sprite.y;if(this.useHandCursor&&i.isDragged===false){this.game.canvas.style.cursor="pointer";this._setHandCursor=true}if(!e&&s&&this.sprite&&this.sprite.events){this.sprite.events.onInputOver$dispatch(this.sprite,t)}if(this.sprite.parent&&this.sprite.parent.type===r.GROUP){this.sprite.parent.onChildInputOver.dispatch(this.sprite,t)}}},_pointerOutHandler:function(t,e){if(this.sprite===null){return}var i=this._pointerData[t.id];i.isOver=false;i.isOut=true;i.timeOut=this.game.time.time;if(this.useHandCursor&&i.isDragged===false){this.game.canvas.style.cursor="default";this._setHandCursor=false}if(!e&&this.sprite&&this.sprite.events){this.sprite.events.onInputOut$dispatch(this.sprite,t);if(this.sprite&&this.sprite.parent&&this.sprite.parent.type===r.GROUP){this.sprite.parent.onChildInputOut.dispatch(this.sprite,t)}}},_touchedHandler:function(t){if(this.sprite===null){return}var e=this._pointerData[t.id];if(!e.isDown&&e.isOver){if(this.pixelPerfectClick&&!this.checkPixel(null,null,t)){return}e.isDown=true;e.isUp=false;e.timeDown=this.game.time.time;this.downPoint.set(t.x,t.y);t.dirty=true;if(this.sprite&&this.sprite.events){this.sprite.events.onInputDown$dispatch(this.sprite,t);if(this.sprite&&this.sprite.parent&&this.sprite.parent.type===r.GROUP){this.sprite.parent.onChildInputDown.dispatch(this.sprite,t)}if(this.sprite===null){return}}if(this.draggable&&this.isDragged===false){if(this.dragTimeThreshold===0&&this.dragDistanceThreshold===0){this.startDrag(t)}else{this._pendingDrag=true;this._dragDistancePass=this.dragDistanceThreshold===0;if(this.dragTimeThreshold>0){this._dragTimePass=false;this.game.time.events.add(this.dragTimeThreshold,this.dragTimeElapsed,this,t)}else{this._dragTimePass=true}}}if(this.bringToTop){this.sprite.bringToTop()}}},dragTimeElapsed:function(t){this._dragTimePass=true;if(this._pendingDrag&&this.sprite){if(this._dragDistancePass){this.startDrag(t)}}},_releasedHandler:function(t){if(this.sprite===null){return}var e=this._pointerData[t.id];if(e.isDown&&t.isUp){e.isDown=false;e.isUp=true;e.timeUp=this.game.time.time;e.downDuration=e.timeUp-e.timeDown;var i=this.checkPointerOver(t);if(this.sprite&&this.sprite.events){if(!this.dragStopBlocksInputUp||this.dragStopBlocksInputUp&&!(this.draggable&&this.isDragged&&this._draggedPointerID===t.id)){this.sprite.events.onInputUp$dispatch(this.sprite,t,i)}if(this.sprite&&this.sprite.parent&&this.sprite.parent.type===r.GROUP){this.sprite.parent.onChildInputUp.dispatch(this.sprite,t,i)}if(i){i=this.checkPointerOver(t)}}e.isOver=i;if(!i&&this.useHandCursor){this.game.canvas.style.cursor="default";this._setHandCursor=false}t.dirty=true;this._pendingDrag=false;if(this.draggable&&this.isDragged&&this._draggedPointerID===t.id){this.stopDrag(t)}}},updateDrag:function(t,e){if(e===undefined){e=false}if(t.isUp){this.stopDrag(t);return false}var i=this.globalToLocalX(t.x)+this._dragPoint.x+this.dragOffset.x;var s=this.globalToLocalY(t.y)+this._dragPoint.y+this.dragOffset.y;if(this.sprite.fixedToCamera){if(this.allowHorizontalDrag){this.sprite.cameraOffset.x=i}if(this.allowVerticalDrag){this.sprite.cameraOffset.y=s}if(this.boundsRect){this.checkBoundsRect()}if(this.boundsSprite){this.checkBoundsSprite()}if(this.snapOnDrag){this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX;this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY;this.snapPoint.set(this.sprite.cameraOffset.x,this.sprite.cameraOffset.y)}}else{var r=this.game.camera.x-this._pointerData[t.id].camX;var n=this.game.camera.y-this._pointerData[t.id].camY;if(this.allowHorizontalDrag){this.sprite.x=i+r}if(this.allowVerticalDrag){this.sprite.y=s+n}if(this.boundsRect){this.checkBoundsRect()}if(this.boundsSprite){this.checkBoundsSprite()}if(this.snapOnDrag){this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX;this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY;this.snapPoint.set(this.sprite.x,this.sprite.y)}}this.sprite.events.onDragUpdate.dispatch(this.sprite,t,i,s,this.snapPoint,e);return true},justOver:function(t,e){t=t||0;e=e||500;return this._pointerData[t].isOver&&this.overDuration(t)<e},justOut:function(t,e){t=t||0;e=e||500;return this._pointerData[t].isOut&&this.game.time.time-this._pointerData[t].timeOut<e},justPressed:function(t,e){t=t||0;e=e||500;return this._pointerData[t].isDown&&this.downDuration(t)<e},justReleased:function(t,e){t=t||0;e=e||500;return this._pointerData[t].isUp&&this.game.time.time-this._pointerData[t].timeUp<e},overDuration:function(t){t=t||0;if(this._pointerData[t].isOver){return this.game.time.time-this._pointerData[t].timeOver}return-1},downDuration:function(t){t=t||0;if(this._pointerData[t].isDown){return this.game.time.time-this._pointerData[t].timeDown}return-1},enableDrag:function(t,e,i,s,n,a){if(t===undefined){t=false}if(e===undefined){e=false}if(i===undefined){i=false}if(s===undefined){s=255}if(n===undefined){n=null}if(a===undefined){a=null}this._dragPoint=new r.Point;this.draggable=true;this.bringToTop=e;this.dragOffset=new r.Point;this.dragFromCenter=t;this.pixelPerfectClick=i;this.pixelPerfectAlpha=s;if(n){this.boundsRect=n}if(a){this.boundsSprite=a}},disableDrag:function(){if(this._pointerData){for(var t=0;t<10;t++){this._pointerData[t].isDragged=false}}this.draggable=false;this.isDragged=false;this._draggedPointerID=-1;this._pendingDrag=false},startDrag:function(t){var e=this.sprite.x;var i=this.sprite.y;this.isDragged=true;this._draggedPointerID=t.id;this._pointerData[t.id].camX=this.game.camera.x;this._pointerData[t.id].camY=this.game.camera.y;this._pointerData[t.id].isDragged=true;if(this.sprite.fixedToCamera){if(this.dragFromCenter){var s=this.sprite.getBounds();this.sprite.cameraOffset.x=this.globalToLocalX(t.x)+(this.sprite.cameraOffset.x-s.centerX);this.sprite.cameraOffset.y=this.globalToLocalY(t.y)+(this.sprite.cameraOffset.y-s.centerY)}this._dragPoint.setTo(this.sprite.cameraOffset.x-t.x,this.sprite.cameraOffset.y-t.y)}else{if(this.dragFromCenter){var s=this.sprite.getBounds();this.sprite.x=this.globalToLocalX(t.x)+(this.sprite.x-s.centerX);this.sprite.y=this.globalToLocalY(t.y)+(this.sprite.y-s.centerY)}this._dragPoint.setTo(this.sprite.x-this.globalToLocalX(t.x),this.sprite.y-this.globalToLocalY(t.y))}this.updateDrag(t,true);if(this.bringToTop){this._dragPhase=true;this.sprite.bringToTop()}this.dragStartPoint.set(e,i);this.sprite.events.onDragStart$dispatch(this.sprite,t,e,i);this._pendingDrag=false},globalToLocalX:function(t){if(this.scaleLayer){t-=this.game.scale.grid.boundsFluid.x;t*=this.game.scale.grid.scaleFluidInversed.x}return t},globalToLocalY:function(t){if(this.scaleLayer){t-=this.game.scale.grid.boundsFluid.y;t*=this.game.scale.grid.scaleFluidInversed.y}return t},stopDrag:function(t){this.isDragged=false;this._draggedPointerID=-1;this._pointerData[t.id].isDragged=false;this._dragPhase=false;this._pendingDrag=false;if(this.snapOnRelease){if(this.sprite.fixedToCamera){this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX;this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY}else{this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX;this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY}}this.sprite.events.onDragStop$dispatch(this.sprite,t);if(this.checkPointerOver(t)===false){this._pointerOutHandler(t)}},setDragLock:function(t,e){if(t===undefined){t=true}if(e===undefined){e=true}this.allowHorizontalDrag=t;this.allowVerticalDrag=e},enableSnap:function(t,e,i,s,r,n){if(i===undefined){i=true}if(s===undefined){s=false}if(r===undefined){r=0}if(n===undefined){n=0}this.snapX=t;this.snapY=e;this.snapOffsetX=r;this.snapOffsetY=n;this.snapOnDrag=i;this.snapOnRelease=s},disableSnap:function(){this.snapOnDrag=false;this.snapOnRelease=false},checkBoundsRect:function(){if(this.sprite.fixedToCamera){if(this.sprite.cameraOffset.x<this.boundsRect.left){this.sprite.cameraOffset.x=this.boundsRect.left}else if(this.sprite.cameraOffset.x+this.sprite.width>this.boundsRect.right){this.sprite.cameraOffset.x=this.boundsRect.right-this.sprite.width}if(this.sprite.cameraOffset.y<this.boundsRect.top){this.sprite.cameraOffset.y=this.boundsRect.top}else if(this.sprite.cameraOffset.y+this.sprite.height>this.boundsRect.bottom){this.sprite.cameraOffset.y=this.boundsRect.bottom-this.sprite.height}}else{if(this.sprite.left<this.boundsRect.left){this.sprite.x=this.boundsRect.x+this.sprite.offsetX}else if(this.sprite.right>this.boundsRect.right){this.sprite.x=this.boundsRect.right-(this.sprite.width-this.sprite.offsetX)}if(this.sprite.top<this.boundsRect.top){this.sprite.y=this.boundsRect.top+this.sprite.offsetY}else if(this.sprite.bottom>this.boundsRect.bottom){this.sprite.y=this.boundsRect.bottom-(this.sprite.height-this.sprite.offsetY)}}},checkBoundsSprite:function(){if(this.sprite.fixedToCamera&&this.boundsSprite.fixedToCamera){if(this.sprite.cameraOffset.x<this.boundsSprite.cameraOffset.x){this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x}else if(this.sprite.cameraOffset.x+this.sprite.width>this.boundsSprite.cameraOffset.x+this.boundsSprite.width){this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x+this.boundsSprite.width-this.sprite.width}if(this.sprite.cameraOffset.y<this.boundsSprite.cameraOffset.y){this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y}else if(this.sprite.cameraOffset.y+this.sprite.height>this.boundsSprite.cameraOffset.y+this.boundsSprite.height){this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y+this.boundsSprite.height-this.sprite.height}}else{if(this.sprite.left<this.boundsSprite.left){this.sprite.x=this.boundsSprite.left+this.sprite.offsetX}else if(this.sprite.right>this.boundsSprite.right){this.sprite.x=this.boundsSprite.right-(this.sprite.width-this.sprite.offsetX)}if(this.sprite.top<this.boundsSprite.top){this.sprite.y=this.boundsSprite.top+this.sprite.offsetY}else if(this.sprite.bottom>this.boundsSprite.bottom){this.sprite.y=this.boundsSprite.bottom-(this.sprite.height-this.sprite.offsetY)}}}};r.InputHandler.prototype.constructor=r.InputHandler;r.Gamepad=function(t){this.game=t;this._gamepadIndexMap={};this._rawPads=[];this._active=false;this.enabled=true;this._gamepadSupportAvailable=!!navigator.webkitGetGamepads||!!navigator.webkitGamepads||navigator.userAgent.indexOf("Firefox/")!==-1||!!navigator.getGamepads;this._prevRawGamepadTypes=[];this._prevTimestamps=[];this.callbackContext=this;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null;this._ongamepadconnected=null;this._gamepaddisconnected=null;this._gamepads=[new r.SinglePad(t,this),new r.SinglePad(t,this),new r.SinglePad(t,this),new r.SinglePad(t,this)]};r.Gamepad.prototype={addCallbacks:function(t,e){if(typeof e!=="undefined"){this.onConnectCallback=typeof e.onConnect==="function"?e.onConnect:this.onConnectCallback;this.onDisconnectCallback=typeof e.onDisconnect==="function"?e.onDisconnect:this.onDisconnectCallback;this.onDownCallback=typeof e.onDown==="function"?e.onDown:this.onDownCallback;this.onUpCallback=typeof e.onUp==="function"?e.onUp:this.onUpCallback;this.onAxisCallback=typeof e.onAxis==="function"?e.onAxis:this.onAxisCallback;this.onFloatCallback=typeof e.onFloat==="function"?e.onFloat:this.onFloatCallback;this.callbackContext=t}},start:function(){if(this._active){return}this._active=true;var t=this;this._onGamepadConnected=function(e){return t.onGamepadConnected(e)};this._onGamepadDisconnected=function(e){return t.onGamepadDisconnected(e)};window.addEventListener("gamepadconnected",this._onGamepadConnected,false);window.addEventListener("gamepaddisconnected",this._onGamepadDisconnected,false)},onGamepadConnected:function(t){var e=t.gamepad;this._rawPads.push(e);this._gamepads[e.index].connect(e)},onGamepadDisconnected:function(t){var e=t.gamepad;for(var i in this._rawPads){if(this._rawPads[i].index===e.index){this._rawPads.splice(i,1)}}this._gamepads[e.index].disconnect()},update:function(){this._pollGamepads();this.pad1.pollStatus();this.pad2.pollStatus();this.pad3.pollStatus();this.pad4.pollStatus()},_pollGamepads:function(){if(!this._active){return}if(navigator["getGamepads"]){var t=navigator.getGamepads()}else if(navigator["webkitGetGamepads"]){var t=navigator.webkitGetGamepads()}else if(navigator["webkitGamepads"]){var t=navigator.webkitGamepads()}if(t){this._rawPads=[];var e=false;for(var i=0;i<t.length;i++){if(typeof t[i]!==this._prevRawGamepadTypes[i]){e=true;this._prevRawGamepadTypes[i]=typeof t[i]}if(t[i]){this._rawPads.push(t[i])}if(i===3){break}}for(var s=0;s<this._gamepads.length;s++){this._gamepads[s]._rawPad=this._rawPads[s]}if(e){var r={rawIndices:{},padIndices:{}};var n;for(var a=0;a<this._gamepads.length;a++){n=this._gamepads[a];if(n.connected){for(var o=0;o<this._rawPads.length;o++){if(this._rawPads[o].index===n.index){r.rawIndices[n.index]=true;r.padIndices[a]=true}}}}for(var h=0;h<this._gamepads.length;h++){n=this._gamepads[h];if(r.padIndices[h]){continue}if(this._rawPads.length<1){n.disconnect()}for(var l=0;l<this._rawPads.length;l++){if(r.padIndices[h]){break}var u=this._rawPads[l];if(u){if(r.rawIndices[u.index]){n.disconnect();continue}else{n.connect(u);r.rawIndices[u.index]=true;r.padIndices[h]=true}}else{n.disconnect()}}}}}},setDeadZones:function(t){for(var e=0;e<this._gamepads.length;e++){this._gamepads[e].deadZone=t}},stop:function(){this._active=false;window.removeEventListener("gamepadconnected",this._onGamepadConnected);window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnected)},reset:function(){this.update();for(var t=0;t<this._gamepads.length;t++){this._gamepads[t].reset()}},justPressed:function(t,e){for(var i=0;i<this._gamepads.length;i++){if(this._gamepads[i].justPressed(t,e)===true){return true}}return false},justReleased:function(t,e){for(var i=0;i<this._gamepads.length;i++){if(this._gamepads[i].justReleased(t,e)===true){return true}}return false},isDown:function(t){for(var e=0;e<this._gamepads.length;e++){if(this._gamepads[e].isDown(t)===true){return true}}return false},destroy:function(){this.stop();for(var t=0;t<this._gamepads.length;t++){this._gamepads[t].destroy()}}};r.Gamepad.prototype.constructor=r.Gamepad;Object.defineProperty(r.Gamepad.prototype,"active",{get:function(){return this._active}});Object.defineProperty(r.Gamepad.prototype,"supported",{get:function(){return this._gamepadSupportAvailable}});Object.defineProperty(r.Gamepad.prototype,"padsConnected",{get:function(){return this._rawPads.length}});Object.defineProperty(r.Gamepad.prototype,"pad1",{get:function(){return this._gamepads[0]}});Object.defineProperty(r.Gamepad.prototype,"pad2",{get:function(){return this._gamepads[1]}});Object.defineProperty(r.Gamepad.prototype,"pad3",{get:function(){return this._gamepads[2]}});Object.defineProperty(r.Gamepad.prototype,"pad4",{get:function(){return this._gamepads[3]}});r.Gamepad.BUTTON_0=0;r.Gamepad.BUTTON_1=1;r.Gamepad.BUTTON_2=2;r.Gamepad.BUTTON_3=3;r.Gamepad.BUTTON_4=4;r.Gamepad.BUTTON_5=5;r.Gamepad.BUTTON_6=6;r.Gamepad.BUTTON_7=7;r.Gamepad.BUTTON_8=8;r.Gamepad.BUTTON_9=9;r.Gamepad.BUTTON_10=10;r.Gamepad.BUTTON_11=11;r.Gamepad.BUTTON_12=12;r.Gamepad.BUTTON_13=13;r.Gamepad.BUTTON_14=14;r.Gamepad.BUTTON_15=15;r.Gamepad.AXIS_0=0;r.Gamepad.AXIS_1=1;r.Gamepad.AXIS_2=2;r.Gamepad.AXIS_3=3;r.Gamepad.AXIS_4=4;r.Gamepad.AXIS_5=5;r.Gamepad.AXIS_6=6;r.Gamepad.AXIS_7=7;r.Gamepad.AXIS_8=8;r.Gamepad.AXIS_9=9;r.Gamepad.XBOX360_A=0;r.Gamepad.XBOX360_B=1;r.Gamepad.XBOX360_X=2;r.Gamepad.XBOX360_Y=3;r.Gamepad.XBOX360_LEFT_BUMPER=4;r.Gamepad.XBOX360_RIGHT_BUMPER=5;r.Gamepad.XBOX360_LEFT_TRIGGER=6;r.Gamepad.XBOX360_RIGHT_TRIGGER=7;r.Gamepad.XBOX360_BACK=8;r.Gamepad.XBOX360_START=9;r.Gamepad.XBOX360_STICK_LEFT_BUTTON=10;r.Gamepad.XBOX360_STICK_RIGHT_BUTTON=11;r.Gamepad.XBOX360_DPAD_LEFT=14;r.Gamepad.XBOX360_DPAD_RIGHT=15;r.Gamepad.XBOX360_DPAD_UP=12;r.Gamepad.XBOX360_DPAD_DOWN=13;r.Gamepad.XBOX360_STICK_LEFT_X=0;r.Gamepad.XBOX360_STICK_LEFT_Y=1;r.Gamepad.XBOX360_STICK_RIGHT_X=2;r.Gamepad.XBOX360_STICK_RIGHT_Y=3;r.Gamepad.PS3XC_X=0;r.Gamepad.PS3XC_CIRCLE=1;r.Gamepad.PS3XC_SQUARE=2;r.Gamepad.PS3XC_TRIANGLE=3;r.Gamepad.PS3XC_L1=4;r.Gamepad.PS3XC_R1=5;r.Gamepad.PS3XC_L2=6;r.Gamepad.PS3XC_R2=7;r.Gamepad.PS3XC_SELECT=8;r.Gamepad.PS3XC_START=9;r.Gamepad.PS3XC_STICK_LEFT_BUTTON=10;r.Gamepad.PS3XC_STICK_RIGHT_BUTTON=11;r.Gamepad.PS3XC_DPAD_UP=12;r.Gamepad.PS3XC_DPAD_DOWN=13;r.Gamepad.PS3XC_DPAD_LEFT=14;r.Gamepad.PS3XC_DPAD_RIGHT=15;r.Gamepad.PS3XC_STICK_LEFT_X=0;r.Gamepad.PS3XC_STICK_LEFT_Y=1;r.Gamepad.PS3XC_STICK_RIGHT_X=2;r.Gamepad.PS3XC_STICK_RIGHT_Y=3;r.SinglePad=function(t,e){this.game=t;this.index=null;this.connected=false;this.callbackContext=this;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null;this.deadZone=.26;this._padParent=e;this._rawPad=null;this._prevTimestamp=null;this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0};r.SinglePad.prototype={addCallbacks:function(t,e){if(typeof e!=="undefined"){this.onConnectCallback=typeof e.onConnect==="function"?e.onConnect:this.onConnectCallback;this.onDisconnectCallback=typeof e.onDisconnect==="function"?e.onDisconnect:this.onDisconnectCallback;this.onDownCallback=typeof e.onDown==="function"?e.onDown:this.onDownCallback;this.onUpCallback=typeof e.onUp==="function"?e.onUp:this.onUpCallback;this.onAxisCallback=typeof e.onAxis==="function"?e.onAxis:this.onAxisCallback;this.onFloatCallback=typeof e.onFloat==="function"?e.onFloat:this.onFloatCallback;this.callbackContext=t}},getButton:function(t){if(this._buttons[t]){return this._buttons[t]}else{return null}},pollStatus:function(){if(!this.connected||!this.game.input.enabled||!this.game.input.gamepad.enabled||this._rawPad.timestamp&&this._rawPad.timestamp===this._prevTimestamp){return}for(var t=0;t<this._buttonsLen;t++){var e=isNaN(this._rawPad.buttons[t])?this._rawPad.buttons[t].value:this._rawPad.buttons[t];if(e!==this._buttons[t].value){if(e===1){this.processButtonDown(t,e)}else if(e===0){this.processButtonUp(t,e)}else{this.processButtonFloat(t,e)}}}for(var i=0;i<this._axesLen;i++){var s=this._rawPad.axes[i];if(s>0&&s>this.deadZone||s<0&&s<-this.deadZone){this.processAxisChange(i,s)}else{this.processAxisChange(i,0)}}this._prevTimestamp=this._rawPad.timestamp},connect:function(t){var e=!this.connected;this.connected=true;this.index=t.index;this._rawPad=t;this._buttons=[];this._buttonsLen=t.buttons.length;this._axes=[];this._axesLen=t.axes.length;for(var i=0;i<this._axesLen;i++){this._axes[i]=t.axes[i]}for(var s in t.buttons){s=parseInt(s,10);this._buttons[s]=new r.DeviceButton(this,s)}if(e&&this._padParent.onConnectCallback){this._padParent.onConnectCallback.call(this._padParent.callbackContext,this.index)}if(e&&this.onConnectCallback){this.onConnectCallback.call(this.callbackContext)}},disconnect:function(){var t=this.connected;var e=this.index;this.connected=false;this.index=null;this._rawPad=undefined;for(var i=0;i<this._buttonsLen;i++){this._buttons[i].destroy()}this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0;if(t&&this._padParent.onDisconnectCallback){this._padParent.onDisconnectCallback.call(this._padParent.callbackContext,e)}if(t&&this.onDisconnectCallback){this.onDisconnectCallback.call(this.callbackContext)}},destroy:function(){this._rawPad=undefined;for(var t=0;t<this._buttonsLen;t++){this._buttons[t].destroy()}this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null},processAxisChange:function(t,e){if(this._axes[t]===e){return}this._axes[t]=e;if(this._padParent.onAxisCallback){this._padParent.onAxisCallback.call(this._padParent.callbackContext,this,t,e)}if(this.onAxisCallback){this.onAxisCallback.call(this.callbackContext,this,t,e)}},processButtonDown:function(t,e){if(this._buttons[t]){this._buttons[t].start(null,e)}if(this._padParent.onDownCallback){this._padParent.onDownCallback.call(this._padParent.callbackContext,t,e,this.index)}if(this.onDownCallback){this.onDownCallback.call(this.callbackContext,t,e)}},processButtonUp:function(t,e){if(this._padParent.onUpCallback){this._padParent.onUpCallback.call(this._padParent.callbackContext,t,e,this.index)}if(this.onUpCallback){this.onUpCallback.call(this.callbackContext,t,e)}if(this._buttons[t]){this._buttons[t].stop(null,e)}},processButtonFloat:function(t,e){if(this._padParent.onFloatCallback){this._padParent.onFloatCallback.call(this._padParent.callbackContext,t,e,this.index)}if(this.onFloatCallback){this.onFloatCallback.call(this.callbackContext,t,e)}if(this._buttons[t]){this._buttons[t].padFloat(e)}},axis:function(t){if(this._axes[t]){return this._axes[t]}return false},isDown:function(t){if(this._buttons[t]){return this._buttons[t].isDown}return false},isUp:function(t){if(this._buttons[t]){return this._buttons[t].isUp}return false},justReleased:function(t,e){if(this._buttons[t]){return this._buttons[t].justReleased(e)}},justPressed:function(t,e){if(this._buttons[t]){return this._buttons[t].justPressed(e)}},buttonValue:function(t){if(this._buttons[t]){return this._buttons[t].value}return null},reset:function(){for(var t=0;t<this._axes.length;t++){this._axes[t]=0}}};r.SinglePad.prototype.constructor=r.SinglePad;r.Key=function(t,e){this.game=t;this._enabled=true;this.event=null;this.isDown=false;this.isUp=true;this.altKey=false;this.ctrlKey=false;this.shiftKey=false;this.timeDown=0;this.duration=0;this.timeUp=-2500;this.repeats=0;this.keyCode=e;this.onDown=new r.Signal;this.onHoldCallback=null;this.onHoldContext=null;this.onUp=new r.Signal;this._justDown=false;this._justUp=false};r.Key.prototype={update:function(){if(!this._enabled){return}if(this.isDown){this.duration=this.game.time.time-this.timeDown;this.repeats++;if(this.onHoldCallback){this.onHoldCallback.call(this.onHoldContext,this)}}},processKeyDown:function(t){if(!this._enabled){return}this.event=t;if(this.isDown){return}this.altKey=t.altKey;this.ctrlKey=t.ctrlKey;this.shiftKey=t.shiftKey;this.isDown=true;this.isUp=false;this.timeDown=this.game.time.time;this.duration=0;this.repeats=0;this._justDown=true;this.onDown.dispatch(this)},processKeyUp:function(t){if(!this._enabled){return}this.event=t;if(this.isUp){return}this.isDown=false;this.isUp=true;this.timeUp=this.game.time.time;this.duration=this.game.time.time-this.timeDown;this._justUp=true;this.onUp.dispatch(this)},reset:function(t){if(t===undefined){t=true}this.isDown=false;this.isUp=true;this.timeUp=this.game.time.time;this.duration=0;this._enabled=true;this._justDown=false;this._justUp=false;if(t){this.onDown.removeAll();this.onUp.removeAll();this.onHoldCallback=null;this.onHoldContext=null}},downDuration:function(t){if(t===undefined){t=50}return this.isDown&&this.duration<t},upDuration:function(t){if(t===undefined){t=50}return!this.isDown&&this.game.time.time-this.timeUp<t}};Object.defineProperty(r.Key.prototype,"justDown",{get:function(){var t=this._justDown;this._justDown=false;return t}});Object.defineProperty(r.Key.prototype,"justUp",{get:function(){var t=this._justUp;this._justUp=false;return t}});Object.defineProperty(r.Key.prototype,"enabled",{get:function(){return this._enabled},set:function(t){t=!!t;if(t!==this._enabled){if(!t){this.reset(false)}this._enabled=t}}});r.Key.prototype.constructor=r.Key;r.Keyboard=function(t){this.game=t;this.enabled=true;this.event=null;this.pressEvent=null;this.callbackContext=this;this.onDownCallback=null;this.onPressCallback=null;this.onUpCallback=null;this._keys=[];this._capture=[];this._onKeyDown=null;this._onKeyPress=null;this._onKeyUp=null;this._i=0;this._k=0};r.Keyboard.prototype={addCallbacks:function(t,e,i,s){this.callbackContext=t;if(e!==undefined&&e!==null){this.onDownCallback=e}if(i!==undefined&&i!==null){this.onUpCallback=i}if(s!==undefined&&s!==null){this.onPressCallback=s}},addKey:function(t){if(!this._keys[t]){this._keys[t]=new r.Key(this.game,t);this.addKeyCapture(t)}return this._keys[t]},addKeys:function(t){var e={};for(var i in t){e[i]=this.addKey(t[i])}return e},removeKey:function(t){if(this._keys[t]){this._keys[t]=null;this.removeKeyCapture(t)}},createCursorKeys:function(){return this.addKeys({up:r.KeyCode.UP,down:r.KeyCode.DOWN,left:r.KeyCode.LEFT,right:r.KeyCode.RIGHT})},start:function(){if(this.game.device.cocoonJS){return}if(this._onKeyDown!==null){return}var t=this;this._onKeyDown=function(e){return t.processKeyDown(e)};this._onKeyUp=function(e){return t.processKeyUp(e)};this._onKeyPress=function(e){return t.processKeyPress(e)};window.addEventListener("keydown",this._onKeyDown,false);window.addEventListener("keyup",this._onKeyUp,false);window.addEventListener("keypress",this._onKeyPress,false)},stop:function(){window.removeEventListener("keydown",this._onKeyDown);window.removeEventListener("keyup",this._onKeyUp);window.removeEventListener("keypress",this._onKeyPress);this._onKeyDown=null;this._onKeyUp=null;this._onKeyPress=null},destroy:function(){this.stop();this.clearCaptures();this._keys.length=0;this._i=0},addKeyCapture:function(t){if(typeof t==="object"){for(var e in t){this._capture[t[e]]=true}}else{this._capture[t]=true}},removeKeyCapture:function(t){delete this._capture[t]},clearCaptures:function(){this._capture={}},update:function(){this._i=this._keys.length;while(this._i--){if(this._keys[this._i]){this._keys[this._i].update()}}},processKeyDown:function(t){this.event=t;if(!this.game.input.enabled||!this.enabled){return}var e=t.keyCode;if(this._capture[e]){t.preventDefault()}if(!this._keys[e]){this._keys[e]=new r.Key(this.game,e)}this._keys[e].processKeyDown(t);this._k=e;if(this.onDownCallback){this.onDownCallback.call(this.callbackContext,t)}},processKeyPress:function(t){this.pressEvent=t;if(!this.game.input.enabled||!this.enabled){return}if(this.onPressCallback){this.onPressCallback.call(this.callbackContext,String.fromCharCode(t.charCode),t)}},processKeyUp:function(t){this.event=t;if(!this.game.input.enabled||!this.enabled){return}var e=t.keyCode;if(this._capture[e]){t.preventDefault()}if(!this._keys[e]){this._keys[e]=new r.Key(this.game,e)}this._keys[e].processKeyUp(t);if(this.onUpCallback){this.onUpCallback.call(this.callbackContext,t)}},reset:function(t){if(t===undefined){t=true}this.event=null;var e=this._keys.length;while(e--){if(this._keys[e]){this._keys[e].reset(t)}}},downDuration:function(t,e){if(this._keys[t]){return this._keys[t].downDuration(e)}else{return null}},upDuration:function(t,e){if(this._keys[t]){return this._keys[t].upDuration(e)}else{return null}},isDown:function(t){if(this._keys[t]){return this._keys[t].isDown}else{return null}}};Object.defineProperty(r.Keyboard.prototype,"lastChar",{get:function(){if(this.event.charCode===32){return""}else{return String.fromCharCode(this.pressEvent.charCode)}}});Object.defineProperty(r.Keyboard.prototype,"lastKey",{get:function(){return this._keys[this._k]}});r.Keyboard.prototype.constructor=r.Keyboard;r.KeyCode={A:"A".charCodeAt(0),B:"B".charCodeAt(0),C:"C".charCodeAt(0),D:"D".charCodeAt(0),E:"E".charCodeAt(0),F:"F".charCodeAt(0),G:"G".charCodeAt(0),H:"H".charCodeAt(0),I:"I".charCodeAt(0),J:"J".charCodeAt(0),K:"K".charCodeAt(0),L:"L".charCodeAt(0),M:"M".charCodeAt(0),N:"N".charCodeAt(0),O:"O".charCodeAt(0),P:"P".charCodeAt(0),Q:"Q".charCodeAt(0),R:"R".charCodeAt(0),S:"S".charCodeAt(0),T:"T".charCodeAt(0),U:"U".charCodeAt(0),V:"V".charCodeAt(0),W:"W".charCodeAt(0),X:"X".charCodeAt(0),Y:"Y".charCodeAt(0),Z:"Z".charCodeAt(0),ZERO:"0".charCodeAt(0),ONE:"1".charCodeAt(0),TWO:"2".charCodeAt(0),THREE:"3".charCodeAt(0),FOUR:"4".charCodeAt(0),FIVE:"5".charCodeAt(0),SIX:"6".charCodeAt(0),SEVEN:"7".charCodeAt(0),EIGHT:"8".charCodeAt(0),NINE:"9".charCodeAt(0),NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,NUMPAD_MULTIPLY:106,NUMPAD_ADD:107,NUMPAD_ENTER:108,NUMPAD_SUBTRACT:109,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,COLON:186,EQUALS:187,COMMA:188,UNDERSCORE:189,PERIOD:190,QUESTION_MARK:191,TILDE:192,OPEN_BRACKET:219,BACKWARD_SLASH:220,CLOSED_BRACKET:221,QUOTES:222,BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,CAPS_LOCK:20,ESC:27,SPACEBAR:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PLUS:43,MINUS:44,INSERT:45,DELETE:46,HELP:47,NUM_LOCK:144};for(var o in r.KeyCode){if(r.KeyCode.hasOwnProperty(o)&&!o.match(/[a-z]/)){r.Keyboard[o]=r.KeyCode[o]}}r.Component=function(){};r.Component.Angle=function(){};r.Component.Angle.prototype={angle:{get:function(){return r.Math.wrapAngle(r.Math.radToDeg(this.rotation))},set:function(t){this.rotation=r.Math.degToRad(r.Math.wrapAngle(t))}}};r.Component.Animation=function(){};r.Component.Animation.prototype={play:function(t,e,i,s){if(this.animations){return this.animations.play(t,e,i,s)}}};r.Component.AutoCull=function(){};r.Component.AutoCull.prototype={autoCull:false,inCamera:{get:function(){if(!this.autoCull&&!this.checkWorldBounds){this._bounds.copyFrom(this.getBounds());this._bounds.x+=this.game.camera.view.x;this._bounds.y+=this.game.camera.view.y}return this.game.world.camera.view.intersects(this._bounds)}}};r.Component.Bounds=function(){};r.Component.Bounds.prototype={offsetX:{get:function(){return this.anchor.x*this.width}},offsetY:{get:function(){return this.anchor.y*this.height}},centerX:{get:function(){return this.x-this.offsetX+this.width*.5},set:function(t){this.x=t+this.offsetX-this.width*.5}},centerY:{get:function(){return this.y-this.offsetY+this.height*.5},set:function(t){this.y=t+this.offsetY-this.height*.5}},left:{get:function(){return this.x-this.offsetX},set:function(t){this.x=t+this.offsetX}},right:{get:function(){return this.x+this.width-this.offsetX},set:function(t){this.x=t-this.width+this.offsetX}},top:{get:function(){return this.y-this.offsetY},set:function(t){this.y=t+this.offsetY}},bottom:{get:function(){return this.y+this.height-this.offsetY},set:function(t){this.y=t-this.height+this.offsetY}},alignIn:function(t,e,i,s){if(i===undefined){i=0}if(s===undefined){s=0}switch(e){default:case r.TOP_LEFT:this.left=t.left-i;this.top=t.top-s;break;case r.TOP_CENTER:this.centerX=t.centerX+i;this.top=t.top-s;break;case r.TOP_RIGHT:this.right=t.right+i;this.top=t.top-s;break;case r.LEFT_CENTER:this.left=t.left-i;this.centerY=t.centerY+s;break;case r.CENTER:this.centerX=t.centerX+i;this.centerY=t.centerY+s;break;case r.RIGHT_CENTER:this.right=t.right+i;this.centerY=t.centerY+s;break;case r.BOTTOM_LEFT:this.left=t.left-i;this.bottom=t.bottom+s;break;case r.BOTTOM_CENTER:this.centerX=t.centerX+i;this.bottom=t.bottom+s;break;case r.BOTTOM_RIGHT:this.right=t.right+i;this.bottom=t.bottom+s;break}return this},alignTo:function(t,e,i,s){if(i===undefined){i=0}if(s===undefined){s=0}switch(e){default:case r.TOP_LEFT:this.left=t.left-i;this.bottom=t.top-s;break;case r.TOP_CENTER:this.centerX=t.centerX+i;this.bottom=t.top-s;break;case r.TOP_RIGHT:this.right=t.right+i;this.bottom=t.top-s;break;case r.LEFT_TOP:this.right=t.left-i;this.top=t.top-s;break;case r.LEFT_CENTER:this.right=t.left-i;this.centerY=t.centerY+s;break;case r.LEFT_BOTTOM:this.right=t.left-i;this.bottom=t.bottom+s;break;case r.RIGHT_TOP:this.left=t.right+i;this.top=t.top-s;break;case r.RIGHT_CENTER:this.left=t.right+i;this.centerY=t.centerY+s;break;case r.RIGHT_BOTTOM:this.left=t.right+i;this.bottom=t.bottom+s;break;case r.BOTTOM_LEFT:this.left=t.left-i;this.top=t.bottom+s;break;case r.BOTTOM_CENTER:this.centerX=t.centerX+i;this.top=t.bottom+s;break;case r.BOTTOM_RIGHT:this.right=t.right+i;this.top=t.bottom+s;break}return this}};r.Group.prototype.alignIn=r.Component.Bounds.prototype.alignIn;r.Group.prototype.alignTo=r.Component.Bounds.prototype.alignTo;r.Component.BringToTop=function(){};r.Component.BringToTop.prototype.bringToTop=function(){if(this.parent){this.parent.bringToTop(this)}return this};r.Component.BringToTop.prototype.sendToBack=function(){if(this.parent){this.parent.sendToBack(this)}return this};r.Component.BringToTop.prototype.moveUp=function(){if(this.parent){this.parent.moveUp(this)}return this};r.Component.BringToTop.prototype.moveDown=function(){if(this.parent){this.parent.moveDown(this)}return this};r.Component.Core=function(){};r.Component.Core.install=function(t){r.Utils.mixinPrototype(this,r.Component.Core.prototype);this.components={};for(var e=0;e<t.length;e++){var i=t[e];var s=false;if(i==="Destroy"){s=true}r.Utils.mixinPrototype(this,r.Component[i].prototype,s);this.components[i]=true}};r.Component.Core.init=function(t,e,i,s,n){this.game=t;this.key=s;this.data={};this.position.set(e,i);this.world=new r.Point(e,i);this.previousPosition=new r.Point(e,i);this.events=new r.Events(this);this._bounds=new r.Rectangle;if(this.components.PhysicsBody){this.body=this.body}if(this.components.Animation){this.animations=new r.AnimationManager(this)}if(this.components.LoadTexture&&s!==null){this.loadTexture(s,n)}if(this.components.FixedToCamera){this.cameraOffset=new r.Point(e,i)}};r.Component.Core.preUpdate=function(){if(this.pendingDestroy){this.destroy();return}this.previousPosition.set(this.world.x,this.world.y);this.previousRotation=this.rotation;if(!this.exists||!this.parent.exists){this.renderOrderID=-1;return false}this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty);if(this.visible){this.renderOrderID=this.game.stage.currentRenderOrderID++}if(this.animations){this.animations.update()}if(this.body){this.body.preUpdate()}for(var t=0;t<this.children.length;t++){this.children[t].preUpdate()}return true};r.Component.Core.prototype={game:null,name:"",data:{},components:{},z:0,events:undefined,animations:undefined,key:"",world:null,debug:false,previousPosition:null,previousRotation:0,renderOrderID:0,fresh:true,pendingDestroy:false,_bounds:null,_exists:true,exists:{get:function(){return this._exists},set:function(t){if(t){this._exists=true;if(this.body&&this.body.type===r.Physics.P2JS){this.body.addToWorld()}this.visible=true}else{this._exists=false;if(this.body&&this.body.type===r.Physics.P2JS){this.body.removeFromWorld()}this.visible=false}}},update:function(){},postUpdate:function(){if(this.customRender){this.key.render()}if(this.components.PhysicsBody){r.Component.PhysicsBody.postUpdate.call(this)}if(this.components.FixedToCamera){r.Component.FixedToCamera.postUpdate.call(this)}for(var t=0;t<this.children.length;t++){this.children[t].postUpdate()}}};r.Component.Crop=function(){};r.Component.Crop.prototype={cropRect:null,_crop:null,crop:function(t,e){if(e===undefined){e=false}if(t){if(e&&this.cropRect!==null){this.cropRect.setTo(t.x,t.y,t.width,t.height)}else if(e&&this.cropRect===null){this.cropRect=new r.Rectangle(t.x,t.y,t.width,t.height)}else{this.cropRect=t}this.updateCrop()}else{this._crop=null;this.cropRect=null;this.resetFrame()}},updateCrop:function(){if(!this.cropRect){return}var t=this.texture.crop.x;var e=this.texture.crop.y;var i=this.texture.crop.width;var s=this.texture.crop.height;this._crop=r.Rectangle.clone(this.cropRect,this._crop);this._crop.x+=this._frame.x;this._crop.y+=this._frame.y;var n=Math.max(this._frame.x,this._crop.x);var a=Math.max(this._frame.y,this._crop.y);var o=Math.min(this._frame.right,this._crop.right)-n;var h=Math.min(this._frame.bottom,this._crop.bottom)-a;this.texture.crop.x=n;this.texture.crop.y=a;this.texture.crop.width=o;this.texture.crop.height=h;this.texture.frame.width=Math.min(o,this.cropRect.width);this.texture.frame.height=Math.min(h,this.cropRect.height);this.texture.width=this.texture.frame.width;this.texture.height=this.texture.frame.height;this.texture._updateUvs();if(this.tint!==16777215&&(t!==n||e!==a||i!==o||s!==h)){this.texture.requiresReTint=true}}};r.Component.Delta=function(){};r.Component.Delta.prototype={deltaX:{get:function(){return this.world.x-this.previousPosition.x}},deltaY:{get:function(){return this.world.y-this.previousPosition.y}},deltaZ:{get:function(){return this.rotation-this.previousRotation}}};r.Component.Destroy=function(){};r.Component.Destroy.prototype={destroyPhase:false,destroy:function(t,e){if(this.game===null||this.destroyPhase){return}if(t===undefined){t=true}if(e===undefined){e=false}this.destroyPhase=true;if(this.events){this.events.onDestroy$dispatch(this)}if(this.parent){if(this.parent instanceof r.Group){this.parent.remove(this)}else{this.parent.removeChild(this)}}if(this.input){this.input.destroy()}if(this.animations){this.animations.destroy()}if(this.body){this.body.destroy()}if(this.events){this.events.destroy()}this.game.tweens.removeFrom(this);var i=this.children.length;if(t){while(i--){this.children[i].destroy(t)}}else{while(i--){this.removeChild(this.children[i])}}if(this._crop){this._crop=null;this.cropRect=null}if(this._frame){this._frame=null}if(r.Video&&this.key instanceof r.Video){this.key.onChangeSource.remove(this.resizeFrame,this)}if(r.BitmapText&&this._glyphs){this._glyphs=[]}this.alive=false;this.exists=false;this.visible=false;this.filters=null;this.mask=null;this.game=null;this.data={};this.renderable=false;if(this.transformCallback){this.transformCallback=null;this.transformCallbackContext=null}this.hitArea=null;this.parent=null;this.stage=null;this.worldTransform=null;this.filterArea=null;this._bounds=null;this._currentBounds=null;this._mask=null;this._destroyCachedSprite();if(e){this.texture.destroy(true)}this.destroyPhase=false;this.pendingDestroy=false}};r.Events=function(t){this.parent=t};r.Events.prototype={destroy:function(){this._parent=null;if(this._onDestroy){this._onDestroy.dispose()}if(this._onAddedToGroup){this._onAddedToGroup.dispose()}if(this._onRemovedFromGroup){this._onRemovedFromGroup.dispose()}if(this._onRemovedFromWorld){this._onRemovedFromWorld.dispose()}if(this._onKilled){this._onKilled.dispose()}if(this._onRevived){this._onRevived.dispose()}if(this._onEnterBounds){this._onEnterBounds.dispose()}if(this._onOutOfBounds){this._onOutOfBounds.dispose()}if(this._onInputOver){this._onInputOver.dispose()}if(this._onInputOut){this._onInputOut.dispose()}if(this._onInputDown){this._onInputDown.dispose()}if(this._onInputUp){this._onInputUp.dispose()}if(this._onDragStart){this._onDragStart.dispose()}if(this._onDragUpdate){this._onDragUpdate.dispose()}if(this._onDragStop){this._onDragStop.dispose()}if(this._onAnimationStart){this._onAnimationStart.dispose()}if(this._onAnimationComplete){this._onAnimationComplete.dispose()}if(this._onAnimationLoop){this._onAnimationLoop.dispose()}},onAddedToGroup:null,onRemovedFromGroup:null,onRemovedFromWorld:null,onDestroy:null,onKilled:null,onRevived:null,onOutOfBounds:null,onEnterBounds:null,onInputOver:null,onInputOut:null,onInputDown:null,onInputUp:null,onDragStart:null,onDragUpdate:null,onDragStop:null,onAnimationStart:null,onAnimationComplete:null,onAnimationLoop:null};r.Events.prototype.constructor=r.Events;for(var h in r.Events.prototype){if(!r.Events.prototype.hasOwnProperty(h)||h.indexOf("on")!==0||r.Events.prototype[h]!==null){continue}(function(t,e){"use strict";Object.defineProperty(r.Events.prototype,t,{get:function(){return this[e]||(this[e]=new r.Signal)}});r.Events.prototype[t+"$dispatch"]=function(){return this[e]?this[e].dispatch.apply(this[e],arguments):null}})(h,"_"+h)}r.Component.FixedToCamera=function(){};r.Component.FixedToCamera.postUpdate=function(){if(this.fixedToCamera){this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y}};r.Component.FixedToCamera.prototype={_fixedToCamera:false,fixedToCamera:{get:function(){return this._fixedToCamera},set:function(t){if(t){this._fixedToCamera=true;this.cameraOffset.set(this.x,this.y)}else{this._fixedToCamera=false}}},cameraOffset:new r.Point};r.Component.Health=function(){};r.Component.Health.prototype={health:1,maxHealth:100,damage:function(t){if(this.alive){this.health-=t;if(this.health<=0){this.kill()}}return this},setHealth:function(t){this.health=t;if(this.health>this.maxHealth){this.health=this.maxHealth}return this},heal:function(t){if(this.alive){this.health+=t;if(this.health>this.maxHealth){this.health=this.maxHealth}}return this}};r.Component.InCamera=function(){};r.Component.InCamera.prototype={inCamera:{get:function(){return this.game.world.camera.view.intersects(this._bounds)}}};r.Component.InputEnabled=function(){};r.Component.InputEnabled.prototype={input:null,inputEnabled:{get:function(){return this.input&&this.input.enabled},set:function(t){if(t){if(this.input===null){this.input=new r.InputHandler(this);this.input.start()}else if(this.input&&!this.input.enabled){this.input.start()}}else{if(this.input&&this.input.enabled){this.input.stop()}}}}};r.Component.InWorld=function(){};r.Component.InWorld.preUpdate=function(){if(this.autoCull||this.checkWorldBounds){this._bounds.copyFrom(this.getBounds());this._bounds.x+=this.game.camera.view.x;this._bounds.y+=this.game.camera.view.y;if(this.autoCull){if(this.game.world.camera.view.intersects(this._bounds)){this.renderable=true;this.game.world.camera.totalInView++}else{this.renderable=false;if(this.outOfCameraBoundsKill){this.kill();return false}}}if(this.checkWorldBounds){if(this._outOfBoundsFired&&this.game.world.bounds.intersects(this._bounds)){this._outOfBoundsFired=false;this.events.onEnterBounds$dispatch(this)}else if(!this._outOfBoundsFired&&!this.game.world.bounds.intersects(this._bounds)){this._outOfBoundsFired=true;this.events.onOutOfBounds$dispatch(this);if(this.outOfBoundsKill){this.kill();return false}}}}return true};r.Component.InWorld.prototype={checkWorldBounds:false,outOfBoundsKill:false,outOfCameraBoundsKill:false,_outOfBoundsFired:false,inWorld:{get:function(){return this.game.world.bounds.intersects(this.getBounds())}}};r.Component.LifeSpan=function(){};r.Component.LifeSpan.preUpdate=function(){if(this.lifespan>0){this.lifespan-=this.game.time.physicsElapsedMS;if(this.lifespan<=0){this.kill();return false}}return true};r.Component.LifeSpan.prototype={alive:true,lifespan:0,revive:function(t){if(t===undefined){t=100}this.alive=true;this.exists=true;this.visible=true;if(typeof this.setHealth==="function"){this.setHealth(t)}if(this.events){this.events.onRevived$dispatch(this)}return this},kill:function(){this.alive=false;this.exists=false;this.visible=false;if(this.events){this.events.onKilled$dispatch(this)}return this}};r.Component.LoadTexture=function(){};r.Component.LoadTexture.prototype={customRender:false,_frame:null,loadTexture:function(t,e,i){if(t===r.PENDING_ATLAS){t=e;e=0}else{e=e||0}if((i||i===undefined)&&this.animations){this.animations.stop()}this.key=t;this.customRender=false;var s=this.game.cache;var n=true;var a=!this.texture.baseTexture.scaleMode;if(r.RenderTexture&&t instanceof r.RenderTexture){this.key=t.key;this.setTexture(t)}else if(r.BitmapData&&t instanceof r.BitmapData){this.customRender=true;this.setTexture(t.texture);if(s.hasFrameData(t.key,r.Cache.BITMAPDATA)){n=!this.animations.loadFrameData(s.getFrameData(t.key,r.Cache.BITMAPDATA),e)}else{n=!this.animations.loadFrameData(t.frameData,0)}}else if(r.Video&&t instanceof r.Video){this.customRender=true;var o=t.texture.valid;this.setTexture(t.texture);this.setFrame(t.texture.frame.clone());t.onChangeSource.add(this.resizeFrame,this);this.texture.valid=o}else if(r.Tilemap&&t instanceof r.TilemapLayer){this.setTexture(PIXI.Texture.fromCanvas(t.canvas))}else if(t instanceof PIXI.Texture){this.setTexture(t)}else{var h=s.getImage(t,true);this.key=h.key;this.setTexture(new PIXI.Texture(h.base));if(t==="__default"){this.texture.baseTexture.skipRender=true}else{this.texture.baseTexture.skipRender=false}n=!this.animations.loadFrameData(h.frameData,e)}if(n){this._frame=r.Rectangle.clone(this.texture.frame)}if(!a){this.texture.baseTexture.scaleMode=1}},setFrame:function(t){this._frame=t;this.texture.frame.x=t.x;this.texture.frame.y=t.y;this.texture.frame.width=t.width;this.texture.frame.height=t.height;this.texture.crop.x=t.x;this.texture.crop.y=t.y;this.texture.crop.width=t.width;this.texture.crop.height=t.height;if(t.trimmed){if(this.texture.trim){this.texture.trim.x=t.spriteSourceSizeX;this.texture.trim.y=t.spriteSourceSizeY;this.texture.trim.width=t.sourceSizeW;this.texture.trim.height=t.sourceSizeH}else{this.texture.trim={x:t.spriteSourceSizeX,y:t.spriteSourceSizeY,width:t.sourceSizeW,height:t.sourceSizeH}}this.texture.width=t.sourceSizeW;this.texture.height=t.sourceSizeH;this.texture.frame.width=t.sourceSizeW;this.texture.frame.height=t.sourceSizeH}else if(!t.trimmed&&this.texture.trim){this.texture.trim=null}if(this.cropRect){this.updateCrop()}this.texture.requiresReTint=true;this.texture._updateUvs();if(this.tilingTexture){this.refreshTexture=true}},resizeFrame:function(t,e,i){this.texture.frame.resize(e,i);this.texture.setFrame(this.texture.frame)},resetFrame:function(){if(this._frame){this.setFrame(this._frame)}},frame:{get:function(){return this.animations.frame},set:function(t){this.animations.frame=t}},frameName:{get:function(){return this.animations.frameName},set:function(t){this.animations.frameName=t}}};r.Component.Overlap=function(){};r.Component.Overlap.prototype={overlap:function(t){return r.Rectangle.intersects(this.getBounds(),t.getBounds())}};r.Component.PhysicsBody=function(){};r.Component.PhysicsBody.preUpdate=function(){if(this.fresh&&this.exists){this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y);this.worldTransform.tx=this.world.x;this.worldTransform.ty=this.world.y;this.previousPosition.set(this.world.x,this.world.y);this.previousRotation=this.rotation;if(this.body){this.body.preUpdate()}this.fresh=false;return false}this.previousPosition.set(this.world.x,this.world.y);this.previousRotation=this.rotation;if(!this._exists||!this.parent.exists){this.renderOrderID=-1;return false}return true};r.Component.PhysicsBody.postUpdate=function(){if(this.exists&&this.body){this.body.postUpdate()}};r.Component.PhysicsBody.prototype={body:null,x:{get:function(){return this.position.x},set:function(t){this.position.x=t;if(this.body&&!this.body.dirty){this.body._reset=true}}},y:{get:function(){return this.position.y},set:function(t){this.position.y=t;if(this.body&&!this.body.dirty){this.body._reset=true}}}};r.Component.Reset=function(){};r.Component.Reset.prototype.reset=function(t,e,i){if(i===undefined){i=1}this.world.set(t,e);this.position.set(t,e);this.fresh=true;this.exists=true;this.visible=true;this.renderable=true;if(this.components.InWorld){this._outOfBoundsFired=false}if(this.components.LifeSpan){this.alive=true;this.health=i}if(this.components.PhysicsBody){if(this.body){this.body.reset(t,e,false,false)}}return this};r.Component.ScaleMinMax=function(){};r.Component.ScaleMinMax.prototype={transformCallback:null,transformCallbackContext:this,scaleMin:null,scaleMax:null,checkTransform:function(t){if(this.scaleMin){if(t.a<this.scaleMin.x){t.a=this.scaleMin.x}if(t.d<this.scaleMin.y){t.d=this.scaleMin.y}}if(this.scaleMax){if(t.a>this.scaleMax.x){t.a=this.scaleMax.x}if(t.d>this.scaleMax.y){t.d=this.scaleMax.y}}},setScaleMinMax:function(t,e,i,s){if(e===undefined){e=i=s=t}else if(i===undefined){i=s=e;e=t}if(t===null){this.scaleMin=null}else{if(this.scaleMin){this.scaleMin.set(t,e)}else{this.scaleMin=new r.Point(t,e)}}if(i===null){this.scaleMax=null}else{if(this.scaleMax){this.scaleMax.set(i,s)}else{this.scaleMax=new r.Point(i,s)}}if(this.scaleMin===null){this.transformCallback=null}else{this.transformCallback=this.checkTransform;this.transformCallbackContext=this}}};r.Component.Smoothed=function(){};r.Component.Smoothed.prototype={smoothed:{get:function(){return!this.texture.baseTexture.scaleMode},set:function(t){if(t){if(this.texture){this.texture.baseTexture.scaleMode=0}}else{if(this.texture){this.texture.baseTexture.scaleMode=1}}}}};r.GameObjectFactory=function(t){this.game=t;this.world=this.game.world};r.GameObjectFactory.prototype={existing:function(t){return this.world.add(t)},weapon:function(t,e,i,s){var n=this.game.plugins.add(r.Weapon);n.createBullets(t,e,i,s);return n},image:function(t,e,i,s,n){if(n===undefined){n=this.world}return n.add(new r.Image(this.game,t,e,i,s))},sprite:function(t,e,i,s,r){if(r===undefined){r=this.world}return r.create(t,e,i,s)},creature:function(t,e,i,s,n){if(n===undefined){n=this.world}var a=new r.Creature(this.game,t,e,i,s);n.add(a);return a},tween:function(t){return this.game.tweens.create(t)},group:function(t,e,i,s,n){return new r.Group(this.game,t,e,i,s,n)},physicsGroup:function(t,e,i,s){return new r.Group(this.game,e,i,s,true,t)},spriteBatch:function(t,e,i){if(t===undefined){t=null}if(e===undefined){e="group"}if(i===undefined){i=false}return new r.SpriteBatch(this.game,t,e,i)},audio:function(t,e,i,s){return this.game.sound.add(t,e,i,s)},sound:function(t,e,i,s){return this.game.sound.add(t,e,i,s)},audioSprite:function(t){return this.game.sound.addSprite(t)},tileSprite:function(t,e,i,s,n,a,o){if(o===undefined){o=this.world}return o.add(new r.TileSprite(this.game,t,e,i,s,n,a))},rope:function(t,e,i,s,n,a){if(a===undefined){a=this.world}return a.add(new r.Rope(this.game,t,e,i,s,n))},text:function(t,e,i,s,n){if(n===undefined){n=this.world}return n.add(new r.Text(this.game,t,e,i,s))},button:function(t,e,i,s,n,a,o,h,l,u){if(u===undefined){u=this.world}return u.add(new r.Button(this.game,t,e,i,s,n,a,o,h,l))},graphics:function(t,e,i){if(i===undefined){i=this.world}return i.add(new r.Graphics(this.game,t,e))},emitter:function(t,e,i){return this.game.particles.add(new r.Particles.Arcade.Emitter(this.game,t,e,i))},retroFont:function(t,e,i,s,n,a,o,h,l){return new r.RetroFont(this.game,t,e,i,s,n,a,o,h,l)},bitmapText:function(t,e,i,s,n,a){if(a===undefined){a=this.world}return a.add(new r.BitmapText(this.game,t,e,i,s,n))},tilemap:function(t,e,i,s,n){return new r.Tilemap(this.game,t,e,i,s,n)},renderTexture:function(t,e,i,s){if(i===undefined||i===""){i=this.game.rnd.uuid()}if(s===undefined){s=false}var n=new r.RenderTexture(this.game,t,e,i);if(s){this.game.cache.addRenderTexture(i,n)}return n},video:function(t,e){return new r.Video(this.game,t,e)},bitmapData:function(t,e,i,s){if(s===undefined){s=false}if(i===undefined||i===""){i=this.game.rnd.uuid()}var n=new r.BitmapData(this.game,i,t,e);if(s){this.game.cache.addBitmapData(i,n)}return n},filter:function(t){var e=Array.prototype.slice.call(arguments,1);var t=new r.Filter[t](this.game);t.init.apply(t,e);return t},plugin:function(t){return this.game.plugins.add(t)}};r.GameObjectFactory.prototype.constructor=r.GameObjectFactory;r.GameObjectCreator=function(t){this.game=t;this.world=this.game.world};r.GameObjectCreator.prototype={image:function(t,e,i,s){return new r.Image(this.game,t,e,i,s)},sprite:function(t,e,i,s){return new r.Sprite(this.game,t,e,i,s)},tween:function(t){return new r.Tween(t,this.game,this.game.tweens)},group:function(t,e,i,s,n){return new r.Group(this.game,t,e,i,s,n)},spriteBatch:function(t,e,i){if(e===undefined){e="group"}if(i===undefined){i=false}return new r.SpriteBatch(this.game,t,e,i)},audio:function(t,e,i,s){return this.game.sound.add(t,e,i,s)},audioSprite:function(t){return this.game.sound.addSprite(t)},sound:function(t,e,i,s){return this.game.sound.add(t,e,i,s)},tileSprite:function(t,e,i,s,n,a){return new r.TileSprite(this.game,t,e,i,s,n,a)},rope:function(t,e,i,s,n){return new r.Rope(this.game,t,e,i,s,n)},text:function(t,e,i,s){return new r.Text(this.game,t,e,i,s)},button:function(t,e,i,s,n,a,o,h,l){return new r.Button(this.game,t,e,i,s,n,a,o,h,l)},graphics:function(t,e){return new r.Graphics(this.game,t,e)},emitter:function(t,e,i){return new r.Particles.Arcade.Emitter(this.game,t,e,i)},retroFont:function(t,e,i,s,n,a,o,h,l){return new r.RetroFont(this.game,t,e,i,s,n,a,o,h,l)},bitmapText:function(t,e,i,s,n,a){return new r.BitmapText(this.game,t,e,i,s,n,a)},tilemap:function(t,e,i,s,n){return new r.Tilemap(this.game,t,e,i,s,n)},renderTexture:function(t,e,i,s){if(i===undefined||i===""){i=this.game.rnd.uuid()}if(s===undefined){s=false}var n=new r.RenderTexture(this.game,t,e,i);if(s){this.game.cache.addRenderTexture(i,n)}return n},bitmapData:function(t,e,i,s){if(s===undefined){s=false}if(i===undefined||i===""){i=this.game.rnd.uuid()}var n=new r.BitmapData(this.game,i,t,e);if(s){this.game.cache.addBitmapData(i,n)}return n},filter:function(t){var e=Array.prototype.slice.call(arguments,1);var t=new r.Filter[t](this.game);t.init.apply(t,e);return t}};r.GameObjectCreator.prototype.constructor=r.GameObjectCreator;r.Sprite=function(t,e,i,s,n){e=e||0;i=i||0;s=s||null;n=n||null;this.type=r.SPRITE;this.physicsType=r.SPRITE;PIXI.Sprite.call(this,r.Cache.DEFAULT);r.Component.Core.init.call(this,t,e,i,s,n)};r.Sprite.prototype=Object.create(PIXI.Sprite.prototype);r.Sprite.prototype.constructor=r.Sprite;r.Component.Core.install.call(r.Sprite.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Delta","Destroy","FixedToCamera","Health","InCamera","InputEnabled","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","ScaleMinMax","Smoothed"]);r.Sprite.prototype.preUpdatePhysics=r.Component.PhysicsBody.preUpdate;r.Sprite.prototype.preUpdateLifeSpan=r.Component.LifeSpan.preUpdate;r.Sprite.prototype.preUpdateInWorld=r.Component.InWorld.preUpdate;r.Sprite.prototype.preUpdateCore=r.Component.Core.preUpdate;r.Sprite.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};r.Image=function(t,e,i,s,n){e=e||0;i=i||0;s=s||null;n=n||null;this.type=r.IMAGE;PIXI.Sprite.call(this,r.Cache.DEFAULT);r.Component.Core.init.call(this,t,e,i,s,n)};r.Image.prototype=Object.create(PIXI.Sprite.prototype);r.Image.prototype.constructor=r.Image;r.Component.Core.install.call(r.Image.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Destroy","FixedToCamera","InputEnabled","LifeSpan","LoadTexture","Overlap","Reset","ScaleMinMax","Smoothed"]);r.Image.prototype.preUpdateInWorld=r.Component.InWorld.preUpdate;r.Image.prototype.preUpdateCore=r.Component.Core.preUpdate;r.Image.prototype.preUpdate=function(){if(!this.preUpdateInWorld()){return false}return this.preUpdateCore()};r.Button=function(t,e,i,s,n,a,o,h,l,u){e=e||0;i=i||0;s=s||null;n=n||null;a=a||this;r.Image.call(this,t,e,i,s,h);this.type=r.BUTTON;this.physicsType=r.SPRITE;this._onOverFrame=null;this._onOutFrame=null;this._onDownFrame=null;this._onUpFrame=null;this.onOverSound=null;this.onOutSound=null;this.onDownSound=null;this.onUpSound=null;this.onOverSoundMarker="";this.onOutSoundMarker="";this.onDownSoundMarker="";this.onUpSoundMarker="";this.onInputOver=new r.Signal;this.onInputOut=new r.Signal;this.onInputDown=new r.Signal;this.onInputUp=new r.Signal;this.onOverMouseOnly=true;this.justReleasedPreventsOver=r.PointerMode.TOUCH;this.freezeFrames=false;this.forceOut=false;this.inputEnabled=true;this.input.start(0,true);this.input.useHandCursor=true;this.setFrames(o,h,l,u);if(n!==null){this.onInputUp.add(n,a)}this.events.onInputOver.add(this.onInputOverHandler,this);this.events.onInputOut.add(this.onInputOutHandler,this);this.events.onInputDown.add(this.onInputDownHandler,this);this.events.onInputUp.add(this.onInputUpHandler,this);this.events.onRemovedFromWorld.add(this.removedFromWorld,this)};r.Button.prototype=Object.create(r.Image.prototype);r.Button.prototype.constructor=r.Button;var l="Over";var u="Out";var c="Down";var d="Up";r.Button.prototype.clearFrames=function(){this.setFrames(null,null,null,null)};r.Button.prototype.removedFromWorld=function(){this.inputEnabled=false};r.Button.prototype.setStateFrame=function(t,e,i){var s="_on"+t+"Frame";if(e!==null){this[s]=e;if(i){this.changeStateFrame(t)}}else{this[s]=null}};r.Button.prototype.changeStateFrame=function(t){if(this.freezeFrames){return false}var e="_on"+t+"Frame";var i=this[e];if(typeof i==="string"){this.frameName=i;return true}else if(typeof i==="number"){this.frame=i;return true}else{return false}};r.Button.prototype.setFrames=function(t,e,i,s){this.setStateFrame(l,t,this.input.pointerOver());this.setStateFrame(u,e,!this.input.pointerOver());this.setStateFrame(c,i,this.input.pointerDown());this.setStateFrame(d,s,this.input.pointerUp())};r.Button.prototype.setStateSound=function(t,e,i){var s="on"+t+"Sound";var n="on"+t+"SoundMarker";if(e instanceof r.Sound||e instanceof r.AudioSprite){this[s]=e;this[n]=typeof i==="string"?i:""}else{this[s]=null;this[n]=""}};r.Button.prototype.playStateSound=function(t){var e="on"+t+"Sound";var i=this[e];if(i){var s="on"+t+"SoundMarker";var r=this[s];i.play(r);return true}else{return false}};r.Button.prototype.setSounds=function(t,e,i,s,r,n,a,o){this.setStateSound(l,t,e);this.setStateSound(u,r,n);this.setStateSound(c,i,s);this.setStateSound(d,a,o)};r.Button.prototype.setOverSound=function(t,e){this.setStateSound(l,t,e)};r.Button.prototype.setOutSound=function(t,e){this.setStateSound(u,t,e)};r.Button.prototype.setDownSound=function(t,e){this.setStateSound(c,t,e)};r.Button.prototype.setUpSound=function(t,e){this.setStateSound(d,t,e)};r.Button.prototype.onInputOverHandler=function(t,e){if(e.justReleased()&&(this.justReleasedPreventsOver&e.pointerMode)===e.pointerMode){return}this.changeStateFrame(l);if(this.onOverMouseOnly&&!e.isMouse){return}this.playStateSound(l);if(this.onInputOver){this.onInputOver.dispatch(this,e)}};r.Button.prototype.onInputOutHandler=function(t,e){this.changeStateFrame(u);this.playStateSound(u);if(this.onInputOut){this.onInputOut.dispatch(this,e)}};r.Button.prototype.onInputDownHandler=function(t,e){this.changeStateFrame(c);this.playStateSound(c);if(this.onInputDown){this.onInputDown.dispatch(this,e)}};r.Button.prototype.onInputUpHandler=function(t,e,i){this.playStateSound(d);if(this.onInputUp){this.onInputUp.dispatch(this,e,i)}if(this.freezeFrames){return}if(this.forceOut===true||(this.forceOut&e.pointerMode)===e.pointerMode){this.changeStateFrame(u)}else{var s=this.changeStateFrame(d);if(!s){if(i){this.changeStateFrame(l)}else{this.changeStateFrame(u)}}}};r.SpriteBatch=function(t,e,i,s){if(e===undefined||e===null){e=t.world}PIXI.SpriteBatch.call(this);r.Group.call(this,t,e,i,s);this.type=r.SPRITEBATCH};r.SpriteBatch.prototype=r.Utils.extend(true,r.SpriteBatch.prototype,PIXI.SpriteBatch.prototype,r.Group.prototype);r.SpriteBatch.prototype.constructor=r.SpriteBatch;r.BitmapData=function(t,e,i,s,n){if(i===undefined||i===0){i=256}if(s===undefined||s===0){s=256}if(n===undefined){n=false}this.game=t;this.key=e;this.width=i;this.height=s;this.canvas=r.Canvas.create(this,i,s,null,n);this.context=this.canvas.getContext("2d",{alpha:true});this.ctx=this.context;this.smoothProperty=t.renderType===r.CANVAS?t.renderer.renderSession.smoothProperty:r.Canvas.getSmoothingPrefix(this.context);this.imageData=this.context.getImageData(0,0,i,s);this.data=null;if(this.imageData){this.data=this.imageData.data}this.pixels=null;if(this.data){if(this.imageData.data.buffer){this.buffer=this.imageData.data.buffer;this.pixels=new Uint32Array(this.buffer)}else{if(window["ArrayBuffer"]){this.buffer=new ArrayBuffer(this.imageData.data.length);this.pixels=new Uint32Array(this.buffer)}else{this.pixels=this.imageData.data}}}this.baseTexture=new PIXI.BaseTexture(this.canvas);this.texture=new PIXI.Texture(this.baseTexture);this.frameData=new r.FrameData;this.textureFrame=this.frameData.addFrame(new r.Frame(0,0,0,i,s,"bitmapData"));this.texture.frame=this.textureFrame;this.type=r.BITMAPDATA;this.disableTextureUpload=false;this.dirty=false;this.cls=this.clear;this._image=null;this._pos=new r.Point;this._size=new r.Point;this._scale=new r.Point;this._rotate=0;this._alpha={prev:1,current:1};this._anchor=new r.Point;this._tempR=0;this._tempG=0;this._tempB=0;this._circle=new r.Circle;this._swapCanvas=undefined};r.BitmapData.prototype={move:function(t,e,i){if(t!==0){this.moveH(t,i)}if(e!==0){this.moveV(e,i)}return this},moveH:function(t,e){if(e===undefined){e=true}if(this._swapCanvas===undefined){this._swapCanvas=PIXI.CanvasPool.create(this,this.width,this.height)}var i=this._swapCanvas;var s=i.getContext("2d");var r=this.height;var n=this.canvas;s.clearRect(0,0,this.width,this.height);if(t<0){t=Math.abs(t);var a=this.width-t;if(e){s.drawImage(n,0,0,t,r,a,0,t,r)}s.drawImage(n,t,0,a,r,0,0,a,r)}else{var a=this.width-t;if(e){s.drawImage(n,a,0,t,r,0,0,t,r)}s.drawImage(n,0,0,a,r,t,0,a,r)}this.clear();return this.copy(this._swapCanvas)},moveV:function(t,e){if(e===undefined){e=true}if(this._swapCanvas===undefined){this._swapCanvas=PIXI.CanvasPool.create(this,this.width,this.height)}var i=this._swapCanvas;var s=i.getContext("2d");var r=this.width;var n=this.canvas;s.clearRect(0,0,this.width,this.height);if(t<0){t=Math.abs(t);var a=this.height-t;if(e){s.drawImage(n,0,0,r,t,0,a,r,t)}s.drawImage(n,0,t,r,a,0,0,r,a)}else{var a=this.height-t;if(e){s.drawImage(n,0,a,r,t,0,0,r,t)}s.drawImage(n,0,0,r,a,0,t,r,a)}this.clear();return this.copy(this._swapCanvas)},add:function(t){if(Array.isArray(t)){for(var e=0;e<t.length;e++){if(t[e]["loadTexture"]){t[e].loadTexture(this)}}}else{t.loadTexture(this)}return this},load:function(t){if(typeof t==="string"){t=this.game.cache.getImage(t)}if(t){this.resize(t.width,t.height);this.cls()}else{return}this.draw(t);this.update();return this},clear:function(t,e,i,s){if(t===undefined){t=0}if(e===undefined){e=0}if(i===undefined){i=this.width}if(s===undefined){s=this.height}this.context.clearRect(t,e,i,s);this.dirty=true;return this},fill:function(t,e,i,s){if(s===undefined){s=1}this.context.fillStyle="rgba("+t+","+e+","+i+","+s+")";this.context.fillRect(0,0,this.width,this.height);this.dirty=true;return this},generateTexture:function(t){var e=new Image;e.src=this.canvas.toDataURL("image/png");var i=this.game.cache.addImage(t,"",e);return new PIXI.Texture(i.base)},resize:function(t,e){if(t!==this.width||e!==this.height){this.width=t;this.height=e;this.canvas.width=t;this.canvas.height=e;if(this._swapCanvas!==undefined){this._swapCanvas.width=t;this._swapCanvas.height=e}this.baseTexture.width=t;this.baseTexture.height=e;this.textureFrame.width=t;this.textureFrame.height=e;this.texture.width=t;this.texture.height=e;this.texture.crop.width=t;this.texture.crop.height=e;this.update();this.dirty=true}return this},update:function(t,e,i,s){if(t===undefined){t=0}if(e===undefined){e=0}if(i===undefined){i=Math.max(1,this.width)}if(s===undefined){s=Math.max(1,this.height)}this.imageData=this.context.getImageData(t,e,i,s);this.data=this.imageData.data;if(this.imageData.data.buffer){this.buffer=this.imageData.data.buffer;this.pixels=new Uint32Array(this.buffer)}else{if(window["ArrayBuffer"]){this.buffer=new ArrayBuffer(this.imageData.data.length);this.pixels=new Uint32Array(this.buffer)}else{this.pixels=this.imageData.data}}return this},processPixelRGB:function(t,e,i,s,n,a){if(i===undefined){i=0}if(s===undefined){s=0}if(n===undefined){n=this.width}if(a===undefined){a=this.height}var o=i+n;var h=s+a;var l=r.Color.createColor();var u={r:0,g:0,b:0,a:0};var c=false;for(var d=s;d<h;d++){for(var f=i;f<o;f++){r.Color.unpackPixel(this.getPixel32(f,d),l);u=t.call(e,l,f,d);if(u!==false&&u!==null&&u!==undefined){this.setPixel32(f,d,u.r,u.g,u.b,u.a,false);c=true}}}if(c){this.context.putImageData(this.imageData,0,0);this.dirty=true}return this},processPixel:function(t,e,i,s,r,n){if(i===undefined){i=0}if(s===undefined){s=0}if(r===undefined){r=this.width}if(n===undefined){n=this.height}var a=i+r;var o=s+n;var h=0;var l=0;var u=false;for(var c=s;c<o;c++){for(var d=i;d<a;d++){h=this.getPixel32(d,c);l=t.call(e,h,d,c);if(l!==h){this.pixels[c*this.width+d]=l;u=true}}}if(u){this.context.putImageData(this.imageData,0,0);this.dirty=true}return this},replaceRGB:function(t,e,i,s,n,a,o,h,l){var u=0;var c=0;var d=this.width;var f=this.height;var p=r.Color.packPixel(t,e,i,s);if(l!==undefined&&l instanceof r.Rectangle){u=l.x;c=l.y;d=l.width;f=l.height}for(var g=0;g<f;g++){for(var m=0;m<d;m++){if(this.getPixel32(u+m,c+g)===p){this.setPixel32(u+m,c+g,n,a,o,h,false)}}}this.context.putImageData(this.imageData,0,0);this.dirty=true;return this},setHSL:function(t,e,i,s){var n=t||t===0;var a=e||e===0;var o=i||i===0;if(!n&&!a&&!o){return}if(s===undefined){s=new r.Rectangle(0,0,this.width,this.height)}var h=r.Color.createColor();for(var l=s.y;l<s.bottom;l++){for(var u=s.x;u<s.right;u++){r.Color.unpackPixel(this.getPixel32(u,l),h,true);if(n){h.h=t}if(a){h.s=e}if(o){h.l=i}r.Color.HSLtoRGB(h.h,h.s,h.l,h);this.setPixel32(u,l,h.r,h.g,h.b,h.a,false)}}this.context.putImageData(this.imageData,0,0);this.dirty=true;return this},shiftHSL:function(t,e,i,s){if(t===undefined||t===null){t=false}if(e===undefined||e===null){e=false}if(i===undefined||i===null){i=false}if(!t&&!e&&!i){return}if(s===undefined){s=new r.Rectangle(0,0,this.width,this.height)}var n=r.Color.createColor();for(var a=s.y;a<s.bottom;a++){for(var o=s.x;o<s.right;o++){r.Color.unpackPixel(this.getPixel32(o,a),n,true);if(t){n.h=this.game.math.wrap(n.h+t,0,1)}if(e){n.s=this.game.math.clamp(n.s+e,0,1)}if(i){n.l=this.game.math.clamp(n.l+i,0,1)}r.Color.HSLtoRGB(n.h,n.s,n.l,n);this.setPixel32(o,a,n.r,n.g,n.b,n.a,false)}}this.context.putImageData(this.imageData,0,0);this.dirty=true;return this},setPixel32:function(t,e,i,s,n,a,o){if(o===undefined){o=true}if(t>=0&&t<=this.width&&e>=0&&e<=this.height){if(r.Device.LITTLE_ENDIAN){this.pixels[e*this.width+t]=a<<24|n<<16|s<<8|i}else{this.pixels[e*this.width+t]=i<<24|s<<16|n<<8|a}if(o){this.context.putImageData(this.imageData,0,0);this.dirty=true}}return this},setPixel:function(t,e,i,s,r,n){return this.setPixel32(t,e,i,s,r,255,n)},getPixel:function(t,e,i){if(!i){i=r.Color.createColor()}var s=~~(t+e*this.width);s*=4;i.r=this.data[s];i.g=this.data[++s];i.b=this.data[++s];i.a=this.data[++s];return i},getPixel32:function(t,e){if(t>=0&&t<=this.width&&e>=0&&e<=this.height){return this.pixels[e*this.width+t]}},getPixelRGB:function(t,e,i,s,n){return r.Color.unpackPixel(this.getPixel32(t,e),i,s,n)},getPixels:function(t){return this.context.getImageData(t.x,t.y,t.width,t.height)},getFirstPixel:function(t){if(t===undefined){t=0}var e=r.Color.createColor();var i=0;var s=0;var n=1;var a=false;if(t===1){n=-1;s=this.height}else if(t===3){n=-1;i=this.width}do{r.Color.unpackPixel(this.getPixel32(i,s),e);if(t===0||t===1){i++;if(i===this.width){i=0;s+=n;if(s>=this.height||s<=0){a=true}}}else if(t===2||t===3){s++;if(s===this.height){s=0;i+=n;if(i>=this.width||i<=0){a=true}}}}while(e.a===0&&!a);e.x=i;e.y=s;return e},getBounds:function(t){if(t===undefined){t=new r.Rectangle}t.x=this.getFirstPixel(2).x;if(t.x===this.width){return t.setTo(0,0,0,0)}t.y=this.getFirstPixel(0).y;t.width=this.getFirstPixel(3).x-t.x+1;t.height=this.getFirstPixel(1).y-t.y+1;return t},addToWorld:function(t,e,i,s,r,n){r=r||1;n=n||1;var a=this.game.add.image(t,e,this);a.anchor.set(i,s);a.scale.set(r,n);return a},copy:function(t,e,i,s,n,a,o,h,l,u,c,d,f,p,g,m,y){if(t===undefined||t===null){t=this}if(t instanceof r.RenderTexture||t instanceof PIXI.RenderTexture){t=t.getCanvas()}this._image=t;if(t instanceof r.Sprite||t instanceof r.Image||t instanceof r.Text||t instanceof PIXI.Sprite){this._pos.set(t.texture.crop.x,t.texture.crop.y);this._size.set(t.texture.crop.width,t.texture.crop.height);this._scale.set(t.scale.x,t.scale.y);this._anchor.set(t.anchor.x,t.anchor.y);this._rotate=t.rotation;this._alpha.current=t.alpha;if(t.texture instanceof r.RenderTexture||t.texture instanceof PIXI.RenderTexture){this._image=t.texture.getCanvas()}else{this._image=t.texture.baseTexture.source}if(a===undefined||a===null){a=t.x}if(o===undefined||o===null){o=t.y}if(t.texture.trim){a+=t.texture.trim.x-t.anchor.x*t.texture.trim.width;o+=t.texture.trim.y-t.anchor.y*t.texture.trim.height}if(t.tint!==16777215){if(t.cachedTint!==t.tint){t.cachedTint=t.tint;t.tintedTexture=PIXI.CanvasTinter.getTintedTexture(t,t.tint)}this._image=t.tintedTexture;this._pos.set(0)}}else{this._pos.set(0);this._scale.set(1);this._anchor.set(0);this._rotate=0;this._alpha.current=1;if(t instanceof r.BitmapData){this._image=t.canvas}else if(typeof t==="string"){t=this.game.cache.getImage(t);if(t===null){return}else{this._image=t}}this._size.set(this._image.width,this._image.height)}if(e===undefined||e===null){e=0}if(i===undefined||i===null){i=0}if(s){this._size.x=s}if(n){this._size.y=n}if(a===undefined||a===null){a=e}if(o===undefined||o===null){o=i}if(h===undefined||h===null){h=this._size.x}if(l===undefined||l===null){l=this._size.y}if(typeof u==="number"){this._rotate=u}if(typeof c==="number"){this._anchor.x=c}if(typeof d==="number"){this._anchor.y=d}if(typeof f==="number"){this._scale.x=f}if(typeof p==="number"){this._scale.y=p}if(typeof g==="number"){this._alpha.current=g}if(m===undefined){m=null}if(y===undefined){y=false}if(this._alpha.current<=0||this._scale.x===0||this._scale.y===0||this._size.x===0||this._size.y===0){return}var v=this.context;this._alpha.prev=v.globalAlpha;v.save();v.globalAlpha=this._alpha.current;if(m){this.op=m}if(y){a|=0;o|=0}v.translate(a,o);v.scale(this._scale.x,this._scale.y);v.rotate(this._rotate);v.drawImage(this._image,this._pos.x+e,this._pos.y+i,this._size.x,this._size.y,-h*this._anchor.x,-l*this._anchor.y,h,l);v.restore();v.globalAlpha=this._alpha.prev;this.dirty=true;return this},copyTransform:function(t,e,i){if(e===undefined){e=null}if(i===undefined){i=false}if(!t.hasOwnProperty("worldTransform")||!t.worldVisible||t.worldAlpha===0){return this}var s=t.worldTransform;this._pos.set(t.texture.crop.x,t.texture.crop.y);this._size.set(t.texture.crop.width,t.texture.crop.height);if(s.a===0||s.d===0||this._size.x===0||this._size.y===0){return this}if(t.texture instanceof r.RenderTexture||t.texture instanceof PIXI.RenderTexture){this._image=t.texture.getCanvas()}else{this._image=t.texture.baseTexture.source}var n=s.tx;var a=s.ty;if(t.texture.trim){n+=t.texture.trim.x-t.anchor.x*t.texture.trim.width;a+=t.texture.trim.y-t.anchor.y*t.texture.trim.height}if(t.tint!==16777215){if(t.cachedTint!==t.tint){t.cachedTint=t.tint;t.tintedTexture=PIXI.CanvasTinter.getTintedTexture(t,t.tint)}this._image=t.tintedTexture;this._pos.set(0)}if(i){n|=0;a|=0}var o=this.context;this._alpha.prev=o.globalAlpha;o.save();o.globalAlpha=this._alpha.current;if(e){this.op=e}o[this.smoothProperty]=t.texture.baseTexture.scaleMode===PIXI.scaleModes.LINEAR;o.setTransform(s.a,s.b,s.c,s.d,n,a);o.drawImage(this._image,this._pos.x,this._pos.y,this._size.x,this._size.y,-this._size.x*t.anchor.x,-this._size.y*t.anchor.y,this._size.x,this._size.y);o.restore();o.globalAlpha=this._alpha.prev;this.dirty=true;return this},copyRect:function(t,e,i,s,r,n,a){return this.copy(t,e.x,e.y,e.width,e.height,i,s,e.width,e.height,0,0,0,1,1,r,n,a)},draw:function(t,e,i,s,r,n,a){return this.copy(t,null,null,null,null,e,i,s,r,null,null,null,null,null,null,n,a)},drawGroup:function(t,e,i){if(t.total>0){t.forEachExists(this.drawGroupProxy,this,e,i)}return this},drawGroupProxy:function(t,e,i){if(t.hasOwnProperty("texture")){this.copyTransform(t,e,i)}if(t.type===r.GROUP&&t.exists){this.drawGroup(t,e,i)}else{if(t.hasOwnProperty("children")&&t.children.length>0){for(var s=0;s<t.children.length;s++){if(t.children[s].exists){this.copyTransform(t.children[s],e,i)}}}}},drawFull:function(t,e,i){if(t.worldVisible===false||t.worldAlpha===0||t.hasOwnProperty("exists")&&t.exists===false){return this}if(t.type!==r.GROUP&&t.type!==r.EMITTER&&t.type!==r.BITMAPTEXT){if(t.type===r.GRAPHICS){var s=t.getBounds();this.ctx.save();this.ctx.translate(s.x,s.y);PIXI.CanvasGraphics.renderGraphics(t,this.ctx);this.ctx.restore()}else{this.copy(t,null,null,null,null,t.worldPosition.x,t.worldPosition.y,null,null,t.worldRotation,null,null,t.worldScale.x,t.worldScale.y,t.worldAlpha,e,i)}}if(t.children){for(var n=0;n<t.children.length;n++){this.drawFull(t.children[n],e,i)}}return this},shadow:function(t,e,i,s){var r=this.context;if(t===undefined||t===null){r.shadowColor="rgba(0,0,0,0)"}else{r.shadowColor=t;r.shadowBlur=e||5;r.shadowOffsetX=i||10;r.shadowOffsetY=s||10}return this},alphaMask:function(t,e,i,s){if(s===undefined||s===null){this.draw(e).blendSourceAtop()}else{this.draw(e,s.x,s.y,s.width,s.height).blendSourceAtop()}if(i===undefined||i===null){this.draw(t).blendReset()}else{this.draw(t,i.x,i.y,i.width,i.height).blendReset()}return this},extract:function(t,e,i,s,r,n,a,o,h){if(r===undefined){r=255}if(n===undefined){n=false}if(a===undefined){a=e}if(o===undefined){o=i}if(h===undefined){h=s}if(n){t.resize(this.width,this.height)}this.processPixelRGB(function(n,l,u){if(n.r===e&&n.g===i&&n.b===s){t.setPixel32(l,u,a,o,h,r,false)}return false},this);t.context.putImageData(t.imageData,0,0);t.dirty=true;return t},rect:function(t,e,i,s,r){if(typeof r!=="undefined"){this.context.fillStyle=r}this.context.fillRect(t,e,i,s);return this},text:function(t,e,i,s,r,n){if(e===undefined){e=0}if(i===undefined){i=0}if(s===undefined){s="14px Courier"}if(r===undefined){r="rgb(255,255,255)"}if(n===undefined){n=true}var a=this.context;var o=a.font;a.font=s;if(n){a.fillStyle="rgb(0,0,0)";a.fillText(t,e+1,i+1)}a.fillStyle=r;a.fillText(t,e,i);a.font=o;return this},circle:function(t,e,i,s){var r=this.context;if(s!==undefined){r.fillStyle=s}r.beginPath();r.arc(t,e,i,0,Math.PI*2,false);r.closePath();r.fill();return this},line:function(t,e,i,s,r,n){if(r===undefined){r="#fff"}if(n===undefined){n=1}var a=this.context;a.beginPath();a.moveTo(t,e);a.lineTo(i,s);a.lineWidth=n;a.strokeStyle=r;a.stroke();a.closePath();return this},textureLine:function(t,e,i){if(i===undefined){i="repeat-x"}if(typeof e==="string"){e=this.game.cache.getImage(e);if(!e){return}}var s=t.length;if(i==="no-repeat"&&s>e.width){s=e.width}var n=this.context;n.fillStyle=n.createPattern(e,i);this._circle=new r.Circle(t.start.x,t.start.y,e.height);this._circle.circumferencePoint(t.angle-1.5707963267948966,false,this._pos);n.save();n.translate(this._pos.x,this._pos.y);n.rotate(t.angle);n.fillRect(0,0,s,e.height);n.restore();this.dirty=true;return this},render:function(){if(!this.disableTextureUpload&&this.dirty){this.baseTexture.dirty();this.dirty=false}return this},destroy:function(){this.frameData.destroy();this.texture.destroy(true);PIXI.CanvasPool.remove(this)},blendReset:function(){this.op="source-over";return this},blendSourceOver:function(){this.op="source-over";return this},blendSourceIn:function(){this.op="source-in";return this},blendSourceOut:function(){this.op="source-out";return this},blendSourceAtop:function(){this.op="source-atop";return this},blendDestinationOver:function(){this.op="destination-over";return this},blendDestinationIn:function(){this.op="destination-in";return this},blendDestinationOut:function(){this.op="destination-out";return this},blendDestinationAtop:function(){this.op="destination-atop";return this},blendXor:function(){this.op="xor";return this},blendAdd:function(){this.op="lighter";return this},blendMultiply:function(){this.op="multiply";return this},blendScreen:function(){this.op="screen";return this},blendOverlay:function(){this.op="overlay";return this},blendDarken:function(){this.op="darken";return this},blendLighten:function(){this.op="lighten";return this},blendColorDodge:function(){this.op="color-dodge";return this},blendColorBurn:function(){this.op="color-burn";return this},blendHardLight:function(){this.op="hard-light";return this},blendSoftLight:function(){this.op="soft-light";return this},blendDifference:function(){this.op="difference";return this},blendExclusion:function(){this.op="exclusion";return this},blendHue:function(){this.op="hue";return this},blendSaturation:function(){this.op="saturation";return this},blendColor:function(){this.op="color";return this},blendLuminosity:function(){this.op="luminosity";return this}};Object.defineProperty(r.BitmapData.prototype,"smoothed",{get:function(){r.Canvas.getSmoothingEnabled(this.context)},set:function(t){r.Canvas.setSmoothingEnabled(this.context,t)}});Object.defineProperty(r.BitmapData.prototype,"op",{get:function(){return this.context.globalCompositeOperation},set:function(t){this.context.globalCompositeOperation=t}});r.BitmapData.getTransform=function(t,e,i,s,r,n){if(typeof t!=="number"){t=0}if(typeof e!=="number"){e=0}if(typeof i!=="number"){i=1}if(typeof s!=="number"){s=1}if(typeof r!=="number"){r=0}if(typeof n!=="number"){n=0}return{sx:i,sy:s,scaleX:i,scaleY:s,skewX:r,skewY:n,translateX:t,translateY:e,tx:t,ty:e}};r.BitmapData.prototype.constructor=r.BitmapData;PIXI.Graphics=function(){PIXI.DisplayObjectContainer.call(this);this.renderable=true;this.fillAlpha=1;this.lineWidth=0;this.lineColor=0;this.graphicsData=[];this.tint=16777215;this.blendMode=PIXI.blendModes.NORMAL;this.currentPath=null;this._webGL=[];this.isMask=false;this.boundsPadding=0;this._localBounds=new PIXI.Rectangle(0,0,1,1);this.dirty=true;this._boundsDirty=false;this.webGLDirty=false;this.cachedSpriteDirty=false};PIXI.Graphics.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);PIXI.Graphics.prototype.constructor=PIXI.Graphics;PIXI.Graphics.prototype.lineStyle=function(t,e,i){this.lineWidth=t||0;this.lineColor=e||0;this.lineAlpha=i===undefined?1:i;if(this.currentPath){if(this.currentPath.shape.points.length){this.drawShape(new PIXI.Polygon(this.currentPath.shape.points.slice(-2)))}else{this.currentPath.lineWidth=this.lineWidth;this.currentPath.lineColor=this.lineColor;this.currentPath.lineAlpha=this.lineAlpha}}return this};PIXI.Graphics.prototype.moveTo=function(t,e){this.drawShape(new PIXI.Polygon([t,e]));return this};PIXI.Graphics.prototype.lineTo=function(t,e){if(!this.currentPath){this.moveTo(0,0)}this.currentPath.shape.points.push(t,e);this.dirty=true;this._boundsDirty=true;return this};PIXI.Graphics.prototype.quadraticCurveTo=function(t,e,i,s){if(this.currentPath){if(this.currentPath.shape.points.length===0){this.currentPath.shape.points=[0,0]}}else{this.moveTo(0,0)}var r,n,a=20,o=this.currentPath.shape.points;if(o.length===0){this.moveTo(0,0)}var h=o[o.length-2];var l=o[o.length-1];var u=0;for(var c=1;c<=a;++c){u=c/a;r=h+(t-h)*u;n=l+(e-l)*u;o.push(r+(t+(i-t)*u-r)*u,n+(e+(s-e)*u-n)*u)}this.dirty=true;this._boundsDirty=true;return this};PIXI.Graphics.prototype.bezierCurveTo=function(t,e,i,s,r,n){if(this.currentPath){if(this.currentPath.shape.points.length===0){this.currentPath.shape.points=[0,0]}}else{this.moveTo(0,0)}var a=20,o,h,l,u,c,d=this.currentPath.shape.points;var f=d[d.length-2];var p=d[d.length-1];var g=0;for(var m=1;m<=a;++m){g=m/a;o=1-g;h=o*o;l=h*o;u=g*g;c=u*g;d.push(l*f+3*h*g*t+3*o*u*i+c*r,l*p+3*h*g*e+3*o*u*s+c*n)}this.dirty=true;this._boundsDirty=true;return this};PIXI.Graphics.prototype.arcTo=function(t,e,i,s,r){if(this.currentPath){if(this.currentPath.shape.points.length===0){this.currentPath.shape.points.push(t,e)}}else{this.moveTo(t,e)}var n=this.currentPath.shape.points,a=n[n.length-2],o=n[n.length-1],h=o-e,l=a-t,u=s-e,c=i-t,d=Math.abs(h*c-l*u);if(d<1e-8||r===0){if(n[n.length-2]!==t||n[n.length-1]!==e){n.push(t,e)}}else{var f=h*h+l*l,p=u*u+c*c,g=h*u+l*c,m=r*Math.sqrt(f)/d,y=r*Math.sqrt(p)/d,v=m*g/f,b=y*g/p,x=m*c+y*l,w=m*u+y*h,_=l*(y+v),P=h*(y+v),T=c*(m+b),C=u*(m+b),S=Math.atan2(P-w,_-x),A=Math.atan2(C-w,T-x);this.arc(x+t,w+e,r,S,A,l*u>c*h)}this.dirty=true;this._boundsDirty=true;return this};PIXI.Graphics.prototype.arc=function(t,e,i,s,r,n,a){if(s===r){return this}if(n===undefined){n=false}if(a===undefined){a=40}if(!n&&r<=s){r+=Math.PI*2}else if(n&&s<=r){s+=Math.PI*2}var o=n?(s-r)*-1:r-s;var h=Math.ceil(Math.abs(o)/(Math.PI*2))*a;if(o===0){return this}var l=t+Math.cos(s)*i;var u=e+Math.sin(s)*i;if(n&&this.filling){this.moveTo(t,e)}else{this.moveTo(l,u)}var c=this.currentPath.shape.points;var d=o/(h*2);var f=d*2;var p=Math.cos(d);var g=Math.sin(d);var m=h-1;var y=m%1/m;for(var v=0;v<=m;v++){var b=v+y*v;var x=d+s+f*b;var w=Math.cos(x);var _=-Math.sin(x);c.push((p*w+g*_)*i+t,(p*-_+g*w)*i+e)}this.dirty=true;this._boundsDirty=true;return this};PIXI.Graphics.prototype.beginFill=function(t,e){this.filling=true;this.fillColor=t||0;this.fillAlpha=e===undefined?1:e;if(this.currentPath){if(this.currentPath.shape.points.length<=2){this.currentPath.fill=this.filling;this.currentPath.fillColor=this.fillColor;this.currentPath.fillAlpha=this.fillAlpha}}return this};PIXI.Graphics.prototype.endFill=function(){this.filling=false;this.fillColor=null;this.fillAlpha=1;return this};PIXI.Graphics.prototype.drawRect=function(t,e,i,s){this.drawShape(new PIXI.Rectangle(t,e,i,s));return this};PIXI.Graphics.prototype.drawRoundedRect=function(t,e,i,s,r){this.drawShape(new PIXI.RoundedRectangle(t,e,i,s,r));return this};PIXI.Graphics.prototype.drawCircle=function(t,e,i){this.drawShape(new PIXI.Circle(t,e,i));return this};PIXI.Graphics.prototype.drawEllipse=function(t,e,i,s){this.drawShape(new PIXI.Ellipse(t,e,i,s));return this};PIXI.Graphics.prototype.drawPolygon=function(t){if(t instanceof r.Polygon||t instanceof PIXI.Polygon){t=t.points}var e=t;if(!Array.isArray(e)){e=new Array(arguments.length);for(var i=0;i<e.length;++i){e[i]=arguments[i]}}this.drawShape(new r.Polygon(e));return this};PIXI.Graphics.prototype.clear=function(){this.lineWidth=0;this.filling=false;this.dirty=true;this._boundsDirty=true;this.clearDirty=true;this.graphicsData=[];this.updateLocalBounds();return this};PIXI.Graphics.prototype.generateTexture=function(t,e,i){if(t===undefined){t=1}if(e===undefined){e=PIXI.scaleModes.DEFAULT}if(i===undefined){i=0}var s=this.getBounds();s.width+=i;s.height+=i;var r=new PIXI.CanvasBuffer(s.width*t,s.height*t);var n=PIXI.Texture.fromCanvas(r.canvas,e);n.baseTexture.resolution=t;r.context.scale(t,t);r.context.translate(-s.x,-s.y);PIXI.CanvasGraphics.renderGraphics(this,r.context);return n};PIXI.Graphics.prototype._renderWebGL=function(t){if(this.visible===false||this.alpha===0||this.isMask===true)return;if(this._cacheAsBitmap){if(this.dirty||this.cachedSpriteDirty){this._generateCachedSprite();this.updateCachedSpriteTexture();this.cachedSpriteDirty=false;this.dirty=false}this._cachedSprite.worldAlpha=this.worldAlpha;PIXI.Sprite.prototype._renderWebGL.call(this._cachedSprite,t);return}else{t.spriteBatch.stop();t.blendModeManager.setBlendMode(this.blendMode);if(this._mask)t.maskManager.pushMask(this._mask,t);if(this._filters)t.filterManager.pushFilter(this._filterBlock);if(this.blendMode!==t.spriteBatch.currentBlendMode){t.spriteBatch.currentBlendMode=this.blendMode;var e=PIXI.blendModesWebGL[t.spriteBatch.currentBlendMode];t.spriteBatch.gl.blendFunc(e[0],e[1])}if(this.webGLDirty){this.dirty=true;this.webGLDirty=false}PIXI.WebGLGraphics.renderGraphics(this,t);if(this.children.length){t.spriteBatch.start();for(var i=0;i<this.children.length;i++){this.children[i]._renderWebGL(t)}t.spriteBatch.stop()}if(this._filters)t.filterManager.popFilter();if(this._mask)t.maskManager.popMask(this.mask,t);t.drawCount++;t.spriteBatch.start()}};PIXI.Graphics.prototype._renderCanvas=function(t){if(this.visible===false||this.alpha===0||this.isMask===true)return;if(this._prevTint!==this.tint){this.dirty=true;this._prevTint=this.tint}if(this._cacheAsBitmap){if(this.dirty||this.cachedSpriteDirty){this._generateCachedSprite();this.updateCachedSpriteTexture();this.cachedSpriteDirty=false;this.dirty=false}this._cachedSprite.alpha=this.alpha;PIXI.Sprite.prototype._renderCanvas.call(this._cachedSprite,t);return}else{var e=t.context;var i=this.worldTransform;if(this.blendMode!==t.currentBlendMode){t.currentBlendMode=this.blendMode;e.globalCompositeOperation=PIXI.blendModesCanvas[t.currentBlendMode]}if(this._mask){t.maskManager.pushMask(this._mask,t)}var s=t.resolution;var r=i.tx*t.resolution+t.shakeX;var n=i.ty*t.resolution+t.shakeY;e.setTransform(i.a*s,i.b*s,i.c*s,i.d*s,r,n);PIXI.CanvasGraphics.renderGraphics(this,e);for(var a=0;a<this.children.length;a++){this.children[a]._renderCanvas(t)}if(this._mask){t.maskManager.popMask(t)}}};PIXI.Graphics.prototype.getBounds=function(t){if(!this._currentBounds){if(!this.renderable){return PIXI.EmptyRectangle}if(this.dirty){this.updateLocalBounds();this.webGLDirty=true;this.cachedSpriteDirty=true;this.dirty=false}var e=this._localBounds;var i=e.x;var s=e.width+e.x;var r=e.y;var n=e.height+e.y;var a=t||this.worldTransform;var o=a.a;var h=a.b;var l=a.c;var u=a.d;var c=a.tx;var d=a.ty;var f=o*s+l*n+c;var p=u*n+h*s+d;var g=o*i+l*n+c;var m=u*n+h*i+d;var y=o*i+l*r+c;var v=u*r+h*i+d;var b=o*s+l*r+c;var x=u*r+h*s+d;var w=f;var _=p;var P=f;var T=p;P=g<P?g:P;P=y<P?y:P;P=b<P?b:P;T=m<T?m:T;T=v<T?v:T;T=x<T?x:T;w=g>w?g:w;w=y>w?y:w;w=b>w?b:w;_=m>_?m:_;_=v>_?v:_;_=x>_?x:_;this._bounds.x=P;this._bounds.width=w-P;this._bounds.y=T;this._bounds.height=_-T;this._currentBounds=this._bounds}return this._currentBounds};PIXI.Graphics.prototype.getLocalBounds=function(){var t=this.worldTransform;this.worldTransform=PIXI.identityMatrix;for(var e=0;e<this.children.length;e++){this.children[e].updateTransform()}var i=this.getBounds();this.worldTransform=t;for(e=0;e<this.children.length;e++){this.children[e].updateTransform()}return i};PIXI.Graphics.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,tempPoint);var e=this.graphicsData;for(var i=0;i<e.length;i++){var s=e[i];if(!s.fill){continue}if(s.shape){if(s.shape.contains(tempPoint.x,tempPoint.y)){return true}}}return false};PIXI.Graphics.prototype.updateLocalBounds=function(){var t=Infinity;var e=-Infinity;var i=Infinity;var s=-Infinity;if(this.graphicsData.length){var n,a,o,h,l,u;for(var c=0;c<this.graphicsData.length;c++){var d=this.graphicsData[c];var f=d.type;var p=d.lineWidth;n=d.shape;if(f===PIXI.Graphics.RECT||f===PIXI.Graphics.RREC){o=n.x-p/2;h=n.y-p/2;l=n.width+p;u=n.height+p;t=o<t?o:t;e=o+l>e?o+l:e;i=h<i?h:i;s=h+u>s?h+u:s}else if(f===PIXI.Graphics.CIRC){o=n.x;h=n.y;l=n.radius+p/2;u=n.radius+p/2;t=o-l<t?o-l:t;e=o+l>e?o+l:e;i=h-u<i?h-u:i;s=h+u>s?h+u:s}else if(f===PIXI.Graphics.ELIP){o=n.x;h=n.y;l=n.width+p/2;u=n.height+p/2;t=o-l<t?o-l:t;e=o+l>e?o+l:e;i=h-u<i?h-u:i;s=h+u>s?h+u:s}else{a=n.points;for(var g=0;g<a.length;g++){if(a[g]instanceof r.Point){o=a[g].x;h=a[g].y}else{o=a[g];h=a[g+1];if(g<a.length-1){g++}}t=o-p<t?o-p:t;e=o+p>e?o+p:e;i=h-p<i?h-p:i;s=h+p>s?h+p:s}}}}else{t=0;e=0;i=0;s=0}var m=this.boundsPadding;this._localBounds.x=t-m;this._localBounds.width=e-t+m*2;this._localBounds.y=i-m;this._localBounds.height=s-i+m*2};PIXI.Graphics.prototype._generateCachedSprite=function(){var t=this.getLocalBounds();if(!this._cachedSprite){var e=new PIXI.CanvasBuffer(t.width,t.height);var i=PIXI.Texture.fromCanvas(e.canvas);this._cachedSprite=new PIXI.Sprite(i);this._cachedSprite.buffer=e;this._cachedSprite.worldTransform=this.worldTransform}else{this._cachedSprite.buffer.resize(t.width,t.height)}this._cachedSprite.anchor.x=-(t.x/t.width);this._cachedSprite.anchor.y=-(t.y/t.height);this._cachedSprite.buffer.context.translate(-t.x,-t.y);this.worldAlpha=1;PIXI.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context);this._cachedSprite.alpha=this.alpha};PIXI.Graphics.prototype.updateCachedSpriteTexture=function(){var t=this._cachedSprite;var e=t.texture;var i=t.buffer.canvas;e.baseTexture.width=i.width;e.baseTexture.height=i.height;e.crop.width=e.frame.width=i.width;e.crop.height=e.frame.height=i.height;t._width=i.width;t._height=i.height;e.baseTexture.dirty()};PIXI.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(true);this._cachedSprite=null};PIXI.Graphics.prototype.drawShape=function(t){if(this.currentPath){if(this.currentPath.shape.points.length<=2){this.graphicsData.pop()}}this.currentPath=null;if(t instanceof r.Polygon){t=t.clone();t.flatten()}var e=new PIXI.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,t);this.graphicsData.push(e);if(e.type===PIXI.Graphics.POLY){e.shape.closed=this.filling;this.currentPath=e}this.dirty=true;this._boundsDirty=true;return e};Object.defineProperty(PIXI.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(t){this._cacheAsBitmap=t;if(this._cacheAsBitmap){this._generateCachedSprite()}else{this.destroyCachedSprite()}this.dirty=true;this.webGLDirty=true}});PIXI.GraphicsData=function(t,e,i,s,r,n,a){this.lineWidth=t;this.lineColor=e;this.lineAlpha=i;this._lineTint=e;this.fillColor=s;this.fillAlpha=r;this._fillTint=s;this.fill=n;this.shape=a;this.type=a.type};PIXI.GraphicsData.prototype.constructor=PIXI.GraphicsData;PIXI.GraphicsData.prototype.clone=function(){return new GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)};PIXI.EarCut={};PIXI.EarCut.Triangulate=function(t,e,i){i=i||2;var s=e&&e.length,r=s?e[0]*i:t.length,n=PIXI.EarCut.linkedList(t,0,r,i,true),a=[];if(!n)return a;var o,h,l,u,c,d,f;if(s)n=PIXI.EarCut.eliminateHoles(t,e,n,i);if(t.length>80*i){o=l=t[0];h=u=t[1];for(var p=i;p<r;p+=i){c=t[p];d=t[p+1];if(c<o)o=c;if(d<h)h=d;if(c>l)l=c;if(d>u)u=d}f=Math.max(l-o,u-h)}PIXI.EarCut.earcutLinked(n,a,i,o,h,f);return a};PIXI.EarCut.linkedList=function(t,e,i,s,r){var n=0,a,o,h;for(a=e,o=i-s;a<i;a+=s){n+=(t[o]-t[a])*(t[a+1]+t[o+1]);o=a}if(r===n>0){for(a=e;a<i;a+=s)h=PIXI.EarCut.insertNode(a,t[a],t[a+1],h)}else{for(a=i-s;a>=e;a-=s)h=PIXI.EarCut.insertNode(a,t[a],t[a+1],h)}return h};PIXI.EarCut.filterPoints=function(t,e){if(!t)return t;if(!e)e=t;var i=t,s;do{s=false;if(!i.steiner&&(PIXI.EarCut.equals(i,i.next)||PIXI.EarCut.area(i.prev,i,i.next)===0)){PIXI.EarCut.removeNode(i);i=e=i.prev;if(i===i.next)return null;s=true}else{i=i.next}}while(s||i!==e);return e};PIXI.EarCut.earcutLinked=function(t,e,i,s,r,n,a){if(!t)return;if(!a&&n)PIXI.EarCut.indexCurve(t,s,r,n);var o=t,h,l;while(t.prev!==t.next){h=t.prev;l=t.next;if(n?PIXI.EarCut.isEarHashed(t,s,r,n):PIXI.EarCut.isEar(t)){e.push(h.i/i);e.push(t.i/i);e.push(l.i/i);PIXI.EarCut.removeNode(t);t=l.next;o=l.next;continue}t=l;if(t===o){if(!a){PIXI.EarCut.earcutLinked(PIXI.EarCut.filterPoints(t),e,i,s,r,n,1)}else if(a===1){t=PIXI.EarCut.cureLocalIntersections(t,e,i);PIXI.EarCut.earcutLinked(t,e,i,s,r,n,2)}else if(a===2){PIXI.EarCut.splitEarcut(t,e,i,s,r,n)}break}}};PIXI.EarCut.isEar=function(t){var e=t.prev,i=t,s=t.next;if(PIXI.EarCut.area(e,i,s)>=0)return false;var r=t.next.next;while(r!==t.prev){if(PIXI.EarCut.pointInTriangle(e.x,e.y,i.x,i.y,s.x,s.y,r.x,r.y)&&PIXI.EarCut.area(r.prev,r,r.next)>=0)return false;r=r.next}return true};PIXI.EarCut.isEarHashed=function(t,e,i,s){var r=t.prev,n=t,a=t.next;if(PIXI.EarCut.area(r,n,a)>=0)return false;var o=r.x<n.x?r.x<a.x?r.x:a.x:n.x<a.x?n.x:a.x,h=r.y<n.y?r.y<a.y?r.y:a.y:n.y<a.y?n.y:a.y,l=r.x>n.x?r.x>a.x?r.x:a.x:n.x>a.x?n.x:a.x,u=r.y>n.y?r.y>a.y?r.y:a.y:n.y>a.y?n.y:a.y;var c=PIXI.EarCut.zOrder(o,h,e,i,s),d=PIXI.EarCut.zOrder(l,u,e,i,s);var f=t.nextZ;while(f&&f.z<=d){if(f!==t.prev&&f!==t.next&&PIXI.EarCut.pointInTriangle(r.x,r.y,n.x,n.y,a.x,a.y,f.x,f.y)&&PIXI.EarCut.area(f.prev,f,f.next)>=0)return false;f=f.nextZ}f=t.prevZ;while(f&&f.z>=c){if(f!==t.prev&&f!==t.next&&PIXI.EarCut.pointInTriangle(r.x,r.y,n.x,n.y,a.x,a.y,f.x,f.y)&&PIXI.EarCut.area(f.prev,f,f.next)>=0)return false;f=f.prevZ}return true};PIXI.EarCut.cureLocalIntersections=function(t,e,i){var s=t;do{var r=s.prev,n=s.next.next;if(PIXI.EarCut.intersects(r,s,s.next,n)&&PIXI.EarCut.locallyInside(r,n)&&PIXI.EarCut.locallyInside(n,r)){e.push(r.i/i);e.push(s.i/i);e.push(n.i/i);PIXI.EarCut.removeNode(s);PIXI.EarCut.removeNode(s.next);s=t=n}s=s.next}while(s!==t);return s};PIXI.EarCut.splitEarcut=function(t,e,i,s,r,n){var a=t;do{var o=a.next.next;while(o!==a.prev){if(a.i!==o.i&&PIXI.EarCut.isValidDiagonal(a,o)){var h=PIXI.EarCut.splitPolygon(a,o);a=PIXI.EarCut.filterPoints(a,a.next);h=PIXI.EarCut.filterPoints(h,h.next);PIXI.EarCut.earcutLinked(a,e,i,s,r,n);PIXI.EarCut.earcutLinked(h,e,i,s,r,n);return}o=o.next}a=a.next}while(a!==t)};PIXI.EarCut.eliminateHoles=function(t,e,i,s){var r=[],n,a,o,h,l;for(n=0,a=e.length;n<a;n++){o=e[n]*s;h=n<a-1?e[n+1]*s:t.length;l=PIXI.EarCut.linkedList(t,o,h,s,false);if(l===l.next)l.steiner=true;r.push(PIXI.EarCut.getLeftmost(l))}r.sort(compareX);for(n=0;n<r.length;n++){PIXI.EarCut.eliminateHole(r[n],i);i=PIXI.EarCut.filterPoints(i,i.next)}return i};PIXI.EarCut.compareX=function(t,e){return t.x-e.x};PIXI.EarCut.eliminateHole=function(t,e){e=PIXI.EarCut.findHoleBridge(t,e);if(e){var i=PIXI.EarCut.splitPolygon(e,t);PIXI.EarCut.filterPoints(i,i.next)}};PIXI.EarCut.findHoleBridge=function(t,e){var i=e,s=t.x,r=t.y,n=-Infinity,a;do{if(r<=i.y&&r>=i.next.y){var o=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(o<=s&&o>n){n=o;a=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!a)return null;if(t.x===a.x)return a.prev;var h=a,l=Infinity,u;i=a.next;while(i!==h){if(s>=i.x&&i.x>=a.x&&PIXI.EarCut.pointInTriangle(r<a.y?s:n,r,a.x,a.y,r<a.y?n:s,r,i.x,i.y)){u=Math.abs(r-i.y)/(s-i.x);if((u<l||u===l&&i.x>a.x)&&PIXI.EarCut.locallyInside(i,t)){a=i;l=u}}i=i.next}return a};PIXI.EarCut.indexCurve=function(t,e,i,s){var r=t;do{if(r.z===null)r.z=PIXI.EarCut.zOrder(r.x,r.y,e,i,s);r.prevZ=r.prev;r.nextZ=r.next;r=r.next}while(r!==t);r.prevZ.nextZ=null;r.prevZ=null;PIXI.EarCut.sortLinked(r)};PIXI.EarCut.sortLinked=function(t){var e,i,s,r,n,a,o,h,l=1;do{i=t;t=null;n=null;a=0;while(i){a++;s=i;o=0;for(e=0;e<l;e++){o++;s=s.nextZ;if(!s)break}h=l;while(o>0||h>0&&s){if(o===0){r=s;s=s.nextZ;h--}else if(h===0||!s){r=i;i=i.nextZ;o--}else if(i.z<=s.z){r=i;i=i.nextZ;o--}else{r=s;s=s.nextZ;h--}if(n)n.nextZ=r;else t=r;r.prevZ=n;n=r}i=s}n.nextZ=null;l*=2}while(a>1);return t};PIXI.EarCut.zOrder=function(t,e,i,s,r){t=32767*(t-i)/r;e=32767*(e-s)/r;t=(t|t<<8)&16711935;t=(t|t<<4)&252645135;t=(t|t<<2)&858993459;t=(t|t<<1)&1431655765;e=(e|e<<8)&16711935;e=(e|e<<4)&252645135;e=(e|e<<2)&858993459;e=(e|e<<1)&1431655765;return t|e<<1};PIXI.EarCut.getLeftmost=function(t){var e=t,i=t;do{if(e.x<i.x)i=e;e=e.next}while(e!==t);return i};PIXI.EarCut.pointInTriangle=function(t,e,i,s,r,n,a,o){return(r-a)*(e-o)-(t-a)*(n-o)>=0&&(t-a)*(s-o)-(i-a)*(e-o)>=0&&(i-a)*(n-o)-(r-a)*(s-o)>=0};PIXI.EarCut.isValidDiagonal=function(t,e){return PIXI.EarCut.equals(t,e)||t.next.i!==e.i&&t.prev.i!==e.i&&!PIXI.EarCut.intersectsPolygon(t,e)&&PIXI.EarCut.locallyInside(t,e)&&PIXI.EarCut.locallyInside(e,t)&&PIXI.EarCut.middleInside(t,e)};PIXI.EarCut.area=function(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)};PIXI.EarCut.equals=function(t,e){return t.x===e.x&&t.y===e.y};PIXI.EarCut.intersects=function(t,e,i,s){return PIXI.EarCut.area(t,e,i)>0!==PIXI.EarCut.area(t,e,s)>0&&PIXI.EarCut.area(i,s,t)>0!==PIXI.EarCut.area(i,s,e)>0};PIXI.EarCut.intersectsPolygon=function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&PIXI.EarCut.intersects(i,i.next,t,e))return true;i=i.next}while(i!==t);return false};PIXI.EarCut.locallyInside=function(t,e){return PIXI.EarCut.area(t.prev,t,t.next)<0?PIXI.EarCut.area(t,e,t.next)>=0&&PIXI.EarCut.area(t,t.prev,e)>=0:PIXI.EarCut.area(t,e,t.prev)<0||PIXI.EarCut.area(t,t.next,e)<0};PIXI.EarCut.middleInside=function(t,e){var i=t,s=false,r=(t.x+e.x)/2,n=(t.y+e.y)/2;do{if(i.y>n!==i.next.y>n&&r<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x)s=!s;i=i.next}while(i!==t);return s};PIXI.EarCut.splitPolygon=function(t,e){var i=new PIXI.EarCut.Node(t.i,t.x,t.y),s=new PIXI.EarCut.Node(e.i,e.x,e.y),r=t.next,n=e.prev;t.next=e;e.prev=t;i.next=r;r.prev=i;s.next=i;i.prev=s;n.next=s;s.prev=n;return s};PIXI.EarCut.insertNode=function(t,e,i,s){var r=new PIXI.EarCut.Node(t,e,i);if(!s){r.prev=r;r.next=r}else{r.next=s.next;r.prev=s;s.next.prev=r;s.next=r}return r};PIXI.EarCut.removeNode=function(t){t.next.prev=t.prev;t.prev.next=t.next;if(t.prevZ)t.prevZ.nextZ=t.nextZ;if(t.nextZ)t.nextZ.prevZ=t.prevZ};PIXI.EarCut.Node=function(t,e,i){this.i=t;this.x=e;this.y=i;this.prev=null;this.next=null;this.z=null;this.prevZ=null;this.nextZ=null;this.steiner=false};PIXI.WebGLGraphics=function(){};PIXI.WebGLGraphics.stencilBufferLimit=6;PIXI.WebGLGraphics.renderGraphics=function(t,e){var i=e.gl;var s=e.projection,r=e.offset,n=e.shaderManager.primitiveShader,a;if(t.dirty){PIXI.WebGLGraphics.updateGraphics(t,i)}var o=t._webGL[i.id];for(var h=0;h<o.data.length;h++){if(o.data[h].mode===1){a=o.data[h];e.stencilManager.pushStencil(t,a,e);i.drawElements(i.TRIANGLE_FAN,4,i.UNSIGNED_SHORT,(a.indices.length-4)*2);e.stencilManager.popStencil(t,a,e)}else{a=o.data[h];e.shaderManager.setShader(n);n=e.shaderManager.primitiveShader;i.uniformMatrix3fv(n.translationMatrix,false,t.worldTransform.toArray(true));i.uniform1f(n.flipY,1);i.uniform2f(n.projectionVector,s.x,-s.y);i.uniform2f(n.offsetVector,-r.x,-r.y);i.uniform3fv(n.tintColor,PIXI.hex2rgb(t.tint));i.uniform1f(n.alpha,t.worldAlpha);i.bindBuffer(i.ARRAY_BUFFER,a.buffer);i.vertexAttribPointer(n.aVertexPosition,2,i.FLOAT,false,4*6,0);i.vertexAttribPointer(n.colorAttribute,4,i.FLOAT,false,4*6,2*4);i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,a.indexBuffer);i.drawElements(i.TRIANGLE_STRIP,a.indices.length,i.UNSIGNED_SHORT,0)}}};PIXI.WebGLGraphics.updateGraphics=function(t,e){var i=t._webGL[e.id];if(!i)i=t._webGL[e.id]={lastIndex:0,data:[],gl:e};t.dirty=false;var s;if(t.clearDirty){t.clearDirty=false;for(s=0;s<i.data.length;s++){var r=i.data[s];r.reset();PIXI.WebGLGraphics.graphicsDataPool.push(r)}i.data=[];i.lastIndex=0}var n;for(s=i.lastIndex;s<t.graphicsData.length;s++){var a=t.graphicsData[s];if(a.type===PIXI.Graphics.POLY){a.points=a.shape.points.slice();if(a.shape.closed){if(a.points[0]!==a.points[a.points.length-2]||a.points[1]!==a.points[a.points.length-1]){a.points.push(a.points[0],a.points[1])}}if(a.fill){if(a.points.length>=PIXI.WebGLGraphics.stencilBufferLimit){if(a.points.length<PIXI.WebGLGraphics.stencilBufferLimit*2){n=PIXI.WebGLGraphics.switchMode(i,0);var o=PIXI.WebGLGraphics.buildPoly(a,n);if(!o){n=PIXI.WebGLGraphics.switchMode(i,1);PIXI.WebGLGraphics.buildComplexPoly(a,n)}}else{n=PIXI.WebGLGraphics.switchMode(i,1);PIXI.WebGLGraphics.buildComplexPoly(a,n)}}}if(a.lineWidth>0){n=PIXI.WebGLGraphics.switchMode(i,0);PIXI.WebGLGraphics.buildLine(a,n)}}else{n=PIXI.WebGLGraphics.switchMode(i,0);if(a.type===PIXI.Graphics.RECT){PIXI.WebGLGraphics.buildRectangle(a,n)}else if(a.type===PIXI.Graphics.CIRC||a.type===PIXI.Graphics.ELIP){PIXI.WebGLGraphics.buildCircle(a,n)}else if(a.type===PIXI.Graphics.RREC){PIXI.WebGLGraphics.buildRoundedRectangle(a,n)}}i.lastIndex++}for(s=0;s<i.data.length;s++){n=i.data[s];if(n.dirty)n.upload()}};PIXI.WebGLGraphics.switchMode=function(t,e){var i;if(!t.data.length){i=PIXI.WebGLGraphics.graphicsDataPool.pop()||new PIXI.WebGLGraphicsData(t.gl);i.mode=e;t.data.push(i)}else{i=t.data[t.data.length-1];if(i.mode!==e||e===1){i=PIXI.WebGLGraphics.graphicsDataPool.pop()||new PIXI.WebGLGraphicsData(t.gl);i.mode=e;t.data.push(i)}}i.dirty=true;return i};PIXI.WebGLGraphics.buildRectangle=function(t,e){var i=t.shape;var s=i.x;var r=i.y;var n=i.width;var a=i.height;if(t.fill){var o=PIXI.hex2rgb(t.fillColor);var h=t.fillAlpha;var l=o[0]*h;var u=o[1]*h;var c=o[2]*h;var d=e.points;var f=e.indices;var p=d.length/6;d.push(s,r);d.push(l,u,c,h);d.push(s+n,r);d.push(l,u,c,h);d.push(s,r+a);d.push(l,u,c,h);d.push(s+n,r+a);d.push(l,u,c,h);f.push(p,p,p+1,p+2,p+3,p+3)}if(t.lineWidth){var g=t.points;t.points=[s,r,s+n,r,s+n,r+a,s,r+a,s,r];PIXI.WebGLGraphics.buildLine(t,e);t.points=g}};PIXI.WebGLGraphics.buildRoundedRectangle=function(t,e){var i=t.shape;var s=i.x;var r=i.y;var n=i.width;var a=i.height;var o=i.radius;var h=[];h.push(s,r+o);h=h.concat(PIXI.WebGLGraphics.quadraticBezierCurve(s,r+a-o,s,r+a,s+o,r+a));h=h.concat(PIXI.WebGLGraphics.quadraticBezierCurve(s+n-o,r+a,s+n,r+a,s+n,r+a-o));h=h.concat(PIXI.WebGLGraphics.quadraticBezierCurve(s+n,r+o,s+n,r,s+n-o,r));h=h.concat(PIXI.WebGLGraphics.quadraticBezierCurve(s+o,r,s,r,s,r+o));if(t.fill){var l=PIXI.hex2rgb(t.fillColor);var u=t.fillAlpha;var c=l[0]*u;var d=l[1]*u;var f=l[2]*u;var p=e.points;var g=e.indices;var m=p.length/6;var y=PIXI.EarCut.Triangulate(h,null,2);var v=0;for(v=0;v<y.length;v+=3){g.push(y[v]+m);g.push(y[v]+m);g.push(y[v+1]+m);g.push(y[v+2]+m);g.push(y[v+2]+m)}for(v=0;v<h.length;v++){p.push(h[v],h[++v],c,d,f,u)}}if(t.lineWidth){var b=t.points;t.points=h;PIXI.WebGLGraphics.buildLine(t,e);t.points=b}};PIXI.WebGLGraphics.quadraticBezierCurve=function(t,e,i,s,r,n){var a,o,h,l,u,c,d=20,f=[];function p(t,e,i){var s=e-t;return t+s*i}var g=0;for(var m=0;m<=d;m++){g=m/d;a=p(t,i,g);o=p(e,s,g);h=p(i,r,g);l=p(s,n,g);u=p(a,h,g);c=p(o,l,g);f.push(u,c)}return f};PIXI.WebGLGraphics.buildCircle=function(t,e){var i=t.shape;var s=i.x;var r=i.y;var n;var a;if(t.type===PIXI.Graphics.CIRC){n=i.radius;a=i.radius}else{n=i.width;a=i.height}var o=40;var h=Math.PI*2/o;var l=0;if(t.fill){var u=PIXI.hex2rgb(t.fillColor);var c=t.fillAlpha;var d=u[0]*c;var f=u[1]*c;var p=u[2]*c;var g=e.points;var m=e.indices;var y=g.length/6;m.push(y);for(l=0;l<o+1;l++){g.push(s,r,d,f,p,c);g.push(s+Math.sin(h*l)*n,r+Math.cos(h*l)*a,d,f,p,c);m.push(y++,y++)}m.push(y-1)}if(t.lineWidth){var v=t.points;t.points=[];for(l=0;l<o+1;l++){t.points.push(s+Math.sin(h*l)*n,r+Math.cos(h*l)*a)}PIXI.WebGLGraphics.buildLine(t,e);t.points=v}};PIXI.WebGLGraphics.buildLine=function(t,e){var i=0;var s=t.points;if(s.length===0)return;if(t.lineWidth%2){for(i=0;i<s.length;i++){s[i]+=.5}}var r=new PIXI.Point(s[0],s[1]);var n=new PIXI.Point(s[s.length-2],s[s.length-1]);if(r.x===n.x&&r.y===n.y){s=s.slice();s.pop();s.pop();n=new PIXI.Point(s[s.length-2],s[s.length-1]);var a=n.x+(r.x-n.x)*.5;var o=n.y+(r.y-n.y)*.5;s.unshift(a,o);s.push(a,o)}var h=e.points;var l=e.indices;var u=s.length/2;var c=s.length;var d=h.length/6;var f=t.lineWidth/2;var p=PIXI.hex2rgb(t.lineColor);var g=t.lineAlpha;var m=p[0]*g;var y=p[1]*g;var v=p[2]*g;var b,x,w,_,P,T,C,S;var A,E,I,M,R,L;var B,O,k,F,D,U;var G,N,X;w=s[0];_=s[1];P=s[2];T=s[3];A=-(_-T);E=w-P;X=Math.sqrt(A*A+E*E);A/=X;E/=X;A*=f;E*=f;h.push(w-A,_-E,m,y,v,g);h.push(w+A,_+E,m,y,v,g);for(i=1;i<u-1;i++){w=s[(i-1)*2];_=s[(i-1)*2+1];P=s[i*2];T=s[i*2+1];C=s[(i+1)*2];S=s[(i+1)*2+1];A=-(_-T);E=w-P;X=Math.sqrt(A*A+E*E);A/=X;E/=X;A*=f;E*=f;I=-(T-S);M=P-C;X=Math.sqrt(I*I+M*M);I/=X;M/=X;I*=f;M*=f;B=-E+_-(-E+T);O=-A+P-(-A+w);k=(-A+w)*(-E+T)-(-A+P)*(-E+_);F=-M+S-(-M+T);D=-I+P-(-I+C);U=(-I+C)*(-M+T)-(-I+P)*(-M+S);G=B*D-F*O;if(Math.abs(G)<.1){G+=10.1;h.push(P-A,T-E,m,y,v,g);h.push(P+A,T+E,m,y,v,g);continue}b=(O*U-D*k)/G;x=(F*k-B*U)/G;N=(b-P)*(b-P)+(x-T)+(x-T);if(N>140*140){R=A-I;L=E-M;X=Math.sqrt(R*R+L*L);R/=X;L/=X;R*=f;L*=f;h.push(P-R,T-L);h.push(m,y,v,g);h.push(P+R,T+L);h.push(m,y,v,g);h.push(P-R,T-L);h.push(m,y,v,g);c++}else{h.push(b,x);h.push(m,y,v,g);h.push(P-(b-P),T-(x-T));h.push(m,y,v,g)}}w=s[(u-2)*2];_=s[(u-2)*2+1];P=s[(u-1)*2];T=s[(u-1)*2+1];A=-(_-T);E=w-P;X=Math.sqrt(A*A+E*E);A/=X;E/=X;A*=f;E*=f;h.push(P-A,T-E);h.push(m,y,v,g);h.push(P+A,T+E);h.push(m,y,v,g);l.push(d);for(i=0;i<c;i++){l.push(d++)}l.push(d-1)};PIXI.WebGLGraphics.buildComplexPoly=function(t,e){var i=t.points.slice();if(i.length<6)return;var s=e.indices;e.points=i;e.alpha=t.fillAlpha;e.color=PIXI.hex2rgb(t.fillColor);var r=Infinity;var n=-Infinity;var a=Infinity;var o=-Infinity;var h,l;for(var u=0;u<i.length;u+=2){h=i[u];l=i[u+1];r=h<r?h:r;n=h>n?h:n;a=l<a?l:a;o=l>o?l:o}i.push(r,a,n,a,n,o,r,o);var c=i.length/2;for(u=0;u<c;u++){s.push(u)}};PIXI.WebGLGraphics.buildPoly=function(t,e){var i=t.points;if(i.length<6)return;var s=e.points;var r=e.indices;var n=i.length/2;var a=PIXI.hex2rgb(t.fillColor);var o=t.fillAlpha;var h=a[0]*o;var l=a[1]*o;var u=a[2]*o;var c=PIXI.EarCut.Triangulate(i,null,2);if(!c)return false;var d=s.length/6;var f=0;for(f=0;f<c.length;f+=3){r.push(c[f]+d);r.push(c[f]+d);r.push(c[f+1]+d);r.push(c[f+2]+d);r.push(c[f+2]+d)}for(f=0;f<n;f++){s.push(i[f*2],i[f*2+1],h,l,u,o)}return true};PIXI.WebGLGraphics.graphicsDataPool=[];PIXI.WebGLGraphicsData=function(t){this.gl=t;this.color=[0,0,0];this.points=[];this.indices=[];this.buffer=t.createBuffer();this.indexBuffer=t.createBuffer();this.mode=1;this.alpha=1;this.dirty=true};PIXI.WebGLGraphicsData.prototype.reset=function(){this.points=[];this.indices=[]};PIXI.WebGLGraphicsData.prototype.upload=function(){var t=this.gl;this.glPoints=new PIXI.Float32Array(this.points);t.bindBuffer(t.ARRAY_BUFFER,this.buffer);t.bufferData(t.ARRAY_BUFFER,this.glPoints,t.STATIC_DRAW);this.glIndicies=new PIXI.Uint16Array(this.indices);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.glIndicies,t.STATIC_DRAW);this.dirty=false};PIXI.CanvasGraphics=function(){};PIXI.CanvasGraphics.renderGraphics=function(t,e){var i=t.worldAlpha;if(t.dirty){this.updateGraphicsTint(t);t.dirty=false}for(var s=0;s<t.graphicsData.length;s++){var r=t.graphicsData[s];var n=r.shape;var a=r._fillTint;var o=r._lineTint;e.lineWidth=r.lineWidth;if(r.type===PIXI.Graphics.POLY){e.beginPath();var h=n.points;e.moveTo(h[0],h[1]);for(var l=1;l<h.length/2;l++){e.lineTo(h[l*2],h[l*2+1])}if(n.closed){e.lineTo(h[0],h[1])}if(h[0]===h[h.length-2]&&h[1]===h[h.length-1]){e.closePath()}if(r.fill){e.globalAlpha=r.fillAlpha*i;e.fillStyle="#"+("00000"+(a|0).toString(16)).substr(-6);e.fill()}if(r.lineWidth){e.globalAlpha=r.lineAlpha*i;e.strokeStyle="#"+("00000"+(o|0).toString(16)).substr(-6);e.stroke()}}else if(r.type===PIXI.Graphics.RECT){if(r.fillColor||r.fillColor===0){e.globalAlpha=r.fillAlpha*i;e.fillStyle="#"+("00000"+(a|0).toString(16)).substr(-6);e.fillRect(n.x,n.y,n.width,n.height)}if(r.lineWidth){e.globalAlpha=r.lineAlpha*i;e.strokeStyle="#"+("00000"+(o|0).toString(16)).substr(-6);e.strokeRect(n.x,n.y,n.width,n.height)}}else if(r.type===PIXI.Graphics.CIRC){e.beginPath();e.arc(n.x,n.y,n.radius,0,2*Math.PI);e.closePath();if(r.fill){e.globalAlpha=r.fillAlpha*i;e.fillStyle="#"+("00000"+(a|0).toString(16)).substr(-6);e.fill()}if(r.lineWidth){e.globalAlpha=r.lineAlpha*i;e.strokeStyle="#"+("00000"+(o|0).toString(16)).substr(-6);e.stroke()}}else if(r.type===PIXI.Graphics.ELIP){var u=n.width*2;var c=n.height*2;var d=n.x-u/2;var f=n.y-c/2;e.beginPath();var p=.5522848,g=u/2*p,m=c/2*p,y=d+u,v=f+c,b=d+u/2,x=f+c/2;e.moveTo(d,x);e.bezierCurveTo(d,x-m,b-g,f,b,f);e.bezierCurveTo(b+g,f,y,x-m,y,x);e.bezierCurveTo(y,x+m,b+g,v,b,v);e.bezierCurveTo(b-g,v,d,x+m,d,x);e.closePath();if(r.fill){e.globalAlpha=r.fillAlpha*i;e.fillStyle="#"+("00000"+(a|0).toString(16)).substr(-6);e.fill()}if(r.lineWidth){e.globalAlpha=r.lineAlpha*i;e.strokeStyle="#"+("00000"+(o|0).toString(16)).substr(-6);e.stroke()}}else if(r.type===PIXI.Graphics.RREC){var w=n.x;var _=n.y;var P=n.width;var T=n.height;var C=n.radius;var S=Math.min(P,T)/2|0;C=C>S?S:C;e.beginPath();e.moveTo(w,_+C);e.lineTo(w,_+T-C);e.quadraticCurveTo(w,_+T,w+C,_+T);e.lineTo(w+P-C,_+T);e.quadraticCurveTo(w+P,_+T,w+P,_+T-C);e.lineTo(w+P,_+C);e.quadraticCurveTo(w+P,_,w+P-C,_);e.lineTo(w+C,_);e.quadraticCurveTo(w,_,w,_+C);e.closePath();if(r.fillColor||r.fillColor===0){e.globalAlpha=r.fillAlpha*i;e.fillStyle="#"+("00000"+(a|0).toString(16)).substr(-6);e.fill()}if(r.lineWidth){e.globalAlpha=r.lineAlpha*i;e.strokeStyle="#"+("00000"+(o|0).toString(16)).substr(-6);e.stroke()}}}};PIXI.CanvasGraphics.renderGraphicsMask=function(t,e){var i=t.graphicsData.length;if(i===0){return}e.beginPath();for(var s=0;s<i;s++){var r=t.graphicsData[s];var n=r.shape;if(r.type===PIXI.Graphics.POLY){var a=n.points;e.moveTo(a[0],a[1]);for(var o=1;o<a.length/2;o++){e.lineTo(a[o*2],a[o*2+1])}if(a[0]===a[a.length-2]&&a[1]===a[a.length-1]){e.closePath()}}else if(r.type===PIXI.Graphics.RECT){e.rect(n.x,n.y,n.width,n.height);e.closePath()}else if(r.type===PIXI.Graphics.CIRC){e.arc(n.x,n.y,n.radius,0,2*Math.PI);e.closePath()}else if(r.type===PIXI.Graphics.ELIP){var h=n.width*2;var l=n.height*2;var u=n.x-h/2;var c=n.y-l/2;var d=.5522848,f=h/2*d,p=l/2*d,g=u+h,m=c+l,y=u+h/2,v=c+l/2;e.moveTo(u,v);e.bezierCurveTo(u,v-p,y-f,c,y,c);e.bezierCurveTo(y+f,c,g,v-p,g,v);e.bezierCurveTo(g,v+p,y+f,m,y,m);e.bezierCurveTo(y-f,m,u,v+p,u,v);e.closePath()}else if(r.type===PIXI.Graphics.RREC){var b=n.x;var x=n.y;var w=n.width;var _=n.height;var P=n.radius;var T=Math.min(w,_)/2|0;P=P>T?T:P;e.moveTo(b,x+P);e.lineTo(b,x+_-P);e.quadraticCurveTo(b,x+_,b+P,x+_);e.lineTo(b+w-P,x+_);e.quadraticCurveTo(b+w,x+_,b+w,x+_-P);e.lineTo(b+w,x+P);e.quadraticCurveTo(b+w,x,b+w-P,x);e.lineTo(b+P,x);e.quadraticCurveTo(b,x,b,x+P);e.closePath()}}};PIXI.CanvasGraphics.updateGraphicsTint=function(t){if(t.tint===16777215){return}var e=(t.tint>>16&255)/255;var i=(t.tint>>8&255)/255;var s=(t.tint&255)/255;for(var r=0;r<t.graphicsData.length;r++){var n=t.graphicsData[r];var a=n.fillColor|0;var o=n.lineColor|0;n._fillTint=((a>>16&255)/255*e*255<<16)+((a>>8&255)/255*i*255<<8)+(a&255)/255*s*255;n._lineTint=((o>>16&255)/255*e*255<<16)+((o>>8&255)/255*i*255<<8)+(o&255)/255*s*255}};r.Graphics=function(t,e,i){if(e===undefined){e=0}if(i===undefined){i=0}this.type=r.GRAPHICS;this.physicsType=r.SPRITE;this.anchor=new r.Point;PIXI.Graphics.call(this);r.Component.Core.init.call(this,t,e,i,"",null)};r.Graphics.prototype=Object.create(PIXI.Graphics.prototype);r.Graphics.prototype.constructor=r.Graphics;r.Component.Core.install.call(r.Graphics.prototype,["Angle","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","PhysicsBody","Reset"]);r.Graphics.prototype.preUpdatePhysics=r.Component.PhysicsBody.preUpdate;r.Graphics.prototype.preUpdateLifeSpan=r.Component.LifeSpan.preUpdate;r.Graphics.prototype.preUpdateInWorld=r.Component.InWorld.preUpdate;r.Graphics.prototype.preUpdateCore=r.Component.Core.preUpdate;r.Graphics.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};r.Graphics.prototype.postUpdate=function(){r.Component.PhysicsBody.postUpdate.call(this);r.Component.FixedToCamera.postUpdate.call(this);if(this._boundsDirty){this.updateLocalBounds();this._boundsDirty=false}for(var t=0;t<this.children.length;t++){this.children[t].postUpdate()}};r.Graphics.prototype.destroy=function(t){this.clear();r.Component.Destroy.prototype.destroy.call(this,t)};r.Graphics.prototype.drawTriangle=function(t,e){if(e===undefined){e=false}var i=new r.Polygon(t);if(e){var s=new r.Point(this.game.camera.x-t[0].x,this.game.camera.y-t[0].y);var n=new r.Point(t[1].x-t[0].x,t[1].y-t[0].y);var a=new r.Point(t[1].x-t[2].x,t[1].y-t[2].y);var o=a.cross(n);if(s.dot(o)>0){this.drawPolygon(i)}}else{this.drawPolygon(i)}};r.Graphics.prototype.drawTriangles=function(t,e,i){if(i===undefined){i=false}var s=new r.Point;var n=new r.Point;var a=new r.Point;var o=[];var h;if(!e){if(t[0]instanceof r.Point){for(h=0;h<t.length/3;h++){this.drawTriangle([t[h*3],t[h*3+1],t[h*3+2]],i)}}else{for(h=0;h<t.length/6;h++){s.x=t[h*6+0];s.y=t[h*6+1];n.x=t[h*6+2];n.y=t[h*6+3];a.x=t[h*6+4];a.y=t[h*6+5];this.drawTriangle([s,n,a],i)}}}else{if(t[0]instanceof r.Point){for(h=0;h<e.length/3;h++){o.push(t[e[h*3]]);o.push(t[e[h*3+1]]);o.push(t[e[h*3+2]]);if(o.length===3){this.drawTriangle(o,i);o=[]}}}else{for(h=0;h<e.length;h++){s.x=t[e[h]*2];s.y=t[e[h]*2+1];o.push(s.copyTo({}));if(o.length===3){this.drawTriangle(o,i);o=[]}}}}};r.RenderTexture=function(t,e,i,s,n,a){if(s===undefined){s=""}if(n===undefined){n=r.scaleModes.DEFAULT}if(a===undefined){a=1}this.game=t;this.key=s;this.type=r.RENDERTEXTURE;this._tempMatrix=new PIXI.Matrix;PIXI.RenderTexture.call(this,e,i,this.game.renderer,n,a);this.render=r.RenderTexture.prototype.render};r.RenderTexture.prototype=Object.create(PIXI.RenderTexture.prototype);r.RenderTexture.prototype.constructor=r.RenderTexture;r.RenderTexture.prototype.renderXY=function(t,e,i,s){t.updateTransform();this._tempMatrix.copyFrom(t.worldTransform);this._tempMatrix.tx=e;this._tempMatrix.ty=i;if(this.renderer.type===PIXI.WEBGL_RENDERER){this.renderWebGL(t,this._tempMatrix,s)}else{this.renderCanvas(t,this._tempMatrix,s)}};r.RenderTexture.prototype.renderRawXY=function(t,e,i,s){this._tempMatrix.identity().translate(e,i);if(this.renderer.type===PIXI.WEBGL_RENDERER){this.renderWebGL(t,this._tempMatrix,s)}else{this.renderCanvas(t,this._tempMatrix,s)}};r.RenderTexture.prototype.render=function(t,e,i){if(e===undefined||e===null){this._tempMatrix.copyFrom(t.worldTransform)}else{this._tempMatrix.copyFrom(e)}if(this.renderer.type===PIXI.WEBGL_RENDERER){this.renderWebGL(t,this._tempMatrix,i)}else{this.renderCanvas(t,this._tempMatrix,i)}};r.Text=function(t,e,i,s,n){e=e||0;i=i||0;if(s===undefined||s===null){s=""}else{s=s.toString()}n=r.Utils.extend({},n);this.type=r.TEXT;this.physicsType=r.SPRITE;this.padding=new r.Point;this.textBounds=null;this.canvas=PIXI.CanvasPool.create(this);this.context=this.canvas.getContext("2d");this.colors=[];this.strokeColors=[];this.fontStyles=[];this.fontWeights=[];this.autoRound=false;this.useAdvancedWrap=false;this._res=t.renderer.resolution;this._text=s;this._fontComponents=null;this._lineSpacing=0;this._charCount=0;this._width=0;this._height=0;r.Sprite.call(this,t,e,i,PIXI.Texture.fromCanvas(this.canvas));this.setStyle(n);if(s!==""){this.updateText()}};r.Text.prototype=Object.create(r.Sprite.prototype);r.Text.prototype.constructor=r.Text;r.Text.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};r.Text.prototype.update=function(){};r.Text.prototype.destroy=function(t){this.texture.destroy(true);r.Component.Destroy.prototype.destroy.call(this,t)};r.Text.prototype.setShadow=function(t,e,i,s,r,n){if(t===undefined){t=0}if(e===undefined){e=0}if(i===undefined){i="rgba(0, 0, 0, 1)"}if(s===undefined){s=0}if(r===undefined){r=true}if(n===undefined){n=true}this.style.shadowOffsetX=t;this.style.shadowOffsetY=e;this.style.shadowColor=i;this.style.shadowBlur=s;this.style.shadowStroke=r;this.style.shadowFill=n;this.dirty=true;return this};r.Text.prototype.setStyle=function(t,e){if(e===undefined){e=false}t=t||{};t.font=t.font||"bold 20pt Arial";t.backgroundColor=t.backgroundColor||null;t.fill=t.fill||"black";t.align=t.align||"left";t.boundsAlignH=t.boundsAlignH||"left";t.boundsAlignV=t.boundsAlignV||"top";t.stroke=t.stroke||"black";t.strokeThickness=t.strokeThickness||0;t.wordWrap=t.wordWrap||false;t.wordWrapWidth=t.wordWrapWidth||100;t.maxLines=t.maxLines||0;t.shadowOffsetX=t.shadowOffsetX||0;t.shadowOffsetY=t.shadowOffsetY||0;t.shadowColor=t.shadowColor||"rgba(0,0,0,0)";t.shadowBlur=t.shadowBlur||0;t.tabs=t.tabs||0;var i=this.fontToComponents(t.font);if(t.fontStyle){i.fontStyle=t.fontStyle}if(t.fontVariant){i.fontVariant=t.fontVariant}if(t.fontWeight){i.fontWeight=t.fontWeight}if(t.fontSize){if(typeof t.fontSize==="number"){t.fontSize=t.fontSize+"px"}i.fontSize=t.fontSize}this._fontComponents=i;t.font=this.componentsToFont(this._fontComponents);this.style=t;this.dirty=true;if(e){this.updateText()}return this};r.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this._res;this.context.font=this.style.font;var t=this.text;if(this.style.wordWrap){t=this.runWordWrap(this.text)}var e=t.split(/(?:\r\n|\r|\n)/);var i=this.style.tabs;var s=[];var r=0;var n=this.determineFontProperties(this.style.font);var a=e.length;if(this.style.maxLines>0&&this.style.maxLines<e.length){a=this.style.maxLines}this._charCount=0;for(var o=0;o<a;o++){if(i===0){var h=this.style.strokeThickness+this.padding.x;if(this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0){h+=this.measureLine(e[o])}else{h+=this.context.measureText(e[o]).width}if(this.style.wordWrap){h-=this.context.measureText(" ").width}}else{var l=e[o].split(/(?:\t)/);var h=this.padding.x+this.style.strokeThickness;if(Array.isArray(i)){var u=0;for(var c=0;c<l.length;c++){var d=0;if(this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0){d=this.measureLine(l[c])}else{d=Math.ceil(this.context.measureText(l[c]).width)}if(c>0){u+=i[c-1]}h=u+d}}else{for(var c=0;c<l.length;c++){if(this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0){h+=this.measureLine(l[c])}else{h+=Math.ceil(this.context.measureText(l[c]).width)}var f=this.game.math.snapToCeil(h,i)-h;h+=f}}}s[o]=Math.ceil(h);r=Math.max(r,s[o])}this.canvas.width=r*this._res;var p=n.fontSize+this.style.strokeThickness+this.padding.y;var g=p*a;var m=this._lineSpacing;if(m<0&&Math.abs(m)>p){m=-p}if(m!==0){g+=m>0?m*e.length:m*(e.length-1)}this.canvas.height=g*this._res;this.context.scale(this._res,this._res);if(navigator.isCocoonJS){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}if(this.style.backgroundColor){this.context.fillStyle=this.style.backgroundColor;this.context.fillRect(0,0,this.canvas.width,this.canvas.height)}this.context.fillStyle=this.style.fill;this.context.font=this.style.font;this.context.strokeStyle=this.style.stroke;this.context.textBaseline="alphabetic";this.context.lineWidth=this.style.strokeThickness;this.context.lineCap="round";this.context.lineJoin="round";var y;var v;this._charCount=0;for(o=0;o<a;o++){y=this.style.strokeThickness/2;v=this.style.strokeThickness/2+o*p+n.ascent;if(o>0){v+=m*o}if(this.style.align==="right"){y+=r-s[o]}else if(this.style.align==="center"){y+=(r-s[o])/2}if(this.autoRound){y=Math.round(y);v=Math.round(v)}if(this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0){this.updateLine(e[o],y,v)}else{if(this.style.stroke&&this.style.strokeThickness){this.updateShadow(this.style.shadowStroke);if(i===0){this.context.strokeText(e[o],y,v)}else{this.renderTabLine(e[o],y,v,false)}}if(this.style.fill){this.updateShadow(this.style.shadowFill);if(i===0){this.context.fillText(e[o],y,v)}else{this.renderTabLine(e[o],y,v,true)}}}}this.updateTexture();this.dirty=false};r.Text.prototype.renderTabLine=function(t,e,i,s){var r=t.split(/(?:\t)/);var n=this.style.tabs;var a=0;if(Array.isArray(n)){var o=0;for(var h=0;h<r.length;h++){if(h>0){o+=n[h-1]}a=e+o;if(s){this.context.fillText(r[h],a,i)}else{this.context.strokeText(r[h],a,i)}}}else{for(var h=0;h<r.length;h++){var l=Math.ceil(this.context.measureText(r[h]).width);a=this.game.math.snapToCeil(e,n);if(s){this.context.fillText(r[h],a,i)}else{this.context.strokeText(r[h],a,i)}e=a+l}}};r.Text.prototype.updateShadow=function(t){if(t){this.context.shadowOffsetX=this.style.shadowOffsetX;this.context.shadowOffsetY=this.style.shadowOffsetY;this.context.shadowColor=this.style.shadowColor;this.context.shadowBlur=this.style.shadowBlur}else{this.context.shadowOffsetX=0;this.context.shadowOffsetY=0;this.context.shadowColor=0;this.context.shadowBlur=0}};r.Text.prototype.measureLine=function(t){var e=0;for(var i=0;i<t.length;i++){var s=t[i];if(this.fontWeights.length>0||this.fontStyles.length>0){var r=this.fontToComponents(this.context.font);if(this.fontStyles[this._charCount]){r.fontStyle=this.fontStyles[this._charCount]}if(this.fontWeights[this._charCount]){r.fontWeight=this.fontWeights[this._charCount]}this.context.font=this.componentsToFont(r)}if(this.style.stroke&&this.style.strokeThickness){if(this.strokeColors[this._charCount]){this.context.strokeStyle=this.strokeColors[this._charCount]}this.updateShadow(this.style.shadowStroke)}if(this.style.fill){if(this.colors[this._charCount]){this.context.fillStyle=this.colors[this._charCount]}this.updateShadow(this.style.shadowFill)}e+=this.context.measureText(s).width;this._charCount++}return Math.ceil(e)};r.Text.prototype.updateLine=function(t,e,i){for(var s=0;s<t.length;s++){var r=t[s];if(this.fontWeights.length>0||this.fontStyles.length>0){var n=this.fontToComponents(this.context.font);if(this.fontStyles[this._charCount]){n.fontStyle=this.fontStyles[this._charCount]}if(this.fontWeights[this._charCount]){n.fontWeight=this.fontWeights[this._charCount]}this.context.font=this.componentsToFont(n)}if(this.style.stroke&&this.style.strokeThickness){if(this.strokeColors[this._charCount]){this.context.strokeStyle=this.strokeColors[this._charCount]}this.updateShadow(this.style.shadowStroke);this.context.strokeText(r,e,i)}if(this.style.fill){if(this.colors[this._charCount]){this.context.fillStyle=this.colors[this._charCount]}this.updateShadow(this.style.shadowFill);this.context.fillText(r,e,i)}e+=this.context.measureText(r).width;this._charCount++}};r.Text.prototype.clearColors=function(){this.colors=[];this.strokeColors=[];this.dirty=true;return this};r.Text.prototype.clearFontValues=function(){this.fontStyles=[];this.fontWeights=[];this.dirty=true;return this};r.Text.prototype.addColor=function(t,e){this.colors[e]=t;this.dirty=true;return this};r.Text.prototype.addStrokeColor=function(t,e){this.strokeColors[e]=t;this.dirty=true;return this};r.Text.prototype.addFontStyle=function(t,e){this.fontStyles[e]=t;this.dirty=true;return this};r.Text.prototype.addFontWeight=function(t,e){this.fontWeights[e]=t;this.dirty=true;return this};r.Text.prototype.precalculateWordWrap=function(t){this.texture.baseTexture.resolution=this._res;this.context.font=this.style.font;var e=this.runWordWrap(t);return e.split(/(?:\r\n|\r|\n)/)};r.Text.prototype.runWordWrap=function(t){if(this.useAdvancedWrap){return this.advancedWordWrap(t)}else{return this.basicWordWrap(t)}};r.Text.prototype.advancedWordWrap=function(t){var e=this.context;var i=this.style.wordWrapWidth;var s="";var r=t.replace(/ +/gi," ").split(/\r?\n/gi);var n=r.length;for(var a=0;a<n;a++){var o=r[a];var h="";o=o.replace(/^ *|\s*$/gi,"");var l=e.measureText(o).width;if(l<i){s+=o+"\n";continue}var u=i;var c=o.split(" ");for(var d=0;d<c.length;d++){var f=c[d];var p=f+" ";var g=e.measureText(p).width;if(g>u){if(d===0){var m=p;while(m.length){m=m.slice(0,-1);g=e.measureText(m).width;if(g<=u){break}}if(!m.length){throw new Error("This text's wordWrapWidth setting is less than a single character!")}var y=f.substr(m.length);c[d]=y;h+=m}var v=c[d].length?d:d+1;var b=c.slice(v).join(" ").replace(/[ \n]*$/gi,"");r[a+1]=b+" "+(r[a+1]||"");n=r.length;break}else{h+=p;u-=g}}s+=h.replace(/[ \n]*$/gi,"")+"\n"}s=s.replace(/[\s|\n]*$/gi,"");return s};r.Text.prototype.basicWordWrap=function(t){var e="";var i=t.split("\n");for(var s=0;s<i.length;s++){var r=this.style.wordWrapWidth;var n=i[s].split(" ");for(var a=0;a<n.length;a++){var o=this.context.measureText(n[a]).width;var h=o+this.context.measureText(" ").width;if(h>r){if(a>0){e+="\n"}e+=n[a]+" ";r=this.style.wordWrapWidth-o}else{r-=h;e+=n[a]+" "}}if(s<i.length-1){e+="\n"}}return e};r.Text.prototype.updateFont=function(t){var e=this.componentsToFont(t);if(this.style.font!==e){this.style.font=e;this.dirty=true;if(this.parent){this.updateTransform()}}};r.Text.prototype.fontToComponents=function(t){var e=t.match(/^\s*(?:\b(normal|italic|oblique|inherit)?\b)\s*(?:\b(normal|small-caps|inherit)?\b)\s*(?:\b(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit)?\b)\s*(?:\b(xx-small|x-small|small|medium|large|x-large|xx-large|larger|smaller|0|\d*(?:[.]\d*)?(?:%|[a-z]{2,5}))?\b)\s*(.*)\s*$/);if(e){var i=e[5].trim();if(!/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(i)&&!/['",]/.exec(i)){i="'"+i+"'"}return{font:t,fontStyle:e[1]||"normal",fontVariant:e[2]||"normal",fontWeight:e[3]||"normal",fontSize:e[4]||"medium",fontFamily:i}}else{console.warn("Phaser.Text - unparsable CSS font: "+t);return{font:t}}};r.Text.prototype.componentsToFont=function(t){var e=[];var i;i=t.fontStyle;if(i&&i!=="normal"){e.push(i)}i=t.fontVariant;if(i&&i!=="normal"){e.push(i)}i=t.fontWeight;if(i&&i!=="normal"){e.push(i)}i=t.fontSize;if(i&&i!=="medium"){e.push(i)}i=t.fontFamily;if(i){e.push(i)}if(!e.length){e.push(t.font)}return e.join(" ")};r.Text.prototype.setText=function(t,e){if(e===undefined){e=false}this.text=t.toString()||"";if(e){this.updateText()}else{this.dirty=true}return this};r.Text.prototype.parseList=function(t){if(!Array.isArray(t)){return this}else{var e="";for(var i=0;i<t.length;i++){if(Array.isArray(t[i])){e+=t[i].join("\t");if(i<t.length-1){e+="\n"}}else{e+=t[i];if(i<t.length-1){e+="\t"}}}}this.text=e;this.dirty=true;return this};r.Text.prototype.setTextBounds=function(t,e,i,s){if(t===undefined){this.textBounds=null}else{if(!this.textBounds){this.textBounds=new r.Rectangle(t,e,i,s)}else{this.textBounds.setTo(t,e,i,s)}if(this.style.wordWrapWidth>i){this.style.wordWrapWidth=i}}this.updateTexture();return this};r.Text.prototype.updateTexture=function(){var t=this.texture.baseTexture;var e=this.texture.crop;var i=this.texture.frame;var s=this.canvas.width;var r=this.canvas.height;t.width=s;t.height=r;e.width=s;e.height=r;i.width=s;i.height=r;this.texture.width=s;this.texture.height=r;this._width=s;this._height=r;if(this.textBounds){var n=this.textBounds.x;var a=this.textBounds.y;if(this.style.boundsAlignH==="right"){n+=this.textBounds.width-this.canvas.width/this.resolution}else if(this.style.boundsAlignH==="center"){n+=this.textBounds.halfWidth-this.canvas.width/this.resolution/2}if(this.style.boundsAlignV==="bottom"){a+=this.textBounds.height-this.canvas.height/this.resolution}else if(this.style.boundsAlignV==="middle"){a+=this.textBounds.halfHeight-this.canvas.height/this.resolution/2}this.pivot.x=-n;this.pivot.y=-a}this.renderable=s!==0&&r!==0;this.texture.requiresReTint=true;this.texture.baseTexture.dirty()};r.Text.prototype._renderWebGL=function(t){if(this.dirty){this.updateText();this.dirty=false}PIXI.Sprite.prototype._renderWebGL.call(this,t)};r.Text.prototype._renderCanvas=function(t){if(this.dirty){this.updateText();this.dirty=false}PIXI.Sprite.prototype._renderCanvas.call(this,t)};r.Text.prototype.determineFontProperties=function(t){var e=r.Text.fontPropertiesCache[t];if(!e){e={};var i=r.Text.fontPropertiesCanvas;var s=r.Text.fontPropertiesContext;s.font=t;var n=Math.ceil(s.measureText("|Mq").width);var a=Math.ceil(s.measureText("|Mq").width);var o=2*a;a=a*1.4|0;i.width=n;i.height=o;s.fillStyle="#f00";s.fillRect(0,0,n,o);s.font=t;s.textBaseline="alphabetic";s.fillStyle="#000";s.fillText("|Mq",0,a);if(!s.getImageData(0,0,n,o)){e.ascent=a;e.descent=a+6;e.fontSize=e.ascent+e.descent;r.Text.fontPropertiesCache[t]=e;return e}var h=s.getImageData(0,0,n,o).data;var l=h.length;var u=n*4;var c,d;var f=0;var p=false;for(c=0;c<a;c++){for(d=0;d<u;d+=4){if(h[f+d]!==255){p=true;break}}if(!p){f+=u}else{break}}e.ascent=a-c;f=l-u;p=false;for(c=o;c>a;c--){for(d=0;d<u;d+=4){if(h[f+d]!==255){p=true;break}}if(!p){f-=u}else{break}}e.descent=c-a;e.descent+=6;e.fontSize=e.ascent+e.descent;r.Text.fontPropertiesCache[t]=e}return e};r.Text.prototype.getBounds=function(t){if(this.dirty){this.updateText();this.dirty=false}return PIXI.Sprite.prototype.getBounds.call(this,t)};Object.defineProperty(r.Text.prototype,"text",{get:function(){return this._text},set:function(t){if(t!==this._text){this._text=t.toString()||"";this.dirty=true;if(this.parent){this.updateTransform()}}}});Object.defineProperty(r.Text.prototype,"cssFont",{get:function(){return this.componentsToFont(this._fontComponents)},set:function(t){t=t||"bold 20pt Arial";this._fontComponents=this.fontToComponents(t);this.updateFont(this._fontComponents)}});Object.defineProperty(r.Text.prototype,"font",{get:function(){return this._fontComponents.fontFamily},set:function(t){t=t||"Arial";t=t.trim();if(!/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(t)&&!/['",]/.exec(t)){t="'"+t+"'"}this._fontComponents.fontFamily=t;this.updateFont(this._fontComponents)}});Object.defineProperty(r.Text.prototype,"fontSize",{get:function(){var t=this._fontComponents.fontSize;if(t&&/(?:^0$|px$)/.exec(t)){return parseInt(t,10)}else{return t}},set:function(t){t=t||"0";if(typeof t==="number"){t=t+"px"}this._fontComponents.fontSize=t;this.updateFont(this._fontComponents)}});Object.defineProperty(r.Text.prototype,"fontWeight",{get:function(){return this._fontComponents.fontWeight||"normal"},set:function(t){t=t||"normal";this._fontComponents.fontWeight=t;this.updateFont(this._fontComponents)}});Object.defineProperty(r.Text.prototype,"fontStyle",{get:function(){return this._fontComponents.fontStyle||"normal"},set:function(t){t=t||"normal";this._fontComponents.fontStyle=t;this.updateFont(this._fontComponents)}});Object.defineProperty(r.Text.prototype,"fontVariant",{get:function(){return this._fontComponents.fontVariant||"normal"},set:function(t){t=t||"normal";this._fontComponents.fontVariant=t;this.updateFont(this._fontComponents)}});Object.defineProperty(r.Text.prototype,"fill",{get:function(){return this.style.fill},set:function(t){if(t!==this.style.fill){this.style.fill=t;this.dirty=true}}});Object.defineProperty(r.Text.prototype,"align",{get:function(){return this.style.align},set:function(t){if(t!==this.style.align){this.style.align=t;this.dirty=true}}});Object.defineProperty(r.Text.prototype,"resolution",{get:function(){return this._res},set:function(t){if(t!==this._res){this._res=t;this.dirty=true}}});Object.defineProperty(r.Text.prototype,"tabs",{get:function(){return this.style.tabs},set:function(t){if(t!==this.style.tabs){this.style.tabs=t;this.dirty=true}}});Object.defineProperty(r.Text.prototype,"boundsAlignH",{get:function(){return this.style.boundsAlignH},set:function(t){if(t!==this.style.boundsAlignH){this.style.boundsAlignH=t;this.dirty=true}}});Object.defineProperty(r.Text.prototype,"boundsAlignV",{get:function(){return this.style.boundsAlignV},set:function(t){if(t!==this.style.boundsAlignV){this.style.boundsAlignV=t;this.dirty=true}}});Object.defineProperty(r.Text.prototype,"stroke",{get:function(){return this.style.stroke},set:function(t){if(t!==this.style.stroke){this.style.stroke=t;this.dirty=true}}});Object.defineProperty(r.Text.prototype,"strokeThickness",{get:function(){return this.style.strokeThickness},set:function(t){if(t!==this.style.strokeThickness){this.style.strokeThickness=t;this.dirty=true}}});Object.defineProperty(r.Text.prototype,"wordWrap",{get:function(){return this.style.wordWrap},set:function(t){if(t!==this.style.wordWrap){this.style.wordWrap=t;this.dirty=true}}});Object.defineProperty(r.Text.prototype,"wordWrapWidth",{get:function(){return this.style.wordWrapWidth},set:function(t){if(t!==this.style.wordWrapWidth){this.style.wordWrapWidth=t;this.dirty=true}}});Object.defineProperty(r.Text.prototype,"lineSpacing",{get:function(){return this._lineSpacing},set:function(t){if(t!==this._lineSpacing){this._lineSpacing=parseFloat(t);this.dirty=true;if(this.parent){this.updateTransform()}}}});Object.defineProperty(r.Text.prototype,"shadowOffsetX",{get:function(){return this.style.shadowOffsetX},set:function(t){if(t!==this.style.shadowOffsetX){this.style.shadowOffsetX=t;this.dirty=true}}});Object.defineProperty(r.Text.prototype,"shadowOffsetY",{get:function(){return this.style.shadowOffsetY},set:function(t){if(t!==this.style.shadowOffsetY){this.style.shadowOffsetY=t;this.dirty=true}}});Object.defineProperty(r.Text.prototype,"shadowColor",{get:function(){return this.style.shadowColor},set:function(t){if(t!==this.style.shadowColor){this.style.shadowColor=t;this.dirty=true}}});Object.defineProperty(r.Text.prototype,"shadowBlur",{get:function(){return this.style.shadowBlur},set:function(t){if(t!==this.style.shadowBlur){this.style.shadowBlur=t;this.dirty=true}}});Object.defineProperty(r.Text.prototype,"shadowStroke",{get:function(){return this.style.shadowStroke},set:function(t){if(t!==this.style.shadowStroke){this.style.shadowStroke=t;this.dirty=true}}});Object.defineProperty(r.Text.prototype,"shadowFill",{get:function(){return this.style.shadowFill},set:function(t){if(t!==this.style.shadowFill){this.style.shadowFill=t;this.dirty=true}}});Object.defineProperty(r.Text.prototype,"width",{get:function(){if(this.dirty){this.updateText();this.dirty=false}return this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width;this._width=t}});Object.defineProperty(r.Text.prototype,"height",{get:function(){if(this.dirty){this.updateText();this.dirty=false}return this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height;this._height=t}});r.Text.fontPropertiesCache={};r.Text.fontPropertiesCanvas=document.createElement("canvas");r.Text.fontPropertiesContext=r.Text.fontPropertiesCanvas.getContext("2d");r.BitmapText=function(t,e,i,s,n,a,o){e=e||0;i=i||0;s=s||"";n=n||"";a=a||32;o=o||"left";PIXI.DisplayObjectContainer.call(this);this.type=r.BITMAPTEXT;this.physicsType=r.SPRITE;this.textWidth=0;this.textHeight=0;this.anchor=new r.Point;this._prevAnchor=new r.Point;this._glyphs=[];this._maxWidth=0;this._text=n.toString()||"";this._data=t.cache.getBitmapFont(s);this._font=s;this._fontSize=a;this._align=o;this._tint=16777215;this.updateText();this.dirty=false;r.Component.Core.init.call(this,t,e,i,"",null)};r.BitmapText.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);r.BitmapText.prototype.constructor=r.BitmapText;r.Component.Core.install.call(r.BitmapText.prototype,["Angle","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","PhysicsBody","Reset"]);r.BitmapText.prototype.preUpdatePhysics=r.Component.PhysicsBody.preUpdate;r.BitmapText.prototype.preUpdateLifeSpan=r.Component.LifeSpan.preUpdate;r.BitmapText.prototype.preUpdateInWorld=r.Component.InWorld.preUpdate;r.BitmapText.prototype.preUpdateCore=r.Component.Core.preUpdate;r.BitmapText.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};r.BitmapText.prototype.postUpdate=function(){r.Component.PhysicsBody.postUpdate.call(this);r.Component.FixedToCamera.postUpdate.call(this);if(this.body&&this.body.type===r.Physics.ARCADE){if(this.textWidth!==this.body.sourceWidth||this.textHeight!==this.body.sourceHeight){this.body.setSize(this.textWidth,this.textHeight)}}};r.BitmapText.prototype.setText=function(t){this.text=t};r.BitmapText.prototype.scanLine=function(t,e,i){var s=0;var r=0;var n=-1;var a=0;var o=null;var h=this._maxWidth>0?this._maxWidth:null;var l=[];for(var u=0;u<i.length;u++){var c=u===i.length-1?true:false;if(/(?:\r\n|\r|\n)/.test(i.charAt(u))){return{width:r,text:i.substr(0,u),end:c,chars:l}}else{var d=i.charCodeAt(u);var f=t.chars[d];var p=0;if(f===undefined){d=32;f=t.chars[d]}var g=o&&f.kerning[o]?f.kerning[o]:0;if(/(\s)/.test(i.charAt(u))){n=u;a=r}p=(g+f.texture.width+f.xOffset)*e;if(h&&r+p>=h&&n>-1){return{width:a||r,text:i.substr(0,u-(u-n)),end:c,chars:l}}else{r+=(f.xAdvance+g)*e;l.push(s+(f.xOffset+g)*e);s+=(f.xAdvance+g)*e;o=d}}}return{width:r,text:i,end:c,chars:l}};r.BitmapText.prototype.cleanText=function(t,e){if(e===undefined){e=""}var i=this._data.font;if(!i){return""}var s=/\r\n|\n\r|\n|\r/g;var r=t.replace(s,"\n").split("\n");for(var n=0;n<r.length;n++){var a="";var o=r[n];for(var h=0;h<o.length;h++){if(i.chars[o.charCodeAt(h)]){a=a.concat(o[h])}else{a=a.concat(e)}}r[n]=a}return r.join("\n")};r.BitmapText.prototype.updateText=function(){var t=this._data.font;if(!t){return}var e=this.text;var i=this._fontSize/t.size;var s=[];var r=0;this.textWidth=0;do{var n=this.scanLine(t,i,e);n.y=r;s.push(n);if(n.width>this.textWidth){this.textWidth=n.width}r+=t.lineHeight*i;e=e.substr(n.text.length+1)}while(n.end===false);this.textHeight=r;var a=0;var o=0;var h=this.textWidth*this.anchor.x;var l=this.textHeight*this.anchor.y;for(var u=0;u<s.length;u++){var n=s[u];if(this._align==="right"){o=this.textWidth-n.width}else if(this._align==="center"){o=(this.textWidth-n.width)/2}for(var c=0;c<n.text.length;c++){var d=n.text.charCodeAt(c);var f=t.chars[d];if(f===undefined){d=32;f=t.chars[d]}var p=this._glyphs[a];if(p){p.texture=f.texture}else{p=new PIXI.Sprite(f.texture);p.name=n.text[c];this._glyphs.push(p)}p.position.x=n.chars[c]+o-h;p.position.y=n.y+f.yOffset*i-l;p.scale.set(i);p.tint=this.tint;p.texture.requiresReTint=true;if(!p.parent){this.addChild(p)}a++}}for(u=a;u<this._glyphs.length;u++){this.removeChild(this._glyphs[u])}};r.BitmapText.prototype.purgeGlyphs=function(){var t=this._glyphs.length;var e=[];for(var i=0;i<this._glyphs.length;i++){if(this._glyphs[i].parent!==this){this._glyphs[i].destroy()}else{e.push(this._glyphs[i])}}this._glyphs=[];this._glyphs=e;this.updateText();return t-e.length};r.BitmapText.prototype.updateTransform=function(){if(this.dirty||!this.anchor.equals(this._prevAnchor)){this.updateText();this.dirty=false;this._prevAnchor.copyFrom(this.anchor)}PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)};Object.defineProperty(r.BitmapText.prototype,"align",{get:function(){return this._align},set:function(t){if(t!==this._align&&(t==="left"||t==="center"||t==="right")){this._align=t;this.updateText()}}});Object.defineProperty(r.BitmapText.prototype,"tint",{get:function(){return this._tint},set:function(t){if(t!==this._tint){this._tint=t;this.updateText()}}});Object.defineProperty(r.BitmapText.prototype,"font",{get:function(){return this._font},set:function(t){if(t!==this._font){this._font=t.trim();this._data=this.game.cache.getBitmapFont(this._font);this.updateText()}}});Object.defineProperty(r.BitmapText.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){t=parseInt(t,10);if(t!==this._fontSize&&t>0){this._fontSize=t;this.updateText()}}});Object.defineProperty(r.BitmapText.prototype,"text",{get:function(){return this._text},set:function(t){if(t!==this._text){this._text=t.toString()||"";this.updateText()}}});Object.defineProperty(r.BitmapText.prototype,"maxWidth",{get:function(){return this._maxWidth},set:function(t){if(t!==this._maxWidth){this._maxWidth=t;this.updateText()}}});Object.defineProperty(r.BitmapText.prototype,"smoothed",{get:function(){return!this._data.base.scaleMode},set:function(t){if(t){this._data.base.scaleMode=0}else{this._data.base.scaleMode=1}}});r.RetroFont=function(t,e,i,s,n,a,o,h,l,u){if(!t.cache.checkImageKey(e)){return false}if(a===undefined||a===null){a=t.cache.getImage(e).width/i}this.characterWidth=i;this.characterHeight=s;this.characterSpacingX=o||0;this.characterSpacingY=h||0;this.characterPerRow=a;this.offsetX=l||0;this.offsetY=u||0;this.align="left";this.multiLine=false;this.autoUpperCase=true;this.customSpacingX=0;this.customSpacingY=0;this.fixedWidth=0;this.fontSet=t.cache.getImage(e);this._text="";this.grabData=[];this.frameData=new r.FrameData;var c=this.offsetX;var d=this.offsetY;var f=0;for(var p=0;p<n.length;p++){var g=this.frameData.addFrame(new r.Frame(p,c,d,this.characterWidth,this.characterHeight));this.grabData[n.charCodeAt(p)]=g.index;f++;if(f===this.characterPerRow){f=0;c=this.offsetX;d+=this.characterHeight+this.characterSpacingY}else{c+=this.characterWidth+this.characterSpacingX}}t.cache.updateFrameData(e,this.frameData);this.stamp=new r.Image(t,0,0,e,0);r.RenderTexture.call(this,t,100,100,"",r.scaleModes.NEAREST);this.type=r.RETROFONT};r.RetroFont.prototype=Object.create(r.RenderTexture.prototype);r.RetroFont.prototype.constructor=r.RetroFont;r.RetroFont.ALIGN_LEFT="left";r.RetroFont.ALIGN_RIGHT="right";r.RetroFont.ALIGN_CENTER="center";r.RetroFont.TEXT_SET1=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~";r.RetroFont.TEXT_SET2=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ";r.RetroFont.TEXT_SET3="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ";r.RetroFont.TEXT_SET4="ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789";r.RetroFont.TEXT_SET5="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,/() '!?-*:0123456789";r.RetroFont.TEXT_SET6="ABCDEFGHIJKLMNOPQRSTUVWXYZ!?:;0123456789\"(),-.' ";r.RetroFont.TEXT_SET7="AGMSY+:4BHNTZ!;5CIOU.?06DJPV,(17EKQW\")28FLRX-'39";r.RetroFont.TEXT_SET8="0123456789 .ABCDEFGHIJKLMNOPQRSTUVWXYZ";r.RetroFont.TEXT_SET9="ABCDEFGHIJKLMNOPQRSTUVWXYZ()-0123456789.:,'\"?!";r.RetroFont.TEXT_SET10="ABCDEFGHIJKLMNOPQRSTUVWXYZ";r.RetroFont.TEXT_SET11="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,\"-+!?()':;0123456789";r.RetroFont.prototype.setFixedWidth=function(t,e){if(e===undefined){e="left"}this.fixedWidth=t;this.align=e};r.RetroFont.prototype.setText=function(t,e,i,s,r,n){this.multiLine=e||false;this.customSpacingX=i||0;this.customSpacingY=s||0;this.align=r||"left";if(n){this.autoUpperCase=false}else{this.autoUpperCase=true}if(t.length>0){this.text=t}};r.RetroFont.prototype.buildRetroFontText=function(){var t=0;var e=0;this.clear();if(this.multiLine){var i=this._text.split("\n");if(this.fixedWidth>0){this.resize(this.fixedWidth,i.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,true)}else{this.resize(this.getLongestLine()*(this.characterWidth+this.customSpacingX),i.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,true)}for(var s=0;s<i.length;s++){t=0;if(this.align===r.RetroFont.ALIGN_RIGHT){t=this.width-i[s].length*(this.characterWidth+this.customSpacingX)}else if(this.align===r.RetroFont.ALIGN_CENTER){t=this.width/2-i[s].length*(this.characterWidth+this.customSpacingX)/2;t+=this.customSpacingX/2}if(t<0){t=0}this.pasteLine(i[s],t,e,this.customSpacingX);e+=this.characterHeight+this.customSpacingY}}else{if(this.fixedWidth>0){this.resize(this.fixedWidth,this.characterHeight,true)}else{this.resize(this._text.length*(this.characterWidth+this.customSpacingX),this.characterHeight,true)}t=0;if(this.align===r.RetroFont.ALIGN_RIGHT){t=this.width-this._text.length*(this.characterWidth+this.customSpacingX)}else if(this.align===r.RetroFont.ALIGN_CENTER){t=this.width/2-this._text.length*(this.characterWidth+this.customSpacingX)/2;t+=this.customSpacingX/2}if(t<0){t=0}this.pasteLine(this._text,t,0,this.customSpacingX)}this.requiresReTint=true};r.RetroFont.prototype.pasteLine=function(t,e,i,s){for(var r=0;r<t.length;r++){if(t.charAt(r)===" "){e+=this.characterWidth+s}else{if(this.grabData[t.charCodeAt(r)]>=0){this.stamp.frame=this.grabData[t.charCodeAt(r)];this.renderXY(this.stamp,e,i,false);e+=this.characterWidth+s;if(e>this.width){break}}}}};r.RetroFont.prototype.getLongestLine=function(){var t=0;if(this._text.length>0){var e=this._text.split("\n");for(var i=0;i<e.length;i++){if(e[i].length>t){t=e[i].length}}}return t};r.RetroFont.prototype.removeUnsupportedCharacters=function(t){var e="";for(var i=0;i<this._text.length;i++){var s=this._text[i];var r=s.charCodeAt(0);if(this.grabData[r]>=0||!t&&s==="\n"){e=e.concat(s)}}return e};r.RetroFont.prototype.updateOffset=function(t,e){if(this.offsetX===t&&this.offsetY===e){return}var i=t-this.offsetX;var s=e-this.offsetY;var r=this.game.cache.getFrameData(this.stamp.key).getFrames();var n=r.length;while(n--){r[n].x+=i;r[n].y+=s}this.buildRetroFontText()};Object.defineProperty(r.RetroFont.prototype,"text",{get:function(){return this._text},set:function(t){var e;if(this.autoUpperCase){e=t.toUpperCase()}else{e=t}if(e!==this._text){this._text=e;this.removeUnsupportedCharacters(this.multiLine);this.buildRetroFontText()}}});Object.defineProperty(r.RetroFont.prototype,"smoothed",{get:function(){return this.stamp.smoothed},set:function(t){this.stamp.smoothed=t;this.buildRetroFontText()}});r.Rope=function(t,e,i,s,n,a){this.points=[];this.points=a;this._hasUpdateAnimation=false;this._updateAnimationCallback=null;e=e||0;i=i||0;s=s||null;n=n||null;this.type=r.ROPE;PIXI.Rope.call(this,r.Cache.DEFAULT,this.points);r.Component.Core.init.call(this,t,e,i,s,n)};r.Rope.prototype=Object.create(PIXI.Rope.prototype);r.Rope.prototype.constructor=r.Rope;r.Component.Core.install.call(r.Rope.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Delta","Destroy","FixedToCamera","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","ScaleMinMax","Smoothed"]);r.Rope.prototype.preUpdatePhysics=r.Component.PhysicsBody.preUpdate;r.Rope.prototype.preUpdateLifeSpan=r.Component.LifeSpan.preUpdate;r.Rope.prototype.preUpdateInWorld=r.Component.InWorld.preUpdate;r.Rope.prototype.preUpdateCore=r.Component.Core.preUpdate;r.Rope.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};r.Rope.prototype.update=function(){if(this._hasUpdateAnimation){this.updateAnimation.call(this)}};r.Rope.prototype.reset=function(t,e){r.Component.Reset.prototype.reset.call(this,t,e);return this};Object.defineProperty(r.Rope.prototype,"updateAnimation",{get:function(){return this._updateAnimation},set:function(t){if(t&&typeof t==="function"){this._hasUpdateAnimation=true;this._updateAnimation=t}else{this._hasUpdateAnimation=false;this._updateAnimation=null}}});Object.defineProperty(r.Rope.prototype,"segments",{get:function(){var t=[];var e,i,s,n,a,o,h,l;for(var u=0;u<this.points.length;u++){e=u*4;i=this.vertices[e]*this.scale.x;s=this.vertices[e+1]*this.scale.y;n=this.vertices[e+4]*this.scale.x;a=this.vertices[e+3]*this.scale.y;o=r.Math.difference(i,n);h=r.Math.difference(s,a);i+=this.world.x;s+=this.world.y;l=new r.Rectangle(i,s,o,h);t.push(l)}return t}});r.TileSprite=function(t,e,i,s,n,a,o){e=e||0;i=i||0;s=s||256;n=n||256;a=a||null;o=o||null;this.type=r.TILESPRITE;this.physicsType=r.SPRITE;this._scroll=new r.Point;var h=t.cache.getImage("__default",true);PIXI.TilingSprite.call(this,new PIXI.Texture(h.base),s,n);r.Component.Core.init.call(this,t,e,i,a,o)};r.TileSprite.prototype=Object.create(PIXI.TilingSprite.prototype);r.TileSprite.prototype.constructor=r.TileSprite;r.Component.Core.install.call(r.TileSprite.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Destroy","FixedToCamera","Health","InCamera","InputEnabled","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","Smoothed"]);r.TileSprite.prototype.preUpdatePhysics=r.Component.PhysicsBody.preUpdate;r.TileSprite.prototype.preUpdateLifeSpan=r.Component.LifeSpan.preUpdate;r.TileSprite.prototype.preUpdateInWorld=r.Component.InWorld.preUpdate;r.TileSprite.prototype.preUpdateCore=r.Component.Core.preUpdate;r.TileSprite.prototype.preUpdate=function(){if(this._scroll.x!==0){this.tilePosition.x+=this._scroll.x*this.game.time.physicsElapsed}if(this._scroll.y!==0){this.tilePosition.y+=this._scroll.y*this.game.time.physicsElapsed}if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};r.TileSprite.prototype.autoScroll=function(t,e){this._scroll.set(t,e)};r.TileSprite.prototype.stopScroll=function(){this._scroll.set(0,0)};r.TileSprite.prototype.destroy=function(t){r.Component.Destroy.prototype.destroy.call(this,t);PIXI.TilingSprite.prototype.destroy.call(this)};r.TileSprite.prototype.reset=function(t,e){r.Component.Reset.prototype.reset.call(this,t,e);this.tilePosition.x=0;this.tilePosition.y=0;return this};r.Device=function(){this.deviceReadyAt=0;this.initialized=false;this.desktop=false;this.iOS=false;this.iOSVersion=0;this.cocoonJS=false;this.cocoonJSApp=false;this.cordova=false;this.node=false;this.nodeWebkit=false;this.electron=false;this.ejecta=false;this.crosswalk=false;this.android=false;this.chromeOS=false;this.linux=false;this.macOS=false;this.windows=false;this.windowsPhone=false;this.canvas=false;this.canvasBitBltShift=null;this.webGL=false;this.file=false;this.fileSystem=false;this.localStorage=false;this.worker=false;this.css3D=false;this.pointerLock=false;this.typedArray=false;this.vibration=false;this.getUserMedia=true;this.quirksMode=false;this.touch=false;this.mspointer=false;this.wheelEvent=null;this.arora=false;this.chrome=false;this.chromeVersion=0;this.epiphany=false;this.firefox=false;this.firefoxVersion=0;this.ie=false;this.ieVersion=0;this.trident=false;this.tridentVersion=0;this.edge=false;this.mobileSafari=false;this.midori=false;this.opera=false;this.safari=false;this.safariVersion=0;this.webApp=false;this.silk=false;this.audioData=false;this.webAudio=false;this.ogg=false;this.opus=false;this.mp3=false;this.wav=false;this.m4a=false;this.webm=false;this.dolby=false;this.oggVideo=false;this.h264Video=false;this.mp4Video=false;this.webmVideo=false;this.vp9Video=false;this.hlsVideo=false;this.iPhone=false;this.iPhone4=false;this.iPad=false;this.pixelRatio=0;this.littleEndian=false;this.LITTLE_ENDIAN=false;this.support32bit=false;this.fullscreen=false;this.requestFullscreen="";this.cancelFullscreen="";this.fullscreenKeyboard=false};r.Device=new r.Device;r.Device.onInitialized=new r.Signal;r.Device.whenReady=function(t,e,i){var s=this._readyCheck;if(this.deviceReadyAt||!s){t.call(e,this)}else if(s._monitor||i){s._queue=s._queue||[];s._queue.push([t,e])}else{s._monitor=s.bind(this);s._queue=s._queue||[];s._queue.push([t,e]);var r=typeof window.cordova!=="undefined";var n=navigator["isCocoonJS"];if(document.readyState==="complete"||document.readyState==="interactive"){window.setTimeout(s._monitor,0)}else if(r&&!n){document.addEventListener("deviceready",s._monitor,false)}else{document.addEventListener("DOMContentLoaded",s._monitor,false);window.addEventListener("load",s._monitor,false)}}};r.Device._readyCheck=function(){var t=this._readyCheck;if(!document.body){window.setTimeout(t._monitor,20)}else if(!this.deviceReadyAt){this.deviceReadyAt=Date.now();document.removeEventListener("deviceready",t._monitor);document.removeEventListener("DOMContentLoaded",t._monitor);window.removeEventListener("load",t._monitor);this._initialize();this.initialized=true;this.onInitialized.dispatch(this);var e;while(e=t._queue.shift()){var i=e[0];var s=e[1];i.call(s,this)}this._readyCheck=null;this._initialize=null;this.onInitialized=null}};r.Device._initialize=function(){var t=this;function e(){var e=navigator.userAgent;if(/Playstation Vita/.test(e)){t.vita=true}else if(/Kindle/.test(e)||/\bKF[A-Z][A-Z]+/.test(e)||/Silk.*Mobile Safari/.test(e)){t.kindle=true}else if(/Android/.test(e)){t.android=true}else if(/CrOS/.test(e)){t.chromeOS=true}else if(/iP[ao]d|iPhone/i.test(e)){t.iOS=true;navigator.appVersion.match(/OS (\d+)/);t.iOSVersion=parseInt(RegExp.$1,10)}else if(/Linux/.test(e)){t.linux=true}else if(/Mac OS/.test(e)){t.macOS=true}else if(/Windows/.test(e)){t.windows=true}if(/Windows Phone/i.test(e)||/IEMobile/i.test(e)){t.android=false;t.iOS=false;t.macOS=false;t.windows=true;t.windowsPhone=true}var i=/Silk/.test(e);if(t.windows||t.macOS||t.linux&&!i||t.chromeOS){t.desktop=true}if(t.windowsPhone||/Windows NT/i.test(e)&&/Touch/i.test(e)){t.desktop=false}}function s(){t.canvas=!!window["CanvasRenderingContext2D"]||t.cocoonJS;try{t.localStorage=!!localStorage.getItem}catch(e){t.localStorage=false}t.file=!!window["File"]&&!!window["FileReader"]&&!!window["FileList"]&&!!window["Blob"];t.fileSystem=!!window["requestFileSystem"];t.webGL=function(){try{var t=document.createElement("canvas");t.screencanvas=false;return!!window.WebGLRenderingContext&&(t.getContext("webgl")||t.getContext("experimental-webgl"))}catch(t){return false}}();t.webGL=!!t.webGL;t.worker=!!window["Worker"];t.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document;t.quirksMode=document.compatMode==="CSS1Compat"?false:true;navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia;window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL;t.getUserMedia=t.getUserMedia&&!!navigator.getUserMedia&&!!window.URL;if(t.firefox&&t.firefoxVersion<21){t.getUserMedia=false}if(!t.iOS&&(t.ie||t.firefox||t.chrome)){t.canvasBitBltShift=true}if(t.safari||t.mobileSafari){t.canvasBitBltShift=false}}function r(){if("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>=1){t.touch=true}if(window.navigator.msPointerEnabled||window.navigator.pointerEnabled){t.mspointer=true}if(!t.cocoonJS){if("onwheel"in window||t.ie&&"WheelEvent"in window){t.wheelEvent="wheel"}else if("onmousewheel"in window){t.wheelEvent="mousewheel"}else if(t.firefox&&"MouseScrollEvent"in window){t.wheelEvent="DOMMouseScroll"}}}function n(){var e=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"];var i=document.createElement("div");for(var s=0;s<e.length;s++){if(i[e[s]]){t.fullscreen=true;t.requestFullscreen=e[s];break}}var r=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(t.fullscreen){for(var s=0;s<r.length;s++){if(document[r[s]]){t.cancelFullscreen=r[s];break}}}if(window["Element"]&&Element["ALLOW_KEYBOARD_INPUT"]){t.fullscreenKeyboard=true}}function a(){var e=navigator.userAgent;if(/Arora/.test(e)){t.arora=true}else if(/Edge\/\d+/.test(e)){t.edge=true}else if(/Chrome\/(\d+)/.test(e)&&!t.windowsPhone){t.chrome=true;t.chromeVersion=parseInt(RegExp.$1,10)}else if(/Epiphany/.test(e)){t.epiphany=true}else if(/Firefox\D+(\d+)/.test(e)){t.firefox=true;t.firefoxVersion=parseInt(RegExp.$1,10)}else if(/AppleWebKit/.test(e)&&t.iOS){t.mobileSafari=true}else if(/MSIE (\d+\.\d+);/.test(e)){t.ie=true;t.ieVersion=parseInt(RegExp.$1,10)}else if(/Midori/.test(e)){t.midori=true}else if(/Opera/.test(e)){t.opera=true}else if(/Safari\/(\d+)/.test(e)&&!t.windowsPhone){t.safari=true;if(/Version\/(\d+)\./.test(e)){t.safariVersion=parseInt(RegExp.$1,10)}}else if(/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(e)){t.ie=true;t.trident=true;t.tridentVersion=parseInt(RegExp.$1,10);t.ieVersion=parseInt(RegExp.$3,10)}if(/Silk/.test(e)){t.silk=true}if(navigator["standalone"]){t.webApp=true}if(typeof window.cordova!=="undefined"){t.cordova=true}if(typeof i!=="undefined"&&"function"!=="undefined"){t.node=true}if(t.node&&typeof i.versions==="object"){t.nodeWebkit=!!i.versions["node-webkit"];t.electron=!!i.versions.electron}if(navigator["isCocoonJS"]){t.cocoonJS=true}if(t.cocoonJS){try{t.cocoonJSApp=typeof CocoonJS!=="undefined"}catch(e){t.cocoonJSApp=false}}if(typeof window.ejecta!=="undefined"){t.ejecta=true}if(/Crosswalk/.test(e)){t.crosswalk=true}}function o(){var e=document.createElement("video");var i=false;try{if(i=!!e.canPlayType){if(e.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")){t.oggVideo=true}if(e.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")){t.h264Video=true;t.mp4Video=true}if(e.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")){t.webmVideo=true}if(e.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,"")){t.vp9Video=true}if(e.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")){t.hlsVideo=true}}}catch(t){}}function h(){t.audioData=!!window["Audio"];t.webAudio=!!(window["AudioContext"]||window["webkitAudioContext"]);var e=document.createElement("audio");var i=false;try{if(i=!!e.canPlayType){if(e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")){t.ogg=true}if(e.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||e.canPlayType("audio/opus;").replace(/^no$/,"")){t.opus=true}if(e.canPlayType("audio/mpeg;").replace(/^no$/,"")){t.mp3=true}if(e.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")){t.wav=true}if(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/aac;").replace(/^no$/,"")){t.m4a=true}if(e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")){t.webm=true}if(e.canPlayType('audio/mp4;codecs="ec-3"')!==""){if(t.edge){t.dolby=true}else if(t.safari&&t.safariVersion>=9){if(/Mac OS X (\d+)_(\d+)/.test(navigator.userAgent)){var s=parseInt(RegExp.$1,10);var r=parseInt(RegExp.$2,10);if(s===10&&r>=11||s>10){t.dolby=true}}}}}}catch(t){}}function l(){var t=new ArrayBuffer(4);var e=new Uint8Array(t);var i=new Uint32Array(t);e[0]=161;e[1]=178;e[2]=195;e[3]=212;if(i[0]===3569595041){return true}if(i[0]===2712847316){return false}else{return null}}function u(){if(Uint8ClampedArray===undefined){return false}var t=PIXI.CanvasPool.create(this,1,1);var e=t.getContext("2d");if(!e){return false}var i=e.createImageData(1,1);PIXI.CanvasPool.remove(this);return i.data instanceof Uint8ClampedArray}function c(){t.pixelRatio=window["devicePixelRatio"]||1;t.iPhone=navigator.userAgent.toLowerCase().indexOf("iphone")!==-1;t.iPhone4=t.pixelRatio===2&&t.iPhone;t.iPad=navigator.userAgent.toLowerCase().indexOf("ipad")!==-1;if(typeof Int8Array!=="undefined"){t.typedArray=true}else{t.typedArray=false}if(typeof ArrayBuffer!=="undefined"&&typeof Uint8Array!=="undefined"&&typeof Uint32Array!=="undefined"){t.littleEndian=l();t.LITTLE_ENDIAN=t.littleEndian}t.support32bit=typeof ArrayBuffer!=="undefined"&&typeof Uint8ClampedArray!=="undefined"&&typeof Int32Array!=="undefined"&&t.littleEndian!==null&&u();navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate;if(navigator.vibrate){t.vibration=true}}function d(){var e=document.createElement("p");var i;var s={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(e,null);for(var r in s){if(e.style[r]!==undefined){e.style[r]="translate3d(1px,1px,1px)";i=window.getComputedStyle(e).getPropertyValue(s[r])}}document.body.removeChild(e);t.css3D=i!==undefined&&i.length>0&&i!=="none"}e();a();h();o();d();c();s();n();r()};r.Device.canPlayAudio=function(t){if(t==="mp3"&&this.mp3){return true}else if(t==="ogg"&&(this.ogg||this.opus)){return true}else if(t==="m4a"&&this.m4a){return true}else if(t==="opus"&&this.opus){return true}else if(t==="wav"&&this.wav){return true}else if(t==="webm"&&this.webm){return true}else if(t==="mp4"&&this.dolby){return true}return false};r.Device.canPlayVideo=function(t){if(t==="webm"&&(this.webmVideo||this.vp9Video)){return true}else if(t==="mp4"&&(this.mp4Video||this.h264Video)){return true}else if((t==="ogg"||t==="ogv")&&this.oggVideo){return true}else if(t==="mpeg"&&this.hlsVideo){return true}return false};r.Device.isConsoleOpen=function(){if(window.console&&window.console["firebug"]){return true}if(window.console){console.profile();console.profileEnd();if(console.clear){console.clear()}if(console["profiles"]){return console["profiles"].length>0}}return false};r.Device.isAndroidStockBrowser=function(){var t=window.navigator.userAgent.match(/Android.*AppleWebKit\/([\d.]+)/);return t&&t[1]<537};r.Canvas={create:function(t,e,i,s,r){e=e||256;i=i||256;var n=r?document.createElement("canvas"):PIXI.CanvasPool.create(t,e,i);if(typeof s==="string"&&s!==""){n.id=s}n.width=e;n.height=i;n.style.display="block";return n},setBackgroundColor:function(t,e){e=e||"rgb(0,0,0)";t.style.backgroundColor=e;return t},setTouchAction:function(t,e){e=e||"none";t.style.msTouchAction=e;t.style["ms-touch-action"]=e;t.style["touch-action"]=e;return t},setUserSelect:function(t,e){e=e||"none";t.style["-webkit-touch-callout"]=e;t.style["-webkit-user-select"]=e;t.style["-khtml-user-select"]=e;t.style["-moz-user-select"]=e;t.style["-ms-user-select"]=e;t.style["user-select"]=e;t.style["-webkit-tap-highlight-color"]="rgba(0, 0, 0, 0)";return t},addToDOM:function(t,e,i){var s;if(i===undefined){i=true}if(e){if(typeof e==="string"){s=document.getElementById(e)}else if(typeof e==="object"&&e.nodeType===1){s=e}}if(!s){s=document.body}if(i&&s.style){s.style.overflow="hidden"}s.appendChild(t);return t},removeFromDOM:function(t){if(t.parentNode){t.parentNode.removeChild(t)}},setTransform:function(t,e,i,s,r,n,a){t.setTransform(s,n,a,r,e,i);return t},setSmoothingEnabled:function(t,e){var i=r.Canvas.getSmoothingPrefix(t);if(i){t[i]=e}return t},getSmoothingPrefix:function(t){var e=["i","webkitI","msI","mozI","oI"];for(var i in e){var s=e[i]+"mageSmoothingEnabled";if(s in t){return s}}return null},getSmoothingEnabled:function(t){var e=r.Canvas.getSmoothingPrefix(t);if(e){return t[e]}},setImageRenderingCrisp:function(t){var e=["optimizeSpeed","crisp-edges","-moz-crisp-edges","-webkit-optimize-contrast","optimize-contrast","pixelated"];for(var i=0;i<e.length;i++){t.style["image-rendering"]=e[i]}t.style.msInterpolationMode="nearest-neighbor";return t},setImageRenderingBicubic:function(t){t.style["image-rendering"]="auto";t.style.msInterpolationMode="bicubic";return t}};r.RequestAnimationFrame=function(t,e){if(e===undefined){e=false}this.game=t;this.isRunning=false;this.forceSetTimeOut=e;var i=["ms","moz","webkit","o"];for(var s=0;s<i.length&&!window.requestAnimationFrame;s++){window.requestAnimationFrame=window[i[s]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[i[s]+"CancelAnimationFrame"]}this._isSetTimeOut=false;this._onLoop=null;this._timeOutID=null};r.RequestAnimationFrame.prototype={start:function(){this.isRunning=true;var t=this;if(!window.requestAnimationFrame||this.forceSetTimeOut){this._isSetTimeOut=true;this._onLoop=function(){return t.updateSetTimeout()};this._timeOutID=window.setTimeout(this._onLoop,0)}else{this._isSetTimeOut=false;this._onLoop=function(e){return t.updateRAF(e)};this._timeOutID=window.requestAnimationFrame(this._onLoop)}},updateRAF:function(t){if(this.isRunning){this.game.update(Math.floor(t));this._timeOutID=window.requestAnimationFrame(this._onLoop)}},updateSetTimeout:function(){if(this.isRunning){this.game.update(Date.now());this._timeOutID=window.setTimeout(this._onLoop,this.game.time.timeToCall)}},stop:function(){if(this._isSetTimeOut){clearTimeout(this._timeOutID)}else{window.cancelAnimationFrame(this._timeOutID)}this.isRunning=false},isSetTimeOut:function(){return this._isSetTimeOut},isRAF:function(){return this._isSetTimeOut===false}};r.RequestAnimationFrame.prototype.constructor=r.RequestAnimationFrame;r.Math={PI2:Math.PI*2,between:function(t,e){return Math.floor(Math.random()*(e-t+1)+t)},fuzzyEqual:function(t,e,i){if(i===undefined){i=1e-4}return Math.abs(t-e)<i},fuzzyLessThan:function(t,e,i){if(i===undefined){i=1e-4}return t<e+i},fuzzyGreaterThan:function(t,e,i){if(i===undefined){i=1e-4}return t>e-i},fuzzyCeil:function(t,e){if(e===undefined){e=1e-4}return Math.ceil(t-e)},fuzzyFloor:function(t,e){if(e===undefined){e=1e-4}return Math.floor(t+e)},average:function(){var t=0;var e=arguments.length;for(var i=0;i<e;i++){t+=+arguments[i]}return t/e},shear:function(t){return t%1},snapTo:function(t,e,i){if(i===undefined){i=0}if(e===0){return t}t-=i;t=e*Math.round(t/e);return i+t},snapToFloor:function(t,e,i){if(i===undefined){i=0}if(e===0){return t}t-=i;t=e*Math.floor(t/e);return i+t},snapToCeil:function(t,e,i){if(i===undefined){i=0}if(e===0){return t}t-=i;t=e*Math.ceil(t/e);return i+t},roundTo:function(t,e,i){if(e===undefined){e=0}if(i===undefined){i=10}var s=Math.pow(i,-e);return Math.round(t*s)/s},floorTo:function(t,e,i){if(e===undefined){e=0}if(i===undefined){i=10}var s=Math.pow(i,-e);return Math.floor(t*s)/s},ceilTo:function(t,e,i){if(e===undefined){e=0}if(i===undefined){i=10}var s=Math.pow(i,-e);return Math.ceil(t*s)/s},rotateToAngle:function(t,e,i){if(i===undefined){i=.05}if(t===e){return t}if(Math.abs(e-t)<=i||Math.abs(e-t)>=r.Math.PI2-i){t=e}else{if(Math.abs(e-t)>Math.PI){if(e<t){e+=r.Math.PI2}else{e-=r.Math.PI2}}if(e>t){t+=i}else if(e<t){t-=i}}return t},getShortestAngle:function(t,e){var i=e-t;if(i===0){return 0}var s=Math.floor((i- -180)/360);return i-s*360},angleBetween:function(t,e,i,s){return Math.atan2(s-e,i-t)},angleBetweenY:function(t,e,i,s){return Math.atan2(i-t,s-e)},angleBetweenPoints:function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)},angleBetweenPointsY:function(t,e){return Math.atan2(e.x-t.x,e.y-t.y)},reverseAngle:function(t){return this.normalizeAngle(t+Math.PI,true)},normalizeAngle:function(t){t=t%(2*Math.PI);return t>=0?t:t+2*Math.PI},maxAdd:function(t,e,i){return Math.min(t+e,i)},minSub:function(t,e,i){return Math.max(t-e,i)},wrap:function(t,e,i){var s=i-e;if(s<=0){return 0}var r=(t-e)%s;if(r<0){r+=s}return r+e},wrapValue:function(t,e,i){var s;t=Math.abs(t);e=Math.abs(e);i=Math.abs(i);s=(t+e)%i;return s},isOdd:function(t){return!!(t&1)},isEven:function(t){return!(t&1)},min:function(){if(arguments.length===1&&typeof arguments[0]==="object"){var t=arguments[0]}else{var t=arguments}for(var e=1,i=0,s=t.length;e<s;e++){if(t[e]<t[i]){i=e}}return t[i]},max:function(){if(arguments.length===1&&typeof arguments[0]==="object"){var t=arguments[0]}else{var t=arguments}for(var e=1,i=0,s=t.length;e<s;e++){if(t[e]>t[i]){i=e}}return t[i]},minProperty:function(t){if(arguments.length===2&&typeof arguments[1]==="object"){var e=arguments[1]}else{var e=arguments.slice(1)}for(var i=1,s=0,r=e.length;i<r;i++){if(e[i][t]<e[s][t]){s=i}}return e[s][t]},maxProperty:function(t){if(arguments.length===2&&typeof arguments[1]==="object"){var e=arguments[1]}else{var e=arguments.slice(1)}for(var i=1,s=0,r=e.length;i<r;i++){if(e[i][t]>e[s][t]){s=i}}return e[s][t]},wrapAngle:function(t,e){return e?this.wrap(t,-Math.PI,Math.PI):this.wrap(t,-180,180)},linearInterpolation:function(t,e){var i=t.length-1;var s=i*e;var r=Math.floor(s);if(e<0){return this.linear(t[0],t[1],s)}if(e>1){return this.linear(t[i],t[i-1],i-s)}return this.linear(t[r],t[r+1>i?i:r+1],s-r)},bezierInterpolation:function(t,e){var i=0;var s=t.length-1;for(var r=0;r<=s;r++){i+=Math.pow(1-e,s-r)*Math.pow(e,r)*t[r]*this.bernstein(s,r)}return i},catmullRomInterpolation:function(t,e){var i=t.length-1;var s=i*e;var r=Math.floor(s);if(t[0]===t[i]){if(e<0){r=Math.floor(s=i*(1+e))}return this.catmullRom(t[(r-1+i)%i],t[r],t[(r+1)%i],t[(r+2)%i],s-r)}else{if(e<0){return t[0]-(this.catmullRom(t[0],t[0],t[1],t[1],-s)-t[0])}if(e>1){return t[i]-(this.catmullRom(t[i],t[i],t[i-1],t[i-1],s-i)-t[i])}return this.catmullRom(t[r?r-1:0],t[r],t[i<r+1?i:r+1],t[i<r+2?i:r+2],s-r)}},linear:function(t,e,i){return(e-t)*i+t},bernstein:function(t,e){return this.factorial(t)/this.factorial(e)/this.factorial(t-e)},factorial:function(t){if(t===0){return 1}var e=t;while(--t){e*=t}return e},catmullRom:function(t,e,i,s,r){var n=(i-t)*.5,a=(s-e)*.5,o=r*r,h=r*o;return(2*e-2*i+n+a)*h+(-3*e+3*i-2*n-a)*o+n*r+e},difference:function(t,e){return Math.abs(t-e)},roundAwayFromZero:function(t){return t>0?Math.ceil(t):Math.floor(t)},sinCosGenerator:function(t,e,i,s){if(e===undefined){e=1}if(i===undefined){i=1}if(s===undefined){s=1}var r=e;var n=i;var a=s*Math.PI/t;var o=[];var h=[];for(var l=0;l<t;l++){n-=r*a;r+=n*a;o[l]=n;h[l]=r}return{sin:h,cos:o,length:t}},distance:function(t,e,i,s){var r=t-i;var n=e-s;return Math.sqrt(r*r+n*n)},distanceSq:function(t,e,i,s){var r=t-i;var n=e-s;return r*r+n*n},distancePow:function(t,e,i,s,r){if(r===undefined){r=2}return Math.sqrt(Math.pow(i-t,r)+Math.pow(s-e,r))},clamp:function(t,e,i){if(t<e){return e}else if(i<t){return i}else{return t}},clampBottom:function(t,e){return t<e?e:t},within:function(t,e,i){return Math.abs(t-e)<=i},mapLinear:function(t,e,i,s,r){return s+(t-e)*(r-s)/(i-e)},smoothstep:function(t,e,i){t=Math.max(0,Math.min(1,(t-e)/(i-e)));return t*t*(3-2*t)},smootherstep:function(t,e,i){t=Math.max(0,Math.min(1,(t-e)/(i-e)));return t*t*t*(t*(t*6-15)+10)},sign:function(t){return t<0?-1:t>0?1:0},percent:function(t,e,i){if(i===undefined){i=0}if(t>e||i>e){return 1}else if(t<i||i>t){return 0}else{return(t-i)/e}}};var f=Math.PI/180;var p=180/Math.PI;r.Math.degToRad=function t(e){return e*f};r.Math.radToDeg=function t(e){return e*p};r.RandomDataGenerator=function(t){if(t===undefined){t=[]}this.c=1;this.s0=0;this.s1=0;this.s2=0;if(typeof t==="string"){this.state(t)}else{this.sow(t)}};r.RandomDataGenerator.prototype={rnd:function(){var t=2091639*this.s0+this.c*2.3283064365386963e-10;this.c=t|0;this.s0=this.s1;this.s1=this.s2;this.s2=t-this.c;return this.s2},sow:function(t){this.s0=this.hash(" ");this.s1=this.hash(this.s0);this.s2=this.hash(this.s1);this.c=1;if(!t){return}for(var e=0;e<t.length&&t[e]!=null;e++){var i=t[e];this.s0-=this.hash(i);this.s0+=~~(this.s0<0);this.s1-=this.hash(i);this.s1+=~~(this.s1<0);this.s2-=this.hash(i);this.s2+=~~(this.s2<0)}},hash:function(t){var e,i,s;s=4022871197;t=t.toString();for(i=0;i<t.length;i++){s+=t.charCodeAt(i);e=.02519603282416938*s;s=e>>>0;e-=s;e*=s;s=e>>>0;e-=s;s+=e*4294967296}return(s>>>0)*2.3283064365386963e-10},integer:function(){return this.rnd.apply(this)*4294967296},frac:function(){return this.rnd.apply(this)+(this.rnd.apply(this)*2097152|0)*1.1102230246251565e-16},real:function(){return this.integer()+this.frac()},integerInRange:function(t,e){return Math.floor(this.realInRange(0,e-t+1)+t)},between:function(t,e){return this.integerInRange(t,e)},realInRange:function(t,e){return this.frac()*(e-t)+t},normal:function(){return 1-2*this.frac()},uuid:function(){var t="";var e="";for(e=t="";t++<36;e+=~t%5|t*3&4?(t^15?8^this.frac()*(t^20?16:4):4).toString(16):"-"){}return e},pick:function(t){return t[this.integerInRange(0,t.length-1)]},sign:function(){return this.pick([-1,1])},weightedPick:function(t){return t[~~(Math.pow(this.frac(),2)*(t.length-1)+.5)]},timestamp:function(t,e){return this.realInRange(t||9466848e5,e||1577862e6)},angle:function(){return this.integerInRange(-180,180)},state:function(t){if(typeof t==="string"&&t.match(/^!rnd/)){t=t.split(",");this.c=parseFloat(t[1]);this.s0=parseFloat(t[2]);this.s1=parseFloat(t[3]);this.s2=parseFloat(t[4])}return["!rnd",this.c,this.s0,this.s1,this.s2].join(",")}};r.RandomDataGenerator.prototype.constructor=r.RandomDataGenerator;r.QuadTree=function(t,e,i,s,r,n,a){this.maxObjects=10;this.maxLevels=4;this.level=0;this.bounds={};this.objects=[];this.nodes=[];this._empty=[];this.reset(t,e,i,s,r,n,a)};r.QuadTree.prototype={reset:function(t,e,i,s,r,n,a){this.maxObjects=r||10;this.maxLevels=n||4;this.level=a||0;this.bounds={x:Math.round(t),y:Math.round(e),width:i,height:s,subWidth:Math.floor(i/2),subHeight:Math.floor(s/2),right:Math.round(t)+Math.floor(i/2),bottom:Math.round(e)+Math.floor(s/2)};this.objects.length=0;this.nodes.length=0},populate:function(t){t.forEach(this.populateHandler,this,true)},populateHandler:function(t){if(t.body&&t.exists){this.insert(t.body)}},split:function(){this.nodes[0]=new r.QuadTree(this.bounds.right,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1);this.nodes[1]=new r.QuadTree(this.bounds.x,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1);this.nodes[2]=new r.QuadTree(this.bounds.x,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1);this.nodes[3]=new r.QuadTree(this.bounds.right,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1)},insert:function(t){var e=0;var i;if(this.nodes[0]!=null){i=this.getIndex(t);if(i!==-1){this.nodes[i].insert(t);return}}this.objects.push(t);if(this.objects.length>this.maxObjects&&this.level<this.maxLevels){if(this.nodes[0]==null){this.split()}while(e<this.objects.length){i=this.getIndex(this.objects[e]);if(i!==-1){this.nodes[i].insert(this.objects.splice(e,1)[0])}else{e++}}}},getIndex:function(t){var e=-1;if(t.x<this.bounds.right&&t.right<this.bounds.right){if(t.y<this.bounds.bottom&&t.bottom<this.bounds.bottom){e=1}else if(t.y>this.bounds.bottom){e=2}}else if(t.x>this.bounds.right){if(t.y<this.bounds.bottom&&t.bottom<this.bounds.bottom){e=0}else if(t.y>this.bounds.bottom){e=3}}return e},retrieve:function(t){if(t instanceof r.Rectangle){var e=this.objects;var i=this.getIndex(t)}else{if(!t.body){return this._empty}var e=this.objects;var i=this.getIndex(t.body)}if(this.nodes[0]){if(i!==-1){e=e.concat(this.nodes[i].retrieve(t))}else{e=e.concat(this.nodes[0].retrieve(t));e=e.concat(this.nodes[1].retrieve(t));e=e.concat(this.nodes[2].retrieve(t));e=e.concat(this.nodes[3].retrieve(t))}}return e},clear:function(){this.objects.length=0;var t=this.nodes.length;while(t--){this.nodes[t].clear();this.nodes.splice(t,1)}this.nodes.length=0}};r.QuadTree.prototype.constructor=r.QuadTree;r.Net=function(t){this.game=t};r.Net.prototype={getHostName:function(){if(window.location&&window.location.hostname){return window.location.hostname}return null},checkDomainName:function(t){return window.location.hostname.indexOf(t)!==-1},updateQueryString:function(t,e,i,s){if(i===undefined){i=false}if(s===undefined||s===""){s=window.location.href}var r="";var n=new RegExp("([?|&])"+t+"=.*?(&|#|$)(.*)","gi");if(n.test(s)){if(typeof e!=="undefined"&&e!==null){r=s.replace(n,"$1"+t+"="+e+"$2$3")}else{r=s.replace(n,"$1$3").replace(/(&|\?)$/,"")}}else{if(typeof e!=="undefined"&&e!==null){var a=s.indexOf("?")!==-1?"&":"?";var o=s.split("#");s=o[0]+a+t+"="+e;if(o[1]){s+="#"+o[1]}r=s}else{r=s}}if(i){window.location.href=r}else{return r}},getQueryString:function(t){if(t===undefined){t=""}var e={};var i=location.search.substring(1).split("&");for(var s in i){var r=i[s].split("=");if(r.length>1){if(t&&t===this.decodeURI(r[0])){return this.decodeURI(r[1])}else{e[this.decodeURI(r[0])]=this.decodeURI(r[1])}}}return e},decodeURI:function(t){return decodeURIComponent(t.replace(/\+/g," "))}};r.Net.prototype.constructor=r.Net;r.TweenManager=function(t){this.game=t;this.frameBased=false;this._tweens=[];this._add=[];this.easeMap={Power0:r.Easing.Power0,Power1:r.Easing.Power1,Power2:r.Easing.Power2,Power3:r.Easing.Power3,Power4:r.Easing.Power4,Linear:r.Easing.Linear.None,Quad:r.Easing.Quadratic.Out,Cubic:r.Easing.Cubic.Out,Quart:r.Easing.Quartic.Out,Quint:r.Easing.Quintic.Out,Sine:r.Easing.Sinusoidal.Out,Expo:r.Easing.Exponential.Out,Circ:r.Easing.Circular.Out,Elastic:r.Easing.Elastic.Out,Back:r.Easing.Back.Out,Bounce:r.Easing.Bounce.Out,"Quad.easeIn":r.Easing.Quadratic.In,"Cubic.easeIn":r.Easing.Cubic.In,"Quart.easeIn":r.Easing.Quartic.In,"Quint.easeIn":r.Easing.Quintic.In,"Sine.easeIn":r.Easing.Sinusoidal.In,"Expo.easeIn":r.Easing.Exponential.In,"Circ.easeIn":r.Easing.Circular.In,"Elastic.easeIn":r.Easing.Elastic.In,"Back.easeIn":r.Easing.Back.In,"Bounce.easeIn":r.Easing.Bounce.In,"Quad.easeOut":r.Easing.Quadratic.Out,"Cubic.easeOut":r.Easing.Cubic.Out,"Quart.easeOut":r.Easing.Quartic.Out,"Quint.easeOut":r.Easing.Quintic.Out,"Sine.easeOut":r.Easing.Sinusoidal.Out,"Expo.easeOut":r.Easing.Exponential.Out,"Circ.easeOut":r.Easing.Circular.Out,"Elastic.easeOut":r.Easing.Elastic.Out,"Back.easeOut":r.Easing.Back.Out,"Bounce.easeOut":r.Easing.Bounce.Out,"Quad.easeInOut":r.Easing.Quadratic.InOut,"Cubic.easeInOut":r.Easing.Cubic.InOut,"Quart.easeInOut":r.Easing.Quartic.InOut,"Quint.easeInOut":r.Easing.Quintic.InOut,"Sine.easeInOut":r.Easing.Sinusoidal.InOut,"Expo.easeInOut":r.Easing.Exponential.InOut,"Circ.easeInOut":r.Easing.Circular.InOut,"Elastic.easeInOut":r.Easing.Elastic.InOut,"Back.easeInOut":r.Easing.Back.InOut,"Bounce.easeInOut":r.Easing.Bounce.InOut};this.game.onPause.add(this._pauseAll,this);this.game.onResume.add(this._resumeAll,this)};r.TweenManager.prototype={getAll:function(){return this._tweens},removeAll:function(){for(var t=0;t<this._tweens.length;t++){this._tweens[t].pendingDelete=true}this._add=[]},removeFrom:function(t,e){if(e===undefined){e=true}var i;var s;if(Array.isArray(t)){for(i=0,s=t.length;i<s;i++){this.removeFrom(t[i])}}else if(t.type===r.GROUP&&e){for(var i=0,s=t.children.length;i<s;i++){this.removeFrom(t.children[i])}}else{for(i=0,s=this._tweens.length;i<s;i++){if(t===this._tweens[i].target){this.remove(this._tweens[i])}}for(i=0,s=this._add.length;i<s;i++){if(t===this._add[i].target){this.remove(this._add[i])}}}},add:function(t){t._manager=this;this._add.push(t)},create:function(t){return new r.Tween(t,this.game,this)},remove:function(t){var e=this._tweens.indexOf(t);if(e!==-1){this._tweens[e].pendingDelete=true}else{e=this._add.indexOf(t);if(e!==-1){this._add[e].pendingDelete=true}}},update:function(){var t=this._add.length;var e=this._tweens.length;if(e===0&&t===0){return false}var i=0;while(i<e){if(this._tweens[i].update(this.game.time.time)){i++}else{this._tweens.splice(i,1);e--}}if(t>0){this._tweens=this._tweens.concat(this._add);this._add.length=0}return true},isTweening:function(t){return this._tweens.some(function(e){return e.target===t})},_pauseAll:function(){for(var t=this._tweens.length-1;t>=0;t--){this._tweens[t]._pause()}},_resumeAll:function(){for(var t=this._tweens.length-1;t>=0;t--){this._tweens[t]._resume()}},pauseAll:function(){for(var t=this._tweens.length-1;t>=0;t--){this._tweens[t].pause()}},resumeAll:function(){for(var t=this._tweens.length-1;t>=0;t--){this._tweens[t].resume(true)}}};r.TweenManager.prototype.constructor=r.TweenManager;r.Tween=function(t,e,i){this.game=e;this.target=t;this.manager=i;this.timeline=[];this.reverse=false;this.timeScale=1;this.repeatCounter=0;this.pendingDelete=false;this.onStart=new r.Signal;this.onLoop=new r.Signal;this.onRepeat=new r.Signal;this.onChildComplete=new r.Signal;this.onComplete=new r.Signal;this.isRunning=false;this.current=0;this.properties={};this.chainedTween=null;this.isPaused=false;this.frameBased=i.frameBased;this._onUpdateCallback=null;this._onUpdateCallbackContext=null;this._pausedTime=0;this._codePaused=false;this._hasStarted=false};r.Tween.prototype={to:function(t,e,i,s,n,a,o){if(e===undefined||e<=0){e=1e3}if(i===undefined||i===null){i=r.Easing.Default}if(s===undefined){s=false}if(n===undefined){n=0}if(a===undefined){a=0}if(o===undefined){o=false}if(typeof i==="string"&&this.manager.easeMap[i]){i=this.manager.easeMap[i]}if(this.isRunning){console.warn("Phaser.Tween.to cannot be called after Tween.start");return this}this.timeline.push(new r.TweenData(this).to(t,e,i,n,a,o));if(s){this.start()}return this},from:function(t,e,i,s,n,a,o){if(e===undefined){e=1e3}if(i===undefined||i===null){i=r.Easing.Default}if(s===undefined){s=false}if(n===undefined){n=0}if(a===undefined){a=0}if(o===undefined){o=false}if(typeof i==="string"&&this.manager.easeMap[i]){i=this.manager.easeMap[i]}if(this.isRunning){console.warn("Phaser.Tween.from cannot be called after Tween.start");return this}this.timeline.push(new r.TweenData(this).from(t,e,i,n,a,o));if(s){this.start()}return this},start:function(t){if(t===undefined){t=0}if(this.game===null||this.target===null||this.timeline.length===0||this.isRunning){return this}for(var e=0;e<this.timeline.length;e++){for(var i in this.timeline[e].vEnd){this.properties[i]=this.target[i]||0;if(!Array.isArray(this.properties[i])){this.properties[i]*=1}}}for(var e=0;e<this.timeline.length;e++){this.timeline[e].loadValues()}this.manager.add(this);this.isRunning=true;if(t<0||t>this.timeline.length-1){t=0}this.current=t;this.timeline[this.current].start();return this},stop:function(t){if(t===undefined){t=false}this.isRunning=false;this._onUpdateCallback=null;this._onUpdateCallbackContext=null;if(t){this.onComplete.dispatch(this.target,this);this._hasStarted=false;if(this.chainedTween){this.chainedTween.start()}}this.manager.remove(this);return this},updateTweenData:function(t,e,i){if(this.timeline.length===0){return this}if(i===undefined){i=0}if(i===-1){for(var s=0;s<this.timeline.length;s++){this.timeline[s][t]=e}}else{this.timeline[i][t]=e}return this},delay:function(t,e){return this.updateTweenData("delay",t,e)},repeat:function(t,e,i){if(e===undefined){e=0}this.updateTweenData("repeatCounter",t,i);return this.updateTweenData("repeatDelay",e,i)},repeatDelay:function(t,e){return this.updateTweenData("repeatDelay",t,e)},yoyo:function(t,e,i){if(e===undefined){e=0}this.updateTweenData("yoyo",t,i);return this.updateTweenData("yoyoDelay",e,i)},yoyoDelay:function(t,e){return this.updateTweenData("yoyoDelay",t,e)},easing:function(t,e){if(typeof t==="string"&&this.manager.easeMap[t]){t=this.manager.easeMap[t]}return this.updateTweenData("easingFunction",t,e)},interpolation:function(t,e,i){if(e===undefined){e=r.Math}this.updateTweenData("interpolationFunction",t,i);return this.updateTweenData("interpolationContext",e,i)},repeatAll:function(t){if(t===undefined){t=0}this.repeatCounter=t;return this},chain:function(){var t=arguments.length;while(t--){if(t>0){arguments[t-1].chainedTween=arguments[t]}else{this.chainedTween=arguments[t]}}return this},loop:function(t){if(t===undefined){t=true}this.repeatCounter=t?-1:0;return this},onUpdateCallback:function(t,e){this._onUpdateCallback=t;this._onUpdateCallbackContext=e;return this},pause:function(){this.isPaused=true;this._codePaused=true;this._pausedTime=this.game.time.time},_pause:function(){if(!this._codePaused){this.isPaused=true;this._pausedTime=this.game.time.time}},resume:function(){if(this.isPaused){this.isPaused=false;this._codePaused=false;for(var t=0;t<this.timeline.length;t++){if(!this.timeline[t].isRunning){this.timeline[t].startTime+=this.game.time.time-this._pausedTime}}}},_resume:function(){if(this._codePaused){return}else{this.resume()}},update:function(t){if(this.pendingDelete||!this.target){return false}if(this.isPaused){return true}var e=this.timeline[this.current].update(t);if(e===r.TweenData.PENDING){return true}else if(e===r.TweenData.RUNNING){if(!this._hasStarted){this.onStart.dispatch(this.target,this);this._hasStarted=true}if(this._onUpdateCallback!==null){this._onUpdateCallback.call(this._onUpdateCallbackContext,this,this.timeline[this.current].value,this.timeline[this.current])}return this.isRunning}else if(e===r.TweenData.LOOPED){if(this.timeline[this.current].repeatCounter===-1){this.onLoop.dispatch(this.target,this)}else{this.onRepeat.dispatch(this.target,this)}return true}else if(e===r.TweenData.COMPLETE){var i=false;if(this.reverse){this.current--;if(this.current<0){this.current=this.timeline.length-1;i=true}}else{this.current++;if(this.current===this.timeline.length){this.current=0;i=true}}if(i){if(this.repeatCounter===-1){this.timeline[this.current].start();this.onLoop.dispatch(this.target,this);return true}else if(this.repeatCounter>0){this.repeatCounter--;this.timeline[this.current].start();this.onRepeat.dispatch(this.target,this);return true}else{this.isRunning=false;this.onComplete.dispatch(this.target,this);this._hasStarted=false;if(this.chainedTween){this.chainedTween.start()}return false}}else{this.onChildComplete.dispatch(this.target,this);this.timeline[this.current].start();return true}}},generateData:function(t,e){if(this.game===null||this.target===null){return null}if(t===undefined){t=60}if(e===undefined){e=[]}for(var i=0;i<this.timeline.length;i++){for(var s in this.timeline[i].vEnd){this.properties[s]=this.target[s]||0;if(!Array.isArray(this.properties[s])){this.properties[s]*=1}}}for(var i=0;i<this.timeline.length;i++){this.timeline[i].loadValues()}for(var i=0;i<this.timeline.length;i++){e=e.concat(this.timeline[i].generateData(t))}return e}};Object.defineProperty(r.Tween.prototype,"totalDuration",{get:function(){var t=0;for(var e=0;e<this.timeline.length;e++){t+=this.timeline[e].duration}return t}});r.Tween.prototype.constructor=r.Tween;r.TweenData=function(t){this.parent=t;this.game=t.game;this.vStart={};this.vStartCache={};this.vEnd={};this.vEndCache={};this.duration=1e3;this.percent=0;this.value=0;this.repeatCounter=0;this.repeatDelay=0;this.repeatTotal=0;this.interpolate=false;this.yoyo=false;this.yoyoDelay=0;this.inReverse=false;this.delay=0;this.dt=0;this.startTime=null;this.easingFunction=r.Easing.Default;this.interpolationFunction=r.Math.linearInterpolation;this.interpolationContext=r.Math;this.isRunning=false;this.isFrom=false};r.TweenData.PENDING=0;r.TweenData.RUNNING=1;r.TweenData.LOOPED=2;r.TweenData.COMPLETE=3;r.TweenData.prototype={to:function(t,e,i,s,r,n){this.vEnd=t;this.duration=e;this.easingFunction=i;this.delay=s;this.repeatTotal=r;this.yoyo=n;this.isFrom=false;return this},from:function(t,e,i,s,r,n){this.vEnd=t;this.duration=e;this.easingFunction=i;this.delay=s;this.repeatTotal=r;this.yoyo=n;this.isFrom=true;return this},start:function(){this.startTime=this.game.time.time+this.delay;if(this.parent.reverse){this.dt=this.duration}else{this.dt=0}if(this.delay>0){this.isRunning=false}else{this.isRunning=true}if(this.isFrom){for(var t in this.vStartCache){this.vStart[t]=this.vEndCache[t];this.vEnd[t]=this.vStartCache[t];this.parent.target[t]=this.vStart[t]}}this.value=0;this.yoyoCounter=0;this.repeatCounter=this.repeatTotal;return this},loadValues:function(){for(var t in this.parent.properties){this.vStart[t]=this.parent.properties[t];if(Array.isArray(this.vEnd[t])){if(this.vEnd[t].length===0){continue}if(this.percent===0){this.vEnd[t]=[this.vStart[t]].concat(this.vEnd[t])}}if(typeof this.vEnd[t]!=="undefined"){if(typeof this.vEnd[t]==="string"){this.vEnd[t]=this.vStart[t]+parseFloat(this.vEnd[t],10)}this.parent.properties[t]=this.vEnd[t]}else{this.vEnd[t]=this.vStart[t]}this.vStartCache[t]=this.vStart[t];this.vEndCache[t]=this.vEnd[t]}return this},update:function(t){if(!this.isRunning){if(t>=this.startTime){this.isRunning=true}else{return r.TweenData.PENDING}}else{if(t<this.startTime){return r.TweenData.RUNNING}}var e=this.parent.frameBased?this.game.time.physicsElapsedMS:this.game.time.elapsedMS;if(this.parent.reverse){this.dt-=e*this.parent.timeScale;this.dt=Math.max(this.dt,0)}else{this.dt+=e*this.parent.timeScale;this.dt=Math.min(this.dt,this.duration)}this.percent=this.dt/this.duration;this.value=this.easingFunction(this.percent);for(var i in this.vEnd){var s=this.vStart[i];var n=this.vEnd[i];if(Array.isArray(n)){this.parent.target[i]=this.interpolationFunction.call(this.interpolationContext,n,this.value)}else{this.parent.target[i]=s+(n-s)*this.value}}if(!this.parent.reverse&&this.percent===1||this.parent.reverse&&this.percent===0){return this.repeat()}return r.TweenData.RUNNING},generateData:function(t){if(this.parent.reverse){this.dt=this.duration}else{this.dt=0}var e=[];var i=false;var s=1/t*1e3;do{if(this.parent.reverse){this.dt-=s;this.dt=Math.max(this.dt,0)}else{this.dt+=s;this.dt=Math.min(this.dt,this.duration)}this.percent=this.dt/this.duration;this.value=this.easingFunction(this.percent);var r={};for(var n in this.vEnd){var a=this.vStart[n];var o=this.vEnd[n];if(Array.isArray(o)){r[n]=this.interpolationFunction(o,this.value)}else{r[n]=a+(o-a)*this.value}}e.push(r);if(!this.parent.reverse&&this.percent===1||this.parent.reverse&&this.percent===0){i=true}}while(!i);if(this.yoyo){var h=e.slice();h.reverse();e=e.concat(h)}return e},repeat:function(){if(this.yoyo){if(this.inReverse&&this.repeatCounter===0){for(var t in this.vStartCache){this.vStart[t]=this.vStartCache[t];this.vEnd[t]=this.vEndCache[t]}this.inReverse=false;return r.TweenData.COMPLETE}this.inReverse=!this.inReverse}else{if(this.repeatCounter===0){return r.TweenData.COMPLETE}}if(this.inReverse){for(var t in this.vStartCache){this.vStart[t]=this.vEndCache[t];this.vEnd[t]=this.vStartCache[t]}}else{for(var t in this.vStartCache){this.vStart[t]=this.vStartCache[t];this.vEnd[t]=this.vEndCache[t]}if(this.repeatCounter>0){this.repeatCounter--}}this.startTime=this.game.time.time;if(this.yoyo&&this.inReverse){this.startTime+=this.yoyoDelay}else if(!this.inReverse){this.startTime+=this.repeatDelay}if(this.parent.reverse){this.dt=this.duration}else{this.dt=0}return r.TweenData.LOOPED}};r.TweenData.prototype.constructor=r.TweenData;r.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){if((t*=2)<1)return.5*t*t;return-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){if((t*=2)<1)return.5*t*t*t;return.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){if((t*=2)<1)return.5*t*t*t*t;return-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){if((t*=2)<1)return.5*t*t*t*t*t;return.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){if(t===0)return 0;if(t===1)return 1;return 1-Math.cos(t*Math.PI/2)},Out:function(t){if(t===0)return 0;if(t===1)return 1;return Math.sin(t*Math.PI/2)},InOut:function(t){if(t===0)return 0;if(t===1)return 1;return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return t===0?0:Math.pow(1024,t-1)},Out:function(t){return t===1?1:1-Math.pow(2,-10*t)},InOut:function(t){if(t===0)return 0;if(t===1)return 1;if((t*=2)<1)return.5*Math.pow(1024,t-1);return.5*(-Math.pow(2,-10*(t-1))+2)}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){if((t*=2)<1)return-.5*(Math.sqrt(1-t*t)-1);return.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){var e,i=.1,s=.4;if(t===0)return 0;if(t===1)return 1;if(!i||i<1){i=1;e=s/4}else e=s*Math.asin(1/i)/(2*Math.PI);return-(i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/s))},Out:function(t){var e,i=.1,s=.4;if(t===0)return 0;if(t===1)return 1;if(!i||i<1){i=1;e=s/4}else e=s*Math.asin(1/i)/(2*Math.PI);return i*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/s)+1},InOut:function(t){var e,i=.1,s=.4;if(t===0)return 0;if(t===1)return 1;if(!i||i<1){i=1;e=s/4}else e=s*Math.asin(1/i)/(2*Math.PI);if((t*=2)<1)return-.5*(i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/s));return i*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/s)*.5+1}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=1.70158*1.525;if((t*=2)<1)return.5*(t*t*((e+1)*t-e));return.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-r.Easing.Bounce.Out(1-t)},Out:function(t){if(t<1/2.75){return 7.5625*t*t}else if(t<2/2.75){return 7.5625*(t-=1.5/2.75)*t+.75}else if(t<2.5/2.75){return 7.5625*(t-=2.25/2.75)*t+.9375}else{return 7.5625*(t-=2.625/2.75)*t+.984375}},InOut:function(t){if(t<.5)return r.Easing.Bounce.In(t*2)*.5;return r.Easing.Bounce.Out(t*2-1)*.5+.5}}};r.Easing.Default=r.Easing.Linear.None;r.Easing.Power0=r.Easing.Linear.None;r.Easing.Power1=r.Easing.Quadratic.Out;r.Easing.Power2=r.Easing.Cubic.Out;r.Easing.Power3=r.Easing.Quartic.Out;r.Easing.Power4=r.Easing.Quintic.Out;r.Time=function(t){this.game=t;this.time=0;this.prevTime=0;this.now=0;this.elapsed=0;this.elapsedMS=0;this.physicsElapsed=1/60;this.physicsElapsedMS=1/60*1e3;this.desiredFpsMult=1/60;this._desiredFps=60;this.suggestedFps=this.desiredFps;this.slowMotion=1;this.advancedTiming=false;this.frames=0;this.fps=0;this.fpsMin=1e3;this.fpsMax=0;this.msMin=1e3;this.msMax=0;this.pauseDuration=0;this.timeToCall=0;this.timeExpected=0;this.events=new r.Timer(this.game,false);this._frameCount=0;this._elapsedAccumulator=0;this._started=0;this._timeLastSecond=0;this._pauseStarted=0;this._justResumed=false;this._timers=[]};r.Time.prototype={boot:function(){this._started=Date.now();this.time=Date.now();this.events.start();this.timeExpected=this.time},add:function(t){this._timers.push(t);return t},create:function(t){if(t===undefined){t=true}var e=new r.Timer(this.game,t);this._timers.push(e);return e},removeAll:function(){for(var t=0;t<this._timers.length;t++){this._timers[t].destroy()}this._timers=[];this.events.removeAll()},refresh:function(){var t=this.time;this.time=Date.now();this.elapsedMS=this.time-t},update:function(t){var e=this.time;this.time=Date.now();this.elapsedMS=this.time-e;this.prevTime=this.now;this.now=t;this.elapsed=this.now-this.prevTime;if(this.game.raf._isSetTimeOut){this.timeToCall=Math.floor(Math.max(0,1e3/this._desiredFps-(this.timeExpected-t)));this.timeExpected=t+this.timeToCall}if(this.advancedTiming){this.updateAdvancedTiming()}if(!this.game.paused){this.events.update(this.time);if(this._timers.length){this.updateTimers()}}},updateTimers:function(){var t=0;var e=this._timers.length;while(t<e){if(this._timers[t].update(this.time)){t++}else{this._timers.splice(t,1);e--}}},updateAdvancedTiming:function(){this._frameCount++;this._elapsedAccumulator+=this.elapsed;if(this._frameCount>=this._desiredFps*2){this.suggestedFps=Math.floor(200/(this._elapsedAccumulator/this._frameCount))*5;this._frameCount=0;this._elapsedAccumulator=0}this.msMin=Math.min(this.msMin,this.elapsed);this.msMax=Math.max(this.msMax,this.elapsed);this.frames++;if(this.now>this._timeLastSecond+1e3){this.fps=Math.round(this.frames*1e3/(this.now-this._timeLastSecond));this.fpsMin=Math.min(this.fpsMin,this.fps);this.fpsMax=Math.max(this.fpsMax,this.fps);this._timeLastSecond=this.now;this.frames=0}},gamePaused:function(){this._pauseStarted=Date.now();this.events.pause();var t=this._timers.length;while(t--){this._timers[t]._pause()}},gameResumed:function(){this.time=Date.now();this.pauseDuration=this.time-this._pauseStarted;this.events.resume();var t=this._timers.length;while(t--){this._timers[t]._resume()}},totalElapsedSeconds:function(){return(this.time-this._started)*.001},elapsedSince:function(t){return this.time-t},elapsedSecondsSince:function(t){return(this.time-t)*.001},reset:function(){this._started=this.time;this.removeAll()}};Object.defineProperty(r.Time.prototype,"desiredFps",{get:function(){return this._desiredFps},set:function(t){this._desiredFps=t;this.physicsElapsed=1/t;this.physicsElapsedMS=this.physicsElapsed*1e3;this.desiredFpsMult=1/t}});r.Time.prototype.constructor=r.Time;r.Timer=function(t,e){if(e===undefined){e=true}this.game=t;this.running=false;this.autoDestroy=e;this.expired=false;this.elapsed=0;this.events=[];this.onComplete=new r.Signal;this.nextTick=0;this.timeCap=1e3;this.paused=false;this._codePaused=false;this._started=0;this._pauseStarted=0;this._pauseTotal=0;this._now=Date.now();this._len=0;this._marked=0;this._i=0;this._diff=0;this._newTick=0};r.Timer.MINUTE=6e4;r.Timer.SECOND=1e3;r.Timer.HALF=500;r.Timer.QUARTER=250;r.Timer.prototype={create:function(t,e,i,s,n,a){t=Math.round(t);var o=t;if(this._now===0){o+=this.game.time.time}else{o+=this._now}var h=new r.TimerEvent(this,t,o,i,e,s,n,a);this.events.push(h);this.order();this.expired=false;return h},add:function(t,e,i){return this.create(t,false,0,e,i,Array.prototype.slice.call(arguments,3))},repeat:function(t,e,i,s){return this.create(t,false,e,i,s,Array.prototype.slice.call(arguments,4))},loop:function(t,e,i){return this.create(t,true,0,e,i,Array.prototype.slice.call(arguments,3))},start:function(t){if(this.running){return}this._started=this.game.time.time+(t||0);this.running=true;for(var e=0;e<this.events.length;e++){this.events[e].tick=this.events[e].delay+this._started}},stop:function(t){this.running=false;if(t===undefined){t=true}if(t){this.events.length=0}},remove:function(t){for(var e=0;e<this.events.length;e++){if(this.events[e]===t){this.events[e].pendingDelete=true;return true}}return false},order:function(){if(this.events.length>0){this.events.sort(this.sortHandler);this.nextTick=this.events[0].tick}},sortHandler:function(t,e){if(t.tick<e.tick){return-1}else if(t.tick>e.tick){return 1}return 0},clearPendingEvents:function(){this._i=this.events.length;while(this._i--){if(this.events[this._i].pendingDelete){this.events.splice(this._i,1)}}this._len=this.events.length;this._i=0},update:function(t){if(this.paused){return true}this.elapsed=t-this._now;this._now=t;if(this.elapsed>this.timeCap){this.adjustEvents(t-this.elapsed)}this._marked=0;this.clearPendingEvents();if(this.running&&this._now>=this.nextTick&&this._len>0){while(this._i<this._len&&this.running){if(this._now>=this.events[this._i].tick&&!this.events[this._i].pendingDelete){this._newTick=this._now+this.events[this._i].delay-(this._now-this.events[this._i].tick);if(this._newTick<0){this._newTick=this._now+this.events[this._i].delay}if(this.events[this._i].loop===true){this.events[this._i].tick=this._newTick;this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)}else if(this.events[this._i].repeatCount>0){this.events[this._i].repeatCount--;this.events[this._i].tick=this._newTick;this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)}else{this._marked++;this.events[this._i].pendingDelete=true;this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)}this._i++}else{break}}if(this.events.length>this._marked){this.order()}else{this.expired=true;this.onComplete.dispatch(this)}}if(this.expired&&this.autoDestroy){return false}else{return true}},pause:function(){if(!this.running){return}this._codePaused=true;if(this.paused){return}this._pauseStarted=this.game.time.time;this.paused=true},_pause:function(){if(this.paused||!this.running){return}this._pauseStarted=this.game.time.time;this.paused=true},adjustEvents:function(t){for(var e=0;e<this.events.length;e++){if(!this.events[e].pendingDelete){var i=this.events[e].tick-t;if(i<0){i=0}this.events[e].tick=this._now+i}}var s=this.nextTick-t;if(s<0){this.nextTick=this._now}else{this.nextTick=this._now+s}},resume:function(){if(!this.paused){return}var t=this.game.time.time;this._pauseTotal+=t-this._now;this._now=t;this.adjustEvents(this._pauseStarted);this.paused=false;this._codePaused=false},_resume:function(){if(this._codePaused){return}else{this.resume()}},removeAll:function(){this.onComplete.removeAll();this.events.length=0;this._len=0;this._i=0},destroy:function(){this.onComplete.removeAll();this.running=false;this.events=[];this._len=0;this._i=0}};Object.defineProperty(r.Timer.prototype,"next",{get:function(){return this.nextTick}});Object.defineProperty(r.Timer.prototype,"duration",{get:function(){if(this.running&&this.nextTick>this._now){return this.nextTick-this._now}else{return 0}}});Object.defineProperty(r.Timer.prototype,"length",{get:function(){return this.events.length}});Object.defineProperty(r.Timer.prototype,"ms",{get:function(){if(this.running){return this._now-this._started-this._pauseTotal}else{return 0}}});Object.defineProperty(r.Timer.prototype,"seconds",{get:function(){if(this.running){return this.ms*.001}else{return 0}}});r.Timer.prototype.constructor=r.Timer;r.TimerEvent=function(t,e,i,s,r,n,a,o){this.timer=t;this.delay=e;this.tick=i;this.repeatCount=s-1;this.loop=r;this.callback=n;this.callbackContext=a;this.args=o;this.pendingDelete=false};r.TimerEvent.prototype.constructor=r.TimerEvent;r.AnimationManager=function(t){this.sprite=t;this.game=t.game;this.currentFrame=null;this.currentAnim=null;this.updateIfVisible=true;this.isLoaded=false;this._frameData=null;this._anims={};this._outputFrames=[]};r.AnimationManager.prototype={loadFrameData:function(t,e){if(t===undefined){return false}if(this.isLoaded){for(var i in this._anims){this._anims[i].updateFrameData(t)}}this._frameData=t;if(e===undefined||e===null){this.frame=0}else{if(typeof e==="string"){this.frameName=e}else{this.frame=e}}this.isLoaded=true;return true},copyFrameData:function(t,e){this._frameData=t.clone();if(this.isLoaded){for(var i in this._anims){this._anims[i].updateFrameData(this._frameData)}}if(e===undefined||e===null){this.frame=0}else{if(typeof e==="string"){this.frameName=e}else{this.frame=e}}this.isLoaded=true;return true},add:function(t,e,i,s,n){e=e||[];i=i||60;if(s===undefined){s=false}if(n===undefined){if(e&&typeof e[0]==="number"){n=true}else{n=false}}this._outputFrames=[];this._frameData.getFrameIndexes(e,n,this._outputFrames);this._anims[t]=new r.Animation(this.game,this.sprite,t,this._frameData,this._outputFrames,i,s);this.currentAnim=this._anims[t];if(this.sprite.tilingTexture){this.sprite.refreshTexture=true}return this._anims[t]},validateFrames:function(t,e){if(e===undefined){e=true}for(var i=0;i<t.length;i++){if(e===true){if(t[i]>this._frameData.total){return false}}else{if(this._frameData.checkFrameName(t[i])===false){return false}}}return true},play:function(t,e,i,s){if(this._anims[t]){if(this.currentAnim===this._anims[t]){if(this.currentAnim.isPlaying===false){this.currentAnim.paused=false;return this.currentAnim.play(e,i,s)}return this.currentAnim}else{if(this.currentAnim&&this.currentAnim.isPlaying){this.currentAnim.stop()}this.currentAnim=this._anims[t];this.currentAnim.paused=false;this.currentFrame=this.currentAnim.currentFrame;return this.currentAnim.play(e,i,s)}}},stop:function(t,e){if(e===undefined){e=false}if(this.currentAnim&&(typeof t!=="string"||t===this.currentAnim.name)){this.currentAnim.stop(e)}},update:function(){if(this.updateIfVisible&&!this.sprite.visible){return false}if(this.currentAnim&&this.currentAnim.update()){this.currentFrame=this.currentAnim.currentFrame;return true}return false},next:function(t){if(this.currentAnim){this.currentAnim.next(t);this.currentFrame=this.currentAnim.currentFrame}},previous:function(t){if(this.currentAnim){this.currentAnim.previous(t);this.currentFrame=this.currentAnim.currentFrame}},getAnimation:function(t){if(typeof t==="string"){if(this._anims[t]){return this._anims[t]}}return null},refreshFrame:function(){},destroy:function(){var t=null;for(var t in this._anims){if(this._anims.hasOwnProperty(t)){this._anims[t].destroy()}}this._anims={};this._outputFrames=[];this._frameData=null;this.currentAnim=null;this.currentFrame=null;this.sprite=null;this.game=null}};r.AnimationManager.prototype.constructor=r.AnimationManager;Object.defineProperty(r.AnimationManager.prototype,"frameData",{get:function(){return this._frameData}});Object.defineProperty(r.AnimationManager.prototype,"frameTotal",{get:function(){return this._frameData.total}});Object.defineProperty(r.AnimationManager.prototype,"paused",{get:function(){return this.currentAnim.isPaused},set:function(t){this.currentAnim.paused=t}});Object.defineProperty(r.AnimationManager.prototype,"name",{get:function(){if(this.currentAnim){return this.currentAnim.name}}});Object.defineProperty(r.AnimationManager.prototype,"frame",{get:function(){if(this.currentFrame){return this.currentFrame.index}},set:function(t){if(typeof t==="number"&&this._frameData&&this._frameData.getFrame(t)!==null){this.currentFrame=this._frameData.getFrame(t);if(this.currentFrame){this.sprite.setFrame(this.currentFrame)}}}});Object.defineProperty(r.AnimationManager.prototype,"frameName",{get:function(){if(this.currentFrame){return this.currentFrame.name}},set:function(t){if(typeof t==="string"&&this._frameData&&this._frameData.getFrameByName(t)!==null){this.currentFrame=this._frameData.getFrameByName(t);if(this.currentFrame){this._frameIndex=this.currentFrame.index;this.sprite.setFrame(this.currentFrame)}}else{console.warn("Cannot set frameName: "+t)}}});r.Animation=function(t,e,i,s,n,a,o){if(o===undefined){o=false}this.game=t;this._parent=e;this._frameData=s;this.name=i;this._frames=[];this._frames=this._frames.concat(n);this.delay=1e3/a;this.loop=o;this.loopCount=0;this.killOnComplete=false;this.isFinished=false;this.isPlaying=false;this.isPaused=false;this._pauseStartTime=0;this._frameIndex=0;this._frameDiff=0;this._frameSkip=1;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.onStart=new r.Signal;this.onUpdate=null;this.onComplete=new r.Signal;this.onLoop=new r.Signal;this.isReversed=false;this.game.onPause.add(this.onPause,this);this.game.onResume.add(this.onResume,this)};r.Animation.prototype={play:function(t,e,i){if(typeof t==="number"){this.delay=1e3/t}if(typeof e==="boolean"){this.loop=e}if(typeof i!=="undefined"){this.killOnComplete=i}this.isPlaying=true;this.isFinished=false;this.paused=false;this.loopCount=0;this._timeLastFrame=this.game.time.time;this._timeNextFrame=this.game.time.time+this.delay;this._frameIndex=this.isReversed?this._frames.length-1:0;this.updateCurrentFrame(false,true);this._parent.events.onAnimationStart$dispatch(this._parent,this);this.onStart.dispatch(this._parent,this);this._parent.animations.currentAnim=this;this._parent.animations.currentFrame=this.currentFrame;return this},restart:function(){this.isPlaying=true;this.isFinished=false;this.paused=false;this.loopCount=0;this._timeLastFrame=this.game.time.time;this._timeNextFrame=this.game.time.time+this.delay;this._frameIndex=0;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this._parent.setFrame(this.currentFrame);this._parent.animations.currentAnim=this;this._parent.animations.currentFrame=this.currentFrame;this.onStart.dispatch(this._parent,this)},reverse:function(){this.reversed=!this.reversed;return this},reverseOnce:function(){this.onComplete.addOnce(this.reverse,this);return this.reverse()},setFrame:function(t,e){var i;if(e===undefined){e=false}if(typeof t==="string"){for(var s=0;s<this._frames.length;s++){if(this._frameData.getFrame(this._frames[s]).name===t){i=s}}}else if(typeof t==="number"){if(e){i=t}else{for(var s=0;s<this._frames.length;s++){if(this._frames[s]===t){i=s}}}}if(i){this._frameIndex=i-1;this._timeNextFrame=this.game.time.time;this.update()}},stop:function(t,e){if(t===undefined){t=false}if(e===undefined){e=false}this.isPlaying=false;this.isFinished=true;this.paused=false;if(t){this.currentFrame=this._frameData.getFrame(this._frames[0]);this._parent.setFrame(this.currentFrame)}if(e){this._parent.events.onAnimationComplete$dispatch(this._parent,this);this.onComplete.dispatch(this._parent,this)}},onPause:function(){if(this.isPlaying){this._frameDiff=this._timeNextFrame-this.game.time.time}},onResume:function(){if(this.isPlaying){this._timeNextFrame=this.game.time.time+this._frameDiff}},update:function(){if(this.isPaused){return false}if(this.isPlaying&&this.game.time.time>=this._timeNextFrame){this._frameSkip=1;this._frameDiff=this.game.time.time-this._timeNextFrame;this._timeLastFrame=this.game.time.time;if(this._frameDiff>this.delay){this._frameSkip=Math.floor(this._frameDiff/this.delay);this._frameDiff-=this._frameSkip*this.delay}this._timeNextFrame=this.game.time.time+(this.delay-this._frameDiff);if(this.isReversed){this._frameIndex-=this._frameSkip}else{this._frameIndex+=this._frameSkip}if(!this.isReversed&&this._frameIndex>=this._frames.length||this.isReversed&&this._frameIndex<=-1){if(this.loop){this._frameIndex=Math.abs(this._frameIndex)%this._frames.length;if(this.isReversed){this._frameIndex=this._frames.length-1-this._frameIndex}this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);if(this.currentFrame){this._parent.setFrame(this.currentFrame)}this.loopCount++;this._parent.events.onAnimationLoop$dispatch(this._parent,this);this.onLoop.dispatch(this._parent,this);if(this.onUpdate){this.onUpdate.dispatch(this,this.currentFrame);return!!this._frameData}else{return true}}else{this.complete();return false}}else{return this.updateCurrentFrame(true)}}return false},updateCurrentFrame:function(t,e){if(e===undefined){e=false}if(!this._frameData){return false}var i=this.currentFrame.index;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);if(this.currentFrame&&(e||!e&&i!==this.currentFrame.index)){this._parent.setFrame(this.currentFrame)}if(this.onUpdate&&t){this.onUpdate.dispatch(this,this.currentFrame);return!!this._frameData}else{return true}},next:function(t){if(t===undefined){t=1}var e=this._frameIndex+t;if(e>=this._frames.length){if(this.loop){e%=this._frames.length}else{e=this._frames.length-1}}if(e!==this._frameIndex){this._frameIndex=e;this.updateCurrentFrame(true)}},previous:function(t){if(t===undefined){t=1}var e=this._frameIndex-t;if(e<0){if(this.loop){e=this._frames.length+e}else{e++}}if(e!==this._frameIndex){this._frameIndex=e;this.updateCurrentFrame(true)}},updateFrameData:function(t){this._frameData=t;this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex%this._frames.length]):null},destroy:function(){if(!this._frameData){return}this.game.onPause.remove(this.onPause,this);this.game.onResume.remove(this.onResume,this);this.game=null;this._parent=null;this._frames=null;this._frameData=null;this.currentFrame=null;this.isPlaying=false;this.onStart.dispose();this.onLoop.dispose();this.onComplete.dispose();if(this.onUpdate){this.onUpdate.dispose()}},complete:function(){this._frameIndex=this._frames.length-1;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.isPlaying=false;this.isFinished=true;this.paused=false;this._parent.events.onAnimationComplete$dispatch(this._parent,this);this.onComplete.dispatch(this._parent,this);if(this.killOnComplete){this._parent.kill()}}};r.Animation.prototype.constructor=r.Animation;Object.defineProperty(r.Animation.prototype,"paused",{get:function(){return this.isPaused},set:function(t){this.isPaused=t;if(t){this._pauseStartTime=this.game.time.time}else{if(this.isPlaying){this._timeNextFrame=this.game.time.time+this.delay}}}});Object.defineProperty(r.Animation.prototype,"reversed",{get:function(){return this.isReversed},set:function(t){this.isReversed=t}});Object.defineProperty(r.Animation.prototype,"frameTotal",{get:function(){return this._frames.length}});Object.defineProperty(r.Animation.prototype,"frame",{get:function(){if(this.currentFrame!==null){return this.currentFrame.index}else{return this._frameIndex}},set:function(t){this.currentFrame=this._frameData.getFrame(this._frames[t]);if(this.currentFrame!==null){this._frameIndex=t;this._parent.setFrame(this.currentFrame);if(this.onUpdate){this.onUpdate.dispatch(this,this.currentFrame)}}}});Object.defineProperty(r.Animation.prototype,"speed",{get:function(){return 1e3/this.delay},set:function(t){if(t>0){this.delay=1e3/t}}});Object.defineProperty(r.Animation.prototype,"enableUpdate",{get:function(){return this.onUpdate!==null},set:function(t){if(t&&this.onUpdate===null){this.onUpdate=new r.Signal}else if(!t&&this.onUpdate!==null){this.onUpdate.dispose();this.onUpdate=null}}});r.Animation.generateFrameNames=function(t,e,i,s,n){if(s===undefined){s=""}var a=[];var o="";if(e<i){for(var h=e;h<=i;h++){if(typeof n==="number"){o=r.Utils.pad(h.toString(),n,"0",1)}else{o=h.toString()}o=t+o+s;a.push(o)}}else{for(var h=e;h>=i;h--){if(typeof n==="number"){o=r.Utils.pad(h.toString(),n,"0",1)}else{o=h.toString()}o=t+o+s;a.push(o)}}return a};r.Frame=function(t,e,i,s,n,a){this.index=t;this.x=e;this.y=i;this.width=s;this.height=n;this.name=a;this.centerX=Math.floor(s/2);this.centerY=Math.floor(n/2);this.distance=r.Math.distance(0,0,s,n);this.rotated=false;this.rotationDirection="cw";this.trimmed=false;this.sourceSizeW=s;this.sourceSizeH=n;this.spriteSourceSizeX=0;this.spriteSourceSizeY=0;this.spriteSourceSizeW=0;this.spriteSourceSizeH=0;this.right=this.x+this.width;this.bottom=this.y+this.height};r.Frame.prototype={resize:function(t,e){this.width=t;this.height=e;this.centerX=Math.floor(t/2);this.centerY=Math.floor(e/2);this.distance=r.Math.distance(0,0,t,e);this.sourceSizeW=t;this.sourceSizeH=e;this.right=this.x+t;this.bottom=this.y+e},setTrim:function(t,e,i,s,r,n,a){this.trimmed=t;if(t){this.sourceSizeW=e;this.sourceSizeH=i;this.centerX=Math.floor(e/2);this.centerY=Math.floor(i/2);this.spriteSourceSizeX=s;this.spriteSourceSizeY=r;this.spriteSourceSizeW=n;this.spriteSourceSizeH=a}},clone:function(){var t=new r.Frame(this.index,this.x,this.y,this.width,this.height,this.name);for(var e in this){if(this.hasOwnProperty(e)){t[e]=this[e]}}return t},getRect:function(t){if(t===undefined){t=new r.Rectangle(this.x,this.y,this.width,this.height)}else{t.setTo(this.x,this.y,this.width,this.height)}return t}};r.Frame.prototype.constructor=r.Frame;r.FrameData=function(){this._frames=[];this._frameNames=[]};r.FrameData.prototype={addFrame:function(t){t.index=this._frames.length;this._frames.push(t);if(t.name!==""){this._frameNames[t.name]=t.index}return t},getFrame:function(t){if(t>=this._frames.length){t=0}return this._frames[t]},getFrameByName:function(t){if(typeof this._frameNames[t]==="number"){return this._frames[this._frameNames[t]]}return null},checkFrameName:function(t){if(this._frameNames[t]==null){return false}return true},clone:function(){var t=new r.FrameData;for(var e=0;e<this._frames.length;e++){t._frames.push(this._frames[e].clone())}for(var i in this._frameNames){if(this._frameNames.hasOwnProperty(i)){t._frameNames.push(this._frameNames[i])}}return t},getFrameRange:function(t,e,i){if(i===undefined){i=[]}for(var s=t;s<=e;s++){i.push(this._frames[s])}return i},getFrames:function(t,e,i){if(e===undefined){e=true}if(i===undefined){i=[]}if(t===undefined||t.length===0){for(var s=0;s<this._frames.length;s++){i.push(this._frames[s])}}else{for(var s=0;s<t.length;s++){if(e){i.push(this.getFrame(t[s]))}else{i.push(this.getFrameByName(t[s]))}}}return i},getFrameIndexes:function(t,e,i){if(e===undefined){e=true}if(i===undefined){i=[]}if(t===undefined||t.length===0){for(var s=0;s<this._frames.length;s++){i.push(this._frames[s].index)}}else{for(var s=0;s<t.length;s++){if(e&&this._frames[t[s]]){i.push(this._frames[t[s]].index)}else{if(this.getFrameByName(t[s])){i.push(this.getFrameByName(t[s]).index)}}}}return i},destroy:function(){this._frames=null;this._frameNames=null}};r.FrameData.prototype.constructor=r.FrameData;Object.defineProperty(r.FrameData.prototype,"total",{get:function(){return this._frames.length}});r.AnimationParser={spriteSheet:function(t,e,i,s,n,a,o){var h=e;if(typeof e==="string"){h=t.cache.getImage(e)}if(h===null){return null}var l=h.width;var u=h.height;if(i<=0){i=Math.floor(-l/Math.min(-1,i))}if(s<=0){s=Math.floor(-u/Math.min(-1,s))}var c=Math.floor((l-a)/(i+o));var d=Math.floor((u-a)/(s+o));var f=c*d;if(n!==-1){f=n}if(l===0||u===0||l<i||u<s||f===0){console.warn("Phaser.AnimationParser.spriteSheet: '"+e+"'s width/height zero or width/height < given frameWidth/frameHeight");return null}var p=new r.FrameData;var g=a;var m=a;for(var y=0;y<f;y++){p.addFrame(new r.Frame(y,g,m,i,s,""));g+=i+o;if(g+i>l){g=a;m+=s+o}}return p},JSONData:function(t,e){if(!e["frames"]){console.warn("Phaser.AnimationParser.JSONData: Invalid Texture Atlas JSON given, missing 'frames' array");console.log(e);return}var i=new r.FrameData;var s=e["frames"];var n;for(var a=0;a<s.length;a++){n=i.addFrame(new r.Frame(a,s[a].frame.x,s[a].frame.y,s[a].frame.w,s[a].frame.h,s[a].filename));if(s[a].trimmed){n.setTrim(s[a].trimmed,s[a].sourceSize.w,s[a].sourceSize.h,s[a].spriteSourceSize.x,s[a].spriteSourceSize.y,s[a].spriteSourceSize.w,s[a].spriteSourceSize.h)}}return i},JSONDataPyxel:function(t,e){var i=["layers","tilewidth","tileheight","tileswide","tileshigh"];i.forEach(function(t){if(!e[t]){console.warn('Phaser.AnimationParser.JSONDataPyxel: Invalid Pyxel Tilemap JSON given, missing "'+t+'" key.');console.log(e);return}});if(e["layers"].length!==1){console.warn("Phaser.AnimationParser.JSONDataPyxel: Too many layers, this parser only supports flat Tilemaps.");console.log(e);return}var s=new r.FrameData;var n=e["tileheight"];var a=e["tilewidth"];var o=e["layers"][0]["tiles"];var h;for(var l=0;l<o.length;l++){h=s.addFrame(new r.Frame(l,o[l].x,o[l].y,a,n,"frame_"+l));h.setTrim(false)}return s},JSONDataHash:function(t,e){if(!e["frames"]){console.warn("Phaser.AnimationParser.JSONDataHash: Invalid Texture Atlas JSON given, missing 'frames' object");console.log(e);return}var i=new r.FrameData;var s=e["frames"];var n;var a=0;for(var o in s){n=i.addFrame(new r.Frame(a,s[o].frame.x,s[o].frame.y,s[o].frame.w,s[o].frame.h,o));if(s[o].trimmed){n.setTrim(s[o].trimmed,s[o].sourceSize.w,s[o].sourceSize.h,s[o].spriteSourceSize.x,s[o].spriteSourceSize.y,s[o].spriteSourceSize.w,s[o].spriteSourceSize.h)}a++}return i},XMLData:function(t,e){if(!e.getElementsByTagName("TextureAtlas")){console.warn("Phaser.AnimationParser.XMLData: Invalid Texture Atlas XML given, missing <TextureAtlas> tag");return}var i=new r.FrameData;var s=e.getElementsByTagName("SubTexture");var n;var a;var o;var h;var l;var u;var c;var d;var f;var p;var g;for(var m=0;m<s.length;m++){o=s[m].attributes;a=o.name.value;h=parseInt(o.x.value,10);l=parseInt(o.y.value,10);u=parseInt(o.width.value,10);c=parseInt(o.height.value,10);d=null;f=null;if(o.frameX){d=Math.abs(parseInt(o.frameX.value,10));f=Math.abs(parseInt(o.frameY.value,10));p=parseInt(o.frameWidth.value,10);g=parseInt(o.frameHeight.value,10)}n=i.addFrame(new r.Frame(m,h,l,u,c,a));if(d!==null||f!==null){n.setTrim(true,u,c,d,f,p,g)}}return i}};r.Cache=function(t){this.game=t;this.autoResolveURL=false;this._cache={canvas:{},image:{},texture:{},sound:{},video:{},text:{},json:{},xml:{},physics:{},tilemap:{},binary:{},bitmapData:{},bitmapFont:{},shader:{},renderTexture:{}};this._urlMap={};this._urlResolver=new Image;this._urlTemp=null;this.onSoundUnlock=new r.Signal;this._cacheMap=[];this._cacheMap[r.Cache.CANVAS]=this._cache.canvas;this._cacheMap[r.Cache.IMAGE]=this._cache.image;this._cacheMap[r.Cache.TEXTURE]=this._cache.texture;this._cacheMap[r.Cache.SOUND]=this._cache.sound;this._cacheMap[r.Cache.TEXT]=this._cache.text;this._cacheMap[r.Cache.PHYSICS]=this._cache.physics;this._cacheMap[r.Cache.TILEMAP]=this._cache.tilemap;this._cacheMap[r.Cache.BINARY]=this._cache.binary;this._cacheMap[r.Cache.BITMAPDATA]=this._cache.bitmapData;this._cacheMap[r.Cache.BITMAPFONT]=this._cache.bitmapFont;this._cacheMap[r.Cache.JSON]=this._cache.json;this._cacheMap[r.Cache.XML]=this._cache.xml;this._cacheMap[r.Cache.VIDEO]=this._cache.video;this._cacheMap[r.Cache.SHADER]=this._cache.shader;this._cacheMap[r.Cache.RENDER_TEXTURE]=this._cache.renderTexture;this.addDefaultImage();this.addMissingImage()};r.Cache.CANVAS=1;r.Cache.IMAGE=2;r.Cache.TEXTURE=3;r.Cache.SOUND=4;r.Cache.TEXT=5;r.Cache.PHYSICS=6;r.Cache.TILEMAP=7;r.Cache.BINARY=8;r.Cache.BITMAPDATA=9;r.Cache.BITMAPFONT=10;r.Cache.JSON=11;r.Cache.XML=12;r.Cache.VIDEO=13;r.Cache.SHADER=14;r.Cache.RENDER_TEXTURE=15;r.Cache.DEFAULT=null;r.Cache.MISSING=null;r.Cache.prototype={addCanvas:function(t,e,i){if(i===undefined){i=e.getContext("2d")}this._cache.canvas[t]={canvas:e,context:i}},addImage:function(t,e,i){if(this.checkImageKey(t)){this.removeImage(t)}var s={key:t,url:e,data:i,base:new PIXI.BaseTexture(i),frame:new r.Frame(0,0,0,i.width,i.height,t),frameData:new r.FrameData};s.frameData.addFrame(new r.Frame(0,0,0,i.width,i.height,e));this._cache.image[t]=s;this._resolveURL(e,s);if(t==="__default"){r.Cache.DEFAULT=new PIXI.Texture(s.base)}else if(t==="__missing"){r.Cache.MISSING=new PIXI.Texture(s.base)}return s},addDefaultImage:function(){var t=new Image;t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAABVJREFUeF7NwIEAAAAAgKD9qdeocAMAoAABm3DkcAAAAABJRU5ErkJggg==";var e=this.addImage("__default",null,t);e.base.skipRender=true;r.Cache.DEFAULT=new PIXI.Texture(e.base)},addMissingImage:function(){var t=new Image;t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJ9JREFUeNq01ssOwyAMRFG46v//Mt1ESmgh+DFmE2GPOBARKb2NVjo+17PXLD8a1+pl5+A+wSgFygymWYHBb0FtsKhJDdZlncG2IzJ4ayoMDv20wTmSMzClEgbWYNTAkQ0Z+OJ+A/eWnAaR9+oxCF4Os0H8htsMUp+pwcgBBiMNnAwF8GqIgL2hAzaGFFgZauDPKABmowZ4GL369/0rwACp2yA/ttmvsQAAAABJRU5ErkJggg==";var e=this.addImage("__missing",null,t);r.Cache.MISSING=new PIXI.Texture(e.base)},addSound:function(t,e,i,s,r){if(s===undefined){s=true;r=false}if(r===undefined){s=false;r=true}var n=false;if(r){n=true}this._cache.sound[t]={url:e,data:i,isDecoding:false,decoded:n,webAudio:s,audioTag:r,locked:this.game.sound.touchLocked};this._resolveURL(e,this._cache.sound[t])},addText:function(t,e,i){this._cache.text[t]={url:e,data:i};this._resolveURL(e,this._cache.text[t])},addPhysicsData:function(t,e,i,s){this._cache.physics[t]={url:e,data:i,format:s};this._resolveURL(e,this._cache.physics[t])},addTilemap:function(t,e,i,s){this._cache.tilemap[t]={url:e,data:i,format:s};this._resolveURL(e,this._cache.tilemap[t])},addBinary:function(t,e){this._cache.binary[t]=e},addBitmapData:function(t,e,i){e.key=t;if(i===undefined){i=new r.FrameData;i.addFrame(e.textureFrame)}this._cache.bitmapData[t]={data:e,frameData:i};return e},addBitmapFont:function(t,e,i,s,n,a,o){var h={url:e,data:i,font:null,base:new PIXI.BaseTexture(i)};if(a===undefined){a=0}if(o===undefined){o=0}if(n==="json"){h.font=r.LoaderParser.jsonBitmapFont(s,h.base,a,o)}else{h.font=r.LoaderParser.xmlBitmapFont(s,h.base,a,o)}this._cache.bitmapFont[t]=h;this._resolveURL(e,h)},addJSON:function(t,e,i){this._cache.json[t]={url:e,data:i};this._resolveURL(e,this._cache.json[t])},addXML:function(t,e,i){this._cache.xml[t]={url:e,data:i};this._resolveURL(e,this._cache.xml[t])},addVideo:function(t,e,i,s){this._cache.video[t]={url:e,data:i,isBlob:s,locked:true};this._resolveURL(e,this._cache.video[t])},addShader:function(t,e,i){this._cache.shader[t]={url:e,data:i};this._resolveURL(e,this._cache.shader[t])},addRenderTexture:function(t,e){this._cache.renderTexture[t]={texture:e,frame:new r.Frame(0,0,0,e.width,e.height,"","")}},addSpriteSheet:function(t,e,i,s,n,a,o,h){if(a===undefined){a=-1}if(o===undefined){o=0}if(h===undefined){h=0}var l={key:t,url:e,data:i,frameWidth:s,frameHeight:n,margin:o,spacing:h,base:new PIXI.BaseTexture(i),frameData:r.AnimationParser.spriteSheet(this.game,i,s,n,a,o,h)};this._cache.image[t]=l;this._resolveURL(e,l)},addTextureAtlas:function(t,e,i,s,n){var a={key:t,url:e,data:i,base:new PIXI.BaseTexture(i)};if(n===r.Loader.TEXTURE_ATLAS_XML_STARLING){a.frameData=r.AnimationParser.XMLData(this.game,s,t)}else if(n===r.Loader.TEXTURE_ATLAS_JSON_PYXEL){a.frameData=r.AnimationParser.JSONDataPyxel(this.game,s,t)}else{if(Array.isArray(s.frames)){a.frameData=r.AnimationParser.JSONData(this.game,s,t)}else{a.frameData=r.AnimationParser.JSONDataHash(this.game,s,t)}}this._cache.image[t]=a;this._resolveURL(e,a)},reloadSound:function(t){var e=this;var i=this.getSound(t);if(i){i.data.src=i.url;i.data.addEventListener("canplaythrough",function(){return e.reloadSoundComplete(t)},false);i.data.load()}},reloadSoundComplete:function(t){var e=this.getSound(t);if(e){e.locked=false;this.onSoundUnlock.dispatch(t)}},updateSound:function(t,e,i){var s=this.getSound(t);if(s){s[e]=i}},decodedSound:function(t,e){var i=this.getSound(t);i.data=e;i.decoded=true;i.isDecoding=false},isSoundDecoded:function(t){var e=this.getItem(t,r.Cache.SOUND,"isSoundDecoded");if(e){return e.decoded}},isSoundReady:function(t){var e=this.getItem(t,r.Cache.SOUND,"isSoundDecoded");if(e){return e.decoded&&!this.game.sound.touchLocked}},checkKey:function(t,e){if(this._cacheMap[t][e]){return true}return false},checkURL:function(t){if(this._urlMap[this._resolveURL(t)]){return true}return false},checkCanvasKey:function(t){return this.checkKey(r.Cache.CANVAS,t)},checkImageKey:function(t){return this.checkKey(r.Cache.IMAGE,t)},checkTextureKey:function(t){return this.checkKey(r.Cache.TEXTURE,t)},checkSoundKey:function(t){return this.checkKey(r.Cache.SOUND,t)},checkTextKey:function(t){return this.checkKey(r.Cache.TEXT,t)},checkPhysicsKey:function(t){return this.checkKey(r.Cache.PHYSICS,t)},checkTilemapKey:function(t){return this.checkKey(r.Cache.TILEMAP,t)},checkBinaryKey:function(t){return this.checkKey(r.Cache.BINARY,t)},checkBitmapDataKey:function(t){return this.checkKey(r.Cache.BITMAPDATA,t)},checkBitmapFontKey:function(t){return this.checkKey(r.Cache.BITMAPFONT,t)},checkJSONKey:function(t){return this.checkKey(r.Cache.JSON,t)},checkXMLKey:function(t){return this.checkKey(r.Cache.XML,t)},checkVideoKey:function(t){return this.checkKey(r.Cache.VIDEO,t)},checkShaderKey:function(t){return this.checkKey(r.Cache.SHADER,t)},checkRenderTextureKey:function(t){return this.checkKey(r.Cache.RENDER_TEXTURE,t)},getItem:function(t,e,i,s){if(!this.checkKey(e,t)){if(i){console.warn("Phaser.Cache."+i+': Key "'+t+'" not found in Cache.')}}else{if(s===undefined){return this._cacheMap[e][t]}else{return this._cacheMap[e][t][s]}}return null},getCanvas:function(t){return this.getItem(t,r.Cache.CANVAS,"getCanvas","canvas")},getImage:function(t,e){if(t===undefined||t===null){t="__default"}if(e===undefined){e=false}var i=this.getItem(t,r.Cache.IMAGE,"getImage");if(i===null){i=this.getItem("__missing",r.Cache.IMAGE,"getImage")}if(e){return i}else{return i.data}},getTextureFrame:function(t){return this.getItem(t,r.Cache.TEXTURE,"getTextureFrame","frame")},getSound:function(t){return this.getItem(t,r.Cache.SOUND,"getSound")},getSoundData:function(t){return this.getItem(t,r.Cache.SOUND,"getSoundData","data")},getText:function(t){return this.getItem(t,r.Cache.TEXT,"getText","data")},getPhysicsData:function(t,e,i){var s=this.getItem(t,r.Cache.PHYSICS,"getPhysicsData","data");if(s===null||e===undefined||e===null){return s}else{if(s[e]){var n=s[e];if(n&&i){for(var a in n){a=n[a];if(a.fixtureKey===i){return a}}console.warn('Phaser.Cache.getPhysicsData: Could not find given fixtureKey: "'+i+" in "+t+'"')}else{return n}}else{console.warn('Phaser.Cache.getPhysicsData: Invalid key/object: "'+t+" / "+e+'"')}}return null},getTilemapData:function(t){return this.getItem(t,r.Cache.TILEMAP,"getTilemapData")},getBinary:function(t){return this.getItem(t,r.Cache.BINARY,"getBinary")},getBitmapData:function(t){return this.getItem(t,r.Cache.BITMAPDATA,"getBitmapData","data")},getBitmapFont:function(t){return this.getItem(t,r.Cache.BITMAPFONT,"getBitmapFont")},getJSON:function(t,e){var i=this.getItem(t,r.Cache.JSON,"getJSON","data");if(i){if(e){return r.Utils.extend(true,Array.isArray(i)?[]:{},i)}else{return i}}else{return null}},getXML:function(t){return this.getItem(t,r.Cache.XML,"getXML","data")},getVideo:function(t){return this.getItem(t,r.Cache.VIDEO,"getVideo")},getShader:function(t){return this.getItem(t,r.Cache.SHADER,"getShader","data")},getRenderTexture:function(t){return this.getItem(t,r.Cache.RENDER_TEXTURE,"getRenderTexture")},getBaseTexture:function(t,e){if(e===undefined){e=r.Cache.IMAGE}return this.getItem(t,e,"getBaseTexture","base")},getFrame:function(t,e){if(e===undefined){e=r.Cache.IMAGE}return this.getItem(t,e,"getFrame","frame")},getFrameCount:function(t,e){var i=this.getFrameData(t,e);if(i){return i.total}else{return 0}},getFrameData:function(t,e){if(e===undefined){e=r.Cache.IMAGE}return this.getItem(t,e,"getFrameData","frameData")},hasFrameData:function(t,e){if(e===undefined){e=r.Cache.IMAGE}return this.getItem(t,e,"","frameData")!==null},updateFrameData:function(t,e,i){if(i===undefined){i=r.Cache.IMAGE}if(this._cacheMap[i][t]){this._cacheMap[i][t].frameData=e}},getFrameByIndex:function(t,e,i){var s=this.getFrameData(t,i);if(s){return s.getFrame(e)}else{return null}},getFrameByName:function(t,e,i){var s=this.getFrameData(t,i);if(s){return s.getFrameByName(e)}else{return null}},getURL:function(t){var t=this._resolveURL(t);if(t){return this._urlMap[t]}else{console.warn('Phaser.Cache.getUrl: Invalid url: "'+t+'" or Cache.autoResolveURL was false');return null}},getKeys:function(t){if(t===undefined){t=r.Cache.IMAGE}var e=[];if(this._cacheMap[t]){for(var i in this._cacheMap[t]){if(i!=="__default"&&i!=="__missing"){e.push(i)}}}return e},removeCanvas:function(t){delete this._cache.canvas[t]},removeImage:function(t,e){if(e===undefined){e=true}var i=this.getImage(t,true);if(e&&i.base){i.base.destroy()}delete this._cache.image[t]},removeSound:function(t){delete this._cache.sound[t]},removeText:function(t){delete this._cache.text[t]},removePhysics:function(t){delete this._cache.physics[t]},removeTilemap:function(t){delete this._cache.tilemap[t]},removeBinary:function(t){delete this._cache.binary[t]},removeBitmapData:function(t){delete this._cache.bitmapData[t]},removeBitmapFont:function(t){delete this._cache.bitmapFont[t]},removeJSON:function(t){delete this._cache.json[t]},removeXML:function(t){delete this._cache.xml[t]},removeVideo:function(t){delete this._cache.video[t]},removeShader:function(t){delete this._cache.shader[t]},removeRenderTexture:function(t){delete this._cache.renderTexture[t]},removeSpriteSheet:function(t){delete this._cache.spriteSheet[t]},removeTextureAtlas:function(t){delete this._cache.atlas[t]},clearGLTextures:function(){for(var t in this._cache.image){this._cache.image[t].base._glTextures=[]}},_resolveURL:function(t,e){if(!this.autoResolveURL){return null}this._urlResolver.src=this.game.load.baseURL+t;this._urlTemp=this._urlResolver.src;this._urlResolver.src="";if(e){this._urlMap[this._urlTemp]=e}return this._urlTemp},destroy:function(){for(var t=0;t<this._cacheMap.length;t++){var e=this._cacheMap[t];for(var i in e){if(i!=="__default"&&i!=="__missing"){if(e[i]["destroy"]){e[i].destroy()}delete e[i]}}}this._urlMap=null;this._urlResolver=null;this._urlTemp=null}};r.Cache.prototype.constructor=r.Cache;r.Loader=function(t){this.game=t;this.cache=t.cache;this.resetLocked=false;this.isLoading=false;this.hasLoaded=false;this.preloadSprite=null;this.crossOrigin=false;this.baseURL="";this.path="";this.headers={requestedWith:false,json:"application/json",xml:"application/xml"};this.onLoadStart=new r.Signal;this.onLoadComplete=new r.Signal;this.onPackComplete=new r.Signal;this.onFileStart=new r.Signal;this.onFileComplete=new r.Signal;this.onFileError=new r.Signal;this.useXDomainRequest=false;this._warnedAboutXDomainRequest=false;this.enableParallel=true;this.maxParallelDownloads=4;this._withSyncPointDepth=0;this._fileList=[];this._flightQueue=[];this._processingHead=0;this._fileLoadStarted=false;this._totalPackCount=0;this._totalFileCount=0;this._loadedPackCount=0;this._loadedFileCount=0};r.Loader.TEXTURE_ATLAS_JSON_ARRAY=0;r.Loader.TEXTURE_ATLAS_JSON_HASH=1;r.Loader.TEXTURE_ATLAS_XML_STARLING=2;r.Loader.PHYSICS_LIME_CORONA_JSON=3;r.Loader.PHYSICS_PHASER_JSON=4;r.Loader.TEXTURE_ATLAS_JSON_PYXEL=5;r.Loader.prototype={setPreloadSprite:function(t,e){e=e||0;this.preloadSprite={sprite:t,direction:e,width:t.width,height:t.height,rect:null};if(e===0){this.preloadSprite.rect=new r.Rectangle(0,0,1,t.height)}else{this.preloadSprite.rect=new r.Rectangle(0,0,t.width,1)}t.crop(this.preloadSprite.rect);t.visible=true},resize:function(){if(this.preloadSprite&&this.preloadSprite.height!==this.preloadSprite.sprite.height){this.preloadSprite.rect.height=this.preloadSprite.sprite.height}},checkKeyExists:function(t,e){return this.getAssetIndex(t,e)>-1},getAssetIndex:function(t,e){var i=-1;for(var s=0;s<this._fileList.length;s++){var r=this._fileList[s];if(r.type===t&&r.key===e){i=s;if(!r.loaded&&!r.loading){break}}}return i},getAsset:function(t,e){var i=this.getAssetIndex(t,e);if(i>-1){return{index:i,file:this._fileList[i]}}return false},reset:function(t,e){if(e===undefined){e=false}if(this.resetLocked){return}if(t){this.preloadSprite=null}this.isLoading=false;this._processingHead=0;this._fileList.length=0;this._flightQueue.length=0;this._fileLoadStarted=false;this._totalFileCount=0;this._totalPackCount=0;this._loadedPackCount=0;this._loadedFileCount=0;if(e){this.onLoadStart.removeAll();this.onLoadComplete.removeAll();this.onPackComplete.removeAll();this.onFileStart.removeAll();this.onFileComplete.removeAll();this.onFileError.removeAll()}},addToFileList:function(t,e,i,s,r,n){if(r===undefined){r=false}if(e===undefined||e===""){console.warn("Phaser.Loader: Invalid or no key given of type "+t);return this}if(i===undefined||i===null){if(n){i=e+n}else{console.warn("Phaser.Loader: No URL given for file type: "+t+" key: "+e);return this}}var a={type:t,key:e,path:this.path,url:i,syncPoint:this._withSyncPointDepth>0,data:null,loading:false,loaded:false,error:false};if(s){for(var o in s){a[o]=s[o]}}var h=this.getAssetIndex(t,e);if(r&&h>-1){var l=this._fileList[h];if(!l.loading&&!l.loaded){this._fileList[h]=a}else{this._fileList.push(a);this._totalFileCount++}}else if(h===-1){this._fileList.push(a);this._totalFileCount++}return this},replaceInFileList:function(t,e,i,s){return this.addToFileList(t,e,i,s,true)},pack:function(t,e,i,s){if(e===undefined){e=null}if(i===undefined){i=null}if(s===undefined){s=null}if(!e&&!i){console.warn("Phaser.Loader.pack - Both url and data are null. One must be set.");return this}var r={type:"packfile",key:t,url:e,path:this.path,syncPoint:true,data:null,loading:false,loaded:false,error:false,callbackContext:s};if(i){if(typeof i==="string"){i=JSON.parse(i)}r.data=i||{};r.loaded=true}for(var n=0;n<this._fileList.length+1;n++){var a=this._fileList[n];if(!a||!a.loaded&&!a.loading&&a.type!=="packfile"){this._fileList.splice(n,0,r);this._totalPackCount++;break}}return this},image:function(t,e,i){return this.addToFileList("image",t,e,undefined,i,".png")},images:function(t,e){if(Array.isArray(e)){for(var i=0;i<t.length;i++){this.image(t[i],e[i])}}else{for(var i=0;i<t.length;i++){this.image(t[i])}}return this},text:function(t,e,i){return this.addToFileList("text",t,e,undefined,i,".txt")},json:function(t,e,i){return this.addToFileList("json",t,e,undefined,i,".json")},shader:function(t,e,i){return this.addToFileList("shader",t,e,undefined,i,".frag")},xml:function(t,e,i){return this.addToFileList("xml",t,e,undefined,i,".xml")},script:function(t,e,i,s){if(i===undefined){i=false}if(i!==false&&s===undefined){s=this}return this.addToFileList("script",t,e,{syncPoint:true,callback:i,callbackContext:s},false,".js")},binary:function(t,e,i,s){if(i===undefined){i=false}if(i!==false&&s===undefined){s=i}return this.addToFileList("binary",t,e,{callback:i,callbackContext:s},false,".bin")},spritesheet:function(t,e,i,s,r,n,a){if(r===undefined){r=-1}if(n===undefined){n=0}if(a===undefined){a=0}return this.addToFileList("spritesheet",t,e,{frameWidth:i,frameHeight:s,frameMax:r,margin:n,spacing:a},false,".png")},audio:function(t,e,i){if(this.game.sound.noAudio){return this}if(i===undefined){i=true}if(typeof e==="string"){e=[e]}return this.addToFileList("audio",t,e,{buffer:null,autoDecode:i})},audioSprite:function(t,e,i,s,r){if(this.game.sound.noAudio){return this}if(i===undefined){i=null}if(s===undefined){s=null}if(r===undefined){r=true}this.audio(t,e,r);if(i){this.json(t+"-audioatlas",i)}else if(s){if(typeof s==="string"){s=JSON.parse(s)}this.cache.addJSON(t+"-audioatlas","",s)}else{console.warn("Phaser.Loader.audiosprite - You must specify either a jsonURL or provide a jsonData object")}return this},audiosprite:function(t,e,i,s,r){return this.audioSprite(t,e,i,s,r)},video:function(t,e,i,s){if(i===undefined){if(this.game.device.firefox){i="loadeddata"}else{i="canplaythrough"}}if(s===undefined){s=false}if(typeof e==="string"){e=[e]}return this.addToFileList("video",t,e,{buffer:null,asBlob:s,loadEvent:i})},tilemap:function(t,e,i,s){if(e===undefined){e=null}if(i===undefined){i=null}if(s===undefined){s=r.Tilemap.CSV}if(!e&&!i){if(s===r.Tilemap.CSV){e=t+".csv"}else{e=t+".json"}}if(i){switch(s){case r.Tilemap.CSV:break;case r.Tilemap.TILED_JSON:if(typeof i==="string"){i=JSON.parse(i)}break}this.cache.addTilemap(t,null,i,s)}else{this.addToFileList("tilemap",t,e,{format:s})}return this},physics:function(t,e,i,s){if(e===undefined){e=null}if(i===undefined){i=null}if(s===undefined){s=r.Physics.LIME_CORONA_JSON}if(!e&&!i){e=t+".json"}if(i){if(typeof i==="string"){i=JSON.parse(i)}this.cache.addPhysicsData(t,null,i,s)}else{this.addToFileList("physics",t,e,{format:s})}return this},bitmapFont:function(t,e,i,s,r,n){if(e===undefined||e===null){e=t+".png"}if(i===undefined){i=null}if(s===undefined){s=null}if(i===null&&s===null){i=t+".xml"}if(r===undefined){r=0}if(n===undefined){n=0}if(i){this.addToFileList("bitmapfont",t,e,{atlasURL:i,xSpacing:r,ySpacing:n})}else{if(typeof s==="string"){var a,o;try{a=JSON.parse(s)}catch(t){o=this.parseXml(s)}if(!o&&!a){throw new Error("Phaser.Loader. Invalid Bitmap Font atlas given")}this.addToFileList("bitmapfont",t,e,{atlasURL:null,atlasData:a||o,atlasType:!!a?"json":"xml",xSpacing:r,ySpacing:n})}}return this},atlasJSONArray:function(t,e,i,s){return this.atlas(t,e,i,s,r.Loader.TEXTURE_ATLAS_JSON_ARRAY)},atlasJSONHash:function(t,e,i,s){return this.atlas(t,e,i,s,r.Loader.TEXTURE_ATLAS_JSON_HASH)},atlasXML:function(t,e,i,s){if(i===undefined){i=null}if(s===undefined){s=null}if(!i&&!s){i=t+".xml"}return this.atlas(t,e,i,s,r.Loader.TEXTURE_ATLAS_XML_STARLING)},atlas:function(t,e,i,s,n){if(e===undefined||e===null){e=t+".png"}if(i===undefined){i=null}if(s===undefined){s=null}if(n===undefined){n=r.Loader.TEXTURE_ATLAS_JSON_ARRAY}if(!i&&!s){if(n===r.Loader.TEXTURE_ATLAS_XML_STARLING){i=t+".xml"}else{i=t+".json"}}if(i){this.addToFileList("textureatlas",t,e,{atlasURL:i,format:n})}else{switch(n){case r.Loader.TEXTURE_ATLAS_JSON_ARRAY:if(typeof s==="string"){s=JSON.parse(s)}break;case r.Loader.TEXTURE_ATLAS_XML_STARLING:if(typeof s==="string"){var a=this.parseXml(s);if(!a){throw new Error("Phaser.Loader. Invalid Texture Atlas XML given")}s=a}break}this.addToFileList("textureatlas",t,e,{atlasURL:null,atlasData:s,format:n})}return this},withSyncPoint:function(t,e){this._withSyncPointDepth++;try{t.call(e||this,this)}finally{this._withSyncPointDepth--}return this},addSyncPoint:function(t,e){var i=this.getAsset(t,e);if(i){i.file.syncPoint=true}return this},removeFile:function(t,e){var i=this.getAsset(t,e);if(i){if(!i.loaded&&!i.loading){this._fileList.splice(i.index,1)}}},removeAll:function(){this._fileList.length=0;this._flightQueue.length=0},start:function(){if(this.isLoading){return}this.hasLoaded=false;this.isLoading=true;this.updateProgress();this.processLoadQueue()},processLoadQueue:function(){if(!this.isLoading){console.warn("Phaser.Loader - active loading canceled / reset");this.finishedLoading(true);return}for(var t=0;t<this._flightQueue.length;t++){var e=this._flightQueue[t];if(e.loaded||e.error){this._flightQueue.splice(t,1);t--;e.loading=false;e.requestUrl=null;e.requestObject=null;if(e.error){this.onFileError.dispatch(e.key,e)}if(e.type!=="packfile"){this._loadedFileCount++;this.onFileComplete.dispatch(this.progress,e.key,!e.error,this._loadedFileCount,this._totalFileCount)}else if(e.type==="packfile"&&e.error){this._loadedPackCount++;this.onPackComplete.dispatch(e.key,!e.error,this._loadedPackCount,this._totalPackCount)}}}var i=false;var s=this.enableParallel?r.Math.clamp(this.maxParallelDownloads,1,12):1;for(var t=this._processingHead;t<this._fileList.length;t++){var e=this._fileList[t];if(e.type==="packfile"&&!e.error&&e.loaded&&t===this._processingHead){this.processPack(e);this._loadedPackCount++;this.onPackComplete.dispatch(e.key,!e.error,this._loadedPackCount,this._totalPackCount)}if(e.loaded||e.error){if(t===this._processingHead){this._processingHead=t+1}}else if(!e.loading&&this._flightQueue.length<s){if(e.type==="packfile"&&!e.data){this._flightQueue.push(e);e.loading=true;this.loadFile(e)}else if(!i){if(!this._fileLoadStarted){this._fileLoadStarted=true;this.onLoadStart.dispatch()}this._flightQueue.push(e);e.loading=true;this.onFileStart.dispatch(this.progress,e.key,e.url);this.loadFile(e)}}if(!e.loaded&&e.syncPoint){i=true}if(this._flightQueue.length>=s||i&&this._loadedPackCount===this._totalPackCount){break}}this.updateProgress();if(this._processingHead>=this._fileList.length){this.finishedLoading()}else if(!this._flightQueue.length){console.warn("Phaser.Loader - aborting: processing queue empty, loading may have stalled");var n=this;setTimeout(function(){n.finishedLoading(true)},2e3)}},finishedLoading:function(t){if(this.hasLoaded){return}this.hasLoaded=true;this.isLoading=false;if(!t&&!this._fileLoadStarted){this._fileLoadStarted=true;this.onLoadStart.dispatch()}this.onLoadComplete.dispatch();this.game.state.loadComplete();this.reset()},asyncComplete:function(t,e){if(e===undefined){e=""}t.loaded=true;t.error=!!e;if(e){t.errorMessage=e;console.warn("Phaser.Loader - "+t.type+"["+t.key+"]"+": "+e)}this.processLoadQueue()},processPack:function(t){var e=t.data[t.key];if(!e){console.warn("Phaser.Loader - "+t.key+": pack has data, but not for pack key");return}for(var i=0;i<e.length;i++){var s=e[i];switch(s.type){case"image":this.image(s.key,s.url,s.overwrite);break;case"text":this.text(s.key,s.url,s.overwrite);break;case"json":this.json(s.key,s.url,s.overwrite);break;case"xml":this.xml(s.key,s.url,s.overwrite);break;case"script":this.script(s.key,s.url,s.callback,t.callbackContext||this);break;case"binary":this.binary(s.key,s.url,s.callback,t.callbackContext||this);break;case"spritesheet":this.spritesheet(s.key,s.url,s.frameWidth,s.frameHeight,s.frameMax,s.margin,s.spacing);break;case"video":this.video(s.key,s.urls);break;case"audio":this.audio(s.key,s.urls,s.autoDecode);break;case"audiosprite":this.audiosprite(s.key,s.urls,s.jsonURL,s.jsonData,s.autoDecode);break;case"tilemap":this.tilemap(s.key,s.url,s.data,r.Tilemap[s.format]);break;case"physics":this.physics(s.key,s.url,s.data,r.Loader[s.format]);break;case"bitmapFont":this.bitmapFont(s.key,s.textureURL,s.atlasURL,s.atlasData,s.xSpacing,s.ySpacing);break;case"atlasJSONArray":this.atlasJSONArray(s.key,s.textureURL,s.atlasURL,s.atlasData);break;case"atlasJSONHash":this.atlasJSONHash(s.key,s.textureURL,s.atlasURL,s.atlasData);break;case"atlasXML":this.atlasXML(s.key,s.textureURL,s.atlasURL,s.atlasData);break;case"atlas":this.atlas(s.key,s.textureURL,s.atlasURL,s.atlasData,r.Loader[s.format]);break;case"shader":this.shader(s.key,s.url,s.overwrite);break}}},transformUrl:function(t,e){if(!t){return false}if(t.match(/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/)){return t}else{return this.baseURL+e.path+t}},loadFile:function(t){switch(t.type){case"packfile":this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.fileComplete);break;case"image":case"spritesheet":case"textureatlas":case"bitmapfont":this.loadImageTag(t);break;case"audio":t.url=this.getAudioURL(t.url);if(t.url){if(this.game.sound.usingWebAudio){this.xhrLoad(t,this.transformUrl(t.url,t),"arraybuffer",this.fileComplete)}else if(this.game.sound.usingAudioTag){this.loadAudioTag(t)}}else{this.fileError(t,null,"No supported audio URL specified or device does not have audio playback support")}break;case"video":t.url=this.getVideoURL(t.url);if(t.url){if(t.asBlob){this.xhrLoad(t,this.transformUrl(t.url,t),"blob",this.fileComplete)}else{this.loadVideoTag(t)}}else{this.fileError(t,null,"No supported video URL specified or device does not have video playback support")}break;case"json":this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.jsonLoadComplete);break;case"xml":this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.xmlLoadComplete);break;case"tilemap":if(t.format===r.Tilemap.TILED_JSON){this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.jsonLoadComplete)}else if(t.format===r.Tilemap.CSV){this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.csvLoadComplete)}else{this.asyncComplete(t,"invalid Tilemap format: "+t.format)}break;case"text":case"script":case"shader":case"physics":this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.fileComplete);break;case"binary":this.xhrLoad(t,this.transformUrl(t.url,t),"arraybuffer",this.fileComplete);break}},loadImageTag:function(t){var e=this;t.data=new Image;t.data.name=t.key;if(this.crossOrigin){t.data.crossOrigin=this.crossOrigin}t.data.onload=function(){if(t.data.onload){t.data.onload=null;t.data.onerror=null;e.fileComplete(t)}};t.data.onerror=function(){if(t.data.onload){t.data.onload=null;t.data.onerror=null;e.fileError(t)}};t.data.src=this.transformUrl(t.url,t);if(t.data.complete&&t.data.width&&t.data.height){t.data.onload=null;t.data.onerror=null;this.fileComplete(t)}},loadVideoTag:function(t){var e=this;t.data=document.createElement("video");t.data.name=t.key;t.data.controls=false;t.data.autoplay=false;var i=function(){t.data.removeEventListener(t.loadEvent,i,false);t.data.onerror=null;t.data.canplay=true;r.GAMES[e.game.id].load.fileComplete(t)};t.data.onerror=function(){t.data.removeEventListener(t.loadEvent,i,false);t.data.onerror=null;t.data.canplay=false;e.fileError(t)};t.data.addEventListener(t.loadEvent,i,false);t.data.src=this.transformUrl(t.url,t);t.data.load()},loadAudioTag:function(t){var e=this;if(this.game.sound.touchLocked){t.data=new Audio;t.data.name=t.key;t.data.preload="auto";t.data.src=this.transformUrl(t.url,t);this.fileComplete(t)}else{t.data=new Audio;t.data.name=t.key;var i=function(){t.data.removeEventListener("canplaythrough",i,false);t.data.onerror=null;e.fileComplete(t)};t.data.onerror=function(){t.data.removeEventListener("canplaythrough",i,false);t.data.onerror=null;e.fileError(t)};t.data.preload="auto";t.data.src=this.transformUrl(t.url,t);t.data.addEventListener("canplaythrough",i,false);t.data.load()}},xhrLoad:function(t,e,i,s,r){if(this.useXDomainRequest&&window.XDomainRequest){this.xhrLoadWithXDR(t,e,i,s,r);return}var n=new XMLHttpRequest;n.open("GET",e,true);n.responseType=i;if(this.headers["requestedWith"]!==false){n.setRequestHeader("X-Requested-With",this.headers["requestedWith"])}if(this.headers[t.type]){n.setRequestHeader("Accept",this.headers[t.type])}r=r||this.fileError;var a=this;n.onload=function(){try{if(n.readyState===4&&n.status>=400&&n.status<=599){return r.call(a,t,n)}else{return s.call(a,t,n)}}catch(e){if(!a.hasLoaded){a.asyncComplete(t,e.message||"Exception")}else{if(window["console"]){console.error(e)}}}};n.onerror=function(){try{return r.call(a,t,n)}catch(e){if(!a.hasLoaded){a.asyncComplete(t,e.message||"Exception")}else{if(window["console"]){console.error(e)}}}};t.requestObject=n;t.requestUrl=e;n.send()},xhrLoadWithXDR:function(t,e,i,s,r){if(!this._warnedAboutXDomainRequest&&(!this.game.device.ie||this.game.device.ieVersion>=10)){this._warnedAboutXDomainRequest=true;console.warn("Phaser.Loader - using XDomainRequest outside of IE 9")}var n=new window.XDomainRequest;n.open("GET",e,true);n.responseType=i;n.timeout=3e3;r=r||this.fileError;var a=this;n.onerror=function(){try{return r.call(a,t,n)}catch(e){a.asyncComplete(t,e.message||"Exception")}};n.ontimeout=function(){try{return r.call(a,t,n)}catch(e){a.asyncComplete(t,e.message||"Exception")}};n.onprogress=function(){};n.onload=function(){try{if(n.readyState===4&&n.status>=400&&n.status<=599){return r.call(a,t,n)}else{return s.call(a,t,n)}return s.call(a,t,n)}catch(e){a.asyncComplete(t,e.message||"Exception")}};t.requestObject=n;t.requestUrl=e;setTimeout(function(){n.send()},0)},getVideoURL:function(t){for(var e=0;e<t.length;e++){var i=t[e];var s;if(i.uri){s=i.type;i=i.uri;if(this.game.device.canPlayVideo(s)){return i}}else{if(i.indexOf("blob:")===0||i.indexOf("data:")===0){return i}if(i.indexOf("?")>=0){i=i.substr(0,i.indexOf("?"))}var r=i.substr((Math.max(0,i.lastIndexOf("."))||Infinity)+1);s=r.toLowerCase();if(this.game.device.canPlayVideo(s)){return t[e]}}}return null},getAudioURL:function(t){if(this.game.sound.noAudio){return null}for(var e=0;e<t.length;e++){var i=t[e];var s;if(i.uri){s=i.type;i=i.uri;if(this.game.device.canPlayAudio(s)){return i}}else{if(i.indexOf("blob:")===0||i.indexOf("data:")===0){return i}if(i.indexOf("?")>=0){i=i.substr(0,i.indexOf("?"))}var r=i.substr((Math.max(0,i.lastIndexOf("."))||Infinity)+1);s=r.toLowerCase();if(this.game.device.canPlayAudio(s)){return t[e]}}}return null},fileError:function(t,e,i){var s=t.requestUrl||this.transformUrl(t.url,t);var r="error loading asset from URL "+s;if(!i&&e){i=e.status}if(i){r=r+" ("+i+")"}this.asyncComplete(t,r)},fileComplete:function(t,e){var i=true;switch(t.type){case"packfile":var s=JSON.parse(e.responseText);t.data=s||{};break;case"image":this.cache.addImage(t.key,t.url,t.data);break;case"spritesheet":this.cache.addSpriteSheet(t.key,t.url,t.data,t.frameWidth,t.frameHeight,t.frameMax,t.margin,t.spacing);break;case"textureatlas":if(t.atlasURL==null){this.cache.addTextureAtlas(t.key,t.url,t.data,t.atlasData,t.format)}else{i=false;if(t.format===r.Loader.TEXTURE_ATLAS_JSON_ARRAY||t.format===r.Loader.TEXTURE_ATLAS_JSON_HASH||t.format===r.Loader.TEXTURE_ATLAS_JSON_PYXEL){this.xhrLoad(t,this.transformUrl(t.atlasURL,t),"text",this.jsonLoadComplete)}else if(t.format===r.Loader.TEXTURE_ATLAS_XML_STARLING){this.xhrLoad(t,this.transformUrl(t.atlasURL,t),"text",this.xmlLoadComplete)}else{throw new Error("Phaser.Loader. Invalid Texture Atlas format: "+t.format)}}break;case"bitmapfont":if(!t.atlasURL){this.cache.addBitmapFont(t.key,t.url,t.data,t.atlasData,t.atlasType,t.xSpacing,t.ySpacing)}else{i=false;this.xhrLoad(t,this.transformUrl(t.atlasURL,t),"text",function(t,e){var i;try{i=JSON.parse(e.responseText)}catch(t){}if(!!i){t.atlasType="json";this.jsonLoadComplete(t,e)}else{t.atlasType="xml";this.xmlLoadComplete(t,e)}})}break;case"video":if(t.asBlob){try{t.data=e.response}catch(e){throw new Error("Phaser.Loader. Unable to parse video file as Blob: "+t.key)}}this.cache.addVideo(t.key,t.url,t.data,t.asBlob);break;case"audio":if(this.game.sound.usingWebAudio){t.data=e.response;this.cache.addSound(t.key,t.url,t.data,true,false);if(t.autoDecode){this.game.sound.decode(t.key)}}else{this.cache.addSound(t.key,t.url,t.data,false,true)}break;case"text":t.data=e.responseText;this.cache.addText(t.key,t.url,t.data);break;case"shader":t.data=e.responseText;this.cache.addShader(t.key,t.url,t.data);break;case"physics":var s=JSON.parse(e.responseText);this.cache.addPhysicsData(t.key,t.url,s,t.format);break;case"script":t.data=document.createElement("script");t.data.language="javascript";t.data.type="text/javascript";t.data.defer=false;t.data.text=e.responseText;document.head.appendChild(t.data);if(t.callback){t.data=t.callback.call(t.callbackContext,t.key,e.responseText)}break;case"binary":if(t.callback){t.data=t.callback.call(t.callbackContext,t.key,e.response)}else{t.data=e.response}this.cache.addBinary(t.key,t.data);break}if(i){this.asyncComplete(t)}},jsonLoadComplete:function(t,e){var i=JSON.parse(e.responseText);if(t.type==="tilemap"){this.cache.addTilemap(t.key,t.url,i,t.format)}else if(t.type==="bitmapfont"){this.cache.addBitmapFont(t.key,t.url,t.data,i,t.atlasType,t.xSpacing,t.ySpacing)}else if(t.type==="json"){this.cache.addJSON(t.key,t.url,i)}else{this.cache.addTextureAtlas(t.key,t.url,t.data,i,t.format)}this.asyncComplete(t)},csvLoadComplete:function(t,e){var i=e.responseText;this.cache.addTilemap(t.key,t.url,i,t.format);this.asyncComplete(t)},xmlLoadComplete:function(t,e){var i=e.responseText;var s=this.parseXml(i);if(!s){var r=e.responseType||e.contentType;console.warn("Phaser.Loader - "+t.key+": invalid XML ("+r+")");this.asyncComplete(t,"invalid XML");return}if(t.type==="bitmapfont"){this.cache.addBitmapFont(t.key,t.url,t.data,s,t.atlasType,t.xSpacing,t.ySpacing)}else if(t.type==="textureatlas"){this.cache.addTextureAtlas(t.key,t.url,t.data,s,t.format)}else if(t.type==="xml"){this.cache.addXML(t.key,t.url,s)}this.asyncComplete(t)},parseXml:function(t){var e;try{if(window["DOMParser"]){var i=new DOMParser;e=i.parseFromString(t,"text/xml")}else{e=new ActiveXObject("Microsoft.XMLDOM");e.async="false";e.loadXML(t)}}catch(t){e=null}if(!e||!e.documentElement||e.getElementsByTagName("parsererror").length){return null}else{return e}},updateProgress:function(){if(this.preloadSprite){if(this.preloadSprite.direction===0){this.preloadSprite.rect.width=Math.floor(this.preloadSprite.width/100*this.progress)}else{this.preloadSprite.rect.height=Math.floor(this.preloadSprite.height/100*this.progress)}if(this.preloadSprite.sprite){this.preloadSprite.sprite.updateCrop()}else{this.preloadSprite=null}}},totalLoadedFiles:function(){return this._loadedFileCount},totalQueuedFiles:function(){return this._totalFileCount-this._loadedFileCount},totalLoadedPacks:function(){return this._totalPackCount},totalQueuedPacks:function(){return this._totalPackCount-this._loadedPackCount}};Object.defineProperty(r.Loader.prototype,"progressFloat",{get:function(){var t=this._loadedFileCount/this._totalFileCount*100;return r.Math.clamp(t||0,0,100)}});Object.defineProperty(r.Loader.prototype,"progress",{get:function(){return Math.round(this.progressFloat)}});r.Loader.prototype.constructor=r.Loader;r.LoaderParser={bitmapFont:function(t,e,i,s){return this.xmlBitmapFont(t,e,i,s)},xmlBitmapFont:function(t,e,i,s){var r={};var n=t.getElementsByTagName("info")[0];var a=t.getElementsByTagName("common")[0];r.font=n.getAttribute("face");r.size=parseInt(n.getAttribute("size"),10);r.lineHeight=parseInt(a.getAttribute("lineHeight"),10)+s;r.chars={};var o=t.getElementsByTagName("char");for(var h=0;h<o.length;h++){var l=parseInt(o[h].getAttribute("id"),10);r.chars[l]={x:parseInt(o[h].getAttribute("x"),10),y:parseInt(o[h].getAttribute("y"),10),width:parseInt(o[h].getAttribute("width"),10),height:parseInt(o[h].getAttribute("height"),10),xOffset:parseInt(o[h].getAttribute("xoffset"),10),yOffset:parseInt(o[h].getAttribute("yoffset"),10),xAdvance:parseInt(o[h].getAttribute("xadvance"),10)+i,kerning:{}}}var u=t.getElementsByTagName("kerning");for(h=0;h<u.length;h++){var c=parseInt(u[h].getAttribute("first"),10);var d=parseInt(u[h].getAttribute("second"),10);var f=parseInt(u[h].getAttribute("amount"),10);r.chars[d].kerning[c]=f}return this.finalizeBitmapFont(e,r)},jsonBitmapFont:function(t,e,i,s){var r={font:t.font.info._face,size:parseInt(t.font.info._size,10),lineHeight:parseInt(t.font.common._lineHeight,10)+s,chars:{}};t.font.chars["char"].forEach(function t(e){var s=parseInt(e._id,10);r.chars[s]={x:parseInt(e._x,10),y:parseInt(e._y,10),width:parseInt(e._width,10),height:parseInt(e._height,10),xOffset:parseInt(e._xoffset,10),yOffset:parseInt(e._yoffset,10),xAdvance:parseInt(e._xadvance,10)+i,kerning:{}}});if(t.font.kernings&&t.font.kernings.kerning){t.font.kernings.kerning.forEach(function t(e){r.chars[e._second].kerning[e._first]=parseInt(e._amount,10)})}return this.finalizeBitmapFont(e,r)},finalizeBitmapFont:function(t,e){Object.keys(e.chars).forEach(function i(s){var n=e.chars[s];n.texture=new PIXI.Texture(t,new r.Rectangle(n.x,n.y,n.width,n.height))});return e}};r.AudioSprite=function(t,e){this.game=t;this.key=e;this.config=this.game.cache.getJSON(e+"-audioatlas");this.autoplayKey=null;this.autoplay=false;this.sounds={};for(var i in this.config.spritemap){var s=this.config.spritemap[i];var r=this.game.add.sound(this.key);r.addMarker(i,s.start,s.end-s.start,null,s.loop);this.sounds[i]=r}if(this.config.autoplay){this.autoplayKey=this.config.autoplay;this.play(this.autoplayKey);this.autoplay=this.sounds[this.autoplayKey]}};r.AudioSprite.prototype={play:function(t,e){if(e===undefined){e=1}return this.sounds[t].play(t,null,e)},stop:function(t){if(!t){for(var e in this.sounds){this.sounds[e].stop()}}else{this.sounds[t].stop()}},get:function(t){return this.sounds[t]}};r.AudioSprite.prototype.constructor=r.AudioSprite;r.Sound=function(t,e,i,s,n){if(i===undefined){i=1}if(s===undefined){s=false}if(n===undefined){n=t.sound.connectToMaster}this.game=t;this.name=e;this.key=e;this.loop=s;this.markers={};this.context=null;this.autoplay=false;this.totalDuration=0;this.startTime=0;this.currentTime=0;this.duration=0;this.durationMS=0;this.position=0;this.stopTime=0;this.paused=false;this.pausedPosition=0;this.pausedTime=0;this.isPlaying=false;this.currentMarker="";this.fadeTween=null;this.pendingPlayback=false;this.override=false;this.allowMultiple=false;this.usingWebAudio=this.game.sound.usingWebAudio;this.usingAudioTag=this.game.sound.usingAudioTag;this.externalNode=null;this.masterGainNode=null;this.gainNode=null;this._sound=null;if(this.usingWebAudio){this.context=this.game.sound.context;this.masterGainNode=this.game.sound.masterGain;if(this.context.createGain===undefined){this.gainNode=this.context.createGainNode()}else{this.gainNode=this.context.createGain()}this.gainNode.gain.value=i*this.game.sound.volume;if(n){this.gainNode.connect(this.masterGainNode)}}else if(this.usingAudioTag){if(this.game.cache.getSound(e)&&this.game.cache.isSoundReady(e)){this._sound=this.game.cache.getSoundData(e);this.totalDuration=0;if(this._sound.duration){this.totalDuration=this._sound.duration}}else{this.game.cache.onSoundUnlock.add(this.soundHasUnlocked,this)}}this.onDecoded=new r.Signal;this.onPlay=new r.Signal;this.onPause=new r.Signal;this.onResume=new r.Signal;this.onLoop=new r.Signal;this.onStop=new r.Signal;this.onMute=new r.Signal;this.onMarkerComplete=new r.Signal;this.onFadeComplete=new r.Signal;this._volume=i;this._buffer=null;this._muted=false;this._tempMarker=0;this._tempPosition=0;this._tempVolume=0;this._tempPause=0;this._muteVolume=0;this._tempLoop=0;this._paused=false;this._onDecodedEventDispatched=false};r.Sound.prototype={soundHasUnlocked:function(t){if(t===this.key){this._sound=this.game.cache.getSoundData(this.key);this.totalDuration=this._sound.duration}},addMarker:function(t,e,i,s,r){if(i===undefined||i===null){i=1}if(s===undefined||s===null){s=1}if(r===undefined){r=false}this.markers[t]={name:t,start:e,stop:e+i,volume:s,duration:i,durationMS:i*1e3,loop:r}},removeMarker:function(t){delete this.markers[t]},onEndedHandler:function(){this._sound.onended=null;this.isPlaying=false;this.currentTime=this.durationMS;this.stop()},update:function(){if(!this.game.cache.checkSoundKey(this.key)){this.destroy();return}if(this.isDecoded&&!this._onDecodedEventDispatched){this.onDecoded.dispatch(this);this._onDecodedEventDispatched=true}if(this.pendingPlayback&&this.game.cache.isSoundReady(this.key)){this.pendingPlayback=false;this.play(this._tempMarker,this._tempPosition,this._tempVolume,this._tempLoop)}if(this.isPlaying){this.currentTime=this.game.time.time-this.startTime;if(this.currentTime>=this.durationMS){if(this.usingWebAudio){if(this.loop){this.onLoop.dispatch(this);this.isPlaying=false;if(this.currentMarker===""){this.currentTime=0;this.startTime=this.game.time.time;this.isPlaying=true}else{this.onMarkerComplete.dispatch(this.currentMarker,this);this.play(this.currentMarker,0,this.volume,true,true)}}else{if(this.currentMarker!==""){this.stop()}}}else{if(this.loop){this.onLoop.dispatch(this);if(this.currentMarker===""){this.currentTime=0;this.startTime=this.game.time.time}this.isPlaying=false;this.play(this.currentMarker,0,this.volume,true,true)}else{this.stop()}}}}},loopFull:function(t){return this.play(null,0,t,true)},play:function(t,e,i,s,r){if(t===undefined||t===false||t===null){t=""}if(r===undefined){r=true}if(this.isPlaying&&!this.allowMultiple&&!r&&!this.override){return this}if(this._sound&&this.isPlaying&&!this.allowMultiple&&(this.override||r)){if(this.usingWebAudio){if(this._sound.stop===undefined){this._sound.noteOff(0)}else{try{this._sound.stop(0)}catch(t){}}if(this.externalNode){this._sound.disconnect(this.externalNode)}else if(this.gainNode){this._sound.disconnect(this.gainNode)}}else if(this.usingAudioTag){this._sound.pause();this._sound.currentTime=0}this.isPlaying=false}if(t===""&&Object.keys(this.markers).length>0){return this}if(t!==""){if(this.markers[t]){this.currentMarker=t;this.position=this.markers[t].start;this.volume=this.markers[t].volume;this.loop=this.markers[t].loop;this.duration=this.markers[t].duration;this.durationMS=this.markers[t].durationMS;if(typeof i!=="undefined"){this.volume=i}if(typeof s!=="undefined"){this.loop=s}this._tempMarker=t;this._tempPosition=this.position;this._tempVolume=this.volume;this._tempLoop=this.loop}else{console.warn("Phaser.Sound.play: audio marker "+t+" doesn't exist");return this}}else{e=e||0;if(i===undefined){i=this._volume}if(s===undefined){s=this.loop}this.position=Math.max(0,e);this.volume=i;this.loop=s;this.duration=0;this.durationMS=0;this._tempMarker=t;this._tempPosition=e;this._tempVolume=i;this._tempLoop=s}if(this.usingWebAudio){if(this.game.cache.isSoundDecoded(this.key)){this._sound=this.context.createBufferSource();if(this.externalNode){this._sound.connect(this.externalNode)}else{this._sound.connect(this.gainNode)}this._buffer=this.game.cache.getSoundData(this.key);this._sound.buffer=this._buffer;if(this.loop&&t===""){this._sound.loop=true}if(!this.loop&&t===""){this._sound.onended=this.onEndedHandler.bind(this)}this.totalDuration=this._sound.buffer.duration;if(this.duration===0){this.duration=this.totalDuration;this.durationMS=Math.ceil(this.totalDuration*1e3)}if(this._sound.start===undefined){this._sound.noteGrainOn(0,this.position,this.duration)}else{if(this.loop&&t===""){this._sound.start(0,0)}else{this._sound.start(0,this.position,this.duration)}}this.isPlaying=true;this.startTime=this.game.time.time;this.currentTime=0;this.stopTime=this.startTime+this.durationMS;this.onPlay.dispatch(this)}else{this.pendingPlayback=true;if(this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).isDecoding===false){this.game.sound.decode(this.key,this)}}}else{if(this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).locked){this.game.cache.reloadSound(this.key);this.pendingPlayback=true}else{if(this._sound&&(this.game.device.cocoonJS||this._sound.readyState===4)){this._sound.play();this.totalDuration=this._sound.duration;if(this.duration===0){this.duration=this.totalDuration;this.durationMS=this.totalDuration*1e3}this._sound.currentTime=this.position;this._sound.muted=this._muted;if(this._muted||this.game.sound.mute){this._sound.volume=0}else{this._sound.volume=this._volume}this.isPlaying=true;this.startTime=this.game.time.time;this.currentTime=0;this.stopTime=this.startTime+this.durationMS;this.onPlay.dispatch(this)}else{this.pendingPlayback=true}}}return this},restart:function(t,e,i,s){t=t||"";e=e||0;i=i||1;if(s===undefined){s=false}this.play(t,e,i,s,true)},pause:function(){if(this.isPlaying&&this._sound){this.paused=true;this.pausedPosition=this.currentTime;this.pausedTime=this.game.time.time;this._tempPause=this._sound.currentTime;this.onPause.dispatch(this);this.stop()}},resume:function(){if(this.paused&&this._sound){if(this.usingWebAudio){var t=Math.max(0,this.position+this.pausedPosition/1e3);this._sound=this.context.createBufferSource();this._sound.buffer=this._buffer;if(this.externalNode){this._sound.connect(this.externalNode)}else{this._sound.connect(this.gainNode)}if(this.loop){this._sound.loop=true}if(!this.loop&&this.currentMarker===""){this._sound.onended=this.onEndedHandler.bind(this)}var e=this.duration-this.pausedPosition/1e3;if(this._sound.start===undefined){this._sound.noteGrainOn(0,t,e)}else{if(this.loop&&this.game.device.chrome){if(this.game.device.chromeVersion===42){this._sound.start(0)}else{this._sound.start(0,t)}}else{this._sound.start(0,t,e)}}}else{this._sound.currentTime=this._tempPause;this._sound.play()}this.isPlaying=true;this.paused=false;this.startTime+=this.game.time.time-this.pausedTime;this.onResume.dispatch(this)}},stop:function(){if(this.isPlaying&&this._sound){if(this.usingWebAudio){if(this._sound.stop===undefined){this._sound.noteOff(0)}else{try{this._sound.stop(0)}catch(t){}}if(this.externalNode){this._sound.disconnect(this.externalNode)}else if(this.gainNode){this._sound.disconnect(this.gainNode)}}else if(this.usingAudioTag){this._sound.pause();this._sound.currentTime=0}}this.pendingPlayback=false;this.isPlaying=false;if(!this.paused){var t=this.currentMarker;if(this.currentMarker!==""){this.onMarkerComplete.dispatch(this.currentMarker,this)}this.currentMarker="";if(this.fadeTween!==null){this.fadeTween.stop()}this.onStop.dispatch(this,t)}},fadeIn:function(t,e,i){if(e===undefined){e=false}if(i===undefined){i=this.currentMarker}if(this.paused){return}this.play(i,0,0,e);this.fadeTo(t,1)},fadeOut:function(t){this.fadeTo(t,0)},fadeTo:function(t,e){if(!this.isPlaying||this.paused||e===this.volume){return}if(t===undefined){t=1e3}if(e===undefined){console.warn("Phaser.Sound.fadeTo: No Volume Specified.");return}this.fadeTween=this.game.add.tween(this).to({volume:e},t,r.Easing.Linear.None,true);this.fadeTween.onComplete.add(this.fadeComplete,this)},fadeComplete:function(){this.onFadeComplete.dispatch(this,this.volume);if(this.volume===0){this.stop()}},updateGlobalVolume:function(t){if(this.usingAudioTag&&this._sound){this._sound.volume=t*this._volume}},destroy:function(t){if(t===undefined){t=true}this.stop();if(t){this.game.sound.remove(this)}else{this.markers={};this.context=null;this._buffer=null;this.externalNode=null;this.onDecoded.dispose();this.onPlay.dispose();this.onPause.dispose();this.onResume.dispose();this.onLoop.dispose();this.onStop.dispose();this.onMute.dispose();this.onMarkerComplete.dispose()}}};r.Sound.prototype.constructor=r.Sound;Object.defineProperty(r.Sound.prototype,"isDecoding",{get:function(){return this.game.cache.getSound(this.key).isDecoding}});Object.defineProperty(r.Sound.prototype,"isDecoded",{get:function(){return this.game.cache.isSoundDecoded(this.key)}});Object.defineProperty(r.Sound.prototype,"mute",{get:function(){return this._muted||this.game.sound.mute},set:function(t){t=t||false;if(t===this._muted){return}if(t){this._muted=true;this._muteVolume=this._tempVolume;if(this.usingWebAudio){this.gainNode.gain.value=0}else if(this.usingAudioTag&&this._sound){this._sound.volume=0}}else{this._muted=false;if(this.usingWebAudio){this.gainNode.gain.value=this._muteVolume}else if(this.usingAudioTag&&this._sound){this._sound.volume=this._muteVolume}}this.onMute.dispatch(this)}});Object.defineProperty(r.Sound.prototype,"volume",{get:function(){return this._volume},set:function(t){if(this.game.device.firefox&&this.usingAudioTag){t=this.game.math.clamp(t,0,1)}if(this._muted){this._muteVolume=t;return}this._tempVolume=t;this._volume=t;if(this.usingWebAudio){this.gainNode.gain.value=t}else if(this.usingAudioTag&&this._sound){this._sound.volume=t}}});r.SoundManager=function(t){this.game=t;this.onSoundDecode=new r.Signal;this.onVolumeChange=new r.Signal;this.onMute=new r.Signal;this.onUnMute=new r.Signal;this.context=null;this.usingWebAudio=false;this.usingAudioTag=false;this.noAudio=false;this.connectToMaster=true;this.touchLocked=false;this.channels=32;this.muteOnPause=true;this._codeMuted=false;this._muted=false;this._unlockSource=null;this._volume=1;this._sounds=[];this._watchList=new r.ArraySet;this._watching=false;this._watchCallback=null;this._watchContext=null};r.SoundManager.prototype={boot:function(){if(this.game.device.iOS&&this.game.device.webAudio===false){this.channels=1}if(window["PhaserGlobal"]){if(window["PhaserGlobal"].disableAudio===true){this.noAudio=true;this.touchLocked=false;return}if(window["PhaserGlobal"].disableWebAudio===true){this.usingAudioTag=true;this.touchLocked=false;return}}if(window["PhaserGlobal"]&&window["PhaserGlobal"].audioContext){this.context=window["PhaserGlobal"].audioContext}else{if(!!window["AudioContext"]){try{this.context=new window["AudioContext"]}catch(t){this.context=null;this.usingWebAudio=false;this.touchLocked=false}}else if(!!window["webkitAudioContext"]){try{this.context=new window["webkitAudioContext"]}catch(t){this.context=null;this.usingWebAudio=false;this.touchLocked=false}}}if(this.context===null){if(window["Audio"]===undefined){this.noAudio=true;return}else{this.usingAudioTag=true}}else{this.usingWebAudio=true;if(this.context.createGain===undefined){this.masterGain=this.context.createGainNode()}else{this.masterGain=this.context.createGain()}this.masterGain.gain.value=1;this.masterGain.connect(this.context.destination)}if(!this.noAudio){if(!this.game.device.cocoonJS&&this.game.device.iOS||window["PhaserGlobal"]&&window["PhaserGlobal"].fakeiOSTouchLock){this.setTouchLock()}}},setTouchLock:function(){if(this.noAudio||window["PhaserGlobal"]&&window["PhaserGlobal"].disableAudio===true){return}if(this.game.device.iOSVersion>8){this.game.input.touch.addTouchLockCallback(this.unlock,this,true)}else{this.game.input.touch.addTouchLockCallback(this.unlock,this)}this.touchLocked=true},unlock:function(){if(this.noAudio||!this.touchLocked||this._unlockSource!==null){return true}if(this.usingAudioTag){this.touchLocked=false;this._unlockSource=null}else if(this.usingWebAudio){var t=this.context.createBuffer(1,1,22050);this._unlockSource=this.context.createBufferSource();this._unlockSource.buffer=t;this._unlockSource.connect(this.context.destination);if(this._unlockSource.start===undefined){this._unlockSource.noteOn(0)}else{this._unlockSource.start(0)}}return true},stopAll:function(){if(this.noAudio){return}for(var t=0;t<this._sounds.length;t++){if(this._sounds[t]){this._sounds[t].stop()}}},pauseAll:function(){if(this.noAudio){return}for(var t=0;t<this._sounds.length;t++){if(this._sounds[t]){this._sounds[t].pause()}}},resumeAll:function(){if(this.noAudio){return}for(var t=0;t<this._sounds.length;t++){if(this._sounds[t]){this._sounds[t].resume()}}},decode:function(t,e){e=e||null;var i=this.game.cache.getSoundData(t);if(i){if(this.game.cache.isSoundDecoded(t)===false){this.game.cache.updateSound(t,"isDecoding",true);var s=this;try{this.context.decodeAudioData(i,function(i){if(i){s.game.cache.decodedSound(t,i);s.onSoundDecode.dispatch(t,e)}})}catch(t){}}}},setDecodedCallback:function(t,e,i){if(typeof t==="string"){t=[t]}this._watchList.reset();for(var s=0;s<t.length;s++){if(t[s]instanceof r.Sound){if(!this.game.cache.isSoundDecoded(t[s].key)){this._watchList.add(t[s].key)}}else if(!this.game.cache.isSoundDecoded(t[s])){this._watchList.add(t[s])}}if(this._watchList.total===0){this._watching=false;e.call(i)}else{this._watching=true;this._watchCallback=e;this._watchContext=i}},update:function(){if(this.noAudio){return}if(this.touchLocked&&this._unlockSource!==null&&(this._unlockSource.playbackState===this._unlockSource.PLAYING_STATE||this._unlockSource.playbackState===this._unlockSource.FINISHED_STATE)){this.touchLocked=false;this._unlockSource=null}for(var t=0;t<this._sounds.length;t++){this._sounds[t].update()}if(this._watching){var e=this._watchList.first;while(e){if(this.game.cache.isSoundDecoded(e)){this._watchList.remove(e)}e=this._watchList.next}if(this._watchList.total===0){this._watching=false;this._watchCallback.call(this._watchContext)}}},add:function(t,e,i,s){if(e===undefined){e=1}if(i===undefined){i=false}if(s===undefined){s=this.connectToMaster}var n=new r.Sound(this.game,t,e,i,s);this._sounds.push(n);return n},addSprite:function(t){var e=new r.AudioSprite(this.game,t);return e},remove:function(t){var e=this._sounds.length;while(e--){if(this._sounds[e]===t){this._sounds[e].destroy(false);this._sounds.splice(e,1);return true}}return false},removeByKey:function(t){var e=this._sounds.length;var i=0;while(e--){if(this._sounds[e].key===t){this._sounds[e].destroy(false);this._sounds.splice(e,1);i++}}return i},play:function(t,e,i){if(this.noAudio){return}var s=this.add(t,e,i);s.play();return s},setMute:function(){if(this._muted){return}this._muted=true;if(this.usingWebAudio){this._muteVolume=this.masterGain.gain.value;this.masterGain.gain.value=0}for(var t=0;t<this._sounds.length;t++){if(this._sounds[t].usingAudioTag){this._sounds[t].mute=true}}this.onMute.dispatch()},unsetMute:function(){if(!this._muted||this._codeMuted){return}this._muted=false;if(this.usingWebAudio){this.masterGain.gain.value=this._muteVolume}for(var t=0;t<this._sounds.length;t++){if(this._sounds[t].usingAudioTag){this._sounds[t].mute=false}}this.onUnMute.dispatch()},destroy:function(){this.stopAll();for(var t=0;t<this._sounds.length;t++){if(this._sounds[t]){this._sounds[t].destroy()}}this._sounds=[];this.onSoundDecode.dispose();if(this.context){if(window["PhaserGlobal"]){window["PhaserGlobal"].audioContext=this.context}else{if(this.context.close){this.context.close()}}}}};r.SoundManager.prototype.constructor=r.SoundManager;Object.defineProperty(r.SoundManager.prototype,"mute",{get:function(){return this._muted},set:function(t){t=t||false;if(t){if(this._muted){return}this._codeMuted=true;this.setMute()}else{if(!this._muted){return}this._codeMuted=false;this.unsetMute()}}});Object.defineProperty(r.SoundManager.prototype,"volume",{get:function(){return this._volume},set:function(t){if(t<0){t=0}else if(t>1){t=1}if(this._volume!==t){this._volume=t;if(this.usingWebAudio){this.masterGain.gain.value=t}else{for(var e=0;e<this._sounds.length;e++){if(this._sounds[e].usingAudioTag){this._sounds[e].updateGlobalVolume(t)}}}this.onVolumeChange.dispatch(t)}}});r.ScaleManager=function(t,e,i){this.game=t;this.dom=r.DOM;this.grid=null;this.width=0;this.height=0;this.minWidth=null;this.maxWidth=null;this.minHeight=null;this.maxHeight=null;this.offset=new r.Point;this.forceLandscape=false;this.forcePortrait=false;this.incorrectOrientation=false;this._pageAlignHorizontally=false;this._pageAlignVertically=false;this.onOrientationChange=new r.Signal;this.enterIncorrectOrientation=new r.Signal;this.leaveIncorrectOrientation=new r.Signal;this.hasPhaserSetFullScreen=false;this.fullScreenTarget=null;this._createdFullScreenTarget=null;this.onFullScreenInit=new r.Signal;this.onFullScreenChange=new r.Signal;this.onFullScreenError=new r.Signal;this.screenOrientation=this.dom.getScreenOrientation();this.scaleFactor=new r.Point(1,1);this.scaleFactorInversed=new r.Point(1,1);this.margin={left:0,top:0,right:0,bottom:0,x:0,y:0};this.bounds=new r.Rectangle;this.aspectRatio=0;this.sourceAspectRatio=0;this.event=null;this.windowConstraints={right:"layout",bottom:""};this.compatibility={supportsFullScreen:false,orientationFallback:null,noMargins:false,scrollTo:null,forceMinimumDocumentHeight:false,canExpandParent:true,clickTrampoline:""};this._scaleMode=r.ScaleManager.NO_SCALE;this._fullScreenScaleMode=r.ScaleManager.NO_SCALE;this.parentIsWindow=false;this.parentNode=null;this.parentScaleFactor=new r.Point(1,1);this.trackParentInterval=2e3;this.onSizeChange=new r.Signal;this.onResize=null;this.onResizeContext=null;this._pendingScaleMode=null;this._fullScreenRestore=null;this._gameSize=new r.Rectangle;this._userScaleFactor=new r.Point(1,1);this._userScaleTrim=new r.Point(0,0);this._lastUpdate=0;this._updateThrottle=0;this._updateThrottleReset=100;this._parentBounds=new r.Rectangle;this._tempBounds=new r.Rectangle;this._lastReportedCanvasSize=new r.Rectangle;this._lastReportedGameSize=new r.Rectangle;this._booted=false;if(t.config){this.parseConfig(t.config)}this.setupScale(e,i)};r.ScaleManager.EXACT_FIT=0;r.ScaleManager.NO_SCALE=1;r.ScaleManager.SHOW_ALL=2;r.ScaleManager.RESIZE=3;r.ScaleManager.USER_SCALE=4;r.ScaleManager.prototype={boot:function(){var t=this.compatibility;t.supportsFullScreen=this.game.device.fullscreen&&!this.game.device.cocoonJS;if(!this.game.device.iPad&&!this.game.device.webApp&&!this.game.device.desktop){if(this.game.device.android&&!this.game.device.chrome){t.scrollTo=new r.Point(0,1)}else{t.scrollTo=new r.Point(0,0)}}if(this.game.device.desktop){t.orientationFallback="screen";t.clickTrampoline="when-not-mouse"}else{t.orientationFallback="";t.clickTrampoline=""}var e=this;this._orientationChange=function(t){return e.orientationChange(t)};this._windowResize=function(t){return e.windowResize(t)};window.addEventListener("orientationchange",this._orientationChange,false);window.addEventListener("resize",this._windowResize,false);if(this.compatibility.supportsFullScreen){this._fullScreenChange=function(t){return e.fullScreenChange(t)};this._fullScreenError=function(t){return e.fullScreenError(t)};document.addEventListener("webkitfullscreenchange",this._fullScreenChange,false);document.addEventListener("mozfullscreenchange",this._fullScreenChange,false);document.addEventListener("MSFullscreenChange",this._fullScreenChange,false);document.addEventListener("fullscreenchange",this._fullScreenChange,false);document.addEventListener("webkitfullscreenerror",this._fullScreenError,false);document.addEventListener("mozfullscreenerror",this._fullScreenError,false);document.addEventListener("MSFullscreenError",this._fullScreenError,false);document.addEventListener("fullscreenerror",this._fullScreenError,false)}this.game.onResume.add(this._gameResumed,this);this.dom.getOffset(this.game.canvas,this.offset);this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height);this.setGameSize(this.game.width,this.game.height);this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback);if(r.FlexGrid){this.grid=new r.FlexGrid(this,this.width,this.height)}this._booted=true;if(this._pendingScaleMode!==null){this.scaleMode=this._pendingScaleMode;this._pendingScaleMode=null}},parseConfig:function(t){if(t["scaleMode"]!==undefined){if(this._booted){this.scaleMode=t["scaleMode"]}else{this._pendingScaleMode=t["scaleMode"]}}if(t["fullScreenScaleMode"]!==undefined){this.fullScreenScaleMode=t["fullScreenScaleMode"]}if(t["fullScreenTarget"]){this.fullScreenTarget=t["fullScreenTarget"]}},setupScale:function(t,e){var i;var s=new r.Rectangle;if(this.game.parent!==""){if(typeof this.game.parent==="string"){i=document.getElementById(this.game.parent)}else if(this.game.parent&&this.game.parent.nodeType===1){i=this.game.parent}}if(!i){this.parentNode=null;this.parentIsWindow=true;s.width=this.dom.visualBounds.width;s.height=this.dom.visualBounds.height;this.offset.set(0,0)}else{this.parentNode=i;this.parentIsWindow=false;this.getParentBounds(this._parentBounds);s.width=this._parentBounds.width;s.height=this._parentBounds.height;this.offset.set(this._parentBounds.x,this._parentBounds.y)}var n=0;var a=0;if(typeof t==="number"){n=t}else{this.parentScaleFactor.x=parseInt(t,10)/100;n=s.width*this.parentScaleFactor.x}if(typeof e==="number"){a=e}else{this.parentScaleFactor.y=parseInt(e,10)/100;a=s.height*this.parentScaleFactor.y}n=Math.floor(n);a=Math.floor(a);this._gameSize.setTo(0,0,n,a);this.updateDimensions(n,a,false)},_gameResumed:function(){this.queueUpdate(true)},setGameSize:function(t,e){this._gameSize.setTo(0,0,t,e);if(this.currentScaleMode!==r.ScaleManager.RESIZE){this.updateDimensions(t,e,true)}this.queueUpdate(true)},setUserScale:function(t,e,i,s){this._userScaleFactor.setTo(t,e);this._userScaleTrim.setTo(i|0,s|0);this.queueUpdate(true)},setResizeCallback:function(t,e){this.onResize=t;this.onResizeContext=e},signalSizeChange:function(){if(!r.Rectangle.sameDimensions(this,this._lastReportedCanvasSize)||!r.Rectangle.sameDimensions(this.game,this._lastReportedGameSize)){var t=this.width;var e=this.height;this._lastReportedCanvasSize.setTo(0,0,t,e);this._lastReportedGameSize.setTo(0,0,this.game.width,this.game.height);if(this.grid){this.grid.onResize(t,e)}this.onSizeChange.dispatch(this,t,e);if(this.currentScaleMode===r.ScaleManager.RESIZE){this.game.state.resize(t,e);this.game.load.resize(t,e)}}},setMinMax:function(t,e,i,s){this.minWidth=t;this.minHeight=e;if(typeof i!=="undefined"){this.maxWidth=i}if(typeof s!=="undefined"){this.maxHeight=s}},preUpdate:function(){if(this.game.time.time<this._lastUpdate+this._updateThrottle){return}var t=this._updateThrottle;this._updateThrottleReset=t>=400?0:100;this.dom.getOffset(this.game.canvas,this.offset);var e=this._parentBounds.width;var i=this._parentBounds.height;var s=this.getParentBounds(this._parentBounds);var n=s.width!==e||s.height!==i;var a=this.updateOrientationState();if(n||a){if(this.onResize){this.onResize.call(this.onResizeContext,this,s)}this.updateLayout();this.signalSizeChange()}var o=this._updateThrottle*2;if(this._updateThrottle<t){o=Math.min(t,this._updateThrottleReset)}this._updateThrottle=r.Math.clamp(o,25,this.trackParentInterval);this._lastUpdate=this.game.time.time},pauseUpdate:function(){this.preUpdate();this._updateThrottle=this.trackParentInterval},updateDimensions:function(t,e,i){this.width=t*this.parentScaleFactor.x;this.height=e*this.parentScaleFactor.y;this.game.width=this.width;this.game.height=this.height;this.sourceAspectRatio=this.width/this.height;this.updateScalingAndBounds();if(i){this.game.renderer.resize(this.width,this.height);this.game.camera.setSize(this.width,this.height);this.game.world.resize(this.width,this.height)}},updateScalingAndBounds:function(){this.scaleFactor.x=this.game.width/this.width;this.scaleFactor.y=this.game.height/this.height;this.scaleFactorInversed.x=this.width/this.game.width;this.scaleFactorInversed.y=this.height/this.game.height;this.aspectRatio=this.width/this.height;if(this.game.canvas){this.dom.getOffset(this.game.canvas,this.offset)}this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height);if(this.game.input&&this.game.input.scale){this.game.input.scale.setTo(this.scaleFactor.x,this.scaleFactor.y)}},forceOrientation:function(t,e){if(e===undefined){e=false}this.forceLandscape=t;this.forcePortrait=e;this.queueUpdate(true)},classifyOrientation:function(t){if(t==="portrait-primary"||t==="portrait-secondary"){return"portrait"}else if(t==="landscape-primary"||t==="landscape-secondary"){return"landscape"}else{return null}},updateOrientationState:function(){var t=this.screenOrientation;var e=this.incorrectOrientation;this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback);this.incorrectOrientation=this.forceLandscape&&!this.isLandscape||this.forcePortrait&&!this.isPortrait;var i=t!==this.screenOrientation;var s=e!==this.incorrectOrientation;if(s){if(this.incorrectOrientation){this.enterIncorrectOrientation.dispatch()}else{this.leaveIncorrectOrientation.dispatch()}}if(i||s){this.onOrientationChange.dispatch(this,t,e)}return i||s},orientationChange:function(t){this.event=t;this.queueUpdate(true)},windowResize:function(t){this.event=t;this.queueUpdate(true)},scrollTop:function(){var t=this.compatibility.scrollTo;if(t){window.scrollTo(t.x,t.y)}},refresh:function(){this.scrollTop();this.queueUpdate(true)},updateLayout:function(){var t=this.currentScaleMode;if(t===r.ScaleManager.RESIZE){this.reflowGame();return}this.scrollTop();if(this.compatibility.forceMinimumDocumentHeight){document.documentElement.style.minHeight=window.innerHeight+"px"}if(this.incorrectOrientation){this.setMaximum()}else{if(t===r.ScaleManager.EXACT_FIT){this.setExactFit()}else if(t===r.ScaleManager.SHOW_ALL){if(!this.isFullScreen&&this.boundingParent&&this.compatibility.canExpandParent){this.setShowAll(true);this.resetCanvas();this.setShowAll()}else{this.setShowAll()}}else if(t===r.ScaleManager.NO_SCALE){this.width=this.game.width;this.height=this.game.height}else if(t===r.ScaleManager.USER_SCALE){this.width=this.game.width*this._userScaleFactor.x-this._userScaleTrim.x;this.height=this.game.height*this._userScaleFactor.y-this._userScaleTrim.y}}if(!this.compatibility.canExpandParent&&(t===r.ScaleManager.SHOW_ALL||t===r.ScaleManager.USER_SCALE)){var e=this.getParentBounds(this._tempBounds);this.width=Math.min(this.width,e.width);this.height=Math.min(this.height,e.height)}this.width=this.width|0;this.height=this.height|0;this.reflowCanvas()},getParentBounds:function(t){var e=t||new r.Rectangle;var i=this.boundingParent;var s=this.dom.visualBounds;var n=this.dom.layoutBounds;if(!i){e.setTo(0,0,s.width,s.height)}else{var a=i.getBoundingClientRect();var o=i.offsetParent?i.offsetParent.getBoundingClientRect():i.getBoundingClientRect();e.setTo(a.left-o.left,a.top-o.top,a.width,a.height);var h=this.windowConstraints;if(h.right){var l=h.right==="layout"?n:s;e.right=Math.min(e.right,l.width)}if(h.bottom){var l=h.bottom==="layout"?n:s;e.bottom=Math.min(e.bottom,l.height)}}e.setTo(Math.round(e.x),Math.round(e.y),Math.round(e.width),Math.round(e.height));return e},alignCanvas:function(t,e){var i=this.getParentBounds(this._tempBounds);var s=this.game.canvas;var r=this.margin;if(t){r.left=r.right=0;var n=s.getBoundingClientRect();if(this.width<i.width&&!this.incorrectOrientation){var a=n.left-i.x;var o=i.width/2-this.width/2;o=Math.max(o,0);var h=o-a;r.left=Math.round(h)}s.style.marginLeft=r.left+"px";if(r.left!==0){r.right=-(i.width-n.width-r.left);s.style.marginRight=r.right+"px"}}if(e){r.top=r.bottom=0;var n=s.getBoundingClientRect();if(this.height<i.height&&!this.incorrectOrientation){var a=n.top-i.y;var o=i.height/2-this.height/2;o=Math.max(o,0);var h=o-a;r.top=Math.round(h)}s.style.marginTop=r.top+"px";if(r.top!==0){r.bottom=-(i.height-n.height-r.top);s.style.marginBottom=r.bottom+"px"}}r.x=r.left;r.y=r.top},reflowGame:function(){this.resetCanvas("","");var t=this.getParentBounds(this._tempBounds);this.updateDimensions(t.width,t.height,true)},reflowCanvas:function(){if(!this.incorrectOrientation){this.width=r.Math.clamp(this.width,this.minWidth||0,this.maxWidth||this.width);this.height=r.Math.clamp(this.height,this.minHeight||0,this.maxHeight||this.height)}this.resetCanvas();if(!this.compatibility.noMargins){if(this.isFullScreen&&this._createdFullScreenTarget){this.alignCanvas(true,true)}else{this.alignCanvas(this.pageAlignHorizontally,this.pageAlignVertically)}}this.updateScalingAndBounds()},resetCanvas:function(t,e){if(t===undefined){t=this.width+"px"}if(e===undefined){e=this.height+"px"}var i=this.game.canvas;if(!this.compatibility.noMargins){i.style.marginLeft="";i.style.marginTop="";i.style.marginRight="";i.style.marginBottom=""}i.style.width=t;i.style.height=e},queueUpdate:function(t){if(t){this._parentBounds.width=0;this._parentBounds.height=0}this._updateThrottle=this._updateThrottleReset},reset:function(t){if(t&&this.grid){this.grid.reset()}},setMaximum:function(){this.width=this.dom.visualBounds.width;this.height=this.dom.visualBounds.height},setShowAll:function(t){var e=this.getParentBounds(this._tempBounds);var i=e.width;var s=e.height;var r;if(t){r=Math.max(s/this.game.height,i/this.game.width)}else{r=Math.min(s/this.game.height,i/this.game.width)}this.width=Math.round(this.game.width*r);this.height=Math.round(this.game.height*r)},setExactFit:function(){var t=this.getParentBounds(this._tempBounds);this.width=t.width;this.height=t.height;if(this.isFullScreen){return}if(this.maxWidth){this.width=Math.min(this.width,this.maxWidth)}if(this.maxHeight){this.height=Math.min(this.height,this.maxHeight)}},createFullScreenTarget:function(){var t=document.createElement("div");t.style.margin="0";t.style.padding="0";t.style.background="#000";return t},startFullScreen:function(t,e){if(this.isFullScreen){return false}if(!this.compatibility.supportsFullScreen){var i=this;setTimeout(function(){i.fullScreenError()},10);return}if(this.compatibility.clickTrampoline==="when-not-mouse"){var s=this.game.input;if(s.activePointer&&s.activePointer!==s.mousePointer&&(e||e!==false)){s.activePointer.addClickTrampoline("startFullScreen",this.startFullScreen,this,[t,false]);return}}if(t!==undefined&&this.game.renderType===r.CANVAS){this.game.stage.smoothed=t}var n=this.fullScreenTarget;if(!n){this.cleanupCreatedTarget();this._createdFullScreenTarget=this.createFullScreenTarget();n=this._createdFullScreenTarget}var a={targetElement:n};this.hasPhaserSetFullScreen=true;this.onFullScreenInit.dispatch(this,a);if(this._createdFullScreenTarget){var o=this.game.canvas;var h=o.parentNode;h.insertBefore(n,o);n.appendChild(o)}if(this.game.device.fullscreenKeyboard){n[this.game.device.requestFullscreen](Element.ALLOW_KEYBOARD_INPUT)}else{n[this.game.device.requestFullscreen]()}return true},stopFullScreen:function(){if(!this.isFullScreen||!this.compatibility.supportsFullScreen){return false}this.hasPhaserSetFullScreen=false;document[this.game.device.cancelFullscreen]();return true},cleanupCreatedTarget:function(){var t=this._createdFullScreenTarget;if(t&&t.parentNode){var e=t.parentNode;e.insertBefore(this.game.canvas,t);e.removeChild(t)}this._createdFullScreenTarget=null},prepScreenMode:function(t){var e=!!this._createdFullScreenTarget;var i=this._createdFullScreenTarget||this.fullScreenTarget;if(t){if(e||this.fullScreenScaleMode===r.ScaleManager.EXACT_FIT){if(i!==this.game.canvas){this._fullScreenRestore={targetWidth:i.style.width,targetHeight:i.style.height};i.style.width="100%";i.style.height="100%"}}}else{if(this._fullScreenRestore){i.style.width=this._fullScreenRestore.targetWidth;i.style.height=this._fullScreenRestore.targetHeight;this._fullScreenRestore=null}this.updateDimensions(this._gameSize.width,this._gameSize.height,true);this.resetCanvas()}},fullScreenChange:function(t){this.event=t;if(this.isFullScreen){this.prepScreenMode(true);this.updateLayout();this.queueUpdate(true)}else{this.prepScreenMode(false);this.cleanupCreatedTarget();this.updateLayout();this.queueUpdate(true)}this.onFullScreenChange.dispatch(this,this.width,this.height)},fullScreenError:function(t){this.event=t;this.cleanupCreatedTarget();console.warn("Phaser.ScaleManager: requestFullscreen failed or device does not support the Fullscreen API");this.onFullScreenError.dispatch(this)},scaleSprite:function(t,e,i,s){if(e===undefined){e=this.width}if(i===undefined){i=this.height}if(s===undefined){s=false}if(!t||!t["scale"]){return t}t.scale.x=1;t.scale.y=1;if(t.width<=0||t.height<=0||e<=0||i<=0){return t}var r=e;var n=t.height*e/t.width;var a=t.width*i/t.height;var o=i;var h=a>e;if(h){h=s}else{h=!s}if(h){t.width=Math.floor(r);t.height=Math.floor(n)}else{t.width=Math.floor(a);t.height=Math.floor(o)}return t},destroy:function(){this.game.onResume.remove(this._gameResumed,this);window.removeEventListener("orientationchange",this._orientationChange,false);window.removeEventListener("resize",this._windowResize,false);if(this.compatibility.supportsFullScreen){document.removeEventListener("webkitfullscreenchange",this._fullScreenChange,false);document.removeEventListener("mozfullscreenchange",this._fullScreenChange,false);document.removeEventListener("MSFullscreenChange",this._fullScreenChange,false);document.removeEventListener("fullscreenchange",this._fullScreenChange,false);document.removeEventListener("webkitfullscreenerror",this._fullScreenError,false);document.removeEventListener("mozfullscreenerror",this._fullScreenError,false);document.removeEventListener("MSFullscreenError",this._fullScreenError,false);document.removeEventListener("fullscreenerror",this._fullScreenError,false)}}};r.ScaleManager.prototype.constructor=r.ScaleManager;Object.defineProperty(r.ScaleManager.prototype,"boundingParent",{get:function(){if(this.parentIsWindow||this.isFullScreen&&this.hasPhaserSetFullScreen&&!this._createdFullScreenTarget){return null}var t=this.game.canvas&&this.game.canvas.parentNode;return t||null}});Object.defineProperty(r.ScaleManager.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(t){if(t!==this._scaleMode){if(!this.isFullScreen){this.updateDimensions(this._gameSize.width,this._gameSize.height,true);this.queueUpdate(true)}this._scaleMode=t}return this._scaleMode}});Object.defineProperty(r.ScaleManager.prototype,"fullScreenScaleMode",{get:function(){return this._fullScreenScaleMode},set:function(t){if(t!==this._fullScreenScaleMode){if(this.isFullScreen){this.prepScreenMode(false);this._fullScreenScaleMode=t;this.prepScreenMode(true);this.queueUpdate(true)}else{this._fullScreenScaleMode=t}}return this._fullScreenScaleMode}});Object.defineProperty(r.ScaleManager.prototype,"currentScaleMode",{get:function(){return this.isFullScreen?this._fullScreenScaleMode:this._scaleMode}});Object.defineProperty(r.ScaleManager.prototype,"pageAlignHorizontally",{get:function(){return this._pageAlignHorizontally},set:function(t){if(t!==this._pageAlignHorizontally){this._pageAlignHorizontally=t;this.queueUpdate(true)}}});Object.defineProperty(r.ScaleManager.prototype,"pageAlignVertically",{get:function(){return this._pageAlignVertically},set:function(t){if(t!==this._pageAlignVertically){this._pageAlignVertically=t;this.queueUpdate(true)}}});Object.defineProperty(r.ScaleManager.prototype,"isFullScreen",{get:function(){return!!(document["fullscreenElement"]||document["webkitFullscreenElement"]||document["mozFullScreenElement"]||document["msFullscreenElement"])}});Object.defineProperty(r.ScaleManager.prototype,"isPortrait",{get:function(){return this.classifyOrientation(this.screenOrientation)==="portrait"}});Object.defineProperty(r.ScaleManager.prototype,"isLandscape",{get:function(){return this.classifyOrientation(this.screenOrientation)==="landscape"}});Object.defineProperty(r.ScaleManager.prototype,"isGamePortrait",{get:function(){return this.height>this.width}});Object.defineProperty(r.ScaleManager.prototype,"isGameLandscape",{get:function(){return this.width>this.height}});r.Utils.Debug=function(t){this.game=t;this.sprite=null;this.bmd=null;this.canvas=null;this.context=null;this.font="14px Courier";this.columnWidth=100;this.lineHeight=16;this.renderShadow=true;this.currentX=0;this.currentY=0;this.currentAlpha=1;this.dirty=false};r.Utils.Debug.prototype={boot:function(){if(this.game.renderType===r.CANVAS){this.context=this.game.context}else{this.bmd=new r.BitmapData(this.game,"__DEBUG",this.game.width,this.game.height,true);this.sprite=this.game.make.image(0,0,this.bmd);this.game.stage.addChild(this.sprite);this.game.scale.onSizeChange.add(this.resize,this);this.canvas=PIXI.CanvasPool.create(this,this.game.width,this.game.height);this.context=this.canvas.getContext("2d")}},resize:function(t,e,i){this.bmd.resize(e,i);this.canvas.width=e;this.canvas.height=i},preUpdate:function(){if(this.dirty&&this.sprite){this.bmd.clear();this.bmd.draw(this.canvas,0,0);this.context.clearRect(0,0,this.game.width,this.game.height);this.dirty=false}},reset:function(){if(this.context){this.context.clearRect(0,0,this.game.width,this.game.height)}if(this.sprite){this.bmd.clear()}},start:function(t,e,i,s){if(typeof t!=="number"){t=0}if(typeof e!=="number"){e=0}i=i||"rgb(255,255,255)";if(s===undefined){s=0}this.currentX=t;this.currentY=e;this.currentColor=i;this.columnWidth=s;this.dirty=true;this.context.save();this.context.setTransform(1,0,0,1,0,0);this.context.strokeStyle=i;this.context.fillStyle=i;this.context.font=this.font;this.context.globalAlpha=this.currentAlpha},stop:function(){this.context.restore()},line:function(){var t=this.currentX;for(var e=0;e<arguments.length;e++){if(this.renderShadow){this.context.fillStyle="rgb(0,0,0)";this.context.fillText(arguments[e],t+1,this.currentY+1);this.context.fillStyle=this.currentColor}this.context.fillText(arguments[e],t,this.currentY);t+=this.columnWidth}this.currentY+=this.lineHeight},soundInfo:function(t,e,i,s){this.start(e,i,s);this.line("Sound: "+t.key+" Locked: "+t.game.sound.touchLocked);this.line("Is Ready?: "+this.game.cache.isSoundReady(t.key)+" Pending Playback: "+t.pendingPlayback);this.line("Decoded: "+t.isDecoded+" Decoding: "+t.isDecoding);this.line("Total Duration: "+t.totalDuration+" Playing: "+t.isPlaying);this.line("Time: "+t.currentTime);this.line("Volume: "+t.volume+" Muted: "+t.mute);this.line("WebAudio: "+t.usingWebAudio+" Audio: "+t.usingAudioTag);if(t.currentMarker!==""){this.line("Marker: "+t.currentMarker+" Duration: "+t.duration+" (ms: "+t.durationMS+")");this.line("Start: "+t.markers[t.currentMarker].start+" Stop: "+t.markers[t.currentMarker].stop);this.line("Position: "+t.position)}this.stop()},cameraInfo:function(t,e,i,s){this.start(e,i,s);this.line("Camera ("+t.width+" x "+t.height+")");this.line("X: "+t.x+" Y: "+t.y);if(t.bounds){this.line("Bounds x: "+t.bounds.x+" Y: "+t.bounds.y+" w: "+t.bounds.width+" h: "+t.bounds.height)}this.line("View x: "+t.view.x+" Y: "+t.view.y+" w: "+t.view.width+" h: "+t.view.height);this.line("Total in view: "+t.totalInView);this.stop()},timer:function(t,e,i,s){this.start(e,i,s);this.line("Timer (running: "+t.running+" expired: "+t.expired+")");this.line("Next Tick: "+t.next+" Duration: "+t.duration);this.line("Paused: "+t.paused+" Length: "+t.length);this.stop()},pointer:function(t,e,i,s,r){if(t==null){return}if(e===undefined){e=false}i=i||"rgba(0,255,0,0.5)";s=s||"rgba(255,0,0,0.5)";if(e===true&&t.isUp===true){return}this.start(t.x,t.y-100,r);this.context.beginPath();this.context.arc(t.x,t.y,t.circle.radius,0,Math.PI*2);if(t.active){this.context.fillStyle=i}else{this.context.fillStyle=s}this.context.fill();this.context.closePath();this.context.beginPath();this.context.moveTo(t.positionDown.x,t.positionDown.y);this.context.lineTo(t.position.x,t.position.y);this.context.lineWidth=2;this.context.stroke();this.context.closePath();this.line("ID: "+t.id+" Active: "+t.active);this.line("World X: "+t.worldX+" World Y: "+t.worldY);this.line("Screen X: "+t.x+" Screen Y: "+t.y+" In: "+t.withinGame);this.line("Duration: "+t.duration+" ms");this.line("is Down: "+t.isDown+" is Up: "+t.isUp);this.stop()},spriteInputInfo:function(t,e,i,s){this.start(e,i,s);this.line("Sprite Input: ("+t.width+" x "+t.height+")");this.line("x: "+t.input.pointerX().toFixed(1)+" y: "+t.input.pointerY().toFixed(1));this.line("over: "+t.input.pointerOver()+" duration: "+t.input.overDuration().toFixed(0));this.line("down: "+t.input.pointerDown()+" duration: "+t.input.downDuration().toFixed(0));this.line("just over: "+t.input.justOver()+" just out: "+t.input.justOut());this.stop()},key:function(t,e,i,s){this.start(e,i,s,150);this.line("Key:",t.keyCode,"isDown:",t.isDown);this.line("justDown:",t.justDown,"justUp:",t.justUp);this.line("Time Down:",t.timeDown.toFixed(0),"duration:",t.duration.toFixed(0));this.stop()},inputInfo:function(t,e,i){this.start(t,e,i);this.line("Input");this.line("X: "+this.game.input.x+" Y: "+this.game.input.y);this.line("World X: "+this.game.input.worldX+" World Y: "+this.game.input.worldY);this.line("Scale X: "+this.game.input.scale.x.toFixed(1)+" Scale Y: "+this.game.input.scale.x.toFixed(1));this.line("Screen X: "+this.game.input.activePointer.screenX+" Screen Y: "+this.game.input.activePointer.screenY);this.stop()},spriteBounds:function(t,e,i){var s=t.getBounds();s.x+=this.game.camera.x;s.y+=this.game.camera.y;this.rectangle(s,e,i)},ropeSegments:function(t,e,i){var s=t.segments;var r=this;s.forEach(function(t){r.rectangle(t,e,i)},this)},spriteInfo:function(t,e,i,s){this.start(e,i,s);this.line("Sprite: "+" ("+t.width+" x "+t.height+") anchor: "+t.anchor.x+" x "+t.anchor.y);this.line("x: "+t.x.toFixed(1)+" y: "+t.y.toFixed(1));this.line("angle: "+t.angle.toFixed(1)+" rotation: "+t.rotation.toFixed(1));this.line("visible: "+t.visible+" in camera: "+t.inCamera);this.line("bounds x: "+t._bounds.x.toFixed(1)+" y: "+t._bounds.y.toFixed(1)+" w: "+t._bounds.width.toFixed(1)+" h: "+t._bounds.height.toFixed(1));this.stop()},spriteCoords:function(t,e,i,s){this.start(e,i,s,100);if(t.name){this.line(t.name)}this.line("x:",t.x.toFixed(2),"y:",t.y.toFixed(2));this.line("pos x:",t.position.x.toFixed(2),"pos y:",t.position.y.toFixed(2));this.line("world x:",t.world.x.toFixed(2),"world y:",t.world.y.toFixed(2));this.stop()},lineInfo:function(t,e,i,s){this.start(e,i,s,80);this.line("start.x:",t.start.x.toFixed(2),"start.y:",t.start.y.toFixed(2));this.line("end.x:",t.end.x.toFixed(2),"end.y:",t.end.y.toFixed(2));this.line("length:",t.length.toFixed(2),"angle:",t.angle);this.stop()},pixel:function(t,e,i,s){s=s||2;this.start();this.context.fillStyle=i;this.context.fillRect(t,e,s,s);this.stop()},geom:function(t,e,i,s){if(i===undefined){i=true}if(s===undefined){s=0}e=e||"rgba(0,255,0,0.4)";this.start();this.context.fillStyle=e;this.context.strokeStyle=e;if(t instanceof r.Rectangle||s===1){if(i){this.context.fillRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height)}else{this.context.strokeRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height)}}else if(t instanceof r.Circle||s===2){this.context.beginPath();this.context.arc(t.x-this.game.camera.x,t.y-this.game.camera.y,t.radius,0,Math.PI*2,false);this.context.closePath();if(i){this.context.fill()}else{this.context.stroke()}}else if(t instanceof r.Point||s===3){this.context.fillRect(t.x-this.game.camera.x,t.y-this.game.camera.y,4,4)}else if(t instanceof r.Line||s===4){this.context.lineWidth=1;this.context.beginPath();this.context.moveTo(t.start.x+.5-this.game.camera.x,t.start.y+.5-this.game.camera.y);this.context.lineTo(t.end.x+.5-this.game.camera.x,t.end.y+.5-this.game.camera.y);this.context.closePath();this.context.stroke()}this.stop()},rectangle:function(t,e,i){if(i===undefined){i=true}e=e||"rgba(0, 255, 0, 0.4)";this.start();if(i){this.context.fillStyle=e;this.context.fillRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height)}else{this.context.strokeStyle=e;this.context.strokeRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height)}this.stop()},text:function(t,e,i,s,r){s=s||"rgb(255,255,255)";r=r||"16px Courier";this.start();this.context.font=r;if(this.renderShadow){this.context.fillStyle="rgb(0,0,0)";this.context.fillText(t,e+1,i+1)}this.context.fillStyle=s;this.context.fillText(t,e,i);this.stop()},quadTree:function(t,e){e=e||"rgba(255,0,0,0.3)";this.start();var i=t.bounds;if(t.nodes.length===0){this.context.strokeStyle=e;this.context.strokeRect(i.x,i.y,i.width,i.height);this.text("size: "+t.objects.length,i.x+4,i.y+16,"rgb(0,200,0)","12px Courier");this.context.strokeStyle="rgb(0,255,0)";for(var s=0;s<t.objects.length;s++){this.context.strokeRect(t.objects[s].x,t.objects[s].y,t.objects[s].width,t.objects[s].height)}}else{for(var s=0;s<t.nodes.length;s++){this.quadTree(t.nodes[s])}}this.stop()},body:function(t,e,i){if(t.body){this.start();if(t.body.type===r.Physics.ARCADE){r.Physics.Arcade.Body.render(this.context,t.body,e,i)}else if(t.body.type===r.Physics.NINJA){r.Physics.Ninja.Body.render(this.context,t.body,e,i)}else if(t.body.type===r.Physics.BOX2D){r.Physics.Box2D.renderBody(this.context,t.body,e)}this.stop()}},bodyInfo:function(t,e,i,s){if(t.body){this.start(e,i,s,210);if(t.body.type===r.Physics.ARCADE){r.Physics.Arcade.Body.renderBodyInfo(this,t.body)}else if(t.body.type===r.Physics.BOX2D){this.game.physics.box2d.renderBodyInfo(this,t.body)}this.stop()}},box2dWorld:function(){this.start();this.context.translate(-this.game.camera.view.x,-this.game.camera.view.y,0);this.game.physics.box2d.renderDebugDraw(this.context);this.stop()},box2dBody:function(t,e){this.start();r.Physics.Box2D.renderBody(this.context,t,e);this.stop()},displayList:function(t){if(t===undefined){t=this.game.world}if(t.hasOwnProperty("renderOrderID")){console.log("["+t.renderOrderID+"]",t)}else{console.log("[]",t)}if(t.children&&t.children.length>0){for(var e=0;e<t.children.length;e++){this.game.debug.displayList(t.children[e])}}},destroy:function(){PIXI.CanvasPool.remove(this)}};r.Utils.Debug.prototype.constructor=r.Utils.Debug;r.DOM={getOffset:function(t,e){e=e||new r.Point;var i=t.getBoundingClientRect();var s=r.DOM.scrollY;var n=r.DOM.scrollX;var a=document.documentElement.clientTop;var o=document.documentElement.clientLeft;e.x=i.left+n-o;e.y=i.top+s-a;return e},getBounds:function(t,e){if(e===undefined){e=0}t=t&&!t.nodeType?t[0]:t;if(!t||t.nodeType!==1){return false}else{return this.calibrate(t.getBoundingClientRect(),e)}},calibrate:function(t,e){e=+e||0;var i={width:0,height:0,left:0,right:0,top:0,bottom:0};i.width=(i.right=t.right+e)-(i.left=t.left-e);i.height=(i.bottom=t.bottom+e)-(i.top=t.top-e);return i},getAspectRatio:function(t){t=null==t?this.visualBounds:1===t.nodeType?this.getBounds(t):t;var e=t["width"];var i=t["height"];if(typeof e==="function"){e=e.call(t)}if(typeof i==="function"){i=i.call(t)}return e/i},inLayoutViewport:function(t,e){var i=this.getBounds(t,e);return!!i&&i.bottom>=0&&i.right>=0&&i.top<=this.layoutBounds.width&&i.left<=this.layoutBounds.height},getScreenOrientation:function(t){var e=window.screen;var i=e.orientation||e.mozOrientation||e.msOrientation;if(i&&typeof i.type==="string"){return i.type}else if(typeof i==="string"){return i}var s="portrait-primary";var r="landscape-primary";if(t==="screen"){return e.height>e.width?s:r}else if(t==="viewport"){return this.visualBounds.height>this.visualBounds.width?s:r}else if(t==="window.orientation"&&typeof window.orientation==="number"){return window.orientation===0||window.orientation===180?s:r}else if(window.matchMedia){if(window.matchMedia("(orientation: portrait)").matches){return s}else if(window.matchMedia("(orientation: landscape)").matches){return r}}return this.visualBounds.height>this.visualBounds.width?s:r},visualBounds:new r.Rectangle,layoutBounds:new r.Rectangle,documentBounds:new r.Rectangle};r.Device.whenReady(function(t){var e=window&&"pageXOffset"in window?function(){return window.pageXOffset}:function(){return document.documentElement.scrollLeft};var i=window&&"pageYOffset"in window?function(){return window.pageYOffset}:function(){return document.documentElement.scrollTop};Object.defineProperty(r.DOM,"scrollX",{get:e});Object.defineProperty(r.DOM,"scrollY",{get:i});Object.defineProperty(r.DOM.visualBounds,"x",{get:e});Object.defineProperty(r.DOM.visualBounds,"y",{get:i});Object.defineProperty(r.DOM.layoutBounds,"x",{value:0});Object.defineProperty(r.DOM.layoutBounds,"y",{value:0});var s=t.desktop&&document.documentElement.clientWidth<=window.innerWidth&&document.documentElement.clientHeight<=window.innerHeight;if(s){var n=function(){return Math.max(window.innerWidth,document.documentElement.clientWidth)};var a=function(){return Math.max(window.innerHeight,document.documentElement.clientHeight)};Object.defineProperty(r.DOM.visualBounds,"width",{get:n});Object.defineProperty(r.DOM.visualBounds,"height",{get:a});Object.defineProperty(r.DOM.layoutBounds,"width",{get:n});Object.defineProperty(r.DOM.layoutBounds,"height",{get:a})}else{Object.defineProperty(r.DOM.visualBounds,"width",{get:function(){return window.innerWidth}});Object.defineProperty(r.DOM.visualBounds,"height",{get:function(){return window.innerHeight}});Object.defineProperty(r.DOM.layoutBounds,"width",{get:function(){var t=document.documentElement.clientWidth;var e=window.innerWidth;return t<e?e:t}});Object.defineProperty(r.DOM.layoutBounds,"height",{get:function(){var t=document.documentElement.clientHeight;var e=window.innerHeight;return t<e?e:t}})}Object.defineProperty(r.DOM.documentBounds,"x",{value:0});Object.defineProperty(r.DOM.documentBounds,"y",{value:0});Object.defineProperty(r.DOM.documentBounds,"width",{get:function(){var t=document.documentElement;return Math.max(t.clientWidth,t.offsetWidth,t.scrollWidth)}});Object.defineProperty(r.DOM.documentBounds,"height",{get:function(){var t=document.documentElement;return Math.max(t.clientHeight,t.offsetHeight,t.scrollHeight)}})},null,true);r.ArraySet=function(t){this.position=0;this.list=t||[]};r.ArraySet.prototype={add:function(t){if(!this.exists(t)){this.list.push(t)}return t},getIndex:function(t){return this.list.indexOf(t)},getByKey:function(t,e){var i=this.list.length;while(i--){if(this.list[i][t]===e){return this.list[i]}}return null},exists:function(t){return this.list.indexOf(t)>-1},reset:function(){this.list.length=0},remove:function(t){var e=this.list.indexOf(t);if(e>-1){this.list.splice(e,1);return t}},setAll:function(t,e){var i=this.list.length;while(i--){if(this.list[i]){this.list[i][t]=e}}},callAll:function(t){var e=Array.prototype.slice.call(arguments,1);var i=this.list.length;while(i--){if(this.list[i]&&this.list[i][t]){this.list[i][t].apply(this.list[i],e)}}},removeAll:function(t){if(t===undefined){t=false}var e=this.list.length;while(e--){if(this.list[e]){var i=this.remove(this.list[e]);if(t){i.destroy()}}}this.position=0;this.list=[]}};Object.defineProperty(r.ArraySet.prototype,"total",{get:function(){return this.list.length}});Object.defineProperty(r.ArraySet.prototype,"first",{get:function(){this.position=0;if(this.list.length>0){return this.list[0]}else{return null}}});Object.defineProperty(r.ArraySet.prototype,"next",{get:function(){if(this.position<this.list.length){this.position++;return this.list[this.position]}else{return null}}});r.ArraySet.prototype.constructor=r.ArraySet;r.ArrayUtils={getRandomItem:function(t,e,i){if(t===null){return null}if(e===undefined){e=0}if(i===undefined){i=t.length}var s=e+Math.floor(Math.random()*i);return t[s]===undefined?null:t[s]},removeRandomItem:function(t,e,i){if(t==null){return null}if(e===undefined){e=0}if(i===undefined){i=t.length}var s=e+Math.floor(Math.random()*i);if(s<t.length){var r=t.splice(s,1);return r[0]===undefined?null:r[0]}else{return null}},shuffle:function(t){for(var e=t.length-1;e>0;e--){var i=Math.floor(Math.random()*(e+1));var s=t[e];t[e]=t[i];t[i]=s}return t},transposeMatrix:function(t){var e=t.length;var i=t[0].length;var s=new Array(i);for(var r=0;r<i;r++){s[r]=new Array(e);for(var n=e-1;n>-1;n--){s[r][n]=t[n][r]}}return s},rotateMatrix:function(t,e){if(typeof e!=="string"){e=(e%360+360)%360}if(e===90||e===-270||e==="rotateLeft"){t=r.ArrayUtils.transposeMatrix(t);t=t.reverse()}else if(e===-90||e===270||e==="rotateRight"){t=t.reverse();t=r.ArrayUtils.transposeMatrix(t)}else if(Math.abs(e)===180||e==="rotate180"){for(var i=0;i<t.length;i++){t[i].reverse()}t=t.reverse()}return t},findClosest:function(t,e){if(!e.length){return NaN}else if(e.length===1||t<e[0]){return e[0]}var i=1;while(e[i]<t){i++}var s=e[i-1];var r=i<e.length?e[i]:Number.POSITIVE_INFINITY;return r-t<=t-s?r:s},rotateRight:function(t){var e=t.pop();t.unshift(e);return e},rotateLeft:function(t){var e=t.shift();t.push(e);return e},rotate:function(t){var e=t.shift();t.push(e);return e},numberArray:function(t,e){var i=[];for(var s=t;s<=e;s++){i.push(s)}return i},numberArrayStep:function(t,e,i){if(t===undefined||t===null){t=0}if(e===undefined||e===null){e=t;t=0}if(i===undefined){i=1}var s=[];var n=Math.max(r.Math.roundAwayFromZero((e-t)/(i||1)),0);for(var a=0;a<n;a++){s.push(t);t+=i}return s}};r.LinkedList=function(){this.next=null;this.prev=null;this.first=null;this.last=null;this.total=0};r.LinkedList.prototype={add:function(t){if(this.total===0&&this.first===null&&this.last===null){this.first=t;this.last=t;this.next=t;t.prev=this;this.total++;return t}this.last.next=t;t.prev=this.last;this.last=t;this.total++;return t},reset:function(){this.first=null;this.last=null;this.next=null;this.prev=null;this.total=0},remove:function(t){if(this.total===1){this.reset();t.next=t.prev=null;return}if(t===this.first){this.first=this.first.next}else if(t===this.last){this.last=this.last.prev}if(t.prev){t.prev.next=t.next}if(t.next){t.next.prev=t.prev}t.next=t.prev=null;if(this.first===null){this.last=null}this.total--},callAll:function(t){if(!this.first||!this.last){return}var e=this.first;do{if(e&&e[t]){e[t].call(e)}e=e.next}while(e!==this.last.next)}};r.LinkedList.prototype.constructor=r.LinkedList;r.Create=function(t){this.game=t;this.bmd=null;this.canvas=null;this.ctx=null;this.palettes=[{0:"#000",1:"#9D9D9D",2:"#FFF",3:"#BE2633",4:"#E06F8B",5:"#493C2B",6:"#A46422",7:"#EB8931",8:"#F7E26B",9:"#2F484E",A:"#44891A",B:"#A3CE27",C:"#1B2632",D:"#005784",E:"#31A2F2",F:"#B2DCEF"},{0:"#000",1:"#191028",2:"#46af45",3:"#a1d685",4:"#453e78",5:"#7664fe",6:"#833129",7:"#9ec2e8",8:"#dc534b",9:"#e18d79",A:"#d6b97b",B:"#e9d8a1",C:"#216c4b",D:"#d365c8",E:"#afaab9",F:"#f5f4eb"},{0:"#000",1:"#2234d1",2:"#0c7e45",3:"#44aacc",4:"#8a3622",5:"#5c2e78",6:"#aa5c3d",7:"#b5b5b5",8:"#5e606e",9:"#4c81fb",A:"#6cd947",B:"#7be2f9",C:"#eb8a60",D:"#e23d69",E:"#ffd93f",F:"#fff"},{0:"#000",1:"#fff",2:"#8b4131",3:"#7bbdc5",4:"#8b41ac",5:"#6aac41",6:"#3931a4",7:"#d5de73",8:"#945a20",9:"#5a4100",A:"#bd736a",B:"#525252",C:"#838383",D:"#acee8b",E:"#7b73de",F:"#acacac"},{0:"#000",1:"#191028",2:"#46af45",3:"#a1d685",4:"#453e78",5:"#7664fe",6:"#833129",7:"#9ec2e8",8:"#dc534b",9:"#e18d79",A:"#d6b97b",B:"#e9d8a1",C:"#216c4b",D:"#d365c8",E:"#afaab9",F:"#fff"}]};r.Create.PALETTE_ARNE=0;r.Create.PALETTE_JMP=1;r.Create.PALETTE_CGA=2;r.Create.PALETTE_C64=3;r.Create.PALETTE_JAPANESE_MACHINE=4;r.Create.prototype={texture:function(t,e,i,s,r){if(i===undefined){i=8}if(s===undefined){s=i}if(r===undefined){r=0}var n=e[0].length*i;var a=e.length*s;if(this.bmd===null){this.bmd=this.game.make.bitmapData();this.canvas=this.bmd.canvas;this.ctx=this.bmd.context}this.bmd.resize(n,a);this.bmd.clear();for(var o=0;o<e.length;o++){var h=e[o];for(var l=0;l<h.length;l++){var u=h[l];if(u!=="."&&u!==" "){this.ctx.fillStyle=this.palettes[r][u];this.ctx.fillRect(l*i,o*s,i,s)}}}return this.bmd.generateTexture(t)},grid:function(t,e,i,s,r,n){if(this.bmd===null){this.bmd=this.game.make.bitmapData();this.canvas=this.bmd.canvas;this.ctx=this.bmd.context}this.bmd.resize(e,i);this.ctx.fillStyle=n;for(var a=0;a<i;a+=r){this.ctx.fillRect(0,a,e,1)}for(var o=0;o<e;o+=s){this.ctx.fillRect(o,0,1,i)}return this.bmd.generateTexture(t)}};r.Create.prototype.constructor=r.Create;r.FlexGrid=function(t,e,i){this.game=t.game;this.manager=t;this.width=e;this.height=i;this.boundsCustom=new r.Rectangle(0,0,e,i);this.boundsFluid=new r.Rectangle(0,0,e,i);this.boundsFull=new r.Rectangle(0,0,e,i);this.boundsNone=new r.Rectangle(0,0,e,i);this.positionCustom=new r.Point(0,0);this.positionFluid=new r.Point(0,0);this.positionFull=new r.Point(0,0);this.positionNone=new r.Point(0,0);this.scaleCustom=new r.Point(1,1);this.scaleFluid=new r.Point(1,1);this.scaleFluidInversed=new r.Point(1,1);this.scaleFull=new r.Point(1,1);this.scaleNone=new r.Point(1,1);this.customWidth=0;this.customHeight=0;this.customOffsetX=0;this.customOffsetY=0;this.ratioH=e/i;this.ratioV=i/e;this.multiplier=0;this.layers=[]};r.FlexGrid.prototype={setSize:function(t,e){this.width=t;this.height=e;this.ratioH=t/e;this.ratioV=e/t;this.scaleNone=new r.Point(1,1);this.boundsNone.width=this.width;this.boundsNone.height=this.height;this.refresh()},createCustomLayer:function(t,e,i,s){if(s===undefined){s=true}this.customWidth=t;this.customHeight=e;this.boundsCustom.width=t;this.boundsCustom.height=e;var n=new r.FlexLayer(this,this.positionCustom,this.boundsCustom,this.scaleCustom);if(s){this.game.world.add(n)}this.layers.push(n);if(typeof i!=="undefined"&&typeof i!==null){n.addMultiple(i)}return n},createFluidLayer:function(t,e){if(e===undefined){e=true}var i=new r.FlexLayer(this,this.positionFluid,this.boundsFluid,this.scaleFluid);if(e){this.game.world.add(i)}this.layers.push(i);if(typeof t!=="undefined"&&typeof t!==null){i.addMultiple(t)}return i},createFullLayer:function(t){var e=new r.FlexLayer(this,this.positionFull,this.boundsFull,this.scaleFluid);this.game.world.add(e);this.layers.push(e);if(typeof t!=="undefined"){e.addMultiple(t)}return e},createFixedLayer:function(t){var e=new r.FlexLayer(this,this.positionNone,this.boundsNone,this.scaleNone);this.game.world.add(e);this.layers.push(e);if(typeof t!=="undefined"){e.addMultiple(t)}return e},reset:function(){var t=this.layers.length;while(t--){if(!this.layers[t].persist){this.layers[t].position=null;this.layers[t].scale=null;this.layers.slice(t,1)}}},onResize:function(t,e){this.ratioH=t/e;this.ratioV=e/t;this.refresh(t,e)},refresh:function(){this.multiplier=Math.min(this.manager.height/this.height,this.manager.width/this.width);this.boundsFluid.width=Math.round(this.width*this.multiplier);this.boundsFluid.height=Math.round(this.height*this.multiplier);this.scaleFluid.set(this.boundsFluid.width/this.width,this.boundsFluid.height/this.height);this.scaleFluidInversed.set(this.width/this.boundsFluid.width,this.height/this.boundsFluid.height);this.scaleFull.set(this.boundsFull.width/this.width,this.boundsFull.height/this.height);this.boundsFull.width=Math.round(this.manager.width*this.scaleFluidInversed.x);this.boundsFull.height=Math.round(this.manager.height*this.scaleFluidInversed.y);this.boundsFluid.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY);this.boundsNone.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY);this.positionFluid.set(this.boundsFluid.x,this.boundsFluid.y);this.positionNone.set(this.boundsNone.x,this.boundsNone.y)},fitSprite:function(t){this.manager.scaleSprite(t);t.x=this.manager.bounds.centerX;t.y=this.manager.bounds.centerY},debug:function(){this.game.debug.text(this.boundsFluid.width+" x "+this.boundsFluid.height,this.boundsFluid.x+4,this.boundsFluid.y+16);this.game.debug.geom(this.boundsFluid,"rgba(255,0,0,0.9",false)}};r.FlexGrid.prototype.constructor=r.FlexGrid;r.FlexLayer=function(t,e,i,s){r.Group.call(this,t.game,null,"__flexLayer"+t.game.rnd.uuid(),false);this.manager=t.manager;this.grid=t;this.persist=false;this.position=e;this.bounds=i;this.scale=s;this.topLeft=i.topLeft;this.topMiddle=new r.Point(i.halfWidth,0);this.topRight=i.topRight;this.bottomLeft=i.bottomLeft;this.bottomMiddle=new r.Point(i.halfWidth,i.bottom);this.bottomRight=i.bottomRight};r.FlexLayer.prototype=Object.create(r.Group.prototype);r.FlexLayer.prototype.constructor=r.FlexLayer;r.FlexLayer.prototype.resize=function(){};r.FlexLayer.prototype.debug=function(){this.game.debug.text(this.bounds.width+" x "+this.bounds.height,this.bounds.x+4,this.bounds.y+16);this.game.debug.geom(this.bounds,"rgba(0,0,255,0.9",false);this.game.debug.geom(this.topLeft,"rgba(255,255,255,0.9");this.game.debug.geom(this.topMiddle,"rgba(255,255,255,0.9");this.game.debug.geom(this.topRight,"rgba(255,255,255,0.9")};r.Color={packPixel:function(t,e,i,s){if(r.Device.LITTLE_ENDIAN){return(s<<24|i<<16|e<<8|t)>>>0}else{return(t<<24|e<<16|i<<8|s)>>>0}},unpackPixel:function(t,e,i,s){if(e===undefined||e===null){e=r.Color.createColor()}if(i===undefined||i===null){i=false}if(s===undefined||s===null){s=false}if(r.Device.LITTLE_ENDIAN){e.a=(t&4278190080)>>>24;e.b=(t&16711680)>>>16;e.g=(t&65280)>>>8;e.r=t&255}else{e.r=(t&4278190080)>>>24;e.g=(t&16711680)>>>16;e.b=(t&65280)>>>8;e.a=t&255}e.color=t;e.rgba="rgba("+e.r+","+e.g+","+e.b+","+e.a/255+")";if(i){r.Color.RGBtoHSL(e.r,e.g,e.b,e)}if(s){r.Color.RGBtoHSV(e.r,e.g,e.b,e)}return e},fromRGBA:function(t,e){if(!e){e=r.Color.createColor()}e.r=(t&4278190080)>>>24;e.g=(t&16711680)>>>16;e.b=(t&65280)>>>8;e.a=t&255;e.rgba="rgba("+e.r+","+e.g+","+e.b+","+e.a+")";return e},toRGBA:function(t,e,i,s){return t<<24|e<<16|i<<8|s},toABGR:function(t,e,i,s){return(s<<24|i<<16|e<<8|t)>>>0},RGBtoHSL:function(t,e,i,s){if(!s){s=r.Color.createColor(t,e,i,1)}t/=255;e/=255;i/=255;var n=Math.min(t,e,i);var a=Math.max(t,e,i);s.h=0;s.s=0;s.l=(a+n)/2;if(a!==n){var o=a-n;s.s=s.l>.5?o/(2-a-n):o/(a+n);if(a===t){s.h=(e-i)/o+(e<i?6:0)}else if(a===e){s.h=(i-t)/o+2}else if(a===i){s.h=(t-e)/o+4}s.h/=6}return s},HSLtoRGB:function(t,e,i,s){if(!s){s=r.Color.createColor(i,i,i)}else{s.r=i;s.g=i;s.b=i}if(e!==0){var n=i<.5?i*(1+e):i+e-i*e;var a=2*i-n;s.r=r.Color.hueToColor(a,n,t+1/3);s.g=r.Color.hueToColor(a,n,t);s.b=r.Color.hueToColor(a,n,t-1/3)}s.r=Math.floor(s.r*255|0);s.g=Math.floor(s.g*255|0);s.b=Math.floor(s.b*255|0);r.Color.updateColor(s);return s},RGBtoHSV:function(t,e,i,s){if(!s){s=r.Color.createColor(t,e,i,255)}t/=255;e/=255;i/=255;var n=Math.min(t,e,i);var a=Math.max(t,e,i);var o=a-n;s.h=0;s.s=a===0?0:o/a;s.v=a;if(a!==n){if(a===t){s.h=(e-i)/o+(e<i?6:0)}else if(a===e){s.h=(i-t)/o+2}else if(a===i){s.h=(t-e)/o+4}s.h/=6}return s},HSVtoRGB:function(t,e,i,s){if(s===undefined){s=r.Color.createColor(0,0,0,1,t,e,0,i)}var n,a,o;var h=Math.floor(t*6);var l=t*6-h;var u=i*(1-e);var c=i*(1-l*e);var d=i*(1-(1-l)*e);switch(h%6){case 0:n=i;a=d;o=u;break;case 1:n=c;a=i;o=u;break;case 2:n=u;a=i;o=d;break;case 3:n=u;a=c;o=i;break;case 4:n=d;a=u;o=i;break;case 5:n=i;a=u;o=c;break}s.r=Math.floor(n*255);s.g=Math.floor(a*255);s.b=Math.floor(o*255);r.Color.updateColor(s);return s},hueToColor:function(t,e,i){if(i<0){i+=1}if(i>1){i-=1}if(i<1/6){return t+(e-t)*6*i}if(i<1/2){return e}if(i<2/3){return t+(e-t)*(2/3-i)*6}return t},createColor:function(t,e,i,s,n,a,o,h){var l={r:t||0,g:e||0,b:i||0,a:s||1,h:n||0,s:a||0,l:o||0,v:h||0,color:0,color32:0,rgba:""};return r.Color.updateColor(l)},updateColor:function(t){t.rgba="rgba("+t.r.toString()+","+t.g.toString()+","+t.b.toString()+","+t.a.toString()+")";t.color=r.Color.getColor(t.r,t.g,t.b);t.color32=r.Color.getColor32(t.a*255,t.r,t.g,t.b);return t},getColor32:function(t,e,i,s){return t<<24|e<<16|i<<8|s},getColor:function(t,e,i){return t<<16|e<<8|i},RGBtoString:function(t,e,i,s,n){if(s===undefined){s=255}if(n===undefined){n="#"}if(n==="#"){return"#"+((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1)}else{return"0x"+r.Color.componentToHex(s)+r.Color.componentToHex(t)+r.Color.componentToHex(e)+r.Color.componentToHex(i)}},hexToRGB:function(t){var e=r.Color.hexToColor(t);if(e){return r.Color.getColor32(e.a,e.r,e.g,e.b)}},hexToColor:function(t,e){t=t.replace(/^(?:#|0x)?([a-f\d])([a-f\d])([a-f\d])$/i,function(t,e,i,s){return e+e+i+i+s+s});var i=/^(?:#|0x)?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(i){var s=parseInt(i[1],16);var n=parseInt(i[2],16);var a=parseInt(i[3],16);if(!e){e=r.Color.createColor(s,n,a)}else{e.r=s;e.g=n;e.b=a}}return e},webToColor:function(t,e){if(!e){e=r.Color.createColor()}var i=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(t);if(i){e.r=parseInt(i[1],10);e.g=parseInt(i[2],10);e.b=parseInt(i[3],10);e.a=i[4]!==undefined?parseFloat(i[4]):1;r.Color.updateColor(e)}return e},valueToColor:function(t,e){if(!e){e=r.Color.createColor()}if(typeof t==="string"){if(t.indexOf("rgb")===0){return r.Color.webToColor(t,e)}else{e.a=1;return r.Color.hexToColor(t,e)}}else if(typeof t==="number"){var i=r.Color.getRGB(t);e.r=i.r;e.g=i.g;e.b=i.b;e.a=i.a/255;return e}else{return e}},componentToHex:function(t){var e=t.toString(16);return e.length===1?"0"+e:e},HSVColorWheel:function(t,e){if(t===undefined){t=1}if(e===undefined){e=1}var i=[];for(var s=0;s<=359;s++){i.push(r.Color.HSVtoRGB(s/359,t,e))}return i},HSLColorWheel:function(t,e){if(t===undefined){t=.5}if(e===undefined){e=.5}var i=[];for(var s=0;s<=359;s++){i.push(r.Color.HSLtoRGB(s/359,t,e))}return i},interpolateColor:function(t,e,i,s,n){if(n===undefined){n=255}var a=r.Color.getRGB(t);var o=r.Color.getRGB(e);var h=(o.red-a.red)*s/i+a.red;var l=(o.green-a.green)*s/i+a.green;var u=(o.blue-a.blue)*s/i+a.blue;return r.Color.getColor32(n,h,l,u)},interpolateColorWithRGB:function(t,e,i,s,n,a){var o=r.Color.getRGB(t);var h=(e-o.red)*a/n+o.red;var l=(i-o.green)*a/n+o.green;var u=(s-o.blue)*a/n+o.blue;return r.Color.getColor(h,l,u)},interpolateRGB:function(t,e,i,s,n,a,o,h){var l=(s-t)*h/o+t;var u=(n-e)*h/o+e;var c=(a-i)*h/o+i;return r.Color.getColor(l,u,c)},getRandomColor:function(t,e,i){if(t===undefined){t=0}if(e===undefined){e=255}if(i===undefined){i=255}if(e>255||t>e){return r.Color.getColor(255,255,255)}var s=t+Math.round(Math.random()*(e-t));var n=t+Math.round(Math.random()*(e-t));var a=t+Math.round(Math.random()*(e-t));return r.Color.getColor32(i,s,n,a)},getRGB:function(t){if(t>16777215){return{alpha:t>>>24,red:t>>16&255,green:t>>8&255,blue:t&255,a:t>>>24,r:t>>16&255,g:t>>8&255,b:t&255}}else{return{alpha:255,red:t>>16&255,green:t>>8&255,blue:t&255,a:255,r:t>>16&255,g:t>>8&255,b:t&255}}},getWebRGB:function(t){if(typeof t==="object"){return"rgba("+t.r.toString()+","+t.g.toString()+","+t.b.toString()+","+(t.a/255).toString()+")"}else{var e=r.Color.getRGB(t);return"rgba("+e.r.toString()+","+e.g.toString()+","+e.b.toString()+","+(e.a/255).toString()+")"}},getAlpha:function(t){return t>>>24},getAlphaFloat:function(t){return(t>>>24)/255},getRed:function(t){return t>>16&255},getGreen:function(t){return t>>8&255},getBlue:function(t){return t&255},blendNormal:function(t){return t},blendLighten:function(t,e){return e>t?e:t},blendDarken:function(t,e){return e>t?t:e},blendMultiply:function(t,e){return t*e/255},blendAverage:function(t,e){return(t+e)/2},blendAdd:function(t,e){return Math.min(255,t+e)},blendSubtract:function(t,e){return Math.max(0,t+e-255)},blendDifference:function(t,e){return Math.abs(t-e)},blendNegation:function(t,e){return 255-Math.abs(255-t-e)},blendScreen:function(t,e){return 255-((255-t)*(255-e)>>8)},blendExclusion:function(t,e){return t+e-2*t*e/255},blendOverlay:function(t,e){return e<128?2*t*e/255:255-2*(255-t)*(255-e)/255},blendSoftLight:function(t,e){return e<128?2*((t>>1)+64)*(e/255):255-2*(255-((t>>1)+64))*(255-e)/255},blendHardLight:function(t,e){return r.Color.blendOverlay(e,t)},blendColorDodge:function(t,e){return e===255?e:Math.min(255,(t<<8)/(255-e))},blendColorBurn:function(t,e){return e===0?e:Math.max(0,255-(255-t<<8)/e)},blendLinearDodge:function(t,e){return r.Color.blendAdd(t,e)},blendLinearBurn:function(t,e){return r.Color.blendSubtract(t,e)},blendLinearLight:function(t,e){return e<128?r.Color.blendLinearBurn(t,2*e):r.Color.blendLinearDodge(t,2*(e-128))},blendVividLight:function(t,e){return e<128?r.Color.blendColorBurn(t,2*e):r.Color.blendColorDodge(t,2*(e-128))},blendPinLight:function(t,e){return e<128?r.Color.blendDarken(t,2*e):r.Color.blendLighten(t,2*(e-128))},blendHardMix:function(t,e){return r.Color.blendVividLight(t,e)<128?0:255},blendReflect:function(t,e){return e===255?e:Math.min(255,t*t/(255-e))},blendGlow:function(t,e){return r.Color.blendReflect(e,t)},blendPhoenix:function(t,e){return Math.min(t,e)-Math.max(t,e)+255}};r.Physics=function(t,e){e=e||{};this.game=t;this.config=e;this.arcade=null;this.p2=null;this.ninja=null;this.box2d=null;this.chipmunk=null;this.matter=null;this.parseConfig()};r.Physics.ARCADE=0;r.Physics.P2JS=1;r.Physics.NINJA=2;r.Physics.BOX2D=3;r.Physics.CHIPMUNK=4;r.Physics.MATTERJS=5;r.Physics.prototype={parseConfig:function(){if((!this.config.hasOwnProperty("arcade")||this.config["arcade"]===true)&&r.Physics.hasOwnProperty("Arcade")){this.arcade=new r.Physics.Arcade(this.game)}if(this.config.hasOwnProperty("ninja")&&this.config["ninja"]===true&&r.Physics.hasOwnProperty("Ninja")){this.ninja=new r.Physics.Ninja(this.game)}if(this.config.hasOwnProperty("p2")&&this.config["p2"]===true&&r.Physics.hasOwnProperty("P2")){this.p2=new r.Physics.P2(this.game,this.config)}if(this.config.hasOwnProperty("box2d")&&this.config["box2d"]===true&&r.Physics.hasOwnProperty("BOX2D")){this.box2d=new r.Physics.BOX2D(this.game,this.config)}if(this.config.hasOwnProperty("matter")&&this.config["matter"]===true&&r.Physics.hasOwnProperty("Matter")){this.matter=new r.Physics.Matter(this.game,this.config)}},startSystem:function(t){if(t===r.Physics.ARCADE){this.arcade=new r.Physics.Arcade(this.game)}else if(t===r.Physics.P2JS){if(this.p2===null){this.p2=new r.Physics.P2(this.game,this.config)}else{this.p2.reset()}}else if(t===r.Physics.NINJA){this.ninja=new r.Physics.Ninja(this.game)}else if(t===r.Physics.BOX2D){if(this.box2d===null){this.box2d=new r.Physics.Box2D(this.game,this.config)}else{this.box2d.reset()}}else if(t===r.Physics.MATTERJS){if(this.matter===null){this.matter=new r.Physics.Matter(this.game,this.config)}else{this.matter.reset()}}},enable:function(t,e,i){if(e===undefined){e=r.Physics.ARCADE}if(i===undefined){i=false}if(e===r.Physics.ARCADE){this.arcade.enable(t)}else if(e===r.Physics.P2JS&&this.p2){this.p2.enable(t,i)}else if(e===r.Physics.NINJA&&this.ninja){this.ninja.enableAABB(t)}else if(e===r.Physics.BOX2D&&this.box2d){this.box2d.enable(t)}else if(e===r.Physics.MATTERJS&&this.matter){this.matter.enable(t)}else{console.warn(t.key+" is attempting to enable a physics body using an unknown physics system.")}},preUpdate:function(){if(this.p2){this.p2.preUpdate()}if(this.box2d){this.box2d.preUpdate()}if(this.matter){this.matter.preUpdate()}},update:function(){if(this.p2){this.p2.update()}if(this.box2d){this.box2d.update()}if(this.matter){this.matter.update()}},setBoundsToWorld:function(){if(this.arcade){this.arcade.setBoundsToWorld()}if(this.ninja){this.ninja.setBoundsToWorld()}if(this.p2){this.p2.setBoundsToWorld()}if(this.box2d){this.box2d.setBoundsToWorld()}if(this.matter){this.matter.setBoundsToWorld()}},clear:function(){if(this.p2){this.p2.clear()}if(this.box2d){this.box2d.clear()}if(this.matter){this.matter.clear()}},reset:function(){if(this.p2){this.p2.reset()}if(this.box2d){this.box2d.reset()}if(this.matter){this.matter.reset()}},destroy:function(){if(this.p2){this.p2.destroy()}if(this.box2d){this.box2d.destroy()}if(this.matter){this.matter.destroy()}this.arcade=null;this.ninja=null;this.p2=null;this.box2d=null;this.matter=null}};r.Physics.prototype.constructor=r.Physics;r.Physics.Arcade=function(t){this.game=t;this.gravity=new r.Point;this.bounds=new r.Rectangle(0,0,t.world.width,t.world.height);this.checkCollision={up:true,down:true,left:true,right:true};this.maxObjects=10;this.maxLevels=4;this.OVERLAP_BIAS=4;this.forceX=false;this.sortDirection=r.Physics.Arcade.LEFT_RIGHT;this.skipQuadTree=true;this.isPaused=false;this.quadTree=new r.QuadTree(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this._total=0;this.setBoundsToWorld()};r.Physics.Arcade.prototype.constructor=r.Physics.Arcade;r.Physics.Arcade.SORT_NONE=0;r.Physics.Arcade.LEFT_RIGHT=1;r.Physics.Arcade.RIGHT_LEFT=2;r.Physics.Arcade.TOP_BOTTOM=3;r.Physics.Arcade.BOTTOM_TOP=4;r.Physics.Arcade.prototype={setBounds:function(t,e,i,s){this.bounds.setTo(t,e,i,s)},setBoundsToWorld:function(){this.bounds.copyFrom(this.game.world.bounds)},enable:function(t,e){if(e===undefined){e=true}var i=1;if(Array.isArray(t)){i=t.length;while(i--){if(t[i]instanceof r.Group){this.enable(t[i].children,e)}else{this.enableBody(t[i]);if(e&&t[i].hasOwnProperty("children")&&t[i].children.length>0){this.enable(t[i],true)}}}}else{if(t instanceof r.Group){this.enable(t.children,e)}else{this.enableBody(t);if(e&&t.hasOwnProperty("children")&&t.children.length>0){this.enable(t.children,true)}}}},enableBody:function(t){if(t.hasOwnProperty("body")&&t.body===null){t.body=new r.Physics.Arcade.Body(t);if(t.parent&&t.parent instanceof r.Group){t.parent.addToHash(t)}}},updateMotion:function(t){var e=this.computeVelocity(0,t,t.angularVelocity,t.angularAcceleration,t.angularDrag,t.maxAngular)-t.angularVelocity;t.angularVelocity+=e;t.rotation+=t.angularVelocity*this.game.time.physicsElapsed;t.velocity.x=this.computeVelocity(1,t,t.velocity.x,t.acceleration.x,t.drag.x,t.maxVelocity.x);t.velocity.y=this.computeVelocity(2,t,t.velocity.y,t.acceleration.y,t.drag.y,t.maxVelocity.y)},computeVelocity:function(t,e,i,s,r,n){if(n===undefined){n=1e4}if(t===1&&e.allowGravity){i+=(this.gravity.x+e.gravity.x)*this.game.time.physicsElapsed}else if(t===2&&e.allowGravity){i+=(this.gravity.y+e.gravity.y)*this.game.time.physicsElapsed}if(s){i+=s*this.game.time.physicsElapsed}else if(r){r*=this.game.time.physicsElapsed;if(i-r>0){i-=r}else if(i+r<0){i+=r}else{i=0}}if(i>n){i=n}else if(i<-n){i=-n}return i},overlap:function(t,e,i,s,r){i=i||null;s=s||null;r=r||i;this._total=0;if(!Array.isArray(t)&&Array.isArray(e)){for(var n=0;n<e.length;n++){this.collideHandler(t,e[n],i,s,r,true)}}else if(Array.isArray(t)&&!Array.isArray(e)){for(var n=0;n<t.length;n++){this.collideHandler(t[n],e,i,s,r,true)}}else if(Array.isArray(t)&&Array.isArray(e)){for(var n=0;n<t.length;n++){for(var a=0;a<e.length;a++){this.collideHandler(t[n],e[a],i,s,r,true)}}}else{this.collideHandler(t,e,i,s,r,true)}return this._total>0},collide:function(t,e,i,s,r){i=i||null;s=s||null;r=r||i;this._total=0;if(!Array.isArray(t)&&Array.isArray(e)){for(var n=0;n<e.length;n++){this.collideHandler(t,e[n],i,s,r,false)}}else if(Array.isArray(t)&&!Array.isArray(e)){for(var n=0;n<t.length;n++){this.collideHandler(t[n],e,i,s,r,false)}}else if(Array.isArray(t)&&Array.isArray(e)){for(var n=0;n<t.length;n++){for(var a=0;a<e.length;a++){this.collideHandler(t[n],e[a],i,s,r,false)}}}else{this.collideHandler(t,e,i,s,r,false)}return this._total>0},sortLeftRight:function(t,e){if(!t.body||!e.body){return 0}return t.body.x-e.body.x},sortRightLeft:function(t,e){if(!t.body||!e.body){return 0}return e.body.x-t.body.x},sortTopBottom:function(t,e){if(!t.body||!e.body){return 0}return t.body.y-e.body.y},sortBottomTop:function(t,e){if(!t.body||!e.body){return 0}return e.body.y-t.body.y},sort:function(t,e){if(t.physicsSortDirection!==null){e=t.physicsSortDirection}else{if(e===undefined){e=this.sortDirection}}if(e===r.Physics.Arcade.LEFT_RIGHT){t.hash.sort(this.sortLeftRight)}else if(e===r.Physics.Arcade.RIGHT_LEFT){t.hash.sort(this.sortRightLeft)}else if(e===r.Physics.Arcade.TOP_BOTTOM){t.hash.sort(this.sortTopBottom)}else if(e===r.Physics.Arcade.BOTTOM_TOP){t.hash.sort(this.sortBottomTop)}},collideHandler:function(t,e,i,s,n,a){if(e===undefined&&t.physicsType===r.GROUP){this.sort(t);this.collideGroupVsSelf(t,i,s,n,a);return}if(!t||!e||!t.exists||!e.exists){return}if(this.sortDirection!==r.Physics.Arcade.SORT_NONE){if(t.physicsType===r.GROUP){this.sort(t)}if(e.physicsType===r.GROUP){this.sort(e)}}if(t.physicsType===r.SPRITE){if(e.physicsType===r.SPRITE){this.collideSpriteVsSprite(t,e,i,s,n,a)}else if(e.physicsType===r.GROUP){this.collideSpriteVsGroup(t,e,i,s,n,a)}else if(e.physicsType===r.TILEMAPLAYER){this.collideSpriteVsTilemapLayer(t,e,i,s,n,a)}}else if(t.physicsType===r.GROUP){if(e.physicsType===r.SPRITE){this.collideSpriteVsGroup(e,t,i,s,n,a)}else if(e.physicsType===r.GROUP){this.collideGroupVsGroup(t,e,i,s,n,a)}else if(e.physicsType===r.TILEMAPLAYER){this.collideGroupVsTilemapLayer(t,e,i,s,n,a)}}else if(t.physicsType===r.TILEMAPLAYER){if(e.physicsType===r.SPRITE){this.collideSpriteVsTilemapLayer(e,t,i,s,n,a)}else if(e.physicsType===r.GROUP){this.collideGroupVsTilemapLayer(e,t,i,s,n,a)}}},collideSpriteVsSprite:function(t,e,i,s,r,n){if(!t.body||!e.body){return false}if(this.separate(t.body,e.body,s,r,n)){if(i){i.call(r,t,e)}this._total++}return true},collideSpriteVsGroup:function(t,e,i,s,n,a){if(e.length===0||!t.body){return}if(this.skipQuadTree||t.body.skipQuadTree){var o={};for(var h=0;h<e.hash.length;h++){var l=e.hash[h];if(!l||!l.exists||!l.body){continue}o=l.body.getBounds(o);if(this.sortDirection===r.Physics.Arcade.LEFT_RIGHT){if(t.body.right<o.x){break}else if(o.right<t.body.x){continue}}else if(this.sortDirection===r.Physics.Arcade.RIGHT_LEFT){if(t.body.x>o.right){break}else if(o.x>t.body.right){continue}}else if(this.sortDirection===r.Physics.Arcade.TOP_BOTTOM){if(t.body.bottom<o.y){break}else if(o.bottom<t.body.y){continue}}else if(this.sortDirection===r.Physics.Arcade.BOTTOM_TOP){if(t.body.y>o.bottom){break}else if(o.y>t.body.bottom){continue}}this.collideSpriteVsSprite(t,l,i,s,n,a)}}else{this.quadTree.clear();this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this.quadTree.populate(e);var u=this.quadTree.retrieve(t);for(var h=0;h<u.length;h++){if(this.separate(t.body,u[h],s,n,a)){if(i){i.call(n,t,u[h].sprite)}this._total++}}}},collideGroupVsSelf:function(t,e,i,s,n){if(t.length===0){return}for(var a=0;a<t.hash.length;a++){var o={};var h=t.hash[a];if(!h||!h.exists||!h.body){continue}o=h.body.getBounds(o);for(var l=a+1;l<t.hash.length;l++){var u={};var c=t.hash[l];if(!c||!c.exists||!c.body){continue}u=c.body.getBounds(u);if(this.sortDirection===r.Physics.Arcade.LEFT_RIGHT){if(o.right<u.x){break}else if(u.right<o.x){continue}}else if(this.sortDirection===r.Physics.Arcade.RIGHT_LEFT){if(o.x>u.right){continue}else if(u.x>o.right){break}}else if(this.sortDirection===r.Physics.Arcade.TOP_BOTTOM){if(o.bottom<u.y){continue}else if(u.bottom<o.y){break}}else if(this.sortDirection===r.Physics.Arcade.BOTTOM_TOP){if(o.y>u.bottom){continue}else if(u.y>h.body.bottom){break}}this.collideSpriteVsSprite(h,c,e,i,s,n)}}},collideGroupVsGroup:function(t,e,i,s,n,a){if(t.length===0||e.length===0){return}for(var o=0;o<t.children.length;o++){if(t.children[o].exists){if(t.children[o].physicsType===r.GROUP){this.collideGroupVsGroup(t.children[o],e,i,s,n,a)}else{this.collideSpriteVsGroup(t.children[o],e,i,s,n,a)}}}},separate:function(t,e,i,s,r){if(!t.enable||!e.enable||t.checkCollision.none||e.checkCollision.none||!this.intersects(t,e)){return false}if(i&&i.call(s,t.sprite,e.sprite)===false){return false}if(t.isCircle&&e.isCircle){return this.separateCircle(t,e,r)}if(t.isCircle!==e.isCircle){var n=t.isCircle?e:t;var a=t.isCircle?t:e;var o={x:n.x,y:n.y,right:n.right,bottom:n.bottom};var h={x:a.x+a.radius,y:a.y+a.radius};if(h.y<o.y||h.y>o.bottom){if(h.x<o.x||h.x>o.right){return this.separateCircle(t,e,r)}}}var l=false;var u=false;if(this.forceX||Math.abs(this.gravity.y+t.gravity.y)<Math.abs(this.gravity.x+t.gravity.x)){l=this.separateX(t,e,r);if(this.intersects(t,e)){u=this.separateY(t,e,r)}}else{u=this.separateY(t,e,r);if(this.intersects(t,e)){l=this.separateX(t,e,r)}}var c=l||u;if(c){if(r){if(t.onOverlap){t.onOverlap.dispatch(t.sprite,e.sprite)}if(e.onOverlap){e.onOverlap.dispatch(e.sprite,t.sprite)}}else{if(t.onCollide){t.onCollide.dispatch(t.sprite,e.sprite)}if(e.onCollide){e.onCollide.dispatch(e.sprite,t.sprite)}}}return c},intersects:function(t,e){if(t===e){return false}if(t.isCircle){if(e.isCircle){return r.Math.distance(t.center.x,t.center.y,e.center.x,e.center.y)<=t.radius+e.radius}else{return this.circleBodyIntersects(t,e)}}else{if(e.isCircle){return this.circleBodyIntersects(e,t)}else{if(t.right<=e.position.x){return false}if(t.bottom<=e.position.y){return false}if(t.position.x>=e.right){return false}if(t.position.y>=e.bottom){return false}return true}}},circleBodyIntersects:function(t,e){var i=r.Math.clamp(t.center.x,e.left,e.right);var s=r.Math.clamp(t.center.y,e.top,e.bottom);var n=(t.center.x-i)*(t.center.x-i);var a=(t.center.y-s)*(t.center.y-s);return n+a<=t.radius*t.radius},separateCircle:function(t,e,i){this.getOverlapX(t,e);this.getOverlapY(t,e);var s=e.center.x-t.center.x;var n=e.center.y-t.center.y;var a=Math.atan2(n,s);var o=0;if(t.isCircle!==e.isCircle){var h={x:e.isCircle?t.position.x:e.position.x,y:e.isCircle?t.position.y:e.position.y,right:e.isCircle?t.right:e.right,bottom:e.isCircle?t.bottom:e.bottom};var l={x:t.isCircle?t.position.x+t.radius:e.position.x+e.radius,y:t.isCircle?t.position.y+t.radius:e.position.y+e.radius,radius:t.isCircle?t.radius:e.radius};if(l.y<h.y){if(l.x<h.x){o=r.Math.distance(l.x,l.y,h.x,h.y)-l.radius}else if(l.x>h.right){o=r.Math.distance(l.x,l.y,h.right,h.y)-l.radius}}else if(l.y>h.bottom){if(l.x<h.x){o=r.Math.distance(l.x,l.y,h.x,h.bottom)-l.radius}else if(l.x>h.right){o=r.Math.distance(l.x,l.y,h.right,h.bottom)-l.radius}}o*=-1}else{o=t.radius+e.radius-r.Math.distance(t.center.x,t.center.y,e.center.x,e.center.y)}if(i||o===0||t.immovable&&e.immovable||t.customSeparateX||e.customSeparateX){if(o!==0){if(t.onOverlap){t.onOverlap.dispatch(t.sprite,e.sprite)}if(e.onOverlap){e.onOverlap.dispatch(e.sprite,t.sprite)}}return o!==0}var u={x:t.velocity.x*Math.cos(a)+t.velocity.y*Math.sin(a),y:t.velocity.x*Math.sin(a)-t.velocity.y*Math.cos(a)};var c={x:e.velocity.x*Math.cos(a)+e.velocity.y*Math.sin(a),y:e.velocity.x*Math.sin(a)-e.velocity.y*Math.cos(a)};var d=((t.mass-e.mass)*u.x+2*e.mass*c.x)/(t.mass+e.mass);var f=(2*t.mass*u.x+(e.mass-t.mass)*c.x)/(t.mass+e.mass);if(!t.immovable){t.velocity.x=(d*Math.cos(a)-u.y*Math.sin(a))*t.bounce.x;t.velocity.y=(u.y*Math.cos(a)+d*Math.sin(a))*t.bounce.y}if(!e.immovable){e.velocity.x=(f*Math.cos(a)-c.y*Math.sin(a))*e.bounce.x;e.velocity.y=(c.y*Math.cos(a)+f*Math.sin(a))*e.bounce.y}if(Math.abs(a)<Math.PI/2){if(t.velocity.x>0&&!t.immovable&&e.velocity.x>t.velocity.x){t.velocity.x*=-1}else if(e.velocity.x<0&&!e.immovable&&t.velocity.x<e.velocity.x){e.velocity.x*=-1}else if(t.velocity.y>0&&!t.immovable&&e.velocity.y>t.velocity.y){t.velocity.y*=-1}else if(e.velocity.y<0&&!e.immovable&&t.velocity.y<e.velocity.y){e.velocity.y*=-1}}else if(Math.abs(a)>Math.PI/2){if(t.velocity.x<0&&!t.immovable&&e.velocity.x<t.velocity.x){t.velocity.x*=-1}else if(e.velocity.x>0&&!e.immovable&&t.velocity.x>e.velocity.x){e.velocity.x*=-1}else if(t.velocity.y<0&&!t.immovable&&e.velocity.y<t.velocity.y){t.velocity.y*=-1}else if(e.velocity.y>0&&!e.immovable&&t.velocity.x>e.velocity.y){e.velocity.y*=-1}}if(!t.immovable){t.x+=t.velocity.x*this.game.time.physicsElapsed-o*Math.cos(a);t.y+=t.velocity.y*this.game.time.physicsElapsed-o*Math.sin(a)}if(!e.immovable){e.x+=e.velocity.x*this.game.time.physicsElapsed+o*Math.cos(a);e.y+=e.velocity.y*this.game.time.physicsElapsed+o*Math.sin(a)}if(t.onCollide){t.onCollide.dispatch(t.sprite,e.sprite)}if(e.onCollide){e.onCollide.dispatch(e.sprite,t.sprite)}return true},getOverlapX:function(t,e,i){var s=0;var r=t.deltaAbsX()+e.deltaAbsX()+this.OVERLAP_BIAS;if(t.deltaX()===0&&e.deltaX()===0){t.embedded=true;e.embedded=true}else if(t.deltaX()>e.deltaX()){s=t.right-e.x;if(s>r&&!i||t.checkCollision.right===false||e.checkCollision.left===false){s=0}else{t.touching.none=false;t.touching.right=true;e.touching.none=false;e.touching.left=true}}else if(t.deltaX()<e.deltaX()){s=t.x-e.width-e.x;if(-s>r&&!i||t.checkCollision.left===false||e.checkCollision.right===false){s=0}else{t.touching.none=false;t.touching.left=true;e.touching.none=false;e.touching.right=true}}t.overlapX=s;e.overlapX=s;return s},getOverlapY:function(t,e,i){var s=0;var r=t.deltaAbsY()+e.deltaAbsY()+this.OVERLAP_BIAS;if(t.deltaY()===0&&e.deltaY()===0){t.embedded=true;e.embedded=true}else if(t.deltaY()>e.deltaY()){s=t.bottom-e.y;if(s>r&&!i||t.checkCollision.down===false||e.checkCollision.up===false){s=0}else{t.touching.none=false;t.touching.down=true;e.touching.none=false;e.touching.up=true}}else if(t.deltaY()<e.deltaY()){s=t.y-e.bottom;if(-s>r&&!i||t.checkCollision.up===false||e.checkCollision.down===false){s=0}else{t.touching.none=false;t.touching.up=true;e.touching.none=false;e.touching.down=true}}t.overlapY=s;e.overlapY=s;return s},separateX:function(t,e,i){var s=this.getOverlapX(t,e,i);if(i||s===0||t.immovable&&e.immovable||t.customSeparateX||e.customSeparateX){return s!==0||t.embedded&&e.embedded}var r=t.velocity.x;var n=e.velocity.x;if(!t.immovable&&!e.immovable){s*=.5;t.x-=s;e.x+=s;var a=Math.sqrt(n*n*e.mass/t.mass)*(n>0?1:-1);var o=Math.sqrt(r*r*t.mass/e.mass)*(r>0?1:-1);var h=(a+o)*.5;a-=h;o-=h;t.velocity.x=h+a*t.bounce.x;e.velocity.x=h+o*e.bounce.x}else if(!t.immovable){t.x-=s;t.velocity.x=n-r*t.bounce.x;if(e.moves){t.y+=(e.y-e.prev.y)*e.friction.y}}else{e.x+=s;e.velocity.x=r-n*e.bounce.x;if(t.moves){e.y+=(t.y-t.prev.y)*t.friction.y}}return true},separateY:function(t,e,i){var s=this.getOverlapY(t,e,i);if(i||s===0||t.immovable&&e.immovable||t.customSeparateY||e.customSeparateY){return s!==0||t.embedded&&e.embedded}var r=t.velocity.y;var n=e.velocity.y;if(!t.immovable&&!e.immovable){s*=.5;t.y-=s;e.y+=s;var a=Math.sqrt(n*n*e.mass/t.mass)*(n>0?1:-1);var o=Math.sqrt(r*r*t.mass/e.mass)*(r>0?1:-1);var h=(a+o)*.5;a-=h;o-=h;t.velocity.y=h+a*t.bounce.y;e.velocity.y=h+o*e.bounce.y}else if(!t.immovable){t.y-=s;t.velocity.y=n-r*t.bounce.y;if(e.moves){t.x+=(e.x-e.prev.x)*e.friction.x}}else{e.y+=s;e.velocity.y=r-n*e.bounce.y;if(t.moves){e.x+=(t.x-t.prev.x)*t.friction.x}}return true},getObjectsUnderPointer:function(t,e,i,s){if(e.length===0||!t.exists){return}return this.getObjectsAtLocation(t.x,t.y,e,i,s,t)},getObjectsAtLocation:function(t,e,i,s,n,a){this.quadTree.clear();this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this.quadTree.populate(i);var o=new r.Rectangle(t,e,1,1);var h=[];var l=this.quadTree.retrieve(o);for(var u=0;u<l.length;u++){if(l[u].hitTest(t,e)){if(s){s.call(n,a,l[u].sprite)}h.push(l[u].sprite)}}return h},moveToObject:function(t,e,i,s){if(i===undefined){i=60}if(s===undefined){s=0}var r=Math.atan2(e.y-t.y,e.x-t.x);if(s>0){i=this.distanceBetween(t,e)/(s/1e3)}t.body.velocity.x=Math.cos(r)*i;t.body.velocity.y=Math.sin(r)*i;return r},moveToPointer:function(t,e,i,s){if(e===undefined){e=60}i=i||this.game.input.activePointer;if(s===undefined){s=0}var r=this.angleToPointer(t,i);if(s>0){e=this.distanceToPointer(t,i)/(s/1e3)}t.body.velocity.x=Math.cos(r)*e;t.body.velocity.y=Math.sin(r)*e;return r},moveToXY:function(t,e,i,s,r){if(s===undefined){s=60}if(r===undefined){r=0}var n=Math.atan2(i-t.y,e-t.x);if(r>0){s=this.distanceToXY(t,e,i)/(r/1e3)}t.body.velocity.x=Math.cos(n)*s;t.body.velocity.y=Math.sin(n)*s;return n},velocityFromAngle:function(t,e,i){if(e===undefined){e=60}i=i||new r.Point;return i.setTo(Math.cos(this.game.math.degToRad(t))*e,Math.sin(this.game.math.degToRad(t))*e)},velocityFromRotation:function(t,e,i){if(e===undefined){e=60}i=i||new r.Point;return i.setTo(Math.cos(t)*e,Math.sin(t)*e)},accelerationFromRotation:function(t,e,i){if(e===undefined){e=60}i=i||new r.Point;return i.setTo(Math.cos(t)*e,Math.sin(t)*e)},accelerateToObject:function(t,e,i,s,r){if(i===undefined){i=60}if(s===undefined){s=1e3}if(r===undefined){r=1e3}var n=this.angleBetween(t,e);t.body.acceleration.setTo(Math.cos(n)*i,Math.sin(n)*i);t.body.maxVelocity.setTo(s,r);return n},accelerateToPointer:function(t,e,i,s,r){if(i===undefined){i=60}if(e===undefined){e=this.game.input.activePointer}if(s===undefined){s=1e3}if(r===undefined){r=1e3}var n=this.angleToPointer(t,e);t.body.acceleration.setTo(Math.cos(n)*i,Math.sin(n)*i);t.body.maxVelocity.setTo(s,r);return n},accelerateToXY:function(t,e,i,s,r,n){if(s===undefined){s=60}if(r===undefined){r=1e3}if(n===undefined){n=1e3}var a=this.angleToXY(t,e,i);t.body.acceleration.setTo(Math.cos(a)*s,Math.sin(a)*s);t.body.maxVelocity.setTo(r,n);return a},distanceBetween:function(t,e,i){if(i===undefined){i=false}var s=i?t.world.x-e.world.x:t.x-e.x;var r=i?t.world.y-e.world.y:t.y-e.y;return Math.sqrt(s*s+r*r)},distanceToXY:function(t,e,i,s){if(s===undefined){s=false}var r=s?t.world.x-e:t.x-e;var n=s?t.world.y-i:t.y-i;return Math.sqrt(r*r+n*n)},distanceToPointer:function(t,e,i){if(e===undefined){e=this.game.input.activePointer}if(i===undefined){i=false}var s=i?t.world.x-e.worldX:t.x-e.worldX;var r=i?t.world.y-e.worldY:t.y-e.worldY;return Math.sqrt(s*s+r*r)},angleBetween:function(t,e,i){if(i===undefined){i=false}if(i){return Math.atan2(e.world.y-t.world.y,e.world.x-t.world.x)}else{return Math.atan2(e.y-t.y,e.x-t.x)}},angleBetweenCenters:function(t,e){var i=e.centerX-t.centerX;var s=e.centerY-t.centerY;return Math.atan2(s,i)},angleToXY:function(t,e,i,s){if(s===undefined){s=false}if(s){return Math.atan2(i-t.world.y,e-t.world.x)}else{return Math.atan2(i-t.y,e-t.x)}},angleToPointer:function(t,e,i){if(e===undefined){e=this.game.input.activePointer}if(i===undefined){i=false}if(i){return Math.atan2(e.worldY-t.world.y,e.worldX-t.world.x)}else{return Math.atan2(e.worldY-t.y,e.worldX-t.x)}},worldAngleToPointer:function(t,e){return this.angleToPointer(t,e,true)}};r.Physics.Arcade.Body=function(t){this.sprite=t;this.game=t.game;this.type=r.Physics.ARCADE;this.enable=true;this.isCircle=false;this.radius=0;this.offset=new r.Point;this.position=new r.Point(t.x,t.y);this.prev=new r.Point(this.position.x,this.position.y);this.allowRotation=true;this.rotation=t.angle;this.preRotation=t.angle;this.width=t.width;this.height=t.height;this.sourceWidth=t.width;this.sourceHeight=t.height;if(t.texture){this.sourceWidth=t.texture.frame.width;this.sourceHeight=t.texture.frame.height}this.halfWidth=Math.abs(t.width/2);this.halfHeight=Math.abs(t.height/2);this.center=new r.Point(t.x+this.halfWidth,t.y+this.halfHeight);this.velocity=new r.Point;this.newVelocity=new r.Point;this.deltaMax=new r.Point;this.acceleration=new r.Point;this.drag=new r.Point;this.allowGravity=true;this.gravity=new r.Point;this.bounce=new r.Point;this.worldBounce=null;this.onWorldBounds=null;this.onCollide=null;this.onOverlap=null;this.maxVelocity=new r.Point(1e4,1e4);this.friction=new r.Point(1,0);this.angularVelocity=0;this.angularAcceleration=0;this.angularDrag=0;this.maxAngular=1e3;this.mass=1;this.angle=0;this.speed=0;this.facing=r.NONE;this.immovable=false;this.moves=true;this.customSeparateX=false;this.customSeparateY=false;this.overlapX=0;this.overlapY=0;this.overlapR=0;this.embedded=false;this.collideWorldBounds=false;this.checkCollision={none:false,any:true,up:true,down:true,left:true,right:true};this.touching={none:true,up:false,down:false,left:false,right:false};this.wasTouching={none:true,up:false,down:false,left:false,right:false};this.blocked={up:false,down:false,left:false,right:false};this.tilePadding=new r.Point;this.dirty=false;this.skipQuadTree=false;this.syncBounds=false;this.isMoving=false;this.stopVelocityOnCollide=true;this.moveTimer=0;this.moveDistance=0;this.moveDuration=0;this.moveTarget=null;this.moveEnd=null;this.onMoveComplete=new r.Signal;this.movementCallback=null;this.movementCallbackContext=null;this._reset=true;this._sx=t.scale.x;this._sy=t.scale.y;this._dx=0;this._dy=0};r.Physics.Arcade.Body.prototype={updateBounds:function(){if(this.syncBounds){var t=this.sprite.getBounds();t.ceilAll();if(t.width!==this.width||t.height!==this.height){this.width=t.width;this.height=t.height;this._reset=true}}else{var e=Math.abs(this.sprite.scale.x);var i=Math.abs(this.sprite.scale.y);if(e!==this._sx||i!==this._sy){this.width=this.sourceWidth*e;this.height=this.sourceHeight*i;this._sx=e;this._sy=i;this._reset=true}}if(this._reset){this.halfWidth=Math.floor(this.width/2);this.halfHeight=Math.floor(this.height/2);this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)}},preUpdate:function(){if(!this.enable||this.game.physics.arcade.isPaused){return}this.dirty=true;this.wasTouching.none=this.touching.none;this.wasTouching.up=this.touching.up;this.wasTouching.down=this.touching.down;this.wasTouching.left=this.touching.left;this.wasTouching.right=this.touching.right;this.touching.none=true;this.touching.up=false;this.touching.down=false;this.touching.left=false;this.touching.right=false;this.blocked.up=false;this.blocked.down=false;this.blocked.left=false;this.blocked.right=false;this.embedded=false;this.updateBounds();this.position.x=this.sprite.world.x-this.sprite.anchor.x*this.sprite.width+this.sprite.scale.x*this.offset.x;this.position.x-=this.sprite.scale.x<0?this.width:0;this.position.y=this.sprite.world.y-this.sprite.anchor.y*this.sprite.height+this.sprite.scale.y*this.offset.y;this.position.y-=this.sprite.scale.y<0?this.height:0;this.rotation=this.sprite.angle;this.preRotation=this.rotation;if(this._reset||this.sprite.fresh){this.prev.x=this.position.x;this.prev.y=this.position.y}if(this.moves){this.game.physics.arcade.updateMotion(this);this.newVelocity.set(this.velocity.x*this.game.time.physicsElapsed,this.velocity.y*this.game.time.physicsElapsed);this.position.x+=this.newVelocity.x;this.position.y+=this.newVelocity.y;if(this.position.x!==this.prev.x||this.position.y!==this.prev.y){this.angle=Math.atan2(this.velocity.y,this.velocity.x)}this.speed=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y);if(this.collideWorldBounds){if(this.checkWorldBounds()&&this.onWorldBounds){this.onWorldBounds.dispatch(this.sprite,this.blocked.up,this.blocked.down,this.blocked.left,this.blocked.right)}}}this._dx=this.deltaX();this._dy=this.deltaY();this._reset=false},updateMovement:function(){var t=0;var e=this.overlapX!==0||this.overlapY!==0;if(this.moveDuration>0){this.moveTimer+=this.game.time.elapsedMS;t=this.moveTimer/this.moveDuration}else{this.moveTarget.end.set(this.position.x,this.position.y);t=this.moveTarget.length/this.moveDistance}if(this.movementCallback){var i=this.movementCallback.call(this.movementCallbackContext,this,this.velocity,t)}if(e||t>=1||i!==undefined&&i!==true){this.stopMovement(t>=1||this.stopVelocityOnCollide&&e);return false}return true},stopMovement:function(t){if(this.isMoving){this.isMoving=false;if(t){this.velocity.set(0)}this.onMoveComplete.dispatch(this.sprite,this.overlapX!==0||this.overlapY!==0)}},postUpdate:function(){if(!this.enable||!this.dirty){return}if(this.isMoving){this.updateMovement()}this.dirty=false;if(this.deltaX()<0){this.facing=r.LEFT}else if(this.deltaX()>0){this.facing=r.RIGHT}if(this.deltaY()<0){this.facing=r.UP}else if(this.deltaY()>0){this.facing=r.DOWN}if(this.moves){this._dx=this.deltaX();this._dy=this.deltaY();if(this.deltaMax.x!==0&&this._dx!==0){if(this._dx<0&&this._dx<-this.deltaMax.x){this._dx=-this.deltaMax.x}else if(this._dx>0&&this._dx>this.deltaMax.x){this._dx=this.deltaMax.x}}if(this.deltaMax.y!==0&&this._dy!==0){if(this._dy<0&&this._dy<-this.deltaMax.y){this._dy=-this.deltaMax.y}else if(this._dy>0&&this._dy>this.deltaMax.y){this._dy=this.deltaMax.y}}this.sprite.position.x+=this._dx;this.sprite.position.y+=this._dy;this._reset=true}this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight);if(this.allowRotation){this.sprite.angle+=this.deltaZ()}this.prev.x=this.position.x;this.prev.y=this.position.y},checkWorldBounds:function(){var t=this.position;var e=this.game.physics.arcade.bounds;var i=this.game.physics.arcade.checkCollision;var s=this.worldBounce?-this.worldBounce.x:-this.bounce.x;var r=this.worldBounce?-this.worldBounce.y:-this.bounce.y;if(this.isCircle){var n={x:this.center.x-this.radius,y:this.center.y-this.radius,right:this.center.x+this.radius,bottom:this.center.y+this.radius};if(n.x<e.x&&i.left){t.x=e.x-this.halfWidth+this.radius;this.velocity.x*=s;this.blocked.left=true}else if(n.right>e.right&&i.right){t.x=e.right-this.halfWidth-this.radius;this.velocity.x*=s;this.blocked.right=true}if(n.y<e.y&&i.up){t.y=e.y-this.halfHeight+this.radius;this.velocity.y*=r;this.blocked.up=true}else if(n.bottom>e.bottom&&i.down){t.y=e.bottom-this.halfHeight-this.radius;this.velocity.y*=r;this.blocked.down=true}}else{if(t.x<e.x&&i.left){t.x=e.x;this.velocity.x*=s;this.blocked.left=true}else if(this.right>e.right&&i.right){t.x=e.right-this.width;this.velocity.x*=s;this.blocked.right=true}if(t.y<e.y&&i.up){t.y=e.y;this.velocity.y*=r;this.blocked.up=true}else if(this.bottom>e.bottom&&i.down){t.y=e.bottom-this.height;this.velocity.y*=r;this.blocked.down=true}}return this.blocked.up||this.blocked.down||this.blocked.left||this.blocked.right},moveFrom:function(t,e,i){if(e===undefined){e=this.speed}if(e===0){return false}var s;if(i===undefined){s=this.angle;i=this.game.math.radToDeg(s)}else{s=this.game.math.degToRad(i)}this.moveTimer=0;this.moveDuration=t;if(i===0||i===180){this.velocity.set(Math.cos(s)*e,0)}else if(i===90||i===270){this.velocity.set(0,Math.sin(s)*e)}else{this.velocity.set(Math.cos(s)*e,Math.sin(s)*e)}this.isMoving=true;return true},moveTo:function(t,e,i){var s=e/(t/1e3);if(s===0){return false}var n;if(i===undefined){n=this.angle;i=this.game.math.radToDeg(n)}else{n=this.game.math.degToRad(i)}e=Math.abs(e);this.moveDuration=0;this.moveDistance=e;if(this.moveTarget===null){this.moveTarget=new r.Line;this.moveEnd=new r.Point}this.moveTarget.fromAngle(this.x,this.y,n,e);this.moveEnd.set(this.moveTarget.end.x,this.moveTarget.end.y);this.moveTarget.setTo(this.x,this.y,this.x,this.y);if(i===0||i===180){this.velocity.set(Math.cos(n)*s,0)}else if(i===90||i===270){this.velocity.set(0,Math.sin(n)*s)}else{this.velocity.set(Math.cos(n)*s,Math.sin(n)*s)}this.isMoving=true;return true},setSize:function(t,e,i,s){if(i===undefined){i=this.offset.x}if(s===undefined){s=this.offset.y}this.sourceWidth=t;this.sourceHeight=e;this.width=this.sourceWidth*this._sx;this.height=this.sourceHeight*this._sy;this.halfWidth=Math.floor(this.width/2);this.halfHeight=Math.floor(this.height/2);this.offset.setTo(i,s);this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight);this.isCircle=false;this.radius=0},setCircle:function(t,e,i){if(e===undefined){e=this.offset.x}if(i===undefined){i=this.offset.y}if(t>0){this.isCircle=true;this.radius=t;this.sourceWidth=t*2;this.sourceHeight=t*2;this.width=this.sourceWidth*this._sx;this.height=this.sourceHeight*this._sy;this.halfWidth=Math.floor(this.width/2);this.halfHeight=Math.floor(this.height/2);this.offset.setTo(e,i);this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)}else{this.isCircle=false}},reset:function(t,e){this.velocity.set(0);this.acceleration.set(0);this.speed=0;this.angularVelocity=0;this.angularAcceleration=0;this.position.x=t-this.sprite.anchor.x*this.sprite.width+this.sprite.scale.x*this.offset.x;this.position.x-=this.sprite.scale.x<0?this.width:0;this.position.y=e-this.sprite.anchor.y*this.sprite.height+this.sprite.scale.y*this.offset.y;this.position.y-=this.sprite.scale.y<0?this.height:0;this.prev.x=this.position.x;this.prev.y=this.position.y;this.rotation=this.sprite.angle;this.preRotation=this.rotation;this._sx=this.sprite.scale.x;this._sy=this.sprite.scale.y;this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},getBounds:function(t){if(this.isCircle){t.x=this.center.x-this.radius;t.y=this.center.y-this.radius;t.right=this.center.x+this.radius;t.bottom=this.center.y+this.radius}else{t.x=this.x;t.y=this.y;t.right=this.right;t.bottom=this.bottom}return t},hitTest:function(t,e){return this.isCircle?r.Circle.contains(this,t,e):r.Rectangle.contains(this,t,e)},onFloor:function(){return this.blocked.down},onCeiling:function(){return this.blocked.up},onWall:function(){return this.blocked.left||this.blocked.right},deltaAbsX:function(){return this.deltaX()>0?this.deltaX():-this.deltaX()},deltaAbsY:function(){return this.deltaY()>0?this.deltaY():-this.deltaY()},deltaX:function(){return this.position.x-this.prev.x},deltaY:function(){return this.position.y-this.prev.y},deltaZ:function(){return this.rotation-this.preRotation},destroy:function(){if(this.sprite.parent&&this.sprite.parent instanceof r.Group){this.sprite.parent.removeFromHash(this.sprite)}this.sprite.body=null;this.sprite=null}};Object.defineProperty(r.Physics.Arcade.Body.prototype,"left",{get:function(){return this.position.x}});Object.defineProperty(r.Physics.Arcade.Body.prototype,"right",{get:function(){return this.position.x+this.width}});Object.defineProperty(r.Physics.Arcade.Body.prototype,"top",{get:function(){return this.position.y}});Object.defineProperty(r.Physics.Arcade.Body.prototype,"bottom",{get:function(){return this.position.y+this.height}});Object.defineProperty(r.Physics.Arcade.Body.prototype,"x",{get:function(){return this.position.x},set:function(t){this.position.x=t}});Object.defineProperty(r.Physics.Arcade.Body.prototype,"y",{get:function(){return this.position.y},set:function(t){this.position.y=t}});r.Physics.Arcade.Body.render=function(t,e,i,s){if(s===undefined){s=true}i=i||"rgba(0,255,0,0.4)";t.fillStyle=i;t.strokeStyle=i;if(e.isCircle){t.beginPath();t.arc(e.center.x-e.game.camera.x,e.center.y-e.game.camera.y,e.radius,0,2*Math.PI);if(s){t.fill()}else{t.stroke()}}else{if(s){t.fillRect(e.position.x-e.game.camera.x,e.position.y-e.game.camera.y,e.width,e.height)}else{t.strokeRect(e.position.x-e.game.camera.x,e.position.y-e.game.camera.y,e.width,e.height)}}};r.Physics.Arcade.Body.renderBodyInfo=function(t,e){t.line("x: "+e.x.toFixed(2),"y: "+e.y.toFixed(2),"width: "+e.width,"height: "+e.height);t.line("velocity x: "+e.velocity.x.toFixed(2),"y: "+e.velocity.y.toFixed(2),"deltaX: "+e._dx.toFixed(2),"deltaY: "+e._dy.toFixed(2));t.line("acceleration x: "+e.acceleration.x.toFixed(2),"y: "+e.acceleration.y.toFixed(2),"speed: "+e.speed.toFixed(2),"angle: "+e.angle.toFixed(2));t.line("gravity x: "+e.gravity.x,"y: "+e.gravity.y,"bounce x: "+e.bounce.x.toFixed(2),"y: "+e.bounce.y.toFixed(2));t.line("touching left: "+e.touching.left,"right: "+e.touching.right,"up: "+e.touching.up,"down: "+e.touching.down);t.line("blocked left: "+e.blocked.left,"right: "+e.blocked.right,"up: "+e.blocked.up,"down: "+e.blocked.down)};r.Physics.Arcade.Body.prototype.constructor=r.Physics.Arcade.Body;r.Physics.Arcade.TilemapCollision=function(){};r.Physics.Arcade.TilemapCollision.prototype={TILE_BIAS:16,collideSpriteVsTilemapLayer:function(t,e,i,s,r,n){if(!t.body){return}var a=e.getTiles(t.body.position.x-t.body.tilePadding.x,t.body.position.y-t.body.tilePadding.y,t.body.width+t.body.tilePadding.x,t.body.height+t.body.tilePadding.y,false,false);if(a.length===0){return}for(var o=0;o<a.length;o++){if(s){if(s.call(r,t,a[o])){if(this.separateTile(o,t.body,a[o],e,n)){this._total++;if(i){i.call(r,t,a[o])}}}}else{if(this.separateTile(o,t.body,a[o],e,n)){this._total++;if(i){i.call(r,t,a[o])}}}}},collideGroupVsTilemapLayer:function(t,e,i,s,r,n){if(t.length===0){return}for(var a=0;a<t.children.length;a++){if(t.children[a].exists){this.collideSpriteVsTilemapLayer(t.children[a],e,i,s,r,n)}}},separateTile:function(t,e,i,s,r){if(!e.enable){return false}var n=!s.fixedToCamera?s.position.x:0;var a=!s.fixedToCamera?s.position.y:0;if(!i.intersects(e.position.x-n,e.position.y-a,e.right-n,e.bottom-a)){return false}else if(r){return true}if(i.collisionCallback&&!i.collisionCallback.call(i.collisionCallbackContext,e.sprite,i)){return false}else if(typeof i.layer.callbacks!=="undefined"&&i.layer.callbacks[i.index]&&!i.layer.callbacks[i.index].callback.call(i.layer.callbacks[i.index].callbackContext,e.sprite,i)){return false}if(!i.faceLeft&&!i.faceRight&&!i.faceTop&&!i.faceBottom){return false}var o=0;var h=0;var l=0;var u=1;if(e.deltaAbsX()>e.deltaAbsY()){l=-1}else if(e.deltaAbsX()<e.deltaAbsY()){u=-1}if(e.deltaX()!==0&&e.deltaY()!==0&&(i.faceLeft||i.faceRight)&&(i.faceTop||i.faceBottom)){l=Math.min(Math.abs(e.position.x-n-i.right),Math.abs(e.right-n-i.left));u=Math.min(Math.abs(e.position.y-a-i.bottom),Math.abs(e.bottom-a-i.top))}if(l<u){if(i.faceLeft||i.faceRight){o=this.tileCheckX(e,i,s);if(o!==0&&!i.intersects(e.position.x-n,e.position.y-a,e.right-n,e.bottom-a)){return true}}if(i.faceTop||i.faceBottom){h=this.tileCheckY(e,i,s)}}else{if(i.faceTop||i.faceBottom){h=this.tileCheckY(e,i,s);if(h!==0&&!i.intersects(e.position.x-n,e.position.y-a,e.right-n,e.bottom-a)){return true}}if(i.faceLeft||i.faceRight){o=this.tileCheckX(e,i,s)}}return o!==0||h!==0},tileCheckX:function(t,e,i){var s=0;var r=!i.fixedToCamera?i.position.x:0;if(t.deltaX()<0&&!t.blocked.left&&e.collideRight&&t.checkCollision.left){if(e.faceRight&&t.x-r<e.right){s=t.x-r-e.right;if(s<-this.TILE_BIAS){s=0}}}else if(t.deltaX()>0&&!t.blocked.right&&e.collideLeft&&t.checkCollision.right){if(e.faceLeft&&t.right-r>e.left){s=t.right-r-e.left;if(s>this.TILE_BIAS){s=0}}}if(s!==0){if(t.customSeparateX){t.overlapX=s}else{this.processTileSeparationX(t,s)}}return s},tileCheckY:function(t,e,i){var s=0;var r=!i.fixedToCamera?i.position.y:0;if(t.deltaY()<0&&!t.blocked.up&&e.collideDown&&t.checkCollision.up){if(e.faceBottom&&t.y-r<e.bottom){s=t.y-r-e.bottom;if(s<-this.TILE_BIAS){s=0}}}else if(t.deltaY()>0&&!t.blocked.down&&e.collideUp&&t.checkCollision.down){if(e.faceTop&&t.bottom-r>e.top){s=t.bottom-r-e.top;if(s>this.TILE_BIAS){s=0}}}if(s!==0){if(t.customSeparateY){t.overlapY=s}else{this.processTileSeparationY(t,s)}}return s},processTileSeparationX:function(t,e){if(e<0){t.blocked.left=true}else if(e>0){t.blocked.right=true}t.position.x-=e;if(t.bounce.x===0){t.velocity.x=0}else{t.velocity.x=-t.velocity.x*t.bounce.x}},processTileSeparationY:function(t,e){if(e<0){t.blocked.up=true}else if(e>0){t.blocked.down=true}t.position.y-=e;if(t.bounce.y===0){t.velocity.y=0}else{t.velocity.y=-t.velocity.y*t.bounce.y}}};r.Utils.mixinPrototype(r.Physics.Arcade.prototype,r.Physics.Arcade.TilemapCollision.prototype);p2.Body.prototype.parent=null;p2.Spring.prototype.parent=null;r.Physics.P2=function(t,e){this.game=t;if(e===undefined){e={gravity:[0,0],broadphase:new p2.SAPBroadphase}}else{if(!e.hasOwnProperty("gravity")){e.gravity=[0,0]}if(!e.hasOwnProperty("broadphase")){e.broadphase=new p2.SAPBroadphase}}this.config=e;this.world=new p2.World(this.config);this.frameRate=1/60;this.useElapsedTime=false;this.paused=false;this.materials=[];this.gravity=new r.Physics.P2.InversePointProxy(this,this.world.gravity);this.walls={left:null,right:null,top:null,bottom:null};this.onBodyAdded=new r.Signal;this.onBodyRemoved=new r.Signal;this.onSpringAdded=new r.Signal;this.onSpringRemoved=new r.Signal;this.onConstraintAdded=new r.Signal;this.onConstraintRemoved=new r.Signal;this.onContactMaterialAdded=new r.Signal;this.onContactMaterialRemoved=new r.Signal;this.postBroadphaseCallback=null;this.callbackContext=null;this.onBeginContact=new r.Signal;this.onEndContact=new r.Signal;if(e.hasOwnProperty("mpx")&&e.hasOwnProperty("pxm")&&e.hasOwnProperty("mpxi")&&e.hasOwnProperty("pxmi")){this.mpx=e.mpx;this.mpxi=e.mpxi;this.pxm=e.pxm;this.pxmi=e.pxmi}this.world.on("beginContact",this.beginContactHandler,this);this.world.on("endContact",this.endContactHandler,this);this.collisionGroups=[];this.nothingCollisionGroup=new r.Physics.P2.CollisionGroup(1);this.boundsCollisionGroup=new r.Physics.P2.CollisionGroup(2);this.everythingCollisionGroup=new r.Physics.P2.CollisionGroup(2147483648);this.boundsCollidesWith=[];this._toRemove=[];this._collisionGroupID=2;this._boundsLeft=true;this._boundsRight=true;this._boundsTop=true;this._boundsBottom=true;this._boundsOwnGroup=false;this.setBoundsToWorld(true,true,true,true,false)};r.Physics.P2.prototype={removeBodyNextStep:function(t){this._toRemove.push(t)},preUpdate:function(){var t=this._toRemove.length;while(t--){this.removeBody(this._toRemove[t])}this._toRemove.length=0},enable:function(t,e,i){if(e===undefined){e=false}if(i===undefined){i=true}var s=1;if(Array.isArray(t)){s=t.length;while(s--){if(t[s]instanceof r.Group){this.enable(t[s].children,e,i)}else{this.enableBody(t[s],e);if(i&&t[s].hasOwnProperty("children")&&t[s].children.length>0){this.enable(t[s],e,true)}}}}else{if(t instanceof r.Group){this.enable(t.children,e,i)}else{this.enableBody(t,e);if(i&&t.hasOwnProperty("children")&&t.children.length>0){this.enable(t.children,e,true)}}}},enableBody:function(t,e){if(t.hasOwnProperty("body")&&t.body===null){t.body=new r.Physics.P2.Body(this.game,t,t.x,t.y,1);t.body.debug=e;if(typeof t.anchor!=="undefined"){t.anchor.set(.5)}}},setImpactEvents:function(t){if(t){this.world.on("impact",this.impactHandler,this)}else{this.world.off("impact",this.impactHandler,this)}},setPostBroadphaseCallback:function(t,e){this.postBroadphaseCallback=t;this.callbackContext=e;if(t!==null){this.world.on("postBroadphase",this.postBroadphaseHandler,this)}else{this.world.off("postBroadphase",this.postBroadphaseHandler,this)}},postBroadphaseHandler:function(t){if(!this.postBroadphaseCallback||t.pairs.length===0){return}for(var e=t.pairs.length-2;e>=0;e-=2){if(t.pairs[e].parent&&t.pairs[e+1].parent&&!this.postBroadphaseCallback.call(this.callbackContext,t.pairs[e].parent,t.pairs[e+1].parent)){t.pairs.splice(e,2)}}},impactHandler:function(t){if(t.bodyA.parent&&t.bodyB.parent){var e=t.bodyA.parent;var i=t.bodyB.parent;if(e._bodyCallbacks[t.bodyB.id]){e._bodyCallbacks[t.bodyB.id].call(e._bodyCallbackContext[t.bodyB.id],e,i,t.shapeA,t.shapeB)}if(i._bodyCallbacks[t.bodyA.id]){i._bodyCallbacks[t.bodyA.id].call(i._bodyCallbackContext[t.bodyA.id],i,e,t.shapeB,t.shapeA)}if(e._groupCallbacks[t.shapeB.collisionGroup]){e._groupCallbacks[t.shapeB.collisionGroup].call(e._groupCallbackContext[t.shapeB.collisionGroup],e,i,t.shapeA,t.shapeB)}if(i._groupCallbacks[t.shapeA.collisionGroup]){i._groupCallbacks[t.shapeA.collisionGroup].call(i._groupCallbackContext[t.shapeA.collisionGroup],i,e,t.shapeB,t.shapeA)}}},beginContactHandler:function(t){if(t.bodyA&&t.bodyB){this.onBeginContact.dispatch(t.bodyA,t.bodyB,t.shapeA,t.shapeB,t.contactEquations);if(t.bodyA.parent){t.bodyA.parent.onBeginContact.dispatch(t.bodyB.parent,t.bodyB,t.shapeA,t.shapeB,t.contactEquations)}if(t.bodyB.parent){t.bodyB.parent.onBeginContact.dispatch(t.bodyA.parent,t.bodyA,t.shapeB,t.shapeA,t.contactEquations)}}},endContactHandler:function(t){if(t.bodyA&&t.bodyB){this.onEndContact.dispatch(t.bodyA,t.bodyB,t.shapeA,t.shapeB);if(t.bodyA.parent){t.bodyA.parent.onEndContact.dispatch(t.bodyB.parent,t.bodyB,t.shapeA,t.shapeB)}if(t.bodyB.parent){t.bodyB.parent.onEndContact.dispatch(t.bodyA.parent,t.bodyA,t.shapeB,t.shapeA)}}},setBoundsToWorld:function(t,e,i,s,r){this.setBounds(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,t,e,i,s,r)},setWorldMaterial:function(t,e,i,s,r){if(e===undefined){e=true}if(i===undefined){i=true}if(s===undefined){s=true}if(r===undefined){r=true}if(e&&this.walls.left){this.walls.left.shapes[0].material=t}if(i&&this.walls.right){this.walls.right.shapes[0].material=t}if(s&&this.walls.top){this.walls.top.shapes[0].material=t}if(r&&this.walls.bottom){this.walls.bottom.shapes[0].material=t}},updateBoundsCollisionGroup:function(t){if(t===undefined){t=true}var e=t?this.boundsCollisionGroup.mask:this.everythingCollisionGroup.mask;if(this.walls.left){this.walls.left.shapes[0].collisionGroup=e}if(this.walls.right){this.walls.right.shapes[0].collisionGroup=e}if(this.walls.top){this.walls.top.shapes[0].collisionGroup=e}if(this.walls.bottom){this.walls.bottom.shapes[0].collisionGroup=e}this._boundsOwnGroup=t},setBounds:function(t,e,i,s,r,n,a,o,h){if(r===undefined){r=this._boundsLeft}if(n===undefined){n=this._boundsRight}if(a===undefined){a=this._boundsTop}if(o===undefined){o=this._boundsBottom}if(h===undefined){h=this._boundsOwnGroup}this.setupWall(r,"left",t,e,1.5707963267948966,h);this.setupWall(n,"right",t+i,e,-1.5707963267948966,h);this.setupWall(a,"top",t,e,-3.141592653589793,h);this.setupWall(o,"bottom",t,e+s,0,h);this._boundsLeft=r;this._boundsRight=n;this._boundsTop=a;this._boundsBottom=o;this._boundsOwnGroup=h},setupWall:function(t,e,i,s,r,n){if(t){if(this.walls[e]){this.walls[e].position=[this.pxmi(i),this.pxmi(s)]}else{this.walls[e]=new p2.Body({mass:0,position:[this.pxmi(i),this.pxmi(s)],angle:r});this.walls[e].addShape(new p2.Plane);this.world.addBody(this.walls[e])}if(n){this.walls[e].shapes[0].collisionGroup=this.boundsCollisionGroup.mask}}else{if(this.walls[e]){this.world.removeBody(this.walls[e]);this.walls[e]=null}}},pause:function(){this.paused=true},resume:function(){this.paused=false},update:function(){if(this.paused){return}if(this.useElapsedTime){this.world.step(this.game.time.physicsElapsed)}else{this.world.step(this.frameRate)}},reset:function(){this.world.on("beginContact",this.beginContactHandler,this);this.world.on("endContact",this.endContactHandler,this);this.nothingCollisionGroup=new r.Physics.P2.CollisionGroup(1);this.boundsCollisionGroup=new r.Physics.P2.CollisionGroup(2);this.everythingCollisionGroup=new r.Physics.P2.CollisionGroup(2147483648);this._collisionGroupID=2;this.setBoundsToWorld(true,true,true,true,false)},clear:function(){this.world.time=0;this.world.fixedStepTime=0;if(this.world.solver&&this.world.solver.equations.length){this.world.solver.removeAllEquations()}var t=this.world.constraints;for(var e=t.length-1;e>=0;e--){this.world.removeConstraint(t[e])}var i=this.world.bodies;for(var e=i.length-1;e>=0;e--){this.world.removeBody(i[e])}var s=this.world.springs;for(var e=s.length-1;e>=0;e--){this.world.removeSpring(s[e])}var r=this.world.contactMaterials;for(var e=r.length-1;e>=0;e--){this.world.removeContactMaterial(r[e])}this.world.off("beginContact",this.beginContactHandler,this);this.world.off("endContact",this.endContactHandler,this);this.postBroadphaseCallback=null;this.callbackContext=null;this.impactCallback=null;this.collisionGroups=[];this._toRemove=[];this.boundsCollidesWith=[];this.walls={left:null,right:null,top:null,bottom:null}},destroy:function(){this.clear();this.game=null},addBody:function(t){if(t.data.world){return false}else{this.world.addBody(t.data);this.onBodyAdded.dispatch(t);return true}},removeBody:function(t){if(t.data.world===this.world){this.world.removeBody(t.data);this.onBodyRemoved.dispatch(t)}return t},addSpring:function(t){if(t instanceof r.Physics.P2.Spring||t instanceof r.Physics.P2.RotationalSpring){this.world.addSpring(t.data)}else{this.world.addSpring(t)}this.onSpringAdded.dispatch(t);return t},removeSpring:function(t){if(t instanceof r.Physics.P2.Spring||t instanceof r.Physics.P2.RotationalSpring){this.world.removeSpring(t.data)}else{this.world.removeSpring(t)}this.onSpringRemoved.dispatch(t);return t},createDistanceConstraint:function(t,e,i,s,n,a){t=this.getBody(t);e=this.getBody(e);if(!t||!e){console.warn("Cannot create Constraint, invalid body objects given")}else{return this.addConstraint(new r.Physics.P2.DistanceConstraint(this,t,e,i,s,n,a))}},createGearConstraint:function(t,e,i,s){t=this.getBody(t);e=this.getBody(e);if(!t||!e){console.warn("Cannot create Constraint, invalid body objects given")}else{return this.addConstraint(new r.Physics.P2.GearConstraint(this,t,e,i,s))}},createRevoluteConstraint:function(t,e,i,s,n,a){t=this.getBody(t);i=this.getBody(i);if(!t||!i){console.warn("Cannot create Constraint, invalid body objects given")}else{return this.addConstraint(new r.Physics.P2.RevoluteConstraint(this,t,e,i,s,n,a))}},createLockConstraint:function(t,e,i,s,n){t=this.getBody(t);e=this.getBody(e);if(!t||!e){console.warn("Cannot create Constraint, invalid body objects given")}else{return this.addConstraint(new r.Physics.P2.LockConstraint(this,t,e,i,s,n))}},createPrismaticConstraint:function(t,e,i,s,n,a,o){t=this.getBody(t);e=this.getBody(e);if(!t||!e){console.warn("Cannot create Constraint, invalid body objects given")}else{return this.addConstraint(new r.Physics.P2.PrismaticConstraint(this,t,e,i,s,n,a,o))}},addConstraint:function(t){this.world.addConstraint(t);this.onConstraintAdded.dispatch(t);return t},removeConstraint:function(t){this.world.removeConstraint(t);this.onConstraintRemoved.dispatch(t);return t},addContactMaterial:function(t){this.world.addContactMaterial(t);this.onContactMaterialAdded.dispatch(t);return t},removeContactMaterial:function(t){this.world.removeContactMaterial(t);this.onContactMaterialRemoved.dispatch(t);return t},getContactMaterial:function(t,e){return this.world.getContactMaterial(t,e)},setMaterial:function(t,e){var i=e.length;while(i--){e[i].setMaterial(t)}},createMaterial:function(t,e){t=t||"";var i=new r.Physics.P2.Material(t);this.materials.push(i);if(typeof e!=="undefined"){e.setMaterial(i)}return i},createContactMaterial:function(t,e,i){if(t===undefined){t=this.createMaterial()}if(e===undefined){e=this.createMaterial()}var s=new r.Physics.P2.ContactMaterial(t,e,i);return this.addContactMaterial(s)},getBodies:function(){var t=[];var e=this.world.bodies.length;while(e--){t.push(this.world.bodies[e].parent)}return t},getBody:function(t){if(t instanceof p2.Body){return t}else if(t instanceof r.Physics.P2.Body){return t.data}else if(t["body"]&&t["body"].type===r.Physics.P2JS){return t.body.data}return null},getSprings:function(){var t=[];var e=this.world.springs.length;while(e--){t.push(this.world.springs[e].parent)}return t},getConstraints:function(){var t=[];var e=this.world.constraints.length;while(e--){t.push(this.world.constraints[e])}return t},hitTest:function(t,e,i,s){if(e===undefined){e=this.world.bodies}if(i===undefined){i=5}if(s===undefined){s=false}var n=[this.pxmi(t.x),this.pxmi(t.y)];var a=[];var o=e.length;while(o--){if(e[o]instanceof r.Physics.P2.Body&&!(s&&e[o].data.type===p2.Body.STATIC)){a.push(e[o].data)}else if(e[o]instanceof p2.Body&&e[o].parent&&!(s&&e[o].type===p2.Body.STATIC)){a.push(e[o])}else if(e[o]instanceof r.Sprite&&e[o].hasOwnProperty("body")&&!(s&&e[o].body.data.type===p2.Body.STATIC)){a.push(e[o].body.data)}}return this.world.hitTest(n,a,i)},toJSON:function(){return this.world.toJSON()},createCollisionGroup:function(t){var e=Math.pow(2,this._collisionGroupID);if(this.walls.left){this.walls.left.shapes[0].collisionMask=this.walls.left.shapes[0].collisionMask|e}if(this.walls.right){this.walls.right.shapes[0].collisionMask=this.walls.right.shapes[0].collisionMask|e}if(this.walls.top){this.walls.top.shapes[0].collisionMask=this.walls.top.shapes[0].collisionMask|e}if(this.walls.bottom){this.walls.bottom.shapes[0].collisionMask=this.walls.bottom.shapes[0].collisionMask|e}this._collisionGroupID++;var i=new r.Physics.P2.CollisionGroup(e);this.collisionGroups.push(i);if(t){this.setCollisionGroup(t,i)}return i},setCollisionGroup:function(t,e){if(t instanceof r.Group){for(var i=0;i<t.total;i++){if(t.children[i]["body"]&&t.children[i]["body"].type===r.Physics.P2JS){t.children[i].body.setCollisionGroup(e)}}}else{t.body.setCollisionGroup(e)}},createSpring:function(t,e,i,s,n,a,o,h,l){t=this.getBody(t);e=this.getBody(e);if(!t||!e){console.warn("Cannot create Spring, invalid body objects given")}else{return this.addSpring(new r.Physics.P2.Spring(this,t,e,i,s,n,a,o,h,l))}},createRotationalSpring:function(t,e,i,s,n){t=this.getBody(t);e=this.getBody(e);if(!t||!e){console.warn("Cannot create Rotational Spring, invalid body objects given")}else{return this.addSpring(new r.Physics.P2.RotationalSpring(this,t,e,i,s,n))}},createBody:function(t,e,i,s,n,a){if(s===undefined){s=false}var o=new r.Physics.P2.Body(this.game,null,t,e,i);if(a){var h=o.addPolygon(n,a);if(!h){return false}}if(s){this.world.addBody(o.data)}return o},createParticle:function(t,e,i,s,n,a){if(s===undefined){s=false}var o=new r.Physics.P2.Body(this.game,null,t,e,i);if(a){var h=o.addPolygon(n,a);if(!h){return false}}if(s){this.world.addBody(o.data)}return o},convertCollisionObjects:function(t,e,i){if(i===undefined){i=true}var s=[];for(var r=0,n=t.collision[e].length;r<n;r++){var a=t.collision[e][r];var o=this.createBody(a.x,a.y,0,i,{},a.polyline);if(o){s.push(o)}}return s},clearTilemapLayerBodies:function(t,e){e=t.getLayer(e);var i=t.layers[e].bodies.length;while(i--){t.layers[e].bodies[i].destroy()}t.layers[e].bodies.length=0},convertTilemap:function(t,e,i,s){e=t.getLayer(e);if(i===undefined){i=true}if(s===undefined){s=true}this.clearTilemapLayerBodies(t,e);var r=0;var n=0;var a=0;for(var o=0,h=t.layers[e].height;o<h;o++){r=0;for(var l=0,u=t.layers[e].width;l<u;l++){var c=t.layers[e].data[o][l];if(c&&c.index>-1&&c.collides){if(s){var d=t.getTileRight(e,l,o);if(r===0){n=c.x*c.width;a=c.y*c.height;r=c.width}if(d&&d.collides){r+=c.width}else{var f=this.createBody(n,a,0,false);f.addRectangle(r,c.height,r/2,c.height/2,0);if(i){this.addBody(f)}t.layers[e].bodies.push(f);r=0}}else{var f=this.createBody(c.x*c.width,c.y*c.height,0,false);f.addRectangle(c.width,c.height,c.width/2,c.height/2,0);if(i){this.addBody(f)}t.layers[e].bodies.push(f)}}}}return t.layers[e].bodies},mpx:function(t){return t*=20},pxm:function(t){return t*.05},mpxi:function(t){return t*=-20},pxmi:function(t){return t*-.05}};Object.defineProperty(r.Physics.P2.prototype,"friction",{get:function(){return this.world.defaultContactMaterial.friction},set:function(t){this.world.defaultContactMaterial.friction=t}});Object.defineProperty(r.Physics.P2.prototype,"restitution",{get:function(){return this.world.defaultContactMaterial.restitution},set:function(t){this.world.defaultContactMaterial.restitution=t}});Object.defineProperty(r.Physics.P2.prototype,"contactMaterial",{get:function(){return this.world.defaultContactMaterial},set:function(t){this.world.defaultContactMaterial=t}});Object.defineProperty(r.Physics.P2.prototype,"applySpringForces",{get:function(){return this.world.applySpringForces},set:function(t){this.world.applySpringForces=t}});Object.defineProperty(r.Physics.P2.prototype,"applyDamping",{get:function(){return this.world.applyDamping},set:function(t){this.world.applyDamping=t}});Object.defineProperty(r.Physics.P2.prototype,"applyGravity",{get:function(){return this.world.applyGravity},set:function(t){this.world.applyGravity=t}});Object.defineProperty(r.Physics.P2.prototype,"solveConstraints",{get:function(){return this.world.solveConstraints},set:function(t){this.world.solveConstraints=t}});Object.defineProperty(r.Physics.P2.prototype,"time",{get:function(){return this.world.time}});Object.defineProperty(r.Physics.P2.prototype,"emitImpactEvent",{get:function(){return this.world.emitImpactEvent},set:function(t){this.world.emitImpactEvent=t}});Object.defineProperty(r.Physics.P2.prototype,"sleepMode",{get:function(){return this.world.sleepMode},set:function(t){this.world.sleepMode=t}});Object.defineProperty(r.Physics.P2.prototype,"total",{get:function(){return this.world.bodies.length}});r.Physics.P2.FixtureList=function(t){if(!Array.isArray(t)){t=[t]}this.rawList=t;this.init();this.parse(this.rawList)};r.Physics.P2.FixtureList.prototype={init:function(){this.namedFixtures={};this.groupedFixtures=[];this.allFixtures=[]},setCategory:function(t,e){var i=function(e){e.collisionGroup=t};this.getFixtures(e).forEach(i)},setMask:function(t,e){var i=function(e){e.collisionMask=t};this.getFixtures(e).forEach(i)},setSensor:function(t,e){var i=function(e){e.sensor=t};this.getFixtures(e).forEach(i)},setMaterial:function(t,e){var i=function(e){e.material=t};this.getFixtures(e).forEach(i)},getFixtures:function(t){var e=[];if(t){if(!(t instanceof Array)){t=[t]}var i=this;t.forEach(function(t){if(i.namedFixtures[t]){e.push(i.namedFixtures[t])}});return this.flatten(e)}else{return this.allFixtures}},getFixtureByKey:function(t){return this.namedFixtures[t]},getGroup:function(t){return this.groupedFixtures[t]},parse:function(){var t,e,i,s;i=this.rawList;s=[];for(t in i){e=i[t];if(!isNaN(t-0)){this.groupedFixtures[t]=this.groupedFixtures[t]||[];this.groupedFixtures[t]=this.groupedFixtures[t].concat(e)}else{this.namedFixtures[t]=this.flatten(e)}s.push(this.allFixtures=this.flatten(this.groupedFixtures))}},flatten:function(t){var e,i;e=[];i=arguments.callee;t.forEach(function(t){return Array.prototype.push.apply(e,Array.isArray(t)?i(t):[t])});return e}};r.Physics.P2.PointProxy=function(t,e){this.world=t;this.destination=e};r.Physics.P2.PointProxy.prototype.constructor=r.Physics.P2.PointProxy;Object.defineProperty(r.Physics.P2.PointProxy.prototype,"x",{get:function(){return this.world.mpx(this.destination[0])},set:function(t){this.destination[0]=this.world.pxm(t)}});Object.defineProperty(r.Physics.P2.PointProxy.prototype,"y",{get:function(){return this.world.mpx(this.destination[1])},set:function(t){this.destination[1]=this.world.pxm(t)}});Object.defineProperty(r.Physics.P2.PointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(t){this.destination[0]=t}});Object.defineProperty(r.Physics.P2.PointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(t){this.destination[1]=t}});r.Physics.P2.InversePointProxy=function(t,e){this.world=t;this.destination=e};r.Physics.P2.InversePointProxy.prototype.constructor=r.Physics.P2.InversePointProxy;Object.defineProperty(r.Physics.P2.InversePointProxy.prototype,"x",{get:function(){return this.world.mpxi(this.destination[0])},set:function(t){this.destination[0]=this.world.pxmi(t)}});Object.defineProperty(r.Physics.P2.InversePointProxy.prototype,"y",{get:function(){return this.world.mpxi(this.destination[1])},set:function(t){this.destination[1]=this.world.pxmi(t)}});Object.defineProperty(r.Physics.P2.InversePointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(t){this.destination[0]=-t}});Object.defineProperty(r.Physics.P2.InversePointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(t){this.destination[1]=-t}});r.Physics.P2.Body=function(t,e,i,s,n){e=e||null;i=i||0;s=s||0;if(n===undefined){n=1}this.game=t;this.world=t.physics.p2;this.sprite=e;this.type=r.Physics.P2JS;this.offset=new r.Point;this.data=new p2.Body({position:[this.world.pxmi(i),this.world.pxmi(s)],mass:n});this.data.parent=this;this.velocity=new r.Physics.P2.InversePointProxy(this.world,this.data.velocity);this.force=new r.Physics.P2.InversePointProxy(this.world,this.data.force);this.gravity=new r.Point;this.onBeginContact=new r.Signal;this.onEndContact=new r.Signal;this.collidesWith=[];this.removeNextStep=false;this.debugBody=null;this.dirty=false;this._collideWorldBounds=true;this._bodyCallbacks={};this._bodyCallbackContext={};this._groupCallbacks={};this._groupCallbackContext={};this._reset=false;if(e){this.setRectangleFromSprite(e);if(e.exists){this.game.physics.p2.addBody(this)}}};r.Physics.P2.Body.prototype={createBodyCallback:function(t,e,i){var s=-1;if(t["id"]){s=t.id}else if(t["body"]){s=t.body.id}if(s>-1){if(e===null){delete this._bodyCallbacks[s];delete this._bodyCallbackContext[s]}else{this._bodyCallbacks[s]=e;this._bodyCallbackContext[s]=i}}},createGroupCallback:function(t,e,i){if(e===null){delete this._groupCallbacks[t.mask];delete this._groupCallbackContext[t.mask]}else{this._groupCallbacks[t.mask]=e;this._groupCallbackContext[t.mask]=i}},getCollisionMask:function(){var t=0;if(this._collideWorldBounds){t=this.game.physics.p2.boundsCollisionGroup.mask}for(var e=0;e<this.collidesWith.length;e++){t=t|this.collidesWith[e].mask}return t},updateCollisionMask:function(t){var e=this.getCollisionMask();if(t===undefined){for(var i=this.data.shapes.length-1;i>=0;i--){this.data.shapes[i].collisionMask=e}}else{t.collisionMask=e}},setCollisionGroup:function(t,e){var i=this.getCollisionMask();if(e===undefined){for(var s=this.data.shapes.length-1;s>=0;s--){this.data.shapes[s].collisionGroup=t.mask;this.data.shapes[s].collisionMask=i}}else{e.collisionGroup=t.mask;e.collisionMask=i}},clearCollision:function(t,e,i){if(t===undefined){t=true}if(e===undefined){e=true}if(i===undefined){for(var s=this.data.shapes.length-1;s>=0;s--){if(t){this.data.shapes[s].collisionGroup=null}if(e){this.data.shapes[s].collisionMask=null}}}else{if(t){i.collisionGroup=null}if(e){i.collisionMask=null}}if(t){this.collidesWith.length=0}},removeCollisionGroup:function(t,e,i){if(e===undefined){e=true}var s;if(Array.isArray(t)){for(var r=0;r<t.length;r++){s=this.collidesWith.indexOf(t[r]);if(s>-1){this.collidesWith.splice(s,1);if(e){delete this._groupCallbacks[t.mask];delete this._groupCallbackContext[t.mask]}}}}else{s=this.collidesWith.indexOf(t);if(s>-1){this.collidesWith.splice(s,1);if(e){delete this._groupCallbacks[t.mask];delete this._groupCallbackContext[t.mask]}}}var n=this.getCollisionMask();if(i===undefined){for(var r=this.data.shapes.length-1;r>=0;r--){this.data.shapes[r].collisionMask=n}}else{i.collisionMask=n}},collides:function(t,e,i,s){if(Array.isArray(t)){for(var r=0;r<t.length;r++){if(this.collidesWith.indexOf(t[r])===-1){this.collidesWith.push(t[r]);if(e){this.createGroupCallback(t[r],e,i)}}}}else{if(this.collidesWith.indexOf(t)===-1){this.collidesWith.push(t);if(e){this.createGroupCallback(t,e,i)}}}var n=this.getCollisionMask();if(s===undefined){for(var r=this.data.shapes.length-1;r>=0;r--){this.data.shapes[r].collisionMask=n}}else{s.collisionMask=n}},adjustCenterOfMass:function(){this.data.adjustCenterOfMass();this.shapeChanged()},getVelocityAtPoint:function(t,e){return this.data.getVelocityAtPoint(t,e)},applyDamping:function(t){this.data.applyDamping(t)},applyImpulse:function(t,e,i){this.data.applyImpulse(t,[this.world.pxmi(e),this.world.pxmi(i)])},applyImpulseLocal:function(t,e,i){this.data.applyImpulseLocal(t,[this.world.pxmi(e),this.world.pxmi(i)])},applyForce:function(t,e,i){this.data.applyForce(t,[this.world.pxmi(e),this.world.pxmi(i)])},setZeroForce:function(){this.data.setZeroForce()},setZeroRotation:function(){this.data.angularVelocity=0},setZeroVelocity:function(){this.data.velocity[0]=0;this.data.velocity[1]=0},setZeroDamping:function(){this.data.damping=0;this.data.angularDamping=0},toLocalFrame:function(t,e){return this.data.toLocalFrame(t,e)},toWorldFrame:function(t,e){return this.data.toWorldFrame(t,e)},rotateLeft:function(t){this.data.angularVelocity=this.world.pxm(-t)},rotateRight:function(t){this.data.angularVelocity=this.world.pxm(t)},moveForward:function(t){var e=this.world.pxmi(-t);var i=this.data.angle+Math.PI/2;this.data.velocity[0]=e*Math.cos(i);this.data.velocity[1]=e*Math.sin(i)},moveBackward:function(t){var e=this.world.pxmi(-t);var i=this.data.angle+Math.PI/2;this.data.velocity[0]=-(e*Math.cos(i));this.data.velocity[1]=-(e*Math.sin(i))},thrust:function(t){var e=this.world.pxmi(-t);var i=this.data.angle+Math.PI/2;this.data.force[0]+=e*Math.cos(i);this.data.force[1]+=e*Math.sin(i)},thrustLeft:function(t){var e=this.world.pxmi(-t);var i=this.data.angle;this.data.force[0]+=e*Math.cos(i);this.data.force[1]+=e*Math.sin(i)},thrustRight:function(t){var e=this.world.pxmi(-t);var i=this.data.angle;this.data.force[0]-=e*Math.cos(i);this.data.force[1]-=e*Math.sin(i)},reverse:function(t){var e=this.world.pxmi(-t);var i=this.data.angle+Math.PI/2;this.data.force[0]-=e*Math.cos(i);this.data.force[1]-=e*Math.sin(i)},moveLeft:function(t){this.data.velocity[0]=this.world.pxmi(-t)},moveRight:function(t){this.data.velocity[0]=this.world.pxmi(t)},moveUp:function(t){this.data.velocity[1]=this.world.pxmi(-t)},moveDown:function(t){this.data.velocity[1]=this.world.pxmi(t)},preUpdate:function(){this.dirty=true;if(this.removeNextStep){this.removeFromWorld();this.removeNextStep=false}},postUpdate:function(){this.sprite.x=this.world.mpxi(this.data.position[0])+this.offset.x;this.sprite.y=this.world.mpxi(this.data.position[1])+this.offset.y;if(!this.fixedRotation){this.sprite.rotation=this.data.angle}if(this.debugBody){this.debugBody.updateSpriteTransform()}this.dirty=false},reset:function(t,e,i,s){if(i===undefined){i=false}if(s===undefined){s=false}this.setZeroForce();this.setZeroVelocity();this.setZeroRotation();if(i){this.setZeroDamping()}if(s){this.mass=1}this.x=t;this.y=e},addToWorld:function(){if(this.game.physics.p2._toRemove){for(var t=0;t<this.game.physics.p2._toRemove.length;t++){if(this.game.physics.p2._toRemove[t]===this){this.game.physics.p2._toRemove.splice(t,1)}}}if(this.data.world!==this.game.physics.p2.world){this.game.physics.p2.addBody(this)}},removeFromWorld:function(){if(this.data.world===this.game.physics.p2.world){this.game.physics.p2.removeBodyNextStep(this)}},destroy:function(){this.removeFromWorld();this.clearShapes();this._bodyCallbacks={};this._bodyCallbackContext={};this._groupCallbacks={};this._groupCallbackContext={};if(this.debugBody){this.debugBody.destroy(true,true)}this.debugBody=null;if(this.sprite){this.sprite.body=null;this.sprite=null}},clearShapes:function(){var t=this.data.shapes.length;while(t--){this.data.removeShape(this.data.shapes[t])}this.shapeChanged()},addShape:function(t,e,i,s){if(e===undefined){e=0}if(i===undefined){i=0}if(s===undefined){s=0}this.data.addShape(t,[this.world.pxmi(e),this.world.pxmi(i)],s);this.shapeChanged();return t},addCircle:function(t,e,i,s){var r=new p2.Circle({radius:this.world.pxm(t)});return this.addShape(r,e,i,s)},addRectangle:function(t,e,i,s,r){var n=new p2.Box({width:this.world.pxm(t),height:this.world.pxm(e)});return this.addShape(n,i,s,r)},addPlane:function(t,e,i){var s=new p2.Plane;return this.addShape(s,t,e,i)},addParticle:function(t,e,i){var s=new p2.Particle;return this.addShape(s,t,e,i)},addLine:function(t,e,i,s){var r=new p2.Line({length:this.world.pxm(t)});return this.addShape(r,e,i,s)},addCapsule:function(t,e,i,s,r){var n=new p2.Capsule({length:this.world.pxm(t),radius:this.world.pxm(e)});return this.addShape(n,i,s,r)},addPolygon:function(t,e){t=t||{};if(!Array.isArray(e)){e=Array.prototype.slice.call(arguments,1)}var i=[];if(e.length===1&&Array.isArray(e[0])){i=e[0].slice(0)}else if(Array.isArray(e[0])){i=e.slice()}else if(typeof e[0]==="number"){for(var s=0,r=e.length;s<r;s+=2){i.push([e[s],e[s+1]])}}var n=i.length-1;if(i[n][0]===i[0][0]&&i[n][1]===i[0][1]){i.pop()}for(var a=0;a<i.length;a++){i[a][0]=this.world.pxmi(i[a][0]);i[a][1]=this.world.pxmi(i[a][1])}var o=this.data.fromPolygon(i,t);this.shapeChanged();return o},removeShape:function(t){var e=this.data.removeShape(t);this.shapeChanged();return e},setCircle:function(t,e,i,s){this.clearShapes();return this.addCircle(t,e,i,s)},setRectangle:function(t,e,i,s,r){if(t===undefined){t=16}if(e===undefined){e=16}this.clearShapes();return this.addRectangle(t,e,i,s,r)},setRectangleFromSprite:function(t){if(t===undefined){t=this.sprite}this.clearShapes();return this.addRectangle(t.width,t.height,0,0,t.rotation)},setMaterial:function(t,e){if(e===undefined){for(var i=this.data.shapes.length-1;i>=0;i--){this.data.shapes[i].material=t}}else{e.material=t}},shapeChanged:function(){if(this.debugBody){this.debugBody.draw()}},addPhaserPolygon:function(t,e){var i=this.game.cache.getPhysicsData(t,e);var s=[];for(var r=0;r<i.length;r++){var n=i[r];var a=this.addFixture(n);s[n.filter.group]=s[n.filter.group]||[];s[n.filter.group]=s[n.filter.group].concat(a);if(n.fixtureKey){s[n.fixtureKey]=a}}this.data.aabbNeedsUpdate=true;this.shapeChanged();return s},addFixture:function(t){var e=[];if(t.circle){var i=new p2.Circle({radius:this.world.pxm(t.circle.radius)});i.collisionGroup=t.filter.categoryBits;i.collisionMask=t.filter.maskBits;i.sensor=t.isSensor;var s=p2.vec2.create();s[0]=this.world.pxmi(t.circle.position[0]-this.sprite.width/2);s[1]=this.world.pxmi(t.circle.position[1]-this.sprite.height/2);this.data.addShape(i,s);e.push(i)}else{var r=t.polygons;var n=p2.vec2.create();for(var a=0;a<r.length;a++){var o=r[a];var h=[];for(var l=0;l<o.length;l+=2){h.push([this.world.pxmi(o[l]),this.world.pxmi(o[l+1])])}var i=new p2.Convex({vertices:h});for(var u=0;u!==i.vertices.length;u++){var c=i.vertices[u];p2.vec2.sub(c,c,i.centerOfMass)}p2.vec2.scale(n,i.centerOfMass,1);n[0]-=this.world.pxmi(this.sprite.width/2);n[1]-=this.world.pxmi(this.sprite.height/2);i.updateTriangles();i.updateCenterOfMass();i.updateBoundingRadius();i.collisionGroup=t.filter.categoryBits;i.collisionMask=t.filter.maskBits;i.sensor=t.isSensor;this.data.addShape(i,n);e.push(i)}}return e},loadPolygon:function(t,e){if(t===null){var i=e}else{var i=this.game.cache.getPhysicsData(t,e)}var s=p2.vec2.create();for(var r=0;r<i.length;r++){var n=[];for(var a=0;a<i[r].shape.length;a+=2){n.push([this.world.pxmi(i[r].shape[a]),this.world.pxmi(i[r].shape[a+1])])}var o=new p2.Convex({vertices:n});for(var h=0;h!==o.vertices.length;h++){var l=o.vertices[h];p2.vec2.sub(l,l,o.centerOfMass)}p2.vec2.scale(s,o.centerOfMass,1);s[0]-=this.world.pxmi(this.sprite.width/2);s[1]-=this.world.pxmi(this.sprite.height/2);o.updateTriangles();o.updateCenterOfMass();o.updateBoundingRadius();this.data.addShape(o,s)}this.data.aabbNeedsUpdate=true;this.shapeChanged();return true}};r.Physics.P2.Body.prototype.constructor=r.Physics.P2.Body;r.Physics.P2.Body.DYNAMIC=1;r.Physics.P2.Body.STATIC=2;r.Physics.P2.Body.KINEMATIC=4;Object.defineProperty(r.Physics.P2.Body.prototype,"static",{get:function(){return this.data.type===r.Physics.P2.Body.STATIC},set:function(t){if(t&&this.data.type!==r.Physics.P2.Body.STATIC){this.data.type=r.Physics.P2.Body.STATIC;this.mass=0}else if(!t&&this.data.type===r.Physics.P2.Body.STATIC){this.data.type=r.Physics.P2.Body.DYNAMIC;this.mass=1}}});Object.defineProperty(r.Physics.P2.Body.prototype,"dynamic",{get:function(){return this.data.type===r.Physics.P2.Body.DYNAMIC},set:function(t){if(t&&this.data.type!==r.Physics.P2.Body.DYNAMIC){this.data.type=r.Physics.P2.Body.DYNAMIC;this.mass=1}else if(!t&&this.data.type===r.Physics.P2.Body.DYNAMIC){this.data.type=r.Physics.P2.Body.STATIC;this.mass=0}}});Object.defineProperty(r.Physics.P2.Body.prototype,"kinematic",{get:function(){return this.data.type===r.Physics.P2.Body.KINEMATIC},set:function(t){if(t&&this.data.type!==r.Physics.P2.Body.KINEMATIC){this.data.type=r.Physics.P2.Body.KINEMATIC;this.mass=4}else if(!t&&this.data.type===r.Physics.P2.Body.KINEMATIC){this.data.type=r.Physics.P2.Body.STATIC;this.mass=0}}});Object.defineProperty(r.Physics.P2.Body.prototype,"allowSleep",{get:function(){return this.data.allowSleep},set:function(t){if(t!==this.data.allowSleep){this.data.allowSleep=t}}});Object.defineProperty(r.Physics.P2.Body.prototype,"angle",{get:function(){return r.Math.wrapAngle(r.Math.radToDeg(this.data.angle))},set:function(t){this.data.angle=r.Math.degToRad(r.Math.wrapAngle(t))}});Object.defineProperty(r.Physics.P2.Body.prototype,"angularDamping",{get:function(){return this.data.angularDamping},set:function(t){this.data.angularDamping=t}});Object.defineProperty(r.Physics.P2.Body.prototype,"angularForce",{get:function(){return this.data.angularForce},set:function(t){this.data.angularForce=t}});Object.defineProperty(r.Physics.P2.Body.prototype,"angularVelocity",{get:function(){return this.data.angularVelocity},set:function(t){this.data.angularVelocity=t}});Object.defineProperty(r.Physics.P2.Body.prototype,"damping",{get:function(){return this.data.damping},set:function(t){this.data.damping=t}});Object.defineProperty(r.Physics.P2.Body.prototype,"fixedRotation",{get:function(){return this.data.fixedRotation},set:function(t){if(t!==this.data.fixedRotation){this.data.fixedRotation=t}}});Object.defineProperty(r.Physics.P2.Body.prototype,"inertia",{get:function(){return this.data.inertia},set:function(t){this.data.inertia=t}});Object.defineProperty(r.Physics.P2.Body.prototype,"mass",{get:function(){return this.data.mass},set:function(t){if(t!==this.data.mass){this.data.mass=t;this.data.updateMassProperties()}}});Object.defineProperty(r.Physics.P2.Body.prototype,"motionState",{get:function(){return this.data.type},set:function(t){if(t!==this.data.type){this.data.type=t}}});Object.defineProperty(r.Physics.P2.Body.prototype,"rotation",{get:function(){return this.data.angle},set:function(t){this.data.angle=t}});Object.defineProperty(r.Physics.P2.Body.prototype,"sleepSpeedLimit",{get:function(){return this.data.sleepSpeedLimit},set:function(t){this.data.sleepSpeedLimit=t}});Object.defineProperty(r.Physics.P2.Body.prototype,"x",{get:function(){return this.world.mpxi(this.data.position[0])},set:function(t){this.data.position[0]=this.world.pxmi(t)}});Object.defineProperty(r.Physics.P2.Body.prototype,"y",{get:function(){return this.world.mpxi(this.data.position[1])},set:function(t){this.data.position[1]=this.world.pxmi(t)}});Object.defineProperty(r.Physics.P2.Body.prototype,"id",{get:function(){return this.data.id}});Object.defineProperty(r.Physics.P2.Body.prototype,"debug",{get:function(){return this.debugBody!==null},set:function(t){if(t&&!this.debugBody){this.debugBody=new r.Physics.P2.BodyDebug(this.game,this.data)}else if(!t&&this.debugBody){this.debugBody.destroy();this.debugBody=null}}});Object.defineProperty(r.Physics.P2.Body.prototype,"collideWorldBounds",{get:function(){return this._collideWorldBounds},set:function(t){if(t&&!this._collideWorldBounds){this._collideWorldBounds=true;this.updateCollisionMask()}else if(!t&&this._collideWorldBounds){this._collideWorldBounds=false;this.updateCollisionMask()}}});r.Physics.P2.BodyDebug=function(t,e,i){r.Group.call(this,t);var s={pixelsPerLengthUnit:t.physics.p2.mpx(1),debugPolygons:false,lineWidth:1,alpha:.5};this.settings=r.Utils.extend(s,i);this.ppu=this.settings.pixelsPerLengthUnit;this.ppu=-1*this.ppu;this.body=e;this.canvas=new r.Graphics(t);this.canvas.alpha=this.settings.alpha;this.add(this.canvas);this.draw();this.updateSpriteTransform()};r.Physics.P2.BodyDebug.prototype=Object.create(r.Group.prototype);r.Physics.P2.BodyDebug.prototype.constructor=r.Physics.P2.BodyDebug;r.Utils.extend(r.Physics.P2.BodyDebug.prototype,{updateSpriteTransform:function(){this.position.x=this.body.position[0]*this.ppu;this.position.y=this.body.position[1]*this.ppu;this.rotation=this.body.angle},draw:function(){var t,e,i,s,r,n,a,o,h,l,u,c,d,f,p;o=this.body;l=this.canvas;l.clear();i=parseInt(this.randomPastelHex(),16);n=16711680;a=this.lineWidth;if(o instanceof p2.Body&&o.shapes.length){var g=o.shapes.length;s=0;while(s!==g){e=o.shapes[s];h=e.position||0;t=e.angle||0;if(e instanceof p2.Circle){this.drawCircle(l,h[0]*this.ppu,h[1]*this.ppu,t,e.radius*this.ppu,i,a)}else if(e instanceof p2.Capsule){this.drawCapsule(l,h[0]*this.ppu,h[1]*this.ppu,t,e.length*this.ppu,e.radius*this.ppu,n,i,a)}else if(e instanceof p2.Plane){this.drawPlane(l,h[0]*this.ppu,-h[1]*this.ppu,i,n,a*5,a*10,a*10,this.ppu*100,t)}else if(e instanceof p2.Line){this.drawLine(l,e.length*this.ppu,n,a)}else if(e instanceof p2.Box){this.drawRectangle(l,h[0]*this.ppu,h[1]*this.ppu,t,e.width*this.ppu,e.height*this.ppu,n,i,a)}else if(e instanceof p2.Convex){c=[];d=p2.vec2.create();for(r=f=0,p=e.vertices.length;0<=p?f<p:f>p;r=0<=p?++f:--f){u=e.vertices[r];p2.vec2.rotate(d,u,t);c.push([(d[0]+h[0])*this.ppu,-(d[1]+h[1])*this.ppu])}this.drawConvex(l,c,e.triangles,n,i,a,this.settings.debugPolygons,[h[0]*this.ppu,-h[1]*this.ppu])}s++}}},drawRectangle:function(t,e,i,s,r,n,a,o,h){if(h===undefined){h=1}if(a===undefined){a=0}t.lineStyle(h,a,1);t.beginFill(o);t.drawRect(e-r/2,i-n/2,r,n)},drawCircle:function(t,e,i,s,r,n,a){if(a===undefined){a=1}if(n===undefined){n=16777215}t.lineStyle(a,0,1);t.beginFill(n,1);t.drawCircle(e,i,-r*2);t.endFill();t.moveTo(e,i);t.lineTo(e+r*Math.cos(-s),i+r*Math.sin(-s))},drawLine:function(t,e,i,s){if(s===undefined){s=1}if(i===undefined){i=0}t.lineStyle(s*5,i,1);t.moveTo(-e/2,0);t.lineTo(e/2,0)},drawConvex:function(t,e,i,s,r,n,a,o){var h,l,u,c,d,f,p,g,m,y,v;if(n===undefined){n=1}if(s===undefined){s=0}if(!a){t.lineStyle(n,s,1);t.beginFill(r);l=0;while(l!==e.length){u=e[l];f=u[0];m=u[1];if(l===0){t.moveTo(f,-m)}else{t.lineTo(f,-m)}l++}t.endFill();if(e.length>2){t.moveTo(e[e.length-1][0],-e[e.length-1][1]);return t.lineTo(e[0][0],-e[0][1])}}else{h=[16711680,65280,255];l=0;while(l!==e.length+1){c=e[l%e.length];d=e[(l+1)%e.length];p=c[0];y=c[1];g=d[0];v=d[1];t.lineStyle(n,h[l%h.length],1);t.moveTo(p,-y);t.lineTo(g,-v);t.drawCircle(p,-y,n*2);l++}t.lineStyle(n,0,1);return t.drawCircle(o[0],o[1],n*2)}},drawPath:function(t,e,i,s,r){var n,a,o,h,l,u,c,d,f,p,g,m,y;if(r===undefined){r=1}if(i===undefined){i=0}t.lineStyle(r,i,1);if(typeof s==="number"){t.beginFill(s)}o=null;h=null;a=0;while(a<e.length){g=e[a];m=g[0];y=g[1];if(m!==o||y!==h){if(a===0){t.moveTo(m,y)}else{l=o;u=h;c=m;d=y;f=e[(a+1)%e.length][0];p=e[(a+1)%e.length][1];n=(c-l)*(p-u)-(f-l)*(d-u);if(n!==0){t.lineTo(m,y)}}o=m;h=y}a++}if(typeof s==="number"){t.endFill()}if(e.length>2&&typeof s==="number"){t.moveTo(e[e.length-1][0],e[e.length-1][1]);t.lineTo(e[0][0],e[0][1])}},drawPlane:function(t,e,i,s,r,n,a,o,h,l){var u,c,d;if(n===undefined){n=1}if(s===undefined){s=16777215}t.lineStyle(n,r,11);t.beginFill(s);u=h;t.moveTo(e,-i);c=e+Math.cos(l)*this.game.width;d=i+Math.sin(l)*this.game.height;t.lineTo(c,-d);t.moveTo(e,-i);c=e+Math.cos(l)*-this.game.width;d=i+Math.sin(l)*-this.game.height;t.lineTo(c,-d)},drawCapsule:function(t,e,i,s,r,n,a,o,h){if(h===undefined){h=1}if(a===undefined){a=0}t.lineStyle(h,a,1);var l=Math.cos(s);var u=Math.sin(s);t.beginFill(o,1);t.drawCircle(-r/2*l+e,-r/2*u+i,-n*2);t.drawCircle(r/2*l+e,r/2*u+i,-n*2);t.endFill();t.lineStyle(h,a,0);t.beginFill(o,1);t.moveTo(-r/2*l+n*u+e,-r/2*u+n*l+i);t.lineTo(r/2*l+n*u+e,r/2*u+n*l+i);t.lineTo(r/2*l-n*u+e,r/2*u-n*l+i);t.lineTo(-r/2*l-n*u+e,-r/2*u-n*l+i);t.endFill();t.lineStyle(h,a,1);t.moveTo(-r/2*l+n*u+e,-r/2*u+n*l+i);t.lineTo(r/2*l+n*u+e,r/2*u+n*l+i);t.moveTo(-r/2*l-n*u+e,-r/2*u-n*l+i);t.lineTo(r/2*l-n*u+e,r/2*u-n*l+i)},randomPastelHex:function(){var t,e,i,s;i=[255,255,255];s=Math.floor(Math.random()*256);e=Math.floor(Math.random()*256);t=Math.floor(Math.random()*256);s=Math.floor((s+3*i[0])/4);e=Math.floor((e+3*i[1])/4);t=Math.floor((t+3*i[2])/4);return this.rgbToHex(s,e,t)},rgbToHex:function(t,e,i){return this.componentToHex(t)+this.componentToHex(e)+this.componentToHex(i)},componentToHex:function(t){var e;e=t.toString(16);if(e.length===2){return e}else{return e+"0"}}});r.Physics.P2.Spring=function(t,e,i,s,r,n,a,o,h,l){this.game=t.game;this.world=t;if(s===undefined){s=1}if(r===undefined){r=100}if(n===undefined){n=1}s=t.pxm(s);var u={restLength:s,stiffness:r,damping:n};if(typeof a!=="undefined"&&a!==null){u.worldAnchorA=[t.pxm(a[0]),t.pxm(a[1])]}if(typeof o!=="undefined"&&o!==null){u.worldAnchorB=[t.pxm(o[0]),t.pxm(o[1])]}if(typeof h!=="undefined"&&h!==null){u.localAnchorA=[t.pxm(h[0]),t.pxm(h[1])]}if(typeof l!=="undefined"&&l!==null){u.localAnchorB=[t.pxm(l[0]),t.pxm(l[1])]}this.data=new p2.LinearSpring(e,i,u);this.data.parent=this};r.Physics.P2.Spring.prototype.constructor=r.Physics.P2.Spring;r.Physics.P2.RotationalSpring=function(t,e,i,s,r,n){this.game=t.game;this.world=t;if(s===undefined){s=null}if(r===undefined){r=100}if(n===undefined){n=1}if(s){s=t.pxm(s)}var a={restAngle:s,stiffness:r,damping:n};this.data=new p2.RotationalSpring(e,i,a);this.data.parent=this};r.Physics.P2.Spring.prototype.constructor=r.Physics.P2.Spring;r.Physics.P2.Material=function(t){this.name=t;p2.Material.call(this)};r.Physics.P2.Material.prototype=Object.create(p2.Material.prototype);r.Physics.P2.Material.prototype.constructor=r.Physics.P2.Material;r.Physics.P2.ContactMaterial=function(t,e,i){p2.ContactMaterial.call(this,t,e,i)};r.Physics.P2.ContactMaterial.prototype=Object.create(p2.ContactMaterial.prototype);r.Physics.P2.ContactMaterial.prototype.constructor=r.Physics.P2.ContactMaterial;r.Physics.P2.CollisionGroup=function(t){this.mask=t};r.Physics.P2.DistanceConstraint=function(t,e,i,s,r,n,a){if(s===undefined){s=100}if(r===undefined){r=[0,0]}if(n===undefined){n=[0,0]}if(a===undefined){a=Number.MAX_VALUE}this.game=t.game;this.world=t;s=t.pxm(s);r=[t.pxmi(r[0]),t.pxmi(r[1])];n=[t.pxmi(n[0]),t.pxmi(n[1])];var o={distance:s,localAnchorA:r,localAnchorB:n,maxForce:a};p2.DistanceConstraint.call(this,e,i,o)};r.Physics.P2.DistanceConstraint.prototype=Object.create(p2.DistanceConstraint.prototype);r.Physics.P2.DistanceConstraint.prototype.constructor=r.Physics.P2.DistanceConstraint;r.Physics.P2.GearConstraint=function(t,e,i,s,r){if(s===undefined){s=0}if(r===undefined){r=1}this.game=t.game;this.world=t;var n={angle:s,ratio:r};p2.GearConstraint.call(this,e,i,n)};r.Physics.P2.GearConstraint.prototype=Object.create(p2.GearConstraint.prototype);r.Physics.P2.GearConstraint.prototype.constructor=r.Physics.P2.GearConstraint;r.Physics.P2.LockConstraint=function(t,e,i,s,r,n){if(s===undefined){s=[0,0]}if(r===undefined){r=0}if(n===undefined){n=Number.MAX_VALUE}this.game=t.game;this.world=t;s=[t.pxm(s[0]),t.pxm(s[1])];var a={localOffsetB:s,localAngleB:r,maxForce:n};p2.LockConstraint.call(this,e,i,a)};r.Physics.P2.LockConstraint.prototype=Object.create(p2.LockConstraint.prototype);r.Physics.P2.LockConstraint.prototype.constructor=r.Physics.P2.LockConstraint;r.Physics.P2.PrismaticConstraint=function(t,e,i,s,r,n,a,o){if(s===undefined){s=true}if(r===undefined){r=[0,0]}if(n===undefined){n=[0,0]}if(a===undefined){a=[0,0]}if(o===undefined){o=Number.MAX_VALUE}this.game=t.game;this.world=t;r=[t.pxmi(r[0]),t.pxmi(r[1])];n=[t.pxmi(n[0]),t.pxmi(n[1])];var h={localAnchorA:r,localAnchorB:n,localAxisA:a,maxForce:o,disableRotationalLock:!s};p2.PrismaticConstraint.call(this,e,i,h)};r.Physics.P2.PrismaticConstraint.prototype=Object.create(p2.PrismaticConstraint.prototype);r.Physics.P2.PrismaticConstraint.prototype.constructor=r.Physics.P2.PrismaticConstraint;r.Physics.P2.RevoluteConstraint=function(t,e,i,s,r,n,a){if(n===undefined){n=Number.MAX_VALUE}if(a===undefined){a=null}this.game=t.game;this.world=t;i=[t.pxmi(i[0]),t.pxmi(i[1])];r=[t.pxmi(r[0]),t.pxmi(r[1])];if(a){a=[t.pxmi(a[0]),t.pxmi(a[1])]}var o={worldPivot:a,localPivotA:i,localPivotB:r,maxForce:n};p2.RevoluteConstraint.call(this,e,s,o)};r.Physics.P2.RevoluteConstraint.prototype=Object.create(p2.RevoluteConstraint.prototype);r.Physics.P2.RevoluteConstraint.prototype.constructor=r.Physics.P2.RevoluteConstraint;r.ImageCollection=function(t,e,i,s,r,n,a){if(i===undefined||i<=0){i=32}if(s===undefined||s<=0){s=32}if(r===undefined){r=0}if(n===undefined){n=0}this.name=t;this.firstgid=e|0;this.imageWidth=i|0;this.imageHeight=s|0;this.imageMargin=r|0;this.imageSpacing=n|0;this.properties=a||{};this.images=[];this.total=0};r.ImageCollection.prototype={containsImageIndex:function(t){return t>=this.firstgid&&t<this.firstgid+this.total},addImage:function(t,e){this.images.push({gid:t,image:e});this.total++}};r.ImageCollection.prototype.constructor=r.ImageCollection;r.Tile=function(t,e,i,s,r,n){this.layer=t;this.index=e;this.x=i;this.y=s;this.rotation=0;this.flipped=false;this.worldX=i*r;this.worldY=s*n;this.width=r;this.height=n;this.centerX=Math.abs(r/2);this.centerY=Math.abs(n/2);this.alpha=1;this.properties={};this.scanned=false;this.faceTop=false;this.faceBottom=false;this.faceLeft=false;this.faceRight=false;this.collideLeft=false;this.collideRight=false;this.collideUp=false;this.collideDown=false;this.collisionCallback=null;this.collisionCallbackContext=this};r.Tile.prototype={containsPoint:function(t,e){return!(t<this.worldX||e<this.worldY||t>this.right||e>this.bottom)},intersects:function(t,e,i,s){if(i<=this.worldX){return false}if(s<=this.worldY){return false}if(t>=this.worldX+this.width){return false}if(e>=this.worldY+this.height){return false}return true},setCollisionCallback:function(t,e){this.collisionCallback=t;this.collisionCallbackContext=e},destroy:function(){this.collisionCallback=null;this.collisionCallbackContext=null;this.properties=null},setCollision:function(t,e,i,s){this.collideLeft=t;this.collideRight=e;this.collideUp=i;this.collideDown=s;this.faceLeft=t;this.faceRight=e;this.faceTop=i;this.faceBottom=s},resetCollision:function(){this.collideLeft=false;this.collideRight=false;this.collideUp=false;this.collideDown=false;this.faceTop=false;this.faceBottom=false;this.faceLeft=false;this.faceRight=false},isInteresting:function(t,e){if(t&&e){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.faceTop||this.faceBottom||this.faceLeft||this.faceRight||this.collisionCallback}else if(t){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown}else if(e){return this.faceTop||this.faceBottom||this.faceLeft||this.faceRight}return false},copy:function(t){this.index=t.index;this.alpha=t.alpha;this.properties=t.properties;this.collideUp=t.collideUp;this.collideDown=t.collideDown;this.collideLeft=t.collideLeft;this.collideRight=t.collideRight;this.collisionCallback=t.collisionCallback;this.collisionCallbackContext=t.collisionCallbackContext}};r.Tile.prototype.constructor=r.Tile;Object.defineProperty(r.Tile.prototype,"collides",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown}});Object.defineProperty(r.Tile.prototype,"canCollide",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.collisionCallback}});Object.defineProperty(r.Tile.prototype,"left",{get:function(){return this.worldX}});Object.defineProperty(r.Tile.prototype,"right",{get:function(){return this.worldX+this.width}});Object.defineProperty(r.Tile.prototype,"top",{get:function(){return this.worldY}});Object.defineProperty(r.Tile.prototype,"bottom",{get:function(){return this.worldY+this.height}});r.Tilemap=function(t,e,i,s,n,a){this.game=t;this.key=e;var o=r.TilemapParser.parse(this.game,e,i,s,n,a);if(o===null){return}this.width=o.width;this.height=o.height;this.tileWidth=o.tileWidth;this.tileHeight=o.tileHeight;this.orientation=o.orientation;this.format=o.format;this.version=o.version;this.properties=o.properties;this.widthInPixels=o.widthInPixels;this.heightInPixels=o.heightInPixels;this.layers=o.layers;this.tilesets=o.tilesets;this.imagecollections=o.imagecollections;this.tiles=o.tiles;this.objects=o.objects;this.collideIndexes=[];this.collision=o.collision;this.images=o.images;this.enableDebug=false;this.currentLayer=0;this.debugMap=[];this._results=[];this._tempA=0;this._tempB=0};r.Tilemap.CSV=0;r.Tilemap.TILED_JSON=1;r.Tilemap.NORTH=0;r.Tilemap.EAST=1;r.Tilemap.SOUTH=2;r.Tilemap.WEST=3;r.Tilemap.prototype={create:function(t,e,i,s,r,n){if(n===undefined){n=this.game.world}this.width=e;this.height=i;this.setTileSize(s,r);this.layers.length=0;return this.createBlankLayer(t,e,i,s,r,n)},setTileSize:function(t,e){this.tileWidth=t;this.tileHeight=e;this.widthInPixels=this.width*t;this.heightInPixels=this.height*e},addTilesetImage:function(t,e,i,s,n,a,o){if(t===undefined){return null}if(i===undefined){i=this.tileWidth}if(s===undefined){s=this.tileHeight}if(n===undefined){n=0}if(a===undefined){a=0}if(o===undefined){o=0}if(i===0){i=32}if(s===0){s=32}var h=null;if(e===undefined||e===null){e=t}if(e instanceof r.BitmapData){h=e.canvas}else{if(!this.game.cache.checkImageKey(e)){console.warn('Phaser.Tilemap.addTilesetImage: Invalid image key given: "'+e+'"');return null}h=this.game.cache.getImage(e)}var l=this.getTilesetIndex(t);if(l===null&&this.format===r.Tilemap.TILED_JSON){console.warn('Phaser.Tilemap.addTilesetImage: No data found in the JSON matching the tileset name: "'+t+'"');return null}if(this.tilesets[l]){this.tilesets[l].setImage(h);return this.tilesets[l]}else{var u=new r.Tileset(t,o,i,s,n,a,{});u.setImage(h);this.tilesets.push(u);var c=this.tilesets.length-1;var d=n;var f=n;var p=0;var g=0;var m=0;for(var y=o;y<o+u.total;y++){this.tiles[y]=[d,f,c];d+=i+a;p++;if(p===u.total){break}g++;if(g===u.columns){d=n;f+=s+a;g=0;m++;if(m===u.rows){break}}}return u}return null},createFromObjects:function(t,e,i,s,n,a,o,h,l){if(n===undefined){n=true}if(a===undefined){a=false}if(o===undefined){o=this.game.world}if(h===undefined){h=r.Sprite}if(l===undefined){l=true}if(!this.objects[t]){console.warn("Tilemap.createFromObjects: Invalid objectgroup name given: "+t);return}for(var u=0;u<this.objects[t].length;u++){var c=false;var d=this.objects[t][u];if(d.gid!==undefined&&typeof e==="number"&&d.gid===e){c=true}else if(d.id!==undefined&&typeof e==="number"&&d.id===e){c=true}else if(d.name!==undefined&&typeof e==="string"&&d.name===e){c=true}if(c){var f=new h(this.game,parseFloat(d.x,10),parseFloat(d.y,10),i,s);f.name=d.name;f.visible=d.visible;f.autoCull=a;f.exists=n;if(d.width){f.width=d.width}if(d.height){f.height=d.height}if(d.rotation){f.angle=d.rotation}if(l){f.y-=f.height}o.add(f);for(var p in d.properties){o.set(f,p,d.properties[p],false,false,0,true)}}}},createFromTiles:function(t,e,i,s,n,a){if(typeof t==="number"){t=[t]}if(e===undefined||e===null){e=[]}else if(typeof e==="number"){e=[e]}s=this.getLayer(s);if(n===undefined){n=this.game.world}if(a===undefined){a={}}if(a.customClass===undefined){a.customClass=r.Sprite}if(a.adjustY===undefined){a.adjustY=true}var o=this.layers[s].width;var h=this.layers[s].height;this.copy(0,0,o,h,s);if(this._results.length<2){return 0}var l=0;var u;for(var c=1,d=this._results.length;c<d;c++){if(t.indexOf(this._results[c].index)!==-1){u=new a.customClass(this.game,this._results[c].worldX,this._results[c].worldY,i);for(var f in a){u[f]=a[f]}n.add(u);l++}}if(e.length===1){for(c=0;c<t.length;c++){this.replace(t[c],e[0],0,0,o,h,s)}}else if(e.length>1){for(c=0;c<t.length;c++){this.replace(t[c],e[c],0,0,o,h,s)}}return l},createLayer:function(t,e,i,s){if(e===undefined){e=this.game.width}if(i===undefined){i=this.game.height}if(s===undefined){s=this.game.world}var n=t;if(typeof t==="string"){n=this.getLayerIndex(t)}if(n===null||n>this.layers.length){console.warn("Tilemap.createLayer: Invalid layer ID given: "+n);return}if(e===undefined||e<=0){e=Math.min(this.game.width,this.layers[n].widthInPixels)}else if(e>this.game.width){e=this.game.width}if(i===undefined||i<=0){i=Math.min(this.game.height,this.layers[n].heightInPixels)}else if(i>this.game.height){i=this.game.height}if(this.enableDebug){console.group("Tilemap.createLayer");console.log("Name:",this.layers[n].name);console.log("Size:",e,"x",i);console.log("Tileset:",this.tilesets[0].name,"index:",n)}var a=s.add(new r.TilemapLayer(this.game,this,n,e,i));if(this.enableDebug){console.groupEnd()}return a},createBlankLayer:function(t,e,i,s,n,a){if(a===undefined){a=this.game.world}if(this.getLayerIndex(t)!==null){console.warn("Tilemap.createBlankLayer: Layer with matching name already exists: "+t);return}var o={name:t,x:0,y:0,width:e,height:i,widthInPixels:e*s,heightInPixels:i*n,alpha:1,visible:true,properties:{},indexes:[],callbacks:[],bodies:[],data:null};var h;var l=[];for(var u=0;u<i;u++){h=[];for(var c=0;c<e;c++){h.push(new r.Tile(o,-1,c,u,s,n))}l.push(h)}o.data=l;this.layers.push(o);this.currentLayer=this.layers.length-1;var d=o.widthInPixels;var f=o.heightInPixels;if(d>this.game.width){d=this.game.width}if(f>this.game.height){f=this.game.height}var l=new r.TilemapLayer(this.game,this,this.layers.length-1,d,f);l.name=t;return a.add(l)},getIndex:function(t,e){for(var i=0;i<t.length;i++){if(t[i].name===e){return i}}return null},getLayerIndex:function(t){return this.getIndex(this.layers,t)},getTilesetIndex:function(t){return this.getIndex(this.tilesets,t)},getImageIndex:function(t){return this.getIndex(this.images,t)},setTileIndexCallback:function(t,e,i,s){s=this.getLayer(s);if(typeof t==="number"){this.layers[s].callbacks[t]={callback:e,callbackContext:i}}else{for(var r=0,n=t.length;r<n;r++){this.layers[s].callbacks[t[r]]={callback:e,callbackContext:i}}}},setTileLocationCallback:function(t,e,i,s,r,n,a){a=this.getLayer(a);this.copy(t,e,i,s,a);if(this._results.length<2){return}for(var o=1;o<this._results.length;o++){this._results[o].setCollisionCallback(r,n)}},setCollision:function(t,e,i,s){if(e===undefined){e=true}if(s===undefined){s=true}i=this.getLayer(i);if(typeof t==="number"){return this.setCollisionByIndex(t,e,i,true)}else if(Array.isArray(t)){for(var r=0;r<t.length;r++){this.setCollisionByIndex(t[r],e,i,false)}if(s){this.calculateFaces(i)}}},setCollisionBetween:function(t,e,i,s,r){if(i===undefined){i=true}if(r===undefined){r=true}s=this.getLayer(s);if(t>e){return}for(var n=t;n<=e;n++){this.setCollisionByIndex(n,i,s,false)}if(r){this.calculateFaces(s)}},setCollisionByExclusion:function(t,e,i,s){if(e===undefined){e=true}if(s===undefined){s=true}i=this.getLayer(i);for(var r=0,n=this.tiles.length;r<n;r++){if(t.indexOf(r)===-1){this.setCollisionByIndex(r,e,i,false)}}if(s){this.calculateFaces(i)}},setCollisionByIndex:function(t,e,i,s){if(e===undefined){e=true}if(i===undefined){i=this.currentLayer}if(s===undefined){s=true}if(e){this.collideIndexes.push(t)}else{var r=this.collideIndexes.indexOf(t);if(r>-1){this.collideIndexes.splice(r,1)}}for(var n=0;n<this.layers[i].height;n++){for(var a=0;a<this.layers[i].width;a++){var o=this.layers[i].data[n][a];if(o&&o.index===t){if(e){o.setCollision(true,true,true,true)}else{o.resetCollision()}o.faceTop=e;o.faceBottom=e;o.faceLeft=e;o.faceRight=e}}}if(s){this.calculateFaces(i)}return i},getLayer:function(t){if(t===undefined){t=this.currentLayer}else if(typeof t==="string"){t=this.getLayerIndex(t)}else if(t instanceof r.TilemapLayer){t=t.index}return t},setPreventRecalculate:function(t){if(t===true&&this.preventingRecalculate!==true){this.preventingRecalculate=true;this.needToRecalculate={}}if(t===false&&this.preventingRecalculate===true){this.preventingRecalculate=false;for(var e in this.needToRecalculate){this.calculateFaces(e)}this.needToRecalculate=false}},calculateFaces:function(t){if(this.preventingRecalculate){this.needToRecalculate[t]=true;return}var e=null;var i=null;var s=null;var r=null;for(var n=0,a=this.layers[t].height;n<a;n++){for(var o=0,h=this.layers[t].width;o<h;o++){var l=this.layers[t].data[n][o];if(l){e=this.getTileAbove(t,o,n);i=this.getTileBelow(t,o,n);s=this.getTileLeft(t,o,n);r=this.getTileRight(t,o,n);if(l.collides){l.faceTop=true;l.faceBottom=true;l.faceLeft=true;l.faceRight=true}if(e&&e.collides){l.faceTop=false}if(i&&i.collides){l.faceBottom=false}if(s&&s.collides){l.faceLeft=false}if(r&&r.collides){l.faceRight=false}}}}},getTileAbove:function(t,e,i){if(i>0){return this.layers[t].data[i-1][e]}return null},getTileBelow:function(t,e,i){if(i<this.layers[t].height-1){return this.layers[t].data[i+1][e]}return null},getTileLeft:function(t,e,i){if(e>0){return this.layers[t].data[i][e-1]}return null},getTileRight:function(t,e,i){if(e<this.layers[t].width-1){return this.layers[t].data[i][e+1]}return null},setLayer:function(t){t=this.getLayer(t);if(this.layers[t]){this.currentLayer=t}},hasTile:function(t,e,i){i=this.getLayer(i);if(this.layers[i].data[e]===undefined||this.layers[i].data[e][t]===undefined){return false}return this.layers[i].data[e][t].index>-1},removeTile:function(t,e,i){i=this.getLayer(i);if(t>=0&&t<this.layers[i].width&&e>=0&&e<this.layers[i].height){if(this.hasTile(t,e,i)){var s=this.layers[i].data[e][t];this.layers[i].data[e][t]=new r.Tile(this.layers[i],-1,t,e,this.tileWidth,this.tileHeight);this.layers[i].dirty=true;this.calculateFaces(i);return s}}},removeTileWorldXY:function(t,e,i,s,r){r=this.getLayer(r);t=this.game.math.snapToFloor(t,i)/i;e=this.game.math.snapToFloor(e,s)/s;return this.removeTile(t,e,r)},putTile:function(t,e,i,s){if(t===null){return this.removeTile(e,i,s)}s=this.getLayer(s);if(e>=0&&e<this.layers[s].width&&i>=0&&i<this.layers[s].height){var n;if(t instanceof r.Tile){n=t.index;if(this.hasTile(e,i,s)){this.layers[s].data[i][e].copy(t)}else{this.layers[s].data[i][e]=new r.Tile(s,n,e,i,t.width,t.height)}}else{n=t;if(this.hasTile(e,i,s)){this.layers[s].data[i][e].index=n}else{this.layers[s].data[i][e]=new r.Tile(this.layers[s],n,e,i,this.tileWidth,this.tileHeight)}}if(this.collideIndexes.indexOf(n)>-1){this.layers[s].data[i][e].setCollision(true,true,true,true)}else{this.layers[s].data[i][e].resetCollision()}this.layers[s].dirty=true;this.calculateFaces(s);return this.layers[s].data[i][e]}return null},putTileWorldXY:function(t,e,i,s,r,n){n=this.getLayer(n);e=this.game.math.snapToFloor(e,s)/s;i=this.game.math.snapToFloor(i,r)/r;return this.putTile(t,e,i,n)},searchTileIndex:function(t,e,i,s){if(e===undefined){e=0}if(i===undefined){i=false}s=this.getLayer(s);var r=0;if(i){for(var n=this.layers[s].height-1;n>=0;n--){for(var a=this.layers[s].width-1;a>=0;a--){if(this.layers[s].data[n][a].index===t){if(r===e){return this.layers[s].data[n][a]}else{r++}}}}}else{for(var n=0;n<this.layers[s].height;n++){for(var a=0;a<this.layers[s].width;a++){if(this.layers[s].data[n][a].index===t){if(r===e){return this.layers[s].data[n][a]}else{r++}}}}}return null},getTile:function(t,e,i,s){if(s===undefined){s=false}i=this.getLayer(i);if(t>=0&&t<this.layers[i].width&&e>=0&&e<this.layers[i].height){if(this.layers[i].data[e][t].index===-1){if(s){return this.layers[i].data[e][t]}else{return null}}else{return this.layers[i].data[e][t]}}else{return null}},getTileWorldXY:function(t,e,i,s,r,n){if(i===undefined){i=this.tileWidth}if(s===undefined){s=this.tileHeight}r=this.getLayer(r);t=this.game.math.snapToFloor(t,i)/i;e=this.game.math.snapToFloor(e,s)/s;return this.getTile(t,e,r,n)},copy:function(t,e,i,s,r){r=this.getLayer(r);if(!this.layers[r]){this._results.length=0;return}if(t===undefined){t=0}if(e===undefined){e=0}if(i===undefined){i=this.layers[r].width}if(s===undefined){s=this.layers[r].height}if(t<0){t=0}if(e<0){e=0}if(i>this.layers[r].width){i=this.layers[r].width}if(s>this.layers[r].height){s=this.layers[r].height}this._results.length=0;this._results.push({x:t,y:e,width:i,height:s,layer:r});for(var n=e;n<e+s;n++){for(var a=t;a<t+i;a++){this._results.push(this.layers[r].data[n][a])}}return this._results},paste:function(t,e,i,s){if(t===undefined){t=0}if(e===undefined){e=0}s=this.getLayer(s);if(!i||i.length<2){return}var r=t-i[1].x;var n=e-i[1].y;for(var a=1;a<i.length;a++){this.layers[s].data[n+i[a].y][r+i[a].x].copy(i[a])}this.layers[s].dirty=true;this.calculateFaces(s)},swap:function(t,e,i,s,r,n,a){a=this.getLayer(a);this.copy(i,s,r,n,a);if(this._results.length<2){return}this._tempA=t;this._tempB=e;this._results.forEach(this.swapHandler,this);this.paste(i,s,this._results,a)},swapHandler:function(t){if(t.index===this._tempA){t.index=this._tempB}else if(t.index===this._tempB){t.index=this._tempA}},forEach:function(t,e,i,s,r,n,a){a=this.getLayer(a);this.copy(i,s,r,n,a);if(this._results.length<2){return}this._results.forEach(t,e);this.paste(i,s,this._results,a)},replace:function(t,e,i,s,r,n,a){a=this.getLayer(a);this.copy(i,s,r,n,a);if(this._results.length<2){return}for(var o=1;o<this._results.length;o++){if(this._results[o].index===t){this._results[o].index=e}}this.paste(i,s,this._results,a)},random:function(t,e,i,s,r){r=this.getLayer(r);this.copy(t,e,i,s,r);if(this._results.length<2){return}var n=[];for(var a=1;a<this._results.length;a++){if(this._results[a].index){var o=this._results[a].index;if(n.indexOf(o)===-1){n.push(o)}}}for(var h=1;h<this._results.length;h++){this._results[h].index=this.game.rnd.pick(n)}this.paste(t,e,this._results,r)},shuffle:function(t,e,i,s,n){n=this.getLayer(n);this.copy(t,e,i,s,n);if(this._results.length<2){return}var a=[];for(var o=1;o<this._results.length;o++){if(this._results[o].index){a.push(this._results[o].index)}}r.ArrayUtils.shuffle(a);for(var h=1;h<this._results.length;h++){this._results[h].index=a[h-1]}this.paste(t,e,this._results,n)},fill:function(t,e,i,s,r,n){n=this.getLayer(n);this.copy(e,i,s,r,n);if(this._results.length<2){return}for(var a=1;a<this._results.length;a++){this._results[a].index=t}this.paste(e,i,this._results,n)},removeAllLayers:function(){this.layers.length=0;this.currentLayer=0},dump:function(){var t="";var e=[""];for(var i=0;i<this.layers[this.currentLayer].height;i++){for(var s=0;s<this.layers[this.currentLayer].width;s++){t+="%c  ";if(this.layers[this.currentLayer].data[i][s]>1){if(this.debugMap[this.layers[this.currentLayer].data[i][s]]){e.push("background: "+this.debugMap[this.layers[this.currentLayer].data[i][s]])}else{e.push("background: #ffffff")}}else{e.push("background: rgb(0, 0, 0)")}}t+="\n"}e[0]=t;console.log.apply(console,e)},destroy:function(){this.removeAllLayers();this.data=[];this.game=null}};r.Tilemap.prototype.constructor=r.Tilemap;Object.defineProperty(r.Tilemap.prototype,"layer",{get:function(){return this.layers[this.currentLayer]},set:function(t){if(t!==this.currentLayer){this.setLayer(t)}}});r.TilemapLayer=function(t,e,i,s,n){s|=0;n|=0;r.Sprite.call(this,t,0,0);this.map=e;this.index=i;this.layer=e.layers[i];this.canvas=PIXI.CanvasPool.create(this,s,n);this.context=this.canvas.getContext("2d");this.setTexture(new PIXI.Texture(new PIXI.BaseTexture(this.canvas)));this.type=r.TILEMAPLAYER;this.physicsType=r.TILEMAPLAYER;this.renderSettings={enableScrollDelta:false,overdrawRatio:.2,copyCanvas:null};this.debug=false;this.exists=true;this.debugSettings={missingImageFill:"rgb(255,255,255)",debuggedTileOverfill:"rgba(0,255,0,0.4)",forceFullRedraw:true,debugAlpha:.5,facingEdgeStroke:"rgba(0,255,0,1)",collidingTileOverfill:"rgba(0,255,0,0.2)"};this.scrollFactorX=1;this.scrollFactorY=1;this.dirty=true;this.rayStepRate=4;this._wrap=false;this._mc={scrollX:0,scrollY:0,renderWidth:0,renderHeight:0,tileWidth:e.tileWidth,tileHeight:e.tileHeight,cw:e.tileWidth,ch:e.tileHeight,tilesets:[]};this._scrollX=0;this._scrollY=0;this._results=[];if(!t.device.canvasBitBltShift){this.renderSettings.copyCanvas=r.TilemapLayer.ensureSharedCopyCanvas()}this.fixedToCamera=true};r.TilemapLayer.prototype=Object.create(r.Sprite.prototype);r.TilemapLayer.prototype.constructor=r.TilemapLayer;r.TilemapLayer.prototype.preUpdateCore=r.Component.Core.preUpdate;r.TilemapLayer.sharedCopyCanvas=null;r.TilemapLayer.ensureSharedCopyCanvas=function(){if(!this.sharedCopyCanvas){this.sharedCopyCanvas=PIXI.CanvasPool.create(this,2,2)}return this.sharedCopyCanvas};r.TilemapLayer.prototype.preUpdate=function(){return this.preUpdateCore()};r.TilemapLayer.prototype.postUpdate=function(){if(this.fixedToCamera){this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y}this._scrollX=this.game.camera.view.x*this.scrollFactorX/this.scale.x;this._scrollY=this.game.camera.view.y*this.scrollFactorY/this.scale.y};r.TilemapLayer.prototype._renderCanvas=function(t){if(this.fixedToCamera){this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y}this._scrollX=this.game.camera.view.x*this.scrollFactorX/this.scale.x;this._scrollY=this.game.camera.view.y*this.scrollFactorY/this.scale.y;this.render();PIXI.Sprite.prototype._renderCanvas.call(this,t)};r.TilemapLayer.prototype._renderWebGL=function(t){if(this.fixedToCamera){this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y}this._scrollX=this.game.camera.view.x*this.scrollFactorX/this.scale.x;this._scrollY=this.game.camera.view.y*this.scrollFactorY/this.scale.y;this.render();PIXI.Sprite.prototype._renderWebGL.call(this,t)};r.TilemapLayer.prototype.destroy=function(){PIXI.CanvasPool.remove(this);r.Component.Destroy.prototype.destroy.call(this)};r.TilemapLayer.prototype.resize=function(t,e){this.canvas.width=t;this.canvas.height=e;this.texture.frame.resize(t,e);this.texture.width=t;this.texture.height=e;this.texture.crop.width=t;this.texture.crop.height=e;this.texture.baseTexture.width=t;this.texture.baseTexture.height=e;this.texture.baseTexture.dirty();this.texture.requiresUpdate=true;this.texture._updateUvs();this.dirty=true};r.TilemapLayer.prototype.resizeWorld=function(){this.game.world.setBounds(0,0,this.layer.widthInPixels*this.scale.x,this.layer.heightInPixels*this.scale.y)};r.TilemapLayer.prototype._fixX=function(t){if(this.scrollFactorX===1||this.scrollFactorX===0&&this.position.x===0){return t}if(this.scrollFactorX===0&&this.position.x!==0){return t-this.position.x}return this._scrollX+(t-this._scrollX/this.scrollFactorX)};r.TilemapLayer.prototype._unfixX=function(t){if(this.scrollFactorX===1){return t}return this._scrollX/this.scrollFactorX+(t-this._scrollX)};r.TilemapLayer.prototype._fixY=function(t){if(this.scrollFactorY===1||this.scrollFactorY===0&&this.position.y===0){return t}if(this.scrollFactorY===0&&this.position.y!==0){return t-this.position.y}return this._scrollY+(t-this._scrollY/this.scrollFactorY)};r.TilemapLayer.prototype._unfixY=function(t){if(this.scrollFactorY===1){return t}return this._scrollY/this.scrollFactorY+(t-this._scrollY)};r.TilemapLayer.prototype.getTileX=function(t){return Math.floor(this._fixX(t)/this._mc.tileWidth)};r.TilemapLayer.prototype.getTileY=function(t){return Math.floor(this._fixY(t)/this._mc.tileHeight)};r.TilemapLayer.prototype.getTileXY=function(t,e,i){i.x=this.getTileX(t);i.y=this.getTileY(e);return i};r.TilemapLayer.prototype.getRayCastTiles=function(t,e,i,s){if(!e){e=this.rayStepRate}if(i===undefined){i=false}if(s===undefined){s=false}var r=this.getTiles(t.x,t.y,t.width,t.height,i,s);if(r.length===0){return[]}var n=t.coordinatesOnLine(e);var a=[];for(var o=0;o<r.length;o++){for(var h=0;h<n.length;h++){var l=r[o];var u=n[h];if(l.containsPoint(u[0],u[1])){a.push(l);break}}}return a};r.TilemapLayer.prototype.getTiles=function(t,e,i,s,r,n){if(r===undefined){r=false}if(n===undefined){n=false}var a=!(r||n);t=this._fixX(t);e=this._fixY(e);var o=Math.floor(t/(this._mc.cw*this.scale.x));var h=Math.floor(e/(this._mc.ch*this.scale.y));var l=Math.ceil((t+i)/(this._mc.cw*this.scale.x))-o;var u=Math.ceil((e+s)/(this._mc.ch*this.scale.y))-h;while(this._results.length){this._results.pop()}for(var c=h;c<h+u;c++){for(var d=o;d<o+l;d++){var f=this.layer.data[c];if(f&&f[d]){if(a||f[d].isInteresting(r,n)){this._results.push(f[d])}}}}return this._results.slice()};r.TilemapLayer.prototype.resolveTileset=function(t){var e=this._mc.tilesets;if(t<2e3){while(e.length<t){e.push(undefined)}}var i=this.map.tiles[t]&&this.map.tiles[t][2];if(i!==null){var s=this.map.tilesets[i];if(s&&s.containsTileIndex(t)){return e[t]=s}}return e[t]=null};r.TilemapLayer.prototype.resetTilesetCache=function(){var t=this._mc.tilesets;while(t.length){t.pop()}};r.TilemapLayer.prototype.setScale=function(t,e){t=t||1;e=e||t;for(var i=0;i<this.layer.data.length;i++){var s=this.layer.data[i];for(var r=0;r<s.length;r++){var n=s[r];n.width=this.map.tileWidth*t;n.height=this.map.tileHeight*e;n.worldX=n.x*n.width;n.worldY=n.y*n.height}}this.scale.setTo(t,e)};r.TilemapLayer.prototype.shiftCanvas=function(t,e,i){var s=t.canvas;var r=s.width-Math.abs(e);var n=s.height-Math.abs(i);var a=0;var o=0;var h=e;var l=i;if(e<0){a=-e;h=0}if(i<0){o=-i;l=0}var u=this.renderSettings.copyCanvas;if(u){if(u.width<r||u.height<n){u.width=r;u.height=n}var c=u.getContext("2d");c.clearRect(0,0,r,n);c.drawImage(s,a,o,r,n,0,0,r,n);t.clearRect(h,l,r,n);t.drawImage(u,0,0,r,n,h,l,r,n)}else{t.save();t.globalCompositeOperation="copy";t.drawImage(s,a,o,r,n,h,l,r,n);t.restore()}};r.TilemapLayer.prototype.renderRegion=function(t,e,i,s,r,n){var a=this.context;var o=this.layer.width;var h=this.layer.height;var l=this._mc.tileWidth;var u=this._mc.tileHeight;var c=this._mc.tilesets;var d=NaN;if(!this._wrap){if(i<=r){i=Math.max(0,i);r=Math.min(o-1,r)}if(s<=n){s=Math.max(0,s);n=Math.min(h-1,n)}}var f=i*l-t;var p=s*u-e;var g=(i+(1<<20)*o)%o;var m=(s+(1<<20)*h)%h;var y,v,b,x,w,_;for(x=m,_=n-s,v=p;_>=0;x++,_--,v+=u){if(x>=h){x-=h}var P=this.layer.data[x];for(b=g,w=r-i,y=f;w>=0;b++,w--,y+=l){if(b>=o){b-=o}var T=P[b];if(!T||T.index<0){continue}var C=T.index;var S=c[C];if(S===undefined){S=this.resolveTileset(C)}if(T.alpha!==d&&!this.debug){a.globalAlpha=T.alpha;d=T.alpha}if(S){if(T.rotation||T.flipped){a.save();a.translate(y+T.centerX,v+T.centerY);a.rotate(T.rotation);if(T.flipped){a.scale(-1,1)}S.draw(a,-T.centerX,-T.centerY,C);a.restore()}else{S.draw(a,y,v,C)}}else if(this.debugSettings.missingImageFill){a.fillStyle=this.debugSettings.missingImageFill;a.fillRect(y,v,l,u)}if(T.debug&&this.debugSettings.debuggedTileOverfill){a.fillStyle=this.debugSettings.debuggedTileOverfill;a.fillRect(y,v,l,u)}}}};r.TilemapLayer.prototype.renderDeltaScroll=function(t,e){var i=this._mc.scrollX;var s=this._mc.scrollY;var r=this.canvas.width;var n=this.canvas.height;var a=this._mc.tileWidth;var o=this._mc.tileHeight;var h=0;var l=-a;var u=0;var c=-o;if(t<0){h=r+t;l=r-1}else if(t>0){l=t}if(e<0){u=n+e;c=n-1}else if(e>0){c=e}this.shiftCanvas(this.context,t,e);h=Math.floor((h+i)/a);l=Math.floor((l+i)/a);u=Math.floor((u+s)/o);c=Math.floor((c+s)/o);if(h<=l){this.context.clearRect(h*a-i,0,(l-h+1)*a,n);var d=Math.floor((0+s)/o);var f=Math.floor((n-1+s)/o);this.renderRegion(i,s,h,d,l,f)}if(u<=c){this.context.clearRect(0,u*o-s,r,(c-u+1)*o);var p=Math.floor((0+i)/a);var g=Math.floor((r-1+i)/a);this.renderRegion(i,s,p,u,g,c)}};r.TilemapLayer.prototype.renderFull=function(){var t=this._mc.scrollX;var e=this._mc.scrollY;var i=this.canvas.width;var s=this.canvas.height;var r=this._mc.tileWidth;var n=this._mc.tileHeight;var a=Math.floor(t/r);var o=Math.floor((i-1+t)/r);var h=Math.floor(e/n);var l=Math.floor((s-1+e)/n);this.context.clearRect(0,0,i,s);this.renderRegion(t,e,a,h,o,l)};r.TilemapLayer.prototype.render=function(){var t=false;if(!this.visible){return}if(this.dirty||this.layer.dirty){this.layer.dirty=false;t=true}var e=this.canvas.width;var i=this.canvas.height;var s=this._scrollX|0;var r=this._scrollY|0;var n=this._mc;var a=n.scrollX-s;var o=n.scrollY-r;if(!t&&a===0&&o===0&&n.renderWidth===e&&n.renderHeight===i){return}this.context.save();n.scrollX=s;n.scrollY=r;if(n.renderWidth!==e||n.renderHeight!==i){n.renderWidth=e;n.renderHeight=i}if(this.debug){this.context.globalAlpha=this.debugSettings.debugAlpha;if(this.debugSettings.forceFullRedraw){t=true}}if(!t&&this.renderSettings.enableScrollDelta&&Math.abs(a)+Math.abs(o)<Math.min(e,i)){this.renderDeltaScroll(a,o)}else{this.renderFull()}if(this.debug){this.context.globalAlpha=1;this.renderDebug()}this.texture.baseTexture.dirty();this.dirty=false;this.context.restore();return true};r.TilemapLayer.prototype.renderDebug=function(){var t=this._mc.scrollX;var e=this._mc.scrollY;var i=this.context;var s=this.canvas.width;var r=this.canvas.height;var n=this.layer.width;var a=this.layer.height;var o=this._mc.tileWidth;var h=this._mc.tileHeight;var l=Math.floor(t/o);var u=Math.floor((s-1+t)/o);var c=Math.floor(e/h);var d=Math.floor((r-1+e)/h);var f=l*o-t;var p=c*h-e;var g=(l+(1<<20)*n)%n;var m=(c+(1<<20)*a)%a;var y,v,b,x,w,_;i.strokeStyle=this.debugSettings.facingEdgeStroke;for(x=m,_=d-c,v=p;_>=0;x++,_--,v+=h){if(x>=a){x-=a}var P=this.layer.data[x];for(b=g,w=u-l,y=f;w>=0;b++,w--,y+=o){if(b>=n){b-=n}var T=P[b];if(!T||T.index<0||!T.collides){continue}if(this.debugSettings.collidingTileOverfill){i.fillStyle=this.debugSettings.collidingTileOverfill;i.fillRect(y,v,this._mc.cw,this._mc.ch)}if(this.debugSettings.facingEdgeStroke){i.beginPath();if(T.faceTop){i.moveTo(y,v);i.lineTo(y+this._mc.cw,v)}if(T.faceBottom){i.moveTo(y,v+this._mc.ch);i.lineTo(y+this._mc.cw,v+this._mc.ch)}if(T.faceLeft){i.moveTo(y,v);i.lineTo(y,v+this._mc.ch)}if(T.faceRight){i.moveTo(y+this._mc.cw,v);i.lineTo(y+this._mc.cw,v+this._mc.ch)}i.closePath();i.stroke()}}}};Object.defineProperty(r.TilemapLayer.prototype,"wrap",{get:function(){return this._wrap},set:function(t){this._wrap=t;this.dirty=true}});Object.defineProperty(r.TilemapLayer.prototype,"scrollX",{get:function(){return this._scrollX},set:function(t){this._scrollX=t}});Object.defineProperty(r.TilemapLayer.prototype,"scrollY",{get:function(){return this._scrollY},set:function(t){this._scrollY=t}});Object.defineProperty(r.TilemapLayer.prototype,"collisionWidth",{get:function(){return this._mc.cw},set:function(t){this._mc.cw=t|0;this.dirty=true}});Object.defineProperty(r.TilemapLayer.prototype,"collisionHeight",{get:function(){return this._mc.ch},set:function(t){this._mc.ch=t|0;this.dirty=true}});r.TilemapParser={INSERT_NULL:false,parse:function(t,e,i,s,n,a){if(i===undefined){i=32}if(s===undefined){s=32}if(n===undefined){n=10}if(a===undefined){a=10}if(e===undefined){return this.getEmptyData()}if(e===null){return this.getEmptyData(i,s,n,a)}var o=t.cache.getTilemapData(e);if(o){if(o.format===r.Tilemap.CSV){return this.parseCSV(e,o.data,i,s)}else if(!o.format||o.format===r.Tilemap.TILED_JSON){return this.parseTiledJSON(o.data)}}else{console.warn("Phaser.TilemapParser.parse - No map data found for key "+e)}},parseCSV:function(t,e,i,s){var n=this.getEmptyData();e=e.trim();var a=[];var o=e.split("\n");var h=o.length;var l=0;for(var u=0;u<o.length;u++){a[u]=[];var c=o[u].split(",");for(var d=0;d<c.length;d++){a[u][d]=new r.Tile(n.layers[0],parseInt(c[d],10),d,u,i,s)}if(l===0){l=c.length}}n.format=r.Tilemap.CSV;n.name=t;n.width=l;n.height=h;n.tileWidth=i;n.tileHeight=s;n.widthInPixels=l*i;n.heightInPixels=h*s;n.layers[0].width=l;n.layers[0].height=h;n.layers[0].widthInPixels=n.widthInPixels;n.layers[0].heightInPixels=n.heightInPixels;n.layers[0].data=a;return n},getEmptyData:function(t,e,i,s){return{width:i!==undefined&&i!==null?i:0,height:s!==undefined&&s!==null?s:0,tileWidth:t!==undefined&&t!==null?t:0,tileHeight:e!==undefined&&e!==null?e:0,orientation:"orthogonal",version:"1",properties:{},widthInPixels:0,heightInPixels:0,layers:[{name:"layer",x:0,y:0,width:0,height:0,widthInPixels:0,heightInPixels:0,alpha:1,visible:true,properties:{},indexes:[],callbacks:[],bodies:[],data:[]}],images:[],objects:{},collision:{},tilesets:[],tiles:[]}},parseTiledJSON:function(t){if(t.orientation!=="orthogonal"){console.warn("TilemapParser.parseTiledJSON - Only orthogonal map types are supported in this version of Phaser");return null}var e={width:t.width,height:t.height,tileWidth:t.tilewidth,tileHeight:t.tileheight,orientation:t.orientation,format:r.Tilemap.TILED_JSON,version:t.version,properties:t.properties,widthInPixels:t.width*t.tilewidth,heightInPixels:t.height*t.tileheight};var i=[];for(var s=0;s<t.layers.length;s++){if(t.layers[s].type!=="tilelayer"){continue}var n=t.layers[s];if(!n.compression&&n.encoding&&n.encoding==="base64"){var a=window.atob(n.data);var o=a.length;var h=new Array(o);for(var l=0;l<o;l+=4){h[l/4]=(a.charCodeAt(l)|a.charCodeAt(l+1)<<8|a.charCodeAt(l+2)<<16|a.charCodeAt(l+3)<<24)>>>0}n.data=h;delete n.encoding}else if(n.compression){console.warn("TilemapParser.parseTiledJSON - Layer compression is unsupported, skipping layer '"+n.name+"'");continue}var u={name:n.name,x:n.x,y:n.y,width:n.width,height:n.height,widthInPixels:n.width*t.tilewidth,heightInPixels:n.height*t.tileheight,alpha:n.opacity,visible:n.visible,properties:{},indexes:[],callbacks:[],bodies:[]};if(n.properties){u.properties=n.properties}var c=0;var d=[];var f=[];var p,g,m,y;for(var v=0,o=n.data.length;v<o;v++){p=0;g=false;y=n.data[v];m=0;if(y>536870912){if(y>2147483648){y-=2147483648;m+=4}if(y>1073741824){y-=1073741824;m+=2}if(y>536870912){y-=536870912;m+=1}switch(m){case 5:p=Math.PI/2;break;case 6:p=Math.PI;break;case 3:p=3*Math.PI/2;break;case 4:p=0;g=true;break;case 7:p=Math.PI/2;g=true;break;case 2:p=Math.PI;g=true;break;case 1:p=3*Math.PI/2;g=true;break}}if(y>0){var b=new r.Tile(u,y,c,f.length,t.tilewidth,t.tileheight);b.rotation=p;b.flipped=g;if(m!==0){b.flippedVal=m}d.push(b)}else{if(r.TilemapParser.INSERT_NULL){d.push(null)}else{d.push(new r.Tile(u,-1,c,f.length,t.tilewidth,t.tileheight))}}c++;if(c===n.width){f.push(d);c=0;d=[]}}u.data=f;i.push(u)}e.layers=i;var x=[];for(var s=0;s<t.layers.length;s++){if(t.layers[s].type!=="imagelayer"){continue}var w=t.layers[s];var _={name:w.name,image:w.image,x:w.x,y:w.y,alpha:w.opacity,visible:w.visible,properties:{}};if(w.properties){_.properties=w.properties}x.push(_)}e.images=x;var P=[];var T=[];var C=null;for(var s=0;s<t.tilesets.length;s++){var S=t.tilesets[s];if(S.image){var A=new r.Tileset(S.name,S.firstgid,S.tilewidth,S.tileheight,S.margin,S.spacing,S.properties);if(S.tileproperties){A.tileProperties=S.tileproperties}A.updateTileData(S.imagewidth,S.imageheight);P.push(A)}else{var E=new r.ImageCollection(S.name,S.firstgid,S.tilewidth,S.tileheight,S.margin,S.spacing,S.properties);for(var I in S.tiles){var _=S.tiles[I].image;var y=S.firstgid+parseInt(I,10);E.addImage(y,_)}T.push(E)}if(C){C.lastgid=S.firstgid-1}C=S}e.tilesets=P;e.imagecollections=T;var M={};var R={};function L(t,e){var i={};for(var s in e){var r=e[s];if(typeof t[r]!=="undefined"){i[r]=t[r]}}return i}for(var s=0;s<t.layers.length;s++){if(t.layers[s].type!=="objectgroup"){continue}var B=t.layers[s];M[B.name]=[];R[B.name]=[];for(var O=0,o=B.objects.length;O<o;O++){if(B.objects[O].gid){var k={gid:B.objects[O].gid,name:B.objects[O].name,type:B.objects[O].hasOwnProperty("type")?B.objects[O].type:"",x:B.objects[O].x,y:B.objects[O].y,visible:B.objects[O].visible,properties:B.objects[O].properties};if(B.objects[O].rotation){k.rotation=B.objects[O].rotation}M[B.name].push(k)}else if(B.objects[O].polyline){var k={name:B.objects[O].name,type:B.objects[O].type,x:B.objects[O].x,y:B.objects[O].y,width:B.objects[O].width,height:B.objects[O].height,visible:B.objects[O].visible,properties:B.objects[O].properties};if(B.objects[O].rotation){k.rotation=B.objects[O].rotation}k.polyline=[];for(var F=0;F<B.objects[O].polyline.length;F++){k.polyline.push([B.objects[O].polyline[F].x,B.objects[O].polyline[F].y])}R[B.name].push(k);M[B.name].push(k)}else if(B.objects[O].polygon){var k=L(B.objects[O],["name","type","x","y","visible","rotation","properties"]);k.polygon=[];for(var F=0;F<B.objects[O].polygon.length;F++){k.polygon.push([B.objects[O].polygon[F].x,B.objects[O].polygon[F].y])}M[B.name].push(k)}else if(B.objects[O].ellipse){var k=L(B.objects[O],["name","type","ellipse","x","y","width","height","visible","rotation","properties"]);M[B.name].push(k)}else{var k=L(B.objects[O],["name","type","x","y","width","height","visible","rotation","properties"]);k.rectangle=true;M[B.name].push(k)}}}e.objects=M;e.collision=R;e.tiles=[];for(var s=0;s<e.tilesets.length;s++){var S=e.tilesets[s];var c=S.tileMargin;var D=S.tileMargin;var U=0;var G=0;var N=0;for(var v=S.firstgid;v<S.firstgid+S.total;v++){e.tiles[v]=[c,D,s];c+=S.tileWidth+S.tileSpacing;U++;if(U===S.total){break}G++;if(G===S.columns){c=S.tileMargin;D+=S.tileHeight+S.tileSpacing;G=0;N++;if(N===S.rows){break}}}}var u;var b;var X;var S;for(var s=0;s<e.layers.length;s++){u=e.layers[s];S=null;for(var l=0;l<u.data.length;l++){d=u.data[l];for(var W=0;W<d.length;W++){b=d[W];if(b===null||b.index<0){continue}X=e.tiles[b.index][2];S=e.tilesets[X];if(S.tileProperties&&S.tileProperties[b.index-S.firstgid]){b.properties=r.Utils.mixin(S.tileProperties[b.index-S.firstgid],b.properties)}}}}return e}};r.Tileset=function(t,e,i,s,r,n,a){if(i===undefined||i<=0){i=32}if(s===undefined||s<=0){s=32}if(r===undefined){r=0}if(n===undefined){n=0}this.name=t;this.firstgid=e|0;this.tileWidth=i|0;this.tileHeight=s|0;this.tileMargin=r|0;this.tileSpacing=n|0;this.properties=a||{};this.image=null;this.rows=0;this.columns=0;this.total=0;this.drawCoords=[]};r.Tileset.prototype={draw:function(t,e,i,s){var r=s-this.firstgid<<1;if(r>=0&&r+1<this.drawCoords.length){t.drawImage(this.image,this.drawCoords[r],this.drawCoords[r+1],this.tileWidth,this.tileHeight,e,i,this.tileWidth,this.tileHeight)}},containsTileIndex:function(t){return t>=this.firstgid&&t<this.firstgid+this.total},setImage:function(t){this.image=t;this.updateTileData(t.width,t.height)},setSpacing:function(t,e){this.tileMargin=t|0;this.tileSpacing=e|0;if(this.image){this.updateTileData(this.image.width,this.image.height)}},updateTileData:function(t,e){var i=(e-this.tileMargin*2+this.tileSpacing)/(this.tileHeight+this.tileSpacing);var s=(t-this.tileMargin*2+this.tileSpacing)/(this.tileWidth+this.tileSpacing);if(i%1!==0||s%1!==0){console.warn("Phaser.Tileset - "+this.name+" image tile area is not an even multiple of tile size")}i=Math.floor(i);s=Math.floor(s);if(this.rows&&this.rows!==i||this.columns&&this.columns!==s){console.warn("Phaser.Tileset - actual and expected number of tile rows and columns differ")}this.rows=i;this.columns=s;this.total=i*s;this.drawCoords.length=0;var r=this.tileMargin;var n=this.tileMargin;for(var a=0;a<this.rows;a++){for(var o=0;o<this.columns;o++){this.drawCoords.push(r);this.drawCoords.push(n);r+=this.tileWidth+this.tileSpacing}r=this.tileMargin;n+=this.tileHeight+this.tileSpacing}}};r.Tileset.prototype.constructor=r.Tileset;r.Particle=function(t,e,i,s,n){r.Sprite.call(this,t,e,i,s,n);this.autoScale=false;this.scaleData=null;this._s=0;this.autoAlpha=false;this.alphaData=null;this._a=0};r.Particle.prototype=Object.create(r.Sprite.prototype);r.Particle.prototype.constructor=r.Particle;r.Particle.prototype.update=function(){if(this.autoScale){this._s--;if(this._s){this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y)}else{this.autoScale=false}}if(this.autoAlpha){this._a--;if(this._a){this.alpha=this.alphaData[this._a].v}else{this.autoAlpha=false}}};r.Particle.prototype.onEmit=function(){};r.Particle.prototype.setAlphaData=function(t){this.alphaData=t;this._a=t.length-1;this.alpha=this.alphaData[this._a].v;this.autoAlpha=true};r.Particle.prototype.setScaleData=function(t){this.scaleData=t;this._s=t.length-1;this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y);this.autoScale=true};r.Particle.prototype.reset=function(t,e,i){r.Component.Reset.prototype.reset.call(this,t,e,i);this.alpha=1;this.scale.set(1);this.autoScale=false;this.autoAlpha=false;return this};r.Particles=function(t){this.game=t;this.emitters={};this.ID=0};r.Particles.prototype={add:function(t){this.emitters[t.name]=t;return t},remove:function(t){delete this.emitters[t.name]},update:function(){for(var t in this.emitters){if(this.emitters[t].exists){this.emitters[t].update()}}}};r.Particles.prototype.constructor=r.Particles;r.Particles.Arcade={};r.Particles.Arcade.Emitter=function(t,e,i,s){this.maxParticles=s||50;r.Group.call(this,t);this.name="emitter"+this.game.particles.ID++;this.type=r.EMITTER;this.physicsType=r.GROUP;this.area=new r.Rectangle(e,i,1,1);this.minParticleSpeed=new r.Point(-100,-100);this.maxParticleSpeed=new r.Point(100,100);this.minParticleScale=1;this.maxParticleScale=1;this.scaleData=null;this.minRotation=-360;this.maxRotation=360;this.minParticleAlpha=1;this.maxParticleAlpha=1;this.alphaData=null;this.gravity=100;this.particleClass=r.Particle;this.particleDrag=new r.Point;this.angularDrag=0;this.frequency=100;this.lifespan=2e3;this.bounce=new r.Point;this.on=false;this.particleAnchor=new r.Point(.5,.5);this.blendMode=r.blendModes.NORMAL;this.emitX=e;this.emitY=i;this.autoScale=false;this.autoAlpha=false;this.particleBringToTop=false;this.particleSendToBack=false;this._minParticleScale=new r.Point(1,1);this._maxParticleScale=new r.Point(1,1);this._quantity=0;this._timer=0;this._counter=0;this._flowQuantity=0;this._flowTotal=0;this._explode=true;this._frames=null};r.Particles.Arcade.Emitter.prototype=Object.create(r.Group.prototype);r.Particles.Arcade.Emitter.prototype.constructor=r.Particles.Arcade.Emitter;r.Particles.Arcade.Emitter.prototype.update=function(){if(this.on&&this.game.time.time>=this._timer){this._timer=this.game.time.time+this.frequency*this.game.time.slowMotion;if(this._flowTotal!==0){if(this._flowQuantity>0){for(var t=0;t<this._flowQuantity;t++){if(this.emitParticle()){this._counter++;if(this._flowTotal!==-1&&this._counter>=this._flowTotal){this.on=false;break}}}}else{if(this.emitParticle()){this._counter++;if(this._flowTotal!==-1&&this._counter>=this._flowTotal){this.on=false}}}}else{if(this.emitParticle()){this._counter++;if(this._quantity>0&&this._counter>=this._quantity){this.on=false}}}}var t=this.children.length;while(t--){if(this.children[t].exists){this.children[t].update()}}};r.Particles.Arcade.Emitter.prototype.makeParticles=function(t,e,i,s,r){if(e===undefined){e=0}if(i===undefined){i=this.maxParticles}if(s===undefined){s=false}if(r===undefined){r=false}var n;var a=0;var o=t;var h=e;this._frames=e;if(i>this.maxParticles){this.maxParticles=i}while(a<i){if(Array.isArray(t)){o=this.game.rnd.pick(t)}if(Array.isArray(e)){h=this.game.rnd.pick(e)}n=new this.particleClass(this.game,0,0,o,h);this.game.physics.arcade.enable(n,false);if(s){n.body.checkCollision.any=true;n.body.checkCollision.none=false}else{n.body.checkCollision.none=true}n.body.collideWorldBounds=r;n.body.skipQuadTree=true;n.exists=false;n.visible=false;n.anchor.copyFrom(this.particleAnchor);this.add(n);a++}return this};r.Particles.Arcade.Emitter.prototype.kill=function(){this.on=false;this.alive=false;this.exists=false;return this};r.Particles.Arcade.Emitter.prototype.revive=function(){this.alive=true;this.exists=true;return this};r.Particles.Arcade.Emitter.prototype.explode=function(t,e){this._flowTotal=0;this.start(true,t,0,e,false);return this};r.Particles.Arcade.Emitter.prototype.flow=function(t,e,i,s,r){if(i===undefined||i===0){i=1}if(s===undefined){s=-1}if(r===undefined){r=true}if(i>this.maxParticles){i=this.maxParticles}this._counter=0;this._flowQuantity=i;this._flowTotal=s;if(r){this.start(true,t,e,i);this._counter+=i;this.on=true;this._timer=this.game.time.time+e*this.game.time.slowMotion}else{this.start(false,t,e,i)}return this};r.Particles.Arcade.Emitter.prototype.start=function(t,e,i,s,r){if(t===undefined){t=true}if(e===undefined){e=0}if(i===undefined||i===null){i=250}if(s===undefined){s=0}if(r===undefined){r=false}if(s>this.maxParticles){s=this.maxParticles}this.revive();this.visible=true;this.lifespan=e;this.frequency=i;if(t||r){for(var n=0;n<s;n++){this.emitParticle()}}else{this.on=true;this._quantity=s;this._counter=0;this._timer=this.game.time.time+i*this.game.time.slowMotion}return this};r.Particles.Arcade.Emitter.prototype.emitParticle=function(t,e,i,s){if(t===undefined){t=null}if(e===undefined){e=null}var r=this.getFirstExists(false);if(r===null){return false}var n=this.game.rnd;if(i!==undefined&&s!==undefined){r.loadTexture(i,s)}else if(i!==undefined){r.loadTexture(i)}var a=this.emitX;var o=this.emitY;if(t!==null){a=t}else if(this.width>1){a=n.between(this.left,this.right)}if(e!==null){o=e}else if(this.height>1){o=n.between(this.top,this.bottom)}r.reset(a,o);r.angle=0;r.lifespan=this.lifespan;if(this.particleBringToTop){this.bringToTop(r)}else if(this.particleSendToBack){this.sendToBack(r)}if(this.autoScale){r.setScaleData(this.scaleData)}else if(this.minParticleScale!==1||this.maxParticleScale!==1){r.scale.set(n.realInRange(this.minParticleScale,this.maxParticleScale))}else if(this._minParticleScale.x!==this._maxParticleScale.x||this._minParticleScale.y!==this._maxParticleScale.y){r.scale.set(n.realInRange(this._minParticleScale.x,this._maxParticleScale.x),n.realInRange(this._minParticleScale.y,this._maxParticleScale.y))}if(s===undefined){if(Array.isArray(this._frames)){r.frame=this.game.rnd.pick(this._frames)}else{r.frame=this._frames}}if(this.autoAlpha){r.setAlphaData(this.alphaData)}else{r.alpha=n.realInRange(this.minParticleAlpha,this.maxParticleAlpha)}r.blendMode=this.blendMode;var h=r.body;h.updateBounds();h.bounce.copyFrom(this.bounce);h.drag.copyFrom(this.particleDrag);h.velocity.x=n.between(this.minParticleSpeed.x,this.maxParticleSpeed.x);h.velocity.y=n.between(this.minParticleSpeed.y,this.maxParticleSpeed.y);h.angularVelocity=n.between(this.minRotation,this.maxRotation);h.gravity.y=this.gravity;h.angularDrag=this.angularDrag;r.onEmit();return true};r.Particles.Arcade.Emitter.prototype.destroy=function(){this.game.particles.remove(this);r.Group.prototype.destroy.call(this,true,false)};r.Particles.Arcade.Emitter.prototype.setSize=function(t,e){this.area.width=t;this.area.height=e;return this};r.Particles.Arcade.Emitter.prototype.setXSpeed=function(t,e){t=t||0;e=e||0;this.minParticleSpeed.x=t;this.maxParticleSpeed.x=e;return this};r.Particles.Arcade.Emitter.prototype.setYSpeed=function(t,e){t=t||0;e=e||0;this.minParticleSpeed.y=t;this.maxParticleSpeed.y=e;return this};r.Particles.Arcade.Emitter.prototype.setRotation=function(t,e){t=t||0;e=e||0;this.minRotation=t;this.maxRotation=e;return this};r.Particles.Arcade.Emitter.prototype.setAlpha=function(t,e,i,s,n){if(t===undefined){t=1}if(e===undefined){e=1}if(i===undefined){i=0}if(s===undefined){s=r.Easing.Linear.None}if(n===undefined){n=false}this.minParticleAlpha=t;this.maxParticleAlpha=e;this.autoAlpha=false;if(i>0&&t!==e){var a={v:t};var o=this.game.make.tween(a).to({v:e},i,s);o.yoyo(n);this.alphaData=o.generateData(60);this.alphaData.reverse();this.autoAlpha=true}return this};r.Particles.Arcade.Emitter.prototype.setScale=function(t,e,i,s,n,a,o){if(t===undefined){t=1}if(e===undefined){e=1}if(i===undefined){i=1}if(s===undefined){s=1}if(n===undefined){n=0}if(a===undefined){a=r.Easing.Linear.None}if(o===undefined){o=false}this.minParticleScale=1;this.maxParticleScale=1;this._minParticleScale.set(t,i);this._maxParticleScale.set(e,s);this.autoScale=false;if(n>0&&(t!==e||i!==s)){var h={x:t,y:i};var l=this.game.make.tween(h).to({x:e,y:s},n,a);l.yoyo(o);this.scaleData=l.generateData(60);this.scaleData.reverse();this.autoScale=true}return this};r.Particles.Arcade.Emitter.prototype.at=function(t){if(t.center){this.emitX=t.center.x;this.emitY=t.center.y}else{this.emitX=t.world.x+t.anchor.x*t.width;this.emitY=t.world.y+t.anchor.y*t.height}return this};Object.defineProperty(r.Particles.Arcade.Emitter.prototype,"width",{get:function(){return this.area.width},set:function(t){this.area.width=t}});Object.defineProperty(r.Particles.Arcade.Emitter.prototype,"height",{get:function(){return this.area.height},set:function(t){this.area.height=t}});Object.defineProperty(r.Particles.Arcade.Emitter.prototype,"x",{get:function(){return this.emitX},set:function(t){this.emitX=t}});Object.defineProperty(r.Particles.Arcade.Emitter.prototype,"y",{get:function(){return this.emitY},set:function(t){this.emitY=t}});Object.defineProperty(r.Particles.Arcade.Emitter.prototype,"left",{get:function(){return Math.floor(this.x-this.area.width/2)}});Object.defineProperty(r.Particles.Arcade.Emitter.prototype,"right",{get:function(){return Math.floor(this.x+this.area.width/2)}});Object.defineProperty(r.Particles.Arcade.Emitter.prototype,"top",{get:function(){return Math.floor(this.y-this.area.height/2)}});Object.defineProperty(r.Particles.Arcade.Emitter.prototype,"bottom",{get:function(){return Math.floor(this.y+this.area.height/2)}});r.Weapon=function(t,e){r.Plugin.call(this,t,e);this.bullets=null;this.autoExpandBulletsGroup=false;this.autofire=false;this.shots=0;this.fireLimit=0;this.fireRate=100;this.fireRateVariance=0;this.fireFrom=new r.Rectangle(0,0,1,1);this.fireAngle=r.ANGLE_UP;this.bulletInheritSpriteSpeed=false;this.bulletAnimation="";this.bulletFrameRandom=false;this.bulletFrameCycle=false;this.bulletWorldWrap=false;this.bulletWorldWrapPadding=0;this.bulletAngleOffset=0;this.bulletAngleVariance=0;this.bulletSpeed=200;this.bulletSpeedVariance=0;this.bulletLifespan=0;this.bulletKillDistance=0;this.bulletGravity=new r.Point(0,0);this.bulletRotateToVelocity=false;this.bulletKey="";this.bulletFrame="";this._bulletClass=r.Bullet;this._bulletCollideWorldBounds=false;this._bulletKillType=r.Weapon.KILL_WORLD_BOUNDS;this._data={customBody:false,width:0,height:0,offsetX:0,offsetY:0};this.bounds=new r.Rectangle;this.bulletBounds=t.world.bounds;this.bulletFrames=[];this.bulletFrameIndex=0;this.anims={};this.onFire=new r.Signal;this.onKill=new r.Signal;this.onFireLimit=new r.Signal;this.trackedSprite=null;this.trackedPointer=null;this.trackRotation=false;this.trackOffset=new r.Point;this._nextFire=0;this._rotatedPoint=new r.Point};r.Weapon.prototype=Object.create(r.Plugin.prototype);r.Weapon.prototype.constructor=r.Weapon;r.Weapon.KILL_NEVER=0;r.Weapon.KILL_LIFESPAN=1;r.Weapon.KILL_DISTANCE=2;r.Weapon.KILL_WEAPON_BOUNDS=3;r.Weapon.KILL_CAMERA_BOUNDS=4;r.Weapon.KILL_WORLD_BOUNDS=5;r.Weapon.KILL_STATIC_BOUNDS=6;r.Weapon.prototype.createBullets=function(t,e,i,s){if(t===undefined){t=1}if(s===undefined){s=this.game.world}if(!this.bullets){this.bullets=this.game.add.physicsGroup(r.Physics.ARCADE,s);this.bullets.classType=this._bulletClass}if(t!==0){if(t===-1){this.autoExpandBulletsGroup=true;t=1}this.bullets.createMultiple(t,e,i);this.bullets.setAll("data.bulletManager",this);this.bulletKey=e;this.bulletFrame=i}return this};r.Weapon.prototype.forEach=function(t,e){this.bullets.forEachExists(t,e,arguments);return this};r.Weapon.prototype.pauseAll=function(){this.bullets.setAll("body.enable",false);return this};r.Weapon.prototype.resumeAll=function(){this.bullets.setAll("body.enable",true);return this};r.Weapon.prototype.killAll=function(){this.bullets.callAllExists("kill",true);this.bullets.setAll("body.enable",true);return this};r.Weapon.prototype.resetShots=function(t){this.shots=0;if(t!==undefined){this.fireLimit=t}return this};r.Weapon.prototype.destroy=function(){this.parent.remove(this,false);this.bullets.destroy();this.game=null;this.parent=null;this.active=false;this.visible=false};r.Weapon.prototype.update=function(){if(this._bulletKillType===r.Weapon.KILL_WEAPON_BOUNDS){if(this.trackedSprite){this.trackedSprite.updateTransform();this.bounds.centerOn(this.trackedSprite.worldPosition.x,this.trackedSprite.worldPosition.y)}else if(this.trackedPointer){this.bounds.centerOn(this.trackedPointer.worldX,this.trackedPointer.worldY)}}if(this.autofire){this.fire()}};r.Weapon.prototype.trackSprite=function(t,e,i,s){if(e===undefined){e=0}if(i===undefined){i=0}if(s===undefined){s=false}this.trackedPointer=null;this.trackedSprite=t;this.trackRotation=s;this.trackOffset.set(e,i);return this};r.Weapon.prototype.trackPointer=function(t,e,i){if(t===undefined){t=this.game.input.activePointer}if(e===undefined){e=0}if(i===undefined){i=0}this.trackedPointer=t;this.trackedSprite=null;this.trackRotation=false;this.trackOffset.set(e,i);return this};r.Weapon.prototype.fire=function(t,e,i){if(this.game.time.now<this._nextFire||this.fireLimit>0&&this.shots===this.fireLimit){return false}var s=this.bulletSpeed;if(this.bulletSpeedVariance!==0){s+=r.Math.between(-this.bulletSpeedVariance,this.bulletSpeedVariance)}if(t){if(this.fireFrom.width>1){this.fireFrom.centerOn(t.x,t.y)}else{this.fireFrom.x=t.x;this.fireFrom.y=t.y}}else if(this.trackedSprite){if(this.trackRotation){this._rotatedPoint.set(this.trackedSprite.world.x+this.trackOffset.x,this.trackedSprite.world.y+this.trackOffset.y);this._rotatedPoint.rotate(this.trackedSprite.world.x,this.trackedSprite.world.y,this.trackedSprite.rotation);if(this.fireFrom.width>1){this.fireFrom.centerOn(this._rotatedPoint.x,this._rotatedPoint.y)}else{this.fireFrom.x=this._rotatedPoint.x;this.fireFrom.y=this._rotatedPoint.y}}else{if(this.fireFrom.width>1){this.fireFrom.centerOn(this.trackedSprite.world.x+this.trackOffset.x,this.trackedSprite.world.y+this.trackOffset.y)}else{this.fireFrom.x=this.trackedSprite.world.x+this.trackOffset.x;this.fireFrom.y=this.trackedSprite.world.y+this.trackOffset.y}}if(this.bulletInheritSpriteSpeed){s+=this.trackedSprite.body.speed}}else if(this.trackedPointer){if(this.fireFrom.width>1){this.fireFrom.centerOn(this.trackedPointer.world.x+this.trackOffset.x,this.trackedPointer.world.y+this.trackOffset.y)}else{this.fireFrom.x=this.trackedPointer.world.x+this.trackOffset.x;this.fireFrom.y=this.trackedPointer.world.y+this.trackOffset.y}}var n=this.fireFrom.width>1?this.fireFrom.randomX:this.fireFrom.x;var a=this.fireFrom.height>1?this.fireFrom.randomY:this.fireFrom.y;var o=this.trackRotation?this.trackedSprite.angle:this.fireAngle;if(e!==undefined&&i!==undefined){o=this.game.math.radToDeg(Math.atan2(i-a,e-n))}if(this.bulletAngleVariance!==0){o+=r.Math.between(-this.bulletAngleVariance,this.bulletAngleVariance)}var h=0;var l=0;if(o===0||o===180){h=Math.cos(this.game.math.degToRad(o))*s}else if(o===90||o===270){l=Math.sin(this.game.math.degToRad(o))*s}else{h=Math.cos(this.game.math.degToRad(o))*s;l=Math.sin(this.game.math.degToRad(o))*s}var u=null;if(this.autoExpandBulletsGroup){u=this.bullets.getFirstExists(false,true,n,a,this.bulletKey,this.bulletFrame);u.data.bulletManager=this}else{u=this.bullets.getFirstExists(false)}if(u){u.reset(n,a);u.data.fromX=n;u.data.fromY=a;u.data.killType=this.bulletKillType;u.data.killDistance=this.bulletKillDistance;u.data.rotateToVelocity=this.bulletRotateToVelocity;if(this.bulletKillType===r.Weapon.KILL_LIFESPAN){u.lifespan=this.bulletLifespan}u.angle=o+this.bulletAngleOffset;if(this.bulletAnimation!==""){if(u.animations.getAnimation(this.bulletAnimation)===null){var c=this.anims[this.bulletAnimation];u.animations.add(c.name,c.frames,c.frameRate,c.loop,c.useNumericIndex)}u.animations.play(this.bulletAnimation)}else{if(this.bulletFrameCycle){u.frame=this.bulletFrames[this.bulletFrameIndex];this.bulletFrameIndex++;if(this.bulletFrameIndex>=this.bulletFrames.length){this.bulletFrameIndex=0}}else if(this.bulletFrameRandom){u.frame=this.bulletFrames[Math.floor(Math.random()*this.bulletFrames.length)]}}if(u.data.bodyDirty){if(this._data.customBody){u.body.setSize(this._data.width,this._data.height,this._data.offsetX,this._data.offsetY)}u.body.collideWorldBounds=this.bulletCollideWorldBounds;u.data.bodyDirty=false}u.body.velocity.set(h,l);u.body.gravity.set(this.bulletGravity.x,this.bulletGravity.y);if(this.bulletSpeedVariance!==0){var d=this.fireRate;d+=r.Math.between(-this.fireRateVariance,this.fireRateVariance);if(d<0){d=0}this._nextFire=this.game.time.now+d}else{this._nextFire=this.game.time.now+this.fireRate}this.shots++;this.onFire.dispatch(u,this,s);if(this.fireLimit>0&&this.shots===this.fireLimit){this.onFireLimit.dispatch(this,this.fireLimit)}}return u};r.Weapon.prototype.fireAtPointer=function(t){if(t===undefined){t=this.game.input.activePointer}return this.fire(null,t.worldX,t.worldY)};r.Weapon.prototype.fireAtSprite=function(t){return this.fire(null,t.world.x,t.world.y)};r.Weapon.prototype.fireAtXY=function(t,e){return this.fire(null,t,e)};r.Weapon.prototype.setBulletBodyOffset=function(t,e,i,s){if(i===undefined){i=0}if(s===undefined){s=0}this._data.customBody=true;this._data.width=t;this._data.height=e;this._data.offsetX=i;this._data.offsetY=s;this.bullets.callAll("body.setSize","body",t,e,i,s);this.bullets.setAll("data.bodyDirty",false);return this};r.Weapon.prototype.setBulletFrames=function(t,e,i,s){if(i===undefined){i=true}if(s===undefined){s=false}this.bulletFrames=r.ArrayUtils.numberArray(t,e);this.bulletFrameIndex=0;this.bulletFrameCycle=i;this.bulletFrameRandom=s;return this};r.Weapon.prototype.addBulletAnimation=function(t,e,i,s,r){this.anims[t]={name:t,frames:e,frameRate:i,loop:s,useNumericIndex:r};this.bullets.callAll("animations.add","animations",t,e,i,s,r);this.bulletAnimation=t;return this};r.Weapon.prototype.debug=function(t,e,i){if(t===undefined){t=16}if(e===undefined){e=32}if(i===undefined){i=false}this.game.debug.text("Weapon Plugin",t,e);this.game.debug.text("Bullets Alive: "+this.bullets.total+" - Total: "+this.bullets.length,t,e+24);if(i){this.bullets.forEachExists(this.game.debug.body,this.game.debug,"rgba(255, 0, 255, 0.8)")}};Object.defineProperty(r.Weapon.prototype,"bulletClass",{get:function(){return this._bulletClass},set:function(t){this._bulletClass=t;this.bullets.classType=this._bulletClass}});Object.defineProperty(r.Weapon.prototype,"bulletKillType",{get:function(){return this._bulletKillType},set:function(t){switch(t){case r.Weapon.KILL_STATIC_BOUNDS:case r.Weapon.KILL_WEAPON_BOUNDS:this.bulletBounds=this.bounds;break;case r.Weapon.KILL_CAMERA_BOUNDS:this.bulletBounds=this.game.camera.view;break;case r.Weapon.KILL_WORLD_BOUNDS:this.bulletBounds=this.game.world.bounds;break}this._bulletKillType=t}});Object.defineProperty(r.Weapon.prototype,"bulletCollideWorldBounds",{get:function(){return this._bulletCollideWorldBounds},set:function(t){this._bulletCollideWorldBounds=t;this.bullets.setAll("body.collideWorldBounds",t);this.bullets.setAll("data.bodyDirty",false)}});Object.defineProperty(r.Weapon.prototype,"x",{get:function(){return this.fireFrom.x},set:function(t){this.fireFrom.x=t}});Object.defineProperty(r.Weapon.prototype,"y",{get:function(){return this.fireFrom.y},set:function(t){this.fireFrom.y=t}});r.Bullet=function(t,e,i,s,n){r.Sprite.call(this,t,e,i,s,n);this.anchor.set(.5);this.data={bulletManager:null,fromX:0,fromY:0,bodyDirty:true,rotateToVelocity:false,killType:0,killDistance:0}};r.Bullet.prototype=Object.create(r.Sprite.prototype);r.Bullet.prototype.constructor=r.Bullet;r.Bullet.prototype.kill=function(){this.alive=false;this.exists=false;this.visible=false;this.data.bulletManager.onKill.dispatch(this);return this};r.Bullet.prototype.update=function(){if(!this.exists){return}if(this.data.killType>r.Weapon.KILL_LIFESPAN){if(this.data.killType===r.Weapon.KILL_DISTANCE){if(this.game.physics.arcade.distanceToXY(this,this.data.fromX,this.data.fromY,true)>this.data.killDistance){this.kill()}}else{if(!this.data.bulletManager.bulletBounds.intersects(this)){this.kill()}}}if(this.data.rotateToVelocity){this.rotation=Math.atan2(this.body.velocity.y,this.body.velocity.x)}if(this.data.bulletManager.bulletWorldWrap){this.game.world.wrap(this,this.data.bulletManager.bulletWorldWrapPadding)}};r.Video=function(t,e,i){if(e===undefined){e=null}if(i===undefined){i=null}this.game=t;this.key=e;this.width=0;this.height=0;this.type=r.VIDEO;this.disableTextureUpload=false;this.touchLocked=false;this.onPlay=new r.Signal;this.onChangeSource=new r.Signal;this.onComplete=new r.Signal;this.onAccess=new r.Signal;this.onError=new r.Signal;this.onTimeout=new r.Signal;this.timeout=15e3;this._timeOutID=null;this.video=null;this.videoStream=null;this.isStreaming=false;this.retryLimit=20;this.retry=0;this.retryInterval=500;this._retryID=null;this._codeMuted=false;this._muted=false;this._codePaused=false;this._paused=false;this._pending=false;this._autoplay=false;this._endCallback=null;this._playCallback=null;if(e&&this.game.cache.checkVideoKey(e)){var s=this.game.cache.getVideo(e);if(s.isBlob){this.createVideoFromBlob(s.data)}else{this.video=s.data}this.width=this.video.videoWidth;this.height=this.video.videoHeight}else if(i){this.createVideoFromURL(i,false)}if(this.video&&!i){this.baseTexture=new PIXI.BaseTexture(this.video);this.baseTexture.forceLoaded(this.width,this.height)}else{this.baseTexture=new PIXI.BaseTexture(r.Cache.DEFAULT.baseTexture.source);this.baseTexture.forceLoaded(this.width,this.height)}this.texture=new PIXI.Texture(this.baseTexture);this.textureFrame=new r.Frame(0,0,0,this.width,this.height,"video");this.texture.setFrame(this.textureFrame);this.texture.valid=false;if(e!==null&&this.video){this.texture.valid=this.video.canplay}this.snapshot=null;if(r.BitmapData){this.snapshot=new r.BitmapData(this.game,"",this.width,this.height)}if(!this.game.device.cocoonJS&&(this.game.device.iOS||this.game.device.android)||window["PhaserGlobal"]&&window["PhaserGlobal"].fakeiOSTouchLock){this.setTouchLock()}else{if(s){s.locked=false}}};r.Video.prototype={connectToMediaStream:function(t,e){if(t&&e){this.video=t;this.videoStream=e;this.isStreaming=true;this.baseTexture.source=this.video;this.updateTexture(null,this.video.videoWidth,this.video.videoHeight);this.onAccess.dispatch(this)}return this},startMediaStream:function(t,e,i){if(t===undefined){t=false}if(e===undefined){e=null}if(i===undefined){i=null}if(!this.game.device.getUserMedia){this.onError.dispatch(this,"No getUserMedia");return false}if(this.videoStream!==null){if(this.videoStream["active"]){this.videoStream.active=false}else{this.videoStream.stop()}}this.removeVideoElement();this.video=document.createElement("video");this.video.setAttribute("autoplay","autoplay");if(e!==null){this.video.width=e}if(i!==null){this.video.height=i}this._timeOutID=window.setTimeout(this.getUserMediaTimeout.bind(this),this.timeout);try{navigator.getUserMedia({audio:t,video:true},this.getUserMediaSuccess.bind(this),this.getUserMediaError.bind(this))}catch(t){this.getUserMediaError(t)}return this},getUserMediaTimeout:function(){clearTimeout(this._timeOutID);this.onTimeout.dispatch(this)},getUserMediaError:function(t){clearTimeout(this._timeOutID);this.onError.dispatch(this,t)},getUserMediaSuccess:function(t){clearTimeout(this._timeOutID);this.videoStream=t;if(this.video.mozSrcObject!==undefined){this.video.mozSrcObject=t}else{this.video.src=window.URL&&window.URL.createObjectURL(t)||t}var e=this;this.video.onloadeddata=function(){var t=10;function i(){if(t>0){if(e.video.videoWidth>0){var s=e.video.videoWidth;var r=e.video.videoHeight;if(isNaN(e.video.videoHeight)){r=s/(4/3)}e.video.play();e.isStreaming=true;e.baseTexture.source=e.video;e.updateTexture(null,s,r);e.onAccess.dispatch(e)}else{window.setTimeout(i,500)}}else{console.warn("Unable to connect to video stream. Webcam error?")}t--}i()}},createVideoFromBlob:function(t){var e=this;this.video=document.createElement("video");this.video.controls=false;this.video.setAttribute("autoplay","autoplay");this.video.addEventListener("loadeddata",function(t){e.updateTexture(t)},true);this.video.src=window.URL.createObjectURL(t);this.video.canplay=true;return this},createVideoFromURL:function(t,e){if(e===undefined){e=false}if(this.texture){this.texture.valid=false}this.video=document.createElement("video");this.video.controls=false;if(e){this.video.setAttribute("autoplay","autoplay")}this.video.src=t;this.video.canplay=true;this.video.load();this.retry=this.retryLimit;this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval);this.key=t;return this},updateTexture:function(t,e,i){var s=false;if(e===undefined||e===null){e=this.video.videoWidth;s=true}if(i===undefined||i===null){i=this.video.videoHeight}this.width=e;this.height=i;if(this.baseTexture.source!==this.video){this.baseTexture.source=this.video}this.baseTexture.forceLoaded(e,i);this.texture.frame.resize(e,i);this.texture.width=e;this.texture.height=i;this.texture.valid=true;if(this.snapshot){this.snapshot.resize(e,i)}if(s&&this.key!==null){this.onChangeSource.dispatch(this,e,i);if(this._autoplay){this.video.play();this.onPlay.dispatch(this,this.loop,this.playbackRate)}}},complete:function(){this.onComplete.dispatch(this)},play:function(t,e){if(t===undefined){t=false}if(e===undefined){e=1}if(this.game.sound.onMute){this.game.sound.onMute.add(this.setMute,this);this.game.sound.onUnMute.add(this.unsetMute,this);if(this.game.sound.mute){this.setMute()}}this.game.onPause.add(this.setPause,this);this.game.onResume.add(this.setResume,this);this._endCallback=this.complete.bind(this);this.video.addEventListener("ended",this._endCallback,true);this.video.addEventListener("webkitendfullscreen",this._endCallback,true);if(t){this.video.loop="loop"}else{this.video.loop=""}this.video.playbackRate=e;if(this.touchLocked){this._pending=true}else{this._pending=false;if(this.key!==null){if(this.video.readyState!==4){this.retry=this.retryLimit;this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval)}else{this._playCallback=this.playHandler.bind(this);this.video.addEventListener("playing",this._playCallback,true)}}this.video.play();this.onPlay.dispatch(this,t,e)}return this},playHandler:function(){this.video.removeEventListener("playing",this._playCallback,true);this.updateTexture()},stop:function(){if(this.game.sound.onMute){this.game.sound.onMute.remove(this.setMute,this);this.game.sound.onUnMute.remove(this.unsetMute,this)}this.game.onPause.remove(this.setPause,this);this.game.onResume.remove(this.setResume,this);if(this.isStreaming){if(this.video.mozSrcObject){this.video.mozSrcObject.stop();this.video.src=null}else{this.video.src="";if(this.videoStream["active"]){this.videoStream.active=false}else{if(this.videoStream.getTracks){this.videoStream.getTracks().forEach(function(t){t.stop()})}else{this.videoStream.stop()}}}this.videoStream=null;this.isStreaming=false}else{this.video.removeEventListener("ended",this._endCallback,true);this.video.removeEventListener("webkitendfullscreen",this._endCallback,true);this.video.removeEventListener("playing",this._playCallback,true);if(this.touchLocked){this._pending=false}else{this.video.pause()}}return this},add:function(t){if(Array.isArray(t)){for(var e=0;e<t.length;e++){if(t[e]["loadTexture"]){t[e].loadTexture(this)}}}else{t.loadTexture(this)}return this},addToWorld:function(t,e,i,s,r,n){r=r||1;n=n||1;var a=this.game.add.image(t,e,this);a.anchor.set(i,s);a.scale.set(r,n);return a},render:function(){if(!this.disableTextureUpload&&this.playing){this.baseTexture.dirty()}},setMute:function(){if(this._muted){return}this._muted=true;this.video.muted=true},unsetMute:function(){if(!this._muted||this._codeMuted){return}this._muted=false;this.video.muted=false},setPause:function(){if(this._paused||this.touchLocked){return}this._paused=true;this.video.pause()},setResume:function(){if(!this._paused||this._codePaused||this.touchLocked){return}this._paused=false;if(!this.video.ended){this.video.play()}},changeSource:function(t,e){if(e===undefined){e=true}this.texture.valid=false;this.video.pause();this.retry=this.retryLimit;this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval);this.video.src=t;this.video.load();this._autoplay=e;if(!e){this.paused=true}return this},checkVideoProgress:function(){if(this.video.readyState===4){this.updateTexture()}else{this.retry--;if(this.retry>0){this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval)}else{console.warn("Phaser.Video: Unable to start downloading video in time",this.isStreaming)}}},setTouchLock:function(){this.game.input.touch.addTouchLockCallback(this.unlock,this);this.touchLocked=true},unlock:function(){this.touchLocked=false;this.video.play();this.onPlay.dispatch(this,this.loop,this.playbackRate);if(this.key){var t=this.game.cache.getVideo(this.key);if(t&&!t.isBlob){t.locked=false}}return true},grab:function(t,e,i){if(t===undefined){t=false}if(e===undefined){e=1}if(i===undefined){i=null}if(this.snapshot===null){console.warn("Video.grab cannot run because Phaser.BitmapData is unavailable");return}if(t){this.snapshot.cls()}this.snapshot.copy(this.video,0,0,this.width,this.height,0,0,this.width,this.height,0,0,0,1,1,e,i);return this.snapshot},removeVideoElement:function(){if(!this.video){return}if(this.video.parentNode){this.video.parentNode.removeChild(this.video)}while(this.video.hasChildNodes()){this.video.removeChild(this.video.firstChild)}this.video.removeAttribute("autoplay");this.video.removeAttribute("src");this.video=null},destroy:function(){this.stop();this.removeVideoElement();if(this.touchLocked){this.game.input.touch.removeTouchLockCallback(this.unlock,this)}if(this._retryID){window.clearTimeout(this._retryID)}}};Object.defineProperty(r.Video.prototype,"currentTime",{get:function(){return this.video?this.video.currentTime:0},set:function(t){this.video.currentTime=t}});Object.defineProperty(r.Video.prototype,"duration",{get:function(){return this.video?this.video.duration:0}});Object.defineProperty(r.Video.prototype,"progress",{get:function(){return this.video?this.video.currentTime/this.video.duration:0}});Object.defineProperty(r.Video.prototype,"mute",{get:function(){return this._muted},set:function(t){t=t||null;if(t){if(this._muted){return}this._codeMuted=true;this.setMute()}else{if(!this._muted){return}this._codeMuted=false;this.unsetMute()}}});Object.defineProperty(r.Video.prototype,"paused",{get:function(){return this._paused},set:function(t){t=t||null;if(this.touchLocked){return}if(t){if(this._paused){return}this._codePaused=true;this.setPause()}else{if(!this._paused){return}this._codePaused=false;this.setResume()}}});Object.defineProperty(r.Video.prototype,"volume",{get:function(){return this.video?this.video.volume:1},set:function(t){if(t<0){t=0}else if(t>1){t=1}if(this.video){this.video.volume=t}}});Object.defineProperty(r.Video.prototype,"playbackRate",{get:function(){return this.video?this.video.playbackRate:1},set:function(t){if(this.video){this.video.playbackRate=t}}});Object.defineProperty(r.Video.prototype,"loop",{get:function(){return this.video?this.video.loop:false},set:function(t){if(t&&this.video){this.video.loop="loop"}else if(this.video){this.video.loop=""}}});Object.defineProperty(r.Video.prototype,"playing",{get:function(){return!(this.video.paused&&this.video.ended)}});r.Video.prototype.constructor=r.Video;if(PIXI.blendModes===undefined){PIXI.blendModes=r.blendModes}if(PIXI.scaleModes===undefined){PIXI.scaleModes=r.scaleModes}if(PIXI.Texture.emptyTexture===undefined){PIXI.Texture.emptyTexture=new PIXI.Texture(new PIXI.BaseTexture)}if(PIXI.DisplayObject._tempMatrix===undefined){PIXI.DisplayObject._tempMatrix=new PIXI.Matrix}if(PIXI.RenderTexture.tempMatrix===undefined){PIXI.RenderTexture.tempMatrix=new PIXI.Matrix}if(PIXI.Graphics&&PIXI.Graphics.POLY===undefined){PIXI.Graphics.POLY=r.POLYGON;PIXI.Graphics.RECT=r.RECTANGLE;PIXI.Graphics.CIRC=r.CIRCLE;PIXI.Graphics.ELIP=r.ELLIPSE;PIXI.Graphics.RREC=r.ROUNDEDRECTANGLE}PIXI.TextureSilentFail=true;if(true){if(true&&t.exports){e=t.exports=r}e.Phaser=r}else{}return r}).call(this)}).call(this,i(305))}}]);
//# sourceMappingURL=phaser.83617fe5e2.min.js.map